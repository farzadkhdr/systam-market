<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>سیستەمی فرۆشتی ئەلکترۆنیات</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* هەموو CSS لێرە */
        :root {
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --secondary: #7209b7;
            --success: #4cc9f0;
            --danger: #f72585;
            --warning: #f8961e;
            --info: #4895ef;
            --dark: #212529;
            --light: #f8f9fa;
            --gray: #6c757d;
            --gray-light: #e9ecef;
            --border-radius: 10px;
            --box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--dark);
            min-height: 100vh;
            direction: rtl;
            overflow-x: hidden;
            height: 100vh;
        }
        
        /* شێوازی پەڕەی چوونەژوورەوە */
        #loginPage {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            padding: 20px;
            animation: gradientBG 10s ease infinite;
            background-size: 400% 400%;
        }
        
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .login-container {
            width: 100%;
            max-width: 450px;
            margin: 0 auto;
        }
        
        .login-box {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 40px 30px;
            position: relative;
            overflow: hidden;
            animation: fadeIn 0.8s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .login-header .logo {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .login-header h2 {
            color: var(--dark);
            margin-bottom: 10px;
            font-size: 1.8rem;
        }
        
        .login-header p {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .login-form {
            margin-top: 20px;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--dark);
            font-weight: 500;
        }
        
        .input-group input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--gray-light);
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
        }
        
        .input-group input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }
        
        .input-group.remember {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .input-group.remember input {
            width: auto;
            margin-left: 10px;
        }
        
        .login-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .login-btn:hover {
            background: linear-gradient(to right, var(--primary-dark), #6310a3);
            transform: translateY(-3px);
            box-shadow: 0 7px 20px rgba(0,0,0,0.15);
        }
        
        .login-btn i {
            margin-left: 10px;
        }
        
        .login-footer {
            margin-top: 20px;
            text-align: center;
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .login-footer a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
        }
        
        .login-footer a:hover {
            text-decoration: underline;
        }
        
        .login-animation {
            display: flex;
            justify-content: center;
            margin-top: 30px;
            gap: 15px;
        }
        
        .circle {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background-color: var(--primary);
            animation: bounce 1.5s infinite;
        }
        
        .circle:nth-child(2) {
            animation-delay: 0.2s;
            background-color: var(--secondary);
        }
        
        .circle:nth-child(3) {
            animation-delay: 0.4s;
            background-color: var(--success);
        }
        
        @keyframes bounce {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-15px);
            }
        }
        
        /* شێوازی پەڕەی سەرەکی */
        .container {
            display: flex;
            min-height: 100vh;
            display: none; /* شاردراوە بۆ دەستپێک */
        }
        
        /* بارەگەی لای چەپ - مێنیو */
        .sidebar {
            width: 250px;
            background: linear-gradient(180deg, var(--dark) 0%, #343a40 100%);
            color: white;
            padding: 20px 0;
            transition: var(--transition);
            position: fixed;
            height: 100vh;
            z-index: 100;
            box-shadow: 3px 0 15px rgba(0,0,0,0.1);
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--primary) rgba(255,255,255,0.1);
        }
        
        .sidebar::-webkit-scrollbar {
            width: 6px;
        }
        
        .sidebar::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
        }
        
        .sidebar::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }
        
        .sidebar::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }
        
        .sidebar.collapsed {
            transform: translateX(-250px);
        }
        
        .sidebar.active {
            transform: translateX(0);
        }
        
        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .sidebar-header h3 {
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .close-sidebar {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            display: none;
        }
        
        .nav-menu {
            list-style: none;
        }
        
        .nav-item {
            margin-bottom: 5px;
        }
        
        .nav-link {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            transition: var(--transition);
            border-right: 3px solid transparent;
        }
        
        .nav-link:hover, .nav-link.active {
            background-color: rgba(255,255,255,0.1);
            color: white;
            border-right-color: var(--primary);
        }
        
        .nav-link i {
            margin-left: 10px;
            font-size: 1.2rem;
            width: 25px;
        }
        
        /* بەشی سەرەوە */
        .header {
            height: 70px;
            background-color: white;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            display: flex;
            align-items: center;
            padding: 0 30px;
            position: fixed;
            top: 0;
            right: 0;
            left: 250px;
            z-index: 99;
            transition: var(--transition);
        }
        
        .header.collapsed {
            left: 0;
        }
        
        .header-left {
            display: flex;
            align-items: center;
        }
        
        .menu-toggle {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--dark);
            cursor: pointer;
            margin-left: 20px;
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--primary);
            text-shadow: 1px 1px 3px rgba(0,0,0,0.1);
        }
        
        .header-center {
            flex: 1;
            text-align: center;
        }
        
        .header-center h1 {
            font-size: 1.5rem;
            color: var(--dark);
        }
        
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            background-color: var(--gray-light);
            padding: 8px 15px;
            border-radius: 30px;
            margin-left: 15px;
        }
        
        .user-info i {
            margin-left: 8px;
            color: var(--primary);
            font-size: 1.3rem;
        }
        
        .logout-btn {
            background-color: var(--danger);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
        }
        
        .logout-btn:hover {
            background-color: #e11575;
        }
        
        /* بەشی ناوەڕاست */
        .main-content {
            flex: 1;
            padding: 100px 30px 30px;
            margin-right: 250px;
            transition: var(--transition);
            background-color: #f5f7fa;
            min-height: 100vh;
            overflow-y: auto;
            height: calc(100vh - 70px);
            margin-top: 70px;
        }
        
        .main-content::-webkit-scrollbar {
            width: 8px;
        }
        
        .main-content::-webkit-scrollbar-track {
            background: var(--gray-light);
            border-radius: 10px;
        }
        
        .main-content::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }
        
        .main-content::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }
        
        .main-content.collapsed {
            margin-right: 0;
        }
        
        /* بەشەکانی ناوەڕاست */
        .content-section {
            display: none;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        
        .content-section.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }
        
        /* کارتەکانی داشبۆرد */
        .section-title {
            font-size: 1.8rem;
            margin-bottom: 25px;
            color: var(--dark);
            position: relative;
            padding-bottom: 10px;
        }
        
        .section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            right: 0;
            width: 80px;
            height: 3px;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            border-radius: 3px;
        }
        
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .card {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 25px;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.12);
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(to right, var(--primary), var(--secondary));
        }
        
        .card-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: white;
        }
        
        .card-1 .card-icon { background-color: var(--primary); }
        .card-2 .card-icon { background-color: var(--success); }
        .card-3 .card-icon { background-color: var(--warning); }
        .card-4 .card-icon { background-color: var(--danger); }
        .card-5 .card-icon { background-color: var(--secondary); }
        .card-6 .card-icon { background-color: var(--info); }
        .card-7 .card-icon { background-color: #9d4edd; }
        /* لە ناو CSS زیاد بکە */
.card-8 .card-icon { background-color: #9d4edd; }
.card-9 .card-icon { background-color: #ff6b6b; }
.card-10 .card-icon { background-color: #4ecdc4; }
        .card h3 {
            font-size: 1.1rem;
            color: var(--gray);
            margin-bottom: 10px;
        }
        
        .card-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 15px;
        }
        
        .card-change {
            font-size: 0.9rem;
            display: flex;
            align-items: center;
        }
        
        .card-change.positive {
            color: #28a745;
        }
        
        .card-change.negative {
            color: var(--danger);
        }
        
        /* رەنگەکانی بڕی پارە بەپێی جۆری قەرز */
        .item-value.debt-positive {
            color: #f72585; /* سۆر - کاتێ کەس قەرزداری منە */
            font-weight: 600;
        }
        
        .item-value.debt-negative {
            color: #212529; /* رەش - کاتێ من قەرزداری شەریکم */
            font-weight: 600;
        }
        
        .item-value.debt-zero {
            color: #6c757d; /* خۆڵەمێشی - بێ قەرز */
            font-weight: 600;
        }
        
        .item-value.debt-payment {
            color: #28a745; /* سەوز - پارەواسڵکردن */
            font-weight: 600;
        }
        
        .item-value.debt-expense {
            color: #f8961e; /* پرتەقاڵی - سەرفکردن */
            font-weight: 600;
        }
        
        /* لیستەکان */
        .lists-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .list-box {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 25px;
        }
        
        .list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--gray-light);
        }
        
        .list-header h3 {
            font-size: 1.3rem;
            color: var(--dark);
        }
        
        .list-actions button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            margin-left: 10px;
        }
        
        .list-actions button:hover {
            background-color: var(--primary-dark);
        }
        
        .list-items {
            list-style: none;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .list-item {
            padding: 15px;
            border-bottom: 1px solid var(--gray-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
        }
        
        .list-item:hover {
            background-color: var(--gray-light);
        }
        
        .item-name {
            font-weight: 500;
            color: var(--dark);
        }
        
        .item-value {
            font-weight: 600;
            color: var(--primary);
        }
        
        /* بەشی فرۆشتن و کڕین (نوێکراوە) */
        .sale-purchase-container {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 30px;
            margin-bottom: 40px;
        }
        
        .tab-buttons {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 1px solid var(--gray-light);
        }
        
        .tab-btn {
            background: none;
            border: none;
            padding: 15px 25px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: var(--transition);
            color: var(--gray);
            font-weight: 500;
            position: relative;
        }
        
        .tab-btn.active {
            color: var(--primary);
        }
        
        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            right: 0;
            width: 100%;
            height: 3px;
            background-color: var(--primary);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        .search-container {
            margin-bottom: 25px;
        }
        
        .search-box {
            position: relative;
            max-width: 500px;
        }
        
        .search-box input {
            width: 100%;
            padding: 15px 50px 15px 15px;
            border: 1px solid var(--gray-light);
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
        }
        
        .search-box input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }
        
        .search-box i {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }
        
        .suggestions {
            position: absolute;
            top: 100%;
            right: 0;
            left: 0;
            background-color: white;
            border: 1px solid var(--gray-light);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            z-index: 10;
            max-height: 300px;
            overflow-y: auto;
            display: none;
        }
        
        .suggestion-item {
            padding: 12px 15px;
            cursor: pointer;
            transition: var(--transition);
            border-bottom: 1px solid var(--gray-light);
        }
        
        .suggestion-item:hover {
            background-color: var(--gray-light);
        }
        
        .suggestion-item:last-child {
            border-bottom: none;
        }
        
        .cart-container {
            background-color: var(--gray-light);
            border-radius: var(--border-radius);
            padding: 25px;
            margin-top: 30px;
        }
        
        .cart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .cart-items {
            list-style: none;
            max-height: 250px;
            overflow-y: auto;
            margin-bottom: 20px;
        }
        
        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background-color: white;
            border-radius: var(--border-radius);
            margin-bottom: 15px;
        }
        
        .cart-item-info {
            display: flex;
            align-items: center;
        }
        
        .cart-item-image {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            background-color: var(--primary);
            margin-left: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }
        
        /* ستایلی نوێ بۆ سەبەتەی فرۆشتن */
        .cart-items-container {
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 20px;
            border: 1px solid var(--gray-light);
            border-radius: var(--border-radius);
            padding: 10px;
            background-color: white;
        }
        
        .btn-quantity {
            border: none;
            background: none;
            padding: 5px 10px;
            cursor: pointer;
            color: var(--primary);
            font-weight: bold;
        }
        
        .btn-quantity:hover {
            color: var(--primary-dark);
        }
        
        .payment-options {
            display: flex;
            margin-top: 20px;
            gap: 15px;
        }
        
        .payment-option {
            flex: 1;
            padding: 15px;
            border: 2px solid var(--gray-light);
            border-radius: var(--border-radius);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .payment-option.selected {
            border-color: var(--primary);
            background-color: rgba(67, 97, 238, 0.05);
        }
        
        .action-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 30px;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn i {
            margin-left: 8px;
        }
        
        .btn-primary {
            background-color: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--primary-dark);
        }
        
        .btn-success {
            background-color: var(--success);
            color: white;
        }
        
        .btn-success:hover {
            background-color: #3ab8e0;
        }
        
        .btn-danger {
            background-color: var(--danger);
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #e11575;
        }
        
        .btn-warning {
            background-color: var(--warning);
            color: white;
        }
        
        .btn-warning:hover {
            background-color: #e68905;
        }
        
        /* بەشی مخزن */
        .inventory-tabs {
            display: flex;
            margin-bottom: 30px;
        }
        
        .inventory-tab {
            background: none;
            border: none;
            padding: 15px 25px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: var(--transition);
            color: var(--gray);
            font-weight: 500;
            position: relative;
        }
        
        .inventory-tab.active {
            color: var(--primary);
        }
        
        .inventory-tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            right: 0;
            width: 100%;
            height: 3px;
            background-color: var(--primary);
        }
        
        .inventory-content {
            display: none;
        }
        
        .inventory-content.active {
            display: block;
        }
        
        .item-form {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 30px;
            margin-bottom: 40px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--dark);
            font-weight: 500;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--gray-light);
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
        }
        
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }
        
        /* بەشی پارەواسڵکردن */
        .payment-container {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 30px;
            margin-bottom: 40px;
        }
        
        /* مۆدالی پرێنت */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background-color: white;
            border-radius: var(--border-radius);
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: modalFadeIn 0.3s ease;
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 30px;
            border-bottom: 1px solid var(--gray-light);
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }
        
        .modal-body {
            padding: 30px;
        }
        
        .invoice {
            font-family: Arial, sans-serif;
            line-height: 1.6;
        }
        
        .invoice-header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid var(--primary);
            padding-bottom: 20px;
        }
        
        .invoice-logo {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .invoice-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .invoice-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
        }
        
        .invoice-table th, .invoice-table td {
            padding: 12px 15px;
            text-align: right;
            border-bottom: 1px solid var(--gray-light);
        }
        
        .invoice-table th {
            background-color: var(--gray-light);
            font-weight: 600;
        }
        
        .invoice-total {
            text-align: left;
            margin-top: 30px;
            font-size: 1.2rem;
        }
        
        .print-options {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 40px;
        }
        
        /* ئاگاداری (نوێ) */
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            z-index: 2000;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .notification.success {
            background-color: #28a745;
            color: white;
        }
        
        .notification.error {
            background-color: #dc3545;
            color: white;
        }
        
        .notification.info {
            background-color: #17a2b8;
            color: white;
        }
        
        /* وەڵامی مۆبایل */
        @media (max-width: 992px) {
            .sidebar {
                transform: translateX(-250px);
                box-shadow: none;
            }
            
            .sidebar.active {
                transform: translateX(0);
                box-shadow: 3px 0 15px rgba(0,0,0,0.1);
            }
            
            .header {
                left: 0;
            }
            
            .main-content {
                margin-right: 0;
            }
            
            .close-sidebar {
                display: block;
            }
        }
        
        @media (max-width: 768px) {
            .dashboard-cards {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
            
            .lists-container {
                grid-template-columns: 1fr;
            }
            
            .payment-options {
                flex-direction: column;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
        }
        
        /* بۆستەی بچووک بۆ بەکارهێنان لە لیستەکان */
        .btn-sm {
            padding: 5px 10px;
            font-size: 0.8rem;
        }
        
        /* ستایل بۆ وێنە پیشبینین */
        .image-preview-container {
            width: 150px;
            height: 150px;
            border: 2px dashed var(--gray-light);
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            margin-top: 10px;
            background-color: var(--light);
        }
        
        .image-preview-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        /* ستایل بۆ وێنەی کاڵا لە لیست */
        .product-image-small {
            width: 50px;
            height: 50px;
            border-radius: 5px;
            object-fit: cover;
            margin-left: 10px;
        }
        
        /* ستایل بۆ وێنەی کاڵا لە سەبەتە */
        .cart-item-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
        }
        
        /* بەشی مێژووی فرۆشتن */
        .history-container {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 30px;
        }
        
        .history-search {
            margin-bottom: 20px;
        }
        
        .history-list {
            max-height: 500px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <!-- پەڕەی چوونەژوورەوە -->
    <div id="loginPage" class="login-container">
        <div class="login-box">
            <div class="login-header">
                <div class="logo">الکترۆنیات</div>
                <h2>سیستەمی فرۆشتی ئەلکترۆنیات</h2>
                <p>تکایە ناوی بەکارهێنەر و وشەی نهێنی داخڵ بکە</p>
            </div>
            
            <form id="loginForm" class="login-form">
                <div class="input-group">
                    <label for="username"><i class="fas fa-user"></i> ناوی بەکارهێنەر</label>
                    <input type="text" id="username" placeholder="ناوی بەکارهێنەر" value="farzad">
                </div>
                
                <div class="input-group">
                    <label for="password"><i class="fas fa-lock"></i> وشەی نهێنی</label>
                    <input type="password" id="password" placeholder="وشەی نهێنی" value="farzad1234">
                </div>
                
                <div class="input-group remember">
                    <input type="checkbox" id="remember" checked>
                    <label for="remember">لەبیرم مەکە</label>
                </div>
                
                <button type="submit" class="login-btn">
                    <i class="fas fa-sign-in-alt"></i> چوونەژوورەوە
                </button>
                
                <div class="login-footer">
                    <p>وشەی نهێنیت لەبیرچووە؟ <a href="#">کلیک لێرە بکە</a></p>
                </div>
            </form>
            
            <div class="login-animation">
                <div class="circle"></div>
                <div class="circle"></div>
                <div class="circle"></div>
            </div>
        </div>
    </div>

    <!-- پەڕەی سەرەکی سیستم -->
    <div id="mainPage" class="container">
        <!-- بارەگەی لای چەپ -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h3>مێنیو</h3>
                <button class="close-sidebar" id="closeSidebar">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="#" class="nav-link active" data-section="dashboard">
                        <i class="fas fa-tachometer-alt"></i>
                        داشبۆرد
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="salesPurchases">
                        <i class="fas fa-exchange-alt"></i>
                        فرۆشتن و کڕینەکان
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="cashSettlement">
                        <i class="fas fa-hand-holding-usd"></i>
                        واسڵکردنی پارە
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="inventory">
                        <i class="fas fa-warehouse"></i>
                        مخزن
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="partnerExpense">
                        <i class="fas fa-hand-holding-usd"></i>
                        سەرف و حیسابی شەریکەکان
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="history">
                        <i class="fas fa-history"></i>
                        مێژوو
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="customers">
                        <i class="fas fa-users"></i>
                        کەسەکان
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="partners">
                        <i class="fas fa-handshake"></i>
                        شەریکەکان
                    </a>
                </li>
                <!-- بەشە نوێیەکان -->
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="settings">
                        <i class="fas fa-cogs"></i>
                        رێکخستن
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="employees">
                        <i class="fas fa-users"></i>
                        کارمەندان
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="lossProfit">
                        <i class="fas fa-chart-line"></i>
                        بەسەرچوون و تێکچوون
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="reconciliation">
                        <i class="fas fa-balance-scale"></i>
                        متابق کردنەوە
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="management">
                        <i class="fas fa-user-tie"></i>
                        بەرێوبەرایەتی
                    </a>
                </li>
            </ul>
        </aside>

        <!-- بەشی سەرەوە -->
        <header class="header" id="header">
            <div class="header-left">
                <button class="menu-toggle" id="menuToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="logo">الکترۆنیات</div>
            </div>
            
            <div class="header-center">
                <h1>سیستەمی فرۆشتی ئەلکترۆنیات</h1>
            </div>
            
            <div class="header-right">
                <div class="user-info">
                    <i class="fas fa-user-circle"></i>
                    <span id="currentUser">فەرزاد</span>
                </div>
                <button class="logout-btn" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i> چوونەدەرەوە
                </button>
            </div>
        </header>

        <!-- بەشی ناوەڕاست -->
        <main class="main-content" id="mainContent">
            <!-- داشبۆرد -->
            <section id="dashboardSection" class="content-section active">
                <h2 class="section-title">داشبۆرد</h2>
                
                <div class="dashboard-cards">
                    <div class="card card-1">
                        <div class="card-icon">
                            <i class="fas fa-wallet"></i>
                        </div>
                        <h3>کۆی پارەی واسڵ کراو</h3>
                        <div class="card-value" id="cashBalanceDisplay">٠ <span>دینار</span></div>
                        <div class="card-change positive">
                            <i class="fas fa-arrow-up"></i> ٠٪ زیاتر لە هەفتەی ڕابردوو
                        </div>
                    </div>
                    
                    <div class="card card-2">
                        <div class="card-icon">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                        <h3>کۆی کڕین</h3>
                        <div class="card-value" id="totalPurchaseDisplay">٠ <span>دینار</span></div>
                        <div class="card-change negative">
                            <i class="fas fa-arrow-down"></i> ٠٪ کەمتر لە هەفتەی ڕابردوو
                        </div>
                    </div>
                    
                    <div class="card card-3">
                        <div class="card-icon">
                            <i class="fas fa-exchange-alt"></i>
                        </div>
                        <h3>جیاوازی کڕین و واسڵ کراو</h3>
                        <div class="card-value" id="differenceDisplay">٠ <span>دینار</span></div>
                        <div class="card-change positive">
                            <i class="fas fa-arrow-up"></i> ٠٪ زیاتر لە هەفتەی ڕابردوو
                        </div>
                    </div>
                    
                    <div class="card card-4">
                        <div class="card-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <h3>کۆی کاڵای کەم بوو</h3>
                        <div class="card-value" id="lowStockCount">٠ <span>جۆر</span></div>
                        <div class="card-change positive">
                            <i class="fas fa-arrow-down"></i> ٠ جۆر کەمتر لە هەفتەی ڕابردوو
                        </div>
                    </div>
                    
                    <div class="card card-5">
                        <div class="card-icon">
                            <i class="fas fa-user-ow"></i>
                        </div>
                        <h3>کۆی پارەی قەرزداران</h3>
                        <div class="card-value" id="totalDebtDisplay">٠ <span>دینار</span></div>
                        <div class="card-change negative">
                            <i class="fas fa-arrow-up"></i> ٠٪ زیاتر لە هەفتەی ڕابردوو
                        </div>
                    </div>
                    
                    <div class="card card-6">
                        <div class="card-icon">
                            <i class="fas fa-handshake"></i>
                        </div>
                        <h3>قەرزدارم بە شەریکەکان</h3>
                        <div class="card-value" id="partnerDebtDisplay">٠ <span>دینار</span></div>
                        <div class="card-change positive">
                            <i class="fas fa-arrow-down"></i> ٠٪ کەمتر لە هەفتەی ڕابردوو
                        </div>
                    </div>
                    
                    <div class="card card-7">
                        <div class="card-icon">
                            <i class="fas fa-file-invoice-dollar"></i>
                        </div>
                        <h3>کۆی سەرفکردن (ئەم مانگە)</h3>
                        <div class="card-value" id="monthlyExpenseTotal">٠ <span>دینار</span></div>
                        <div class="card-change" id="expenseChange">
                            <i class="fas fa-minus"></i> ٠٪ جیاوازی لە مانگی ڕابردوو
                        </div>
                    </div>
                </div>
                
                <div class="lists-container">
                    <div class="list-box">
                        <div class="list-header">
                            <h3>کاڵای کەم بووەکان</h3>
                            <div class="list-actions">
                                <button id="refreshLowStock">نوێکردنەوە</button>
                            </div>
                        </div>
                        <ul class="list-items" id="lowStockList">
                            <!-- داتاکان لە JavaScript دا زیاد دەکرێن -->
                        </ul>
                    </div>
                    
                    <div class="list-box">
                        <div class="list-header">
                            <h3>قەرزدارانی ئەم هەفتەیە</h3>
                            <div class="list-actions">
                                <button id="refreshDebtors">نوێکردنەوە</button>
                            </div>
                        </div>
                        <ul class="list-items" id="debtorsList">
                            <!-- داتاکان لە JavaScript دا زیاد دەکرێن -->
                        </ul>
                    </div>
                </div>
            </section>

            <!-- بەشی فرۆشتن و کڕینەکان (نوێکراوە بە تەواوی) -->
            <section id="salesPurchasesSection" class="content-section">
                <h2 class="section-title">فرۆشتن و کڕینەکان</h2>
                
                <div class="sale-purchase-container">
                    <div class="tab-buttons">
                        <button class="tab-btn active" data-tab="newSale">فرۆشتن</button>
                        <button class="tab-btn" data-tab="newPurchase">کڕین</button>
                        <button class="tab-btn" data-tab="saleHistory">مێژووی فرۆشتن</button>
                        <button class="tab-btn" data-tab="purchaseHistory">مێژووی کڕین</button>
                    </div>
                    
                    <!-- بەشی فرۆشتن (نوێکراوە) -->
                    <div class="tab-content active" id="newSale">
                        <div class="cart-container" id="saleCartContainer">
                            <!-- سەبەتەی فرۆشتن لێرە بە JavaScript دروست دەکرێت -->
                        </div>
                    </div>
                    
                    <!-- بەشی کڕین -->
                    <div class="tab-content" id="newPurchase">
                        <div class="cart-container" id="purchaseCartContainer">
                            <!-- سەبەتەی کڕین لێرە بە JavaScript دروست دەکرێت -->
                        </div>
                    </div>
                    
                    <!-- بەشی مێژووی فرۆشتن (نوێکراوە) -->
                    <div class="tab-content" id="saleHistory">
                        <div class="history-container">
                            <div class="search-container">
                                <div class="search-box">
                                    <input type="text" id="saleHistorySearch" placeholder="گەڕان بە کۆدی فاکتوورە یان ناوی کەس...">
                                    <i class="fas fa-search"></i>
                                </div>
                            </div>
                            
                            <div class="list-box">
                                <div class="list-header">
                                    <h3>مێژووی فرۆشتن</h3>
                                    <div class="list-actions">
                                        <button id="refreshSaleHistory">نوێکردنەوە</button>
                                    </div>
                                </div>
                                <div class="history-list">
                                    <ul class="list-items" id="saleHistoryList">
                                        <!-- مێژووی فرۆشتن لێرە زیاد دەکرێن -->
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- بەشی مێژووی کڕین -->
                    <div class="tab-content" id="purchaseHistory">
                        <div class="history-container" id="purchaseHistoryContainer">
                            <!-- مێژووی کڕین لێرە بە JavaScript دروست دەکرێت -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- بەشی واسڵکردنی پارە -->
            <section id="cashSettlementSection" class="content-section">
                <h2 class="section-title">واسڵکردنی پارە</h2>
                <div style="text-align: center; padding: 50px; color: var(--gray); background-color: white; border-radius: var(--border-radius); box-shadow: var(--box-shadow);">
                    <i class="fas fa-hand-holding-usd fa-4x" style="color: var(--primary); margin-bottom: 20px;"></i>
                    <h3 style="margin-bottom: 15px;">بەشی واسڵکردنی پارە</h3>
                    <p style="margin-bottom: 20px;">ئەم بەشە لە وەشانی داهاتوودا بەردەست دەبێت.</p>
                    <p>لێرەدا پارەواسڵکردنەکان و سەرفەکان بە شێوەیەکی تایبەت بەڕێوەدەبرێن.</p>
                </div>
            </section>

            <!-- بەشی مخزن -->
            <section id="inventorySection" class="content-section">
                <h2 class="section-title">مخزن</h2>
                
                <div class="inventory-tabs">
                    <button class="inventory-tab active" data-inventory-tab="products">کاڵاکان</button>
                </div>
                
                <div class="inventory-content active" id="productsTab">
                    <div class="search-container">
                        <div class="search-box">
                            <input type="text" id="inventorySearch" placeholder="گەڕان بەدوای ناوی کاڵا...">
                            <i class="fas fa-search"></i>
                        </div>
                    </div>
                    
                    <div class="list-box" style="margin-bottom: 30px;">
                        <div class="list-header">
                            <h3>لیستی کاڵاکان</h3>
                            <div class="list-actions">
                                <button id="addProductBtn">زیادکردنی کاڵا</button>
                            </div>
                        </div>
                        <ul class="list-items" id="productList">
                            <!-- لیستی کاڵاکان لێرە زیاد دەکرێن -->
                        </ul>
                    </div>
                    
                    <div class="item-form" id="productForm" style="display: none;">
                        <h3 style="margin-bottom: 20px;">زیادکردن/گۆڕانکاری کاڵا</h3>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="productName">ناوی کاڵا</label>
                                <input type="text" id="productName" placeholder="ناوی کاڵا">
                            </div>
                            
                            <div class="form-group">
                                <label for="productBarcode">بارکۆد (ئارەزوومەندانە)</label>
                                <input type="text" id="productBarcode" placeholder="بارکۆد">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="purchasePrice">نرخی کڕین</label>
                                <input type="number" id="purchasePrice" placeholder="نرخی کڕین">
                            </div>
                            
                            <div class="form-group">
                                <label for="salePrice">نرخی فرۆشتن</label>
                                <input type="number" id="salePrice" placeholder="نرخی فرۆشتن">
                            </div>
                            
                            <div class="form-group">
                                <label for="stockQuantity">بڕی کاڵا</label>
                                <input type="number" id="stockQuantity" placeholder="بڕی کاڵا">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="primaryUnit">یەکەی سەرەکی</label>
                                <select id="primaryUnit">
                                    <option value="piece">پارچە</option>
                                    <option value="carton">کارتۆن</option>
                                    <option value="unit">دانە</option>
                                    <option value="meter">مەتر</option>
                                    <option value="kg">کیلۆ</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="secondaryUnit">یەکەی دووەم (ئارەزوومەندانە)</label>
                                <select id="secondaryUnit">
                                    <option value="">هیچ</option>
                                    <option value="piece">پارچە</option>
                                    <option value="carton">کارتۆن</option>
                                    <option value="unit">دانە</option>
                                    <option value="meter">مەتر</option>
                                    <option value="kg">کیلۆ</option>
                                    <option value="box">بۆکس</option>
                                    <option value="pack">پاکەت</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="secondaryUnitQuantity">بڕ لە یەکەی دووەم (ئەگەر هەیە)</label>
                                <input type="number" id="secondaryUnitQuantity" placeholder="بڕ لە یەکەی دووەم">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="productImage">وێنەی کاڵا (ئارەزوومەندانە)</label>
                                <input type="file" id="productImage" accept="image/*" style="padding: 8px;">
                                <small style="color: var(--gray);">رێگەپێدراو: JPG, PNG, GIF</small>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>پێشبینینی وێنە</label>
                            <div id="imagePreview" class="image-preview-container">
                                <p style="color: var(--gray); font-size: 0.9rem;">هیچ وێنەیەک نییە</p>
                            </div>
                        </div>
                        
                        <div class="action-buttons">
                            <button class="btn btn-danger" id="cancelProductBtn">پاشگەزبوونەوە</button>
                            <button class="btn btn-success" id="saveProductBtn">هەڵگرتن</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- بەشی سەرف و حیسابی شەریکەکان -->
            <section id="partnerExpenseSection" class="content-section">
                <h2 class="section-title">سەرف و حیسابی شەریکەکان</h2>
                
                <div class="sale-purchase-container">
                    <div class="tab-buttons">
                        <button class="tab-btn active" data-tab="expenseToPartner">سەرف بۆ شەریک</button>
                        <button class="tab-btn" data-tab="expenseToCustomer">سەرف بۆ کەس</button>
                        <button class="tab-btn" data-tab="expenseOther">سەرف بۆ هۆکی تر</button>
                    </div>
                    
                    <!-- بەشی ١: سەرف بۆ شەریک -->
                    <div class="tab-content active" id="expenseToPartner">
                        <div class="item-form">
                            <h3 style="margin-bottom: 20px;">سەرفکردنی پارە بۆ شەریک</h3>
                            
                            <div class="search-container">
                                <div class="search-box">
                                    <input type="text" id="expensePartnerSearchMain" placeholder="گەڕان بەدوای ناوی شەریک...">
                                    <i class="fas fa-search"></i>
                                    <div class="suggestions" id="expensePartnerSuggestionsMain"></div>
                                </div>
                            </div>
                            
                            <div id="selectedPartnerInfoMain" style="display: none; margin-top: 20px;">
                                <div class="list-box">
                                    <div class="list-header">
                                        <h3>زانیاری شەریک</h3>
                                    </div>
                                    <div style="padding: 20px;">
                                        <p><strong>ناوی شەریک:</strong> <span id="selectedPartnerNameMain"></span></p>
                                        <p><strong>ژمارەی موبایل:</strong> <span id="selectedPartnerPhoneMain"></span></p>
                                        <p><strong>کۆی قەرزی ئێستا:</strong> <span id="selectedPartnerDebtMain"></span> دینار</p>
                                        <p><strong>کۆی پارەی واسڵکراو:</strong> <span id="selectedPartnerPaidMain"></span> دینار</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-row" style="margin-top: 30px;">
                                <div class="form-group">
                                    <label for="expenseToPartnerAmount">بڕی پارەی سەرفکردن</label>
                                    <input type="number" id="expenseToPartnerAmount" placeholder="بڕی پارە بە دینار" min="1">
                                </div>
                                
                                <div class="form-group">
                                    <label for="expenseToPartnerDate">بەرواری سەرفکردن</label>
                                    <input type="date" id="expenseToPartnerDate" value="${new Date().toISOString().split('T')[0]}">
                                </div>
                                
                                <div class="form-group">
                                    <label for="expenseToPartnerReason">هۆکاری سەرفکردن (ئارەزوومەندانە)</label>
                                    <input type="text" id="expenseToPartnerReason" placeholder="هۆکی سەرفکردن">
                                </div>
                            </div>
                            
                            <div class="action-buttons" style="margin-top: 30px;">
                                <button class="btn btn-success" id="submitExpenseToPartnerBtn">
                                    <i class="fas fa-check-circle"></i> تۆمارکردنی سەرفکردن بۆ شەریک
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- بەشی ٢: سەرف بۆ کەس -->
                    <div class="tab-content" id="expenseToCustomer">
                        <div class="item-form">
                            <h3 style="margin-bottom: 20px;">سەرفکردنی پارە بۆ کەس</h3>
                            
                            <div class="search-container">
                                <div class="search-box">
                                    <input type="text" id="expenseCustomerSearchMain" placeholder="گەڕان بەدوای ناوی کەس...">
                                    <i class="fas fa-search"></i>
                                    <div class="suggestions" id="expenseCustomerSuggestionsMain"></div>
                                </div>
                            </div>
                            
                            <div id="selectedCustomerInfoMain" style="display: none; margin-top: 20px;">
                                <div class="list-box">
                                    <div class="list-header">
                                        <h3>زانیاری کەس</h3>
                                    </div>
                                    <div style="padding: 20px;">
                                        <p><strong>ناوی کەس:</strong> <span id="selectedCustomerNameMain"></span></p>
                                        <p><strong>ژمارەی موبایل:</strong> <span id="selectedCustomerPhoneMain"></span></p>
                                        <p><strong>کۆی قەرزی ئێستا:</strong> <span id="selectedCustomerDebtMain"></span> دینار</p>
                                        <p><strong>کۆی پارەی واسڵکراو:</strong> <span id="selectedCustomerPaidMain"></span> دینار</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-row" style="margin-top: 30px;">
                                <div class="form-group">
                                    <label for="expenseToCustomerAmount">بڕی پارەی سەرفکردن</label>
                                    <input type="number" id="expenseToCustomerAmount" placeholder="بڕی پارە بە دینار" min="1">
                                </div>
                                
                                <div class="form-group">
                                    <label for="expenseToCustomerDate">بەرواری سەرفکردن</label>
                                    <input type="date" id="expenseToCustomerDate" value="${new Date().toISOString().split('T')[0]}">
                                </div>
                                
                                <div class="form-group">
                                    <label for="expenseToCustomerReason">هۆکاری سەرفکردن (ئارەزوومەندانە)</label>
                                    <input type="text" id="expenseToCustomerReason" placeholder="هۆکی سەرفکردن">
                                </div>
                            </div>
                            
                            <div class="action-buttons" style="margin-top: 30px;">
                                <button class="btn btn-success" id="submitExpenseToCustomerBtn">
                                    <i class="fas fa-check-circle"></i> تۆمارکردنی سەرفکردن بۆ کەس
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- بەشی ٣: سەرف بۆ هۆکی تر -->
                    <div class="tab-content" id="expenseOther">
                        <div class="item-form">
                            <h3 style="margin-bottom: 20px;">سەرفکردنی پارە بۆ هۆکی تر</h3>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="otherExpenseAmount">بڕی پارەی سەرفکردن</label>
                                    <input type="number" id="otherExpenseAmount" placeholder="بڕی پارە بە دینار" min="1">
                                </div>
                                
                                <div class="form-group">
                                    <label for="otherExpenseDate">بەرواری سەرفکردن</label>
                                    <input type="date" id="otherExpenseDate" value="${new Date().toISOString().split('T')[0]}">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="otherExpenseCategory">پۆلی سەرفکردن</label>
                                    <select id="otherExpenseCategory">
                                        <option value="rent">کرێ</option>
                                        <option value="salary">مووچە</option>
                                        <option value="utility">کەرەستە</option>
                                        <option value="transport">گواستنەوە</option>
                                        <option value="maintenance">چاکسازی</option>
                                        <option value="marketing">بازرگانی</option>
                                        <option value="office">ئۆفیس</option>
                                        <option value="other">هی تر</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="otherExpenseDescription">پێناسە (هۆکاری سەرفکردن)</label>
                                    <input type="text" id="otherExpenseDescription" placeholder="پێناسەی سەرفکردن">
                                </div>
                            </div>
                            
                            <div class="action-buttons" style="margin-top: 30px;">
                                <button class="btn btn-success" id="submitOtherExpenseBtn">
                                    <i class="fas fa-check-circle"></i> تۆمارکردنی سەرفکردن
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- لیستی مێژووی سەرفکردن -->
                <div class="list-box" style="margin-top: 40px;">
                    <div class="list-header">
                        <h3>مێژووی سەرفکردن</h3>
                        <div class="list-actions">
                            <button id="refreshExpenseHistoryMain">نوێکردنەوە</button>
                        </div>
                    </div>
                    <ul class="list-items" id="expenseHistoryMainList">
                        <!-- مێژووی سەرفکردن لێرە زیاد دەکرێن -->
                    </ul>
                </div>
            </section>

            <!-- بەشی مێژوو -->
            <section id="historySection" class="content-section">
                <h2 class="section-title">مێژوو</h2>
                <p style="text-align: center; padding: 40px; color: var(--gray);">
                    بەشی مێژوو لێرە دەبێت کە مێژووی هەموو فرۆشتن و کڕین و پارەواسڵکردنەکان تێدا بێت.
                </p>
            </section>
            
            <!-- بەشی کەسەکان -->
            <section id="customersSection" class="content-section">
                <h2 class="section-title">کەسەکان</h2>
                
                <div class="sale-purchase-container">
                    <div class="tab-buttons">
                        <button class="tab-btn active" data-tab="customersList">لیستی کەسەکان</button>
                        <button class="tab-btn" data-tab="addCustomer">زیادکردنی کەس</button>
                    </div>
                    
                    <div class="tab-content active" id="customersList">
                        <div class="search-container">
                            <div class="search-box">
                                <input type="text" id="customerSearchMain" placeholder="گەڕان بەدوای ناوی کەس...">
                                <i class="fas fa-search"></i>
                                <div class="suggestions" id="customerSearchSuggestions"></div>
                            </div>
                        </div>
                        
                        <div class="list-box" style="margin-top: 20px;">
                            <div class="list-header">
                                <h3>لیستی کەسەکان</h3>
                                <div class="list-actions">
                                    <button id="refreshCustomers">نوێکردنەوە</button>
                                    <button id="addCustomerBtn">زیادکردنی کەس</button>
                                </div>
                            </div>
                            <ul class="list-items" id="customersMainList">
                                <!-- لیستی کەسەکان لێرە زیاد دەکرێن -->
                            </ul>
                        </div>
                    </div>
                    
                    <div class="tab-content" id="addCustomer">
                        <div class="item-form">
                            <h3 style="margin-bottom: 20px;">زیادکردنی کەسی نوێ</h3>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="newCustomerName">ناوی کەس</label>
                                    <input type="text" id="newCustomerName" placeholder="ناوی کەس">
                                </div>
                                
                                <div class="form-group">
                                    <label for="newCustomerPhone">ژمارەی موبایل</label>
                                    <input type="text" id="newCustomerPhone" placeholder="٠٧٧٠١٢٣٤٥٦٧">
                                </div>
                                
                                <div class="form-group">
                                    <label for="newCustomerAddress">ناونیشان (ئارەزوومەندانە)</label>
                                    <input type="text" id="newCustomerAddress" placeholder="ناونیشان">
                                </div>
                            </div>
                            
                            <div class="action-buttons">
                                <button class="btn btn-danger" id="cancelCustomerBtn">پاشگەزبوونەوە</button>
                                <button class="btn btn-success" id="saveCustomerBtn">هەڵگرتن</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- بەشی شەریکەکان -->
            <section id="partnersSection" class="content-section">
                <h2 class="section-title">شەریکەکان</h2>
                
                <div class="sale-purchase-container">
                    <div class="tab-buttons">
                        <button class="tab-btn active" data-tab="partnersList">لیستی شەریکەکان</button>
                        <button class="tab-btn" data-tab="addPartner">زیادکردنی شەریک</button>
                    </div>
                    
                    <div class="tab-content active" id="partnersList">
                        <div class="search-container">
                            <div class="search-box">
                                <input type="text" id="partnerSearch" placeholder="گەڕان بەدوای ناوی شەریک...">
                                <i class="fas fa-search"></i>
                            </div>
                        </div>
                        
                        <div class="list-box" style="margin-top: 20px;">
                            <div class="list-header">
                                <h3>لیستی شەریکەکان</h3>
                                <div class="list-actions">
                                    <button id="refreshPartners">نوێکردنەوە</button>
                                    <button id="addPartnerBtn">زیادکردنی شەریک</button>
                                </div>
                            </div>
                            <ul class="list-items" id="partnersListItems">
                                <!-- لیستی شەریکەکان لێرە زیاد دەکرێن -->
                            </ul>
                        </div>
                    </div>
                    
                    <div class="tab-content" id="addPartner">
                        <div class="item-form">
                            <h3 style="margin-bottom: 20px;">زیادکردنی شەریکی نوێ</h3>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="newPartnerName">ناوی شەریک</label>
                                    <input type="text" id="newPartnerName" placeholder="ناوی شەریک">
                                </div>
                                
                                <div class="form-group">
                                    <label for="newPartnerPhone">ژمارەی موبایل</label>
                                    <input type="text" id="newPartnerPhone" placeholder="٠٧٧٠١٢٣٤٥٦٧">
                                </div>
                                
                                <div class="form-group">
                                    <label for="newPartnerAddress">ناونیشان (ئارەزوومەندانە)</label>
                                    <input type="text" id="newPartnerAddress" placeholder="ناونیشان">
                                </div>
                            </div>
                            
                            <div class="action-buttons">
                                <button class="btn btn-danger" id="cancelPartnerBtn">پاشگەزبوونەوە</button>
                                <button class="btn btn-success" id="savePartnerBtn">هەڵگرتن</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- بەشی رێکخستن -->
            <section id="settingsSection" class="content-section">
                <h2 class="section-title">رێکخستن</h2>
                
                <div class="sale-purchase-container">
                    <div class="tab-buttons">
                        <button class="tab-btn active" data-tab="systemSettings">گۆڕانکاری لە زانیاری سیستەم</button>
                        <button class="tab-btn" data-tab="styleSettings">ستایلی سیستەم</button>
                        <button class="tab-btn" data-tab="securitySettings">سکویرتی و پاراستن</button>
                    </div>
                    
                    <!-- بەشی ١: گۆڕانکاری لە زانیاری سیستەم -->
                    <div class="tab-content active" id="systemSettings">
                        <div style="text-align: center; padding: 50px; color: var(--gray); background-color: white; border-radius: var(--border-radius); box-shadow: var(--box-shadow);">
                            <i class="fas fa-info-circle fa-4x" style="color: var(--primary); margin-bottom: 20px;"></i>
                            <h3 style="margin-bottom: 15px;">گۆڕانکاری لە زانیاری سیستەم</h3>
                            <p style="margin-bottom: 20px;">ئەم بەشە لە وەشانی داهاتوودا بەردەست دەبێت.</p>
                            <p>لێرەدا زانیاری بنچینەیی سیستەم وەک ناو، ناونیشان، ژمارەی پەیوەندی، و زانیاری تر دەستکاری دەکرێن.</p>
                        </div>
                    </div>
                    
                    <!-- بەشی ٢: ستایلی سیستەم -->
                    <div class="tab-content" id="styleSettings">
                        <div style="text-align: center; padding: 50px; color: var(--gray); background-color: white; border-radius: var(--border-radius); box-shadow: var(--box-shadow);">
                            <i class="fas fa-palette fa-4x" style="color: var(--primary); margin-bottom: 20px;"></i>
                            <h3 style="margin-bottom: 15px;">ستایلی سیستەم</h3>
                            <p style="margin-bottom: 20px;">ئەم بەشە لە وەشانی داهاتوودا بەردەست دەبێت.</p>
                            <p>لێرەدا ستایل و رەنگەکانی سیستەم وەک تێم، فۆنت، و درێژایی پەڕەکان دەستکاری دەکرێن.</p>
                        </div>
                    </div>
                    
                    <!-- بەشی ٣: سکویرتی و پاراستن -->
                    <div class="tab-content" id="securitySettings">
                        <div style="text-align: center; padding: 50px; color: var(--gray); background-color: white; border-radius: var(--border-radius); box-shadow: var(--box-shadow);">
                            <i class="fas fa-shield-alt fa-4x" style="color: var(--primary); margin-bottom: 20px;"></i>
                            <h3 style="margin-bottom: 15px;">سکویرتی و پاراستن</h3>
                            <p style="margin-bottom: 20px;">ئەم بەشە لە وەشانی داهاتوودا بەردەست دەبێت.</p>
                            <p>لێرەدا رێکخستنەکانی پاراستنی سیستم وەک وشەی نهێنی، هەژمارەکان، و ئاستی چوونەژوورەوە بەڕێوەدەبرێن.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- بەشی کارمەندان -->
            <section id="employeesSection" class="content-section">
                <h2 class="section-title">کارمەندان</h2>
                
                <div class="sale-purchase-container">
                    <div class="tab-buttons">
                        <button class="tab-btn active" data-tab="employeeInfo">ناوی کارمەند و زانیاری</button>
                        <button class="tab-btn" data-tab="employeeSalaries">داهاتی کارمەندەکان</button>
                        <button class="tab-btn" data-tab="employeeDailyLeaves">مۆڵەتی رۆژانەی کارمەندەکان</button>
                        <button class="tab-btn" data-tab="employeeLeave">مۆڵەتی کارمەند</button>
                    </div>
                    
                    <!-- بەشی ١: ناوی کارمەند و زانیاری -->
                    <div class="tab-content active" id="employeeInfo">
                        <div style="text-align: center; padding: 50px; color: var(--gray); background-color: white; border-radius: var(--border-radius); box-shadow: var(--box-shadow);">
                            <i class="fas fa-user-tie fa-4x" style="color: var(--primary); margin-bottom: 20px;"></i>
                            <h3 style="margin-bottom: 15px;">ناوی کارمەند و زانیاری</h3>
                            <p style="margin-bottom: 20px;">ئەم بەشە لە وەشانی داهاتوودا بەردەست دەبێت.</p>
                            <p>لێرەدا زانیاری کارمەندەکان وەک ناو، ناونیشان، ژمارەی پەیوەندی، و زانیاری تر بەڕێوەدەبرێن.</p>
                        </div>
                    </div>
                    
                    <!-- بەشی ٢: داهاتی کارمەندەکان -->
                    <div class="tab-content" id="employeeSalaries">
                        <div style="text-align: center; padding: 50px; color: var(--gray); background-color: white; border-radius: var(--border-radius); box-shadow: var(--box-shadow);">
                            <i class="fas fa-money-bill-wave fa-4x" style="color: var(--primary); margin-bottom: 20px;"></i>
                            <h3 style="margin-bottom: 15px;">داهاتی کارمەندەکان</h3>
                            <p style="margin-bottom: 20px;">ئەم بەشە لە وەشانی داهاتوودا بەردەست دەبێت.</p>
                            <p>لێرەدا داهات و مووچەی کارمەندەکان و پارەدانەکان بەڕێوەدەبرێن.</p>
                        </div>
                    </div>
                    
                    <!-- بەشی ٣: مۆڵەتی رۆژانەی کارمەندەکان -->
                    <div class="tab-content" id="employeeDailyLeaves">
                        <div style="text-align: center; padding: 50px; color: var(--gray); background-color: white; border-radius: var(--border-radius); box-shadow: var(--box-shadow);">
                            <i class="fas fa-calendar-day fa-4x" style="color: var(--primary); margin-bottom: 20px;"></i>
                            <h3 style="margin-bottom: 15px;">مۆڵەتی رۆژانەی کارمەندەکان</h3>
                            <p style="margin-bottom: 20px;">ئەم بەشە لە وەشانی داهاتوودا بەردەست دەبێت.</p>
                            <p>لێرەدا مۆڵەتی رۆژانەی کارمەندەکان و ئەنجامەکانی بەڕێوەدەبرێن.</p>
                        </div>
                    </div>
                    
                    <!-- بەشی ٤: مۆڵەتی کارمەند -->
                    <div class="tab-content" id="employeeLeave">
                        <div style="text-align: center; padding: 50px; color: var(--gray); background-color: white; border-radius: var(--border-radius); box-shadow: var(--box-shadow);">
                            <i class="fas fa-calendar-alt fa-4x" style="color: var(--primary); margin-bottom: 20px;"></i>
                            <h3 style="margin-bottom: 15px;">مۆڵەتی کارمەند</h3>
                            <p style="margin-bottom: 20px;">ئەم بەشە لە وەشانی داهاتوودا بەردەست دەبێت.</p>
                            <p>لێرەدا مۆڵەتی کارمەندەکان و کاتی نەهاتنیان بەڕێوەدەبرێن.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- بەشی بەسەرچوون و تێکچوون -->
            <section id="lossProfitSection" class="content-section">
                <h2 class="section-title">بەسەرچوون و تێکچوون</h2>
                <div style="text-align: center; padding: 50px; color: var(--gray); background-color: white; border-radius: var(--border-radius); box-shadow: var(--box-shadow);">
                    <i class="fas fa-chart-line fa-4x" style="color: var(--primary); margin-bottom: 20px;"></i>
                    <h3 style="margin-bottom: 15px;">بەشی بەسەرچوون و تێکچوون</h3>
                    <p style="margin-bottom: 20px;">ئەم بەشە لە وەشانی داهاتوودا بەردەست دەبێت.</p>
                    <p>لێرەدا هەژماری بەسەرچوون و تێکچوونەکان پیشان دەدرێت.</p>
                </div>
            </section>

            <!-- بەشی متابق کردنەوە -->
            <section id="reconciliationSection" class="content-section">
                <h2 class="section-title">متابق کردنەوە</h2>
                <div style="text-align: center; padding: 50px; color: var(--gray); background-color: white; border-radius: var(--border-radius); box-shadow: var(--box-shadow);">
                    <i class="fas fa-balance-scale fa-4x" style="color: var(--primary); margin-bottom: 20px;"></i>
                    <h3 style="margin-bottom: 15px;">بەشی متابق کردنەوە</h3>
                    <p style="margin-bottom: 20px;">ئەم بەشە لە وەشانی داهاتوودا بەردەست دەبێت.</p>
                    <p>لێرەدا هەژمارەکان پێکەوە متابق دەکرێنەوە.</p>
                </div>
            </section>

            <!-- بەشی بەرێوبەرایەتی -->
            <section id="managementSection" class="content-section">
                <h2 class="section-title">بەرێوبەرایەتی</h2>
                <div style="text-align: center; padding: 50px; color: var(--gray); background-color: white; border-radius: var(--border-radius); box-shadow: var(--box-shadow);">
                    <i class="fas fa-user-tie fa-4x" style="color: var(--primary); margin-bottom: 20px;"></i>
                    <h3 style="margin-bottom: 15px;">بەشی بەرێوبەرایەتی</h3>
                    <p style="margin-bottom: 20px;">ئەم بەشە لە وەشانی داهاتوودا بەردەست دەبێت.</p>
                    <p>لێرەدا بەرێوبەرایەتی گشتی سیستم ئەنجام دەدرێت.</p>
                </div>
            </section>
        </main>
    </div>

    <!-- مۆدالی پرێنت -->
    <div class="modal" id="printModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>پرێنتکردنی فاکتوور</h3>
                <button class="modal-close" id="closePrintModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="invoice">
                    <div class="invoice-header">
                        <div class="invoice-logo">الکترۆنیات</div>
                        <h2>فاکتووری فرۆشتن</h2>
                        <p>کۆدی فاکتوورە: <span id="invoiceCode">INV-2023-001</span></p>
                        <p>بەروار: <span id="invoiceDate">٢٠٢٣/١٢/١٥</span></p>
                    </div>
                    
                    <div class="invoice-details">
                        <div>
                            <h4>زانیاری فرۆشەر:</h4>
                            <p>ناوی سیستەم: الکترۆنیات</p>
                            <p>ژمارەی موبایل: ٠٧٧٠١٢٣٤٥٦٧</p>
                            <p>ناونیشان: هەولێر، کوردستان</p>
                        </div>
                        
                        <div>
                            <h4>زانیاری کڕیار:</h4>
                            <p id="customerName">ناوی کڕیار: عەلی محەممەد</p>
                            <p id="customerPhone">ژمارەی موبایل: ٠٧٧٠٧٦٥٤٣٢١</p>
                            <p id="customerAddress">ناونیشان: نەزانراو</p>
                        </div>
                    </div>
                    
                    <table class="invoice-table">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>ناوی کاڵا</th>
                                <th>یەکە</th>
                                <th>بڕ</th>
                                <th>نرخ</th>
                                <th>کۆی گشتی</th>
                            </tr>
                        </thead>
                        <tbody id="invoiceItems">
                            <!-- کاڵاکانی فاکتوور لێرە زیاد دەکرێن -->
                        </tbody>
                    </table>
                    
                    <div class="invoice-total">
                        <p><strong>کۆی گشتی:</strong> <span id="invoiceTotal">٠ دینار</span></p>
                        <p><strong>قەرزی پێشوو:</strong> <span id="previousDebt">٠ دینار</span></p>
                        <p><strong>قەرزی ئێستا:</strong> <span id="currentDebt">٠ دینار</span></p>
                        <p><strong>کۆی قەرزی دوای فرۆشتن:</strong> <span id="totalDebt">٠ دینار</span></p>
                    </div>
                    
                    <div class="print-options">
                        <button class="btn btn-warning" id="printSmall">
                            <i class="fas fa-print"></i> پرێنتی بچووک
                        </button>
                        <button class="btn btn-primary" id="printA4">
                            <i class="fas fa-print"></i> پرێنتی A4
                        </button>
                        <button class="btn btn-danger" id="closeInvoice">
                            <i class="fas fa-times"></i> داخستن
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- مۆدالی بینینی و بەڕێوەبردنی کەس -->
    <div class="modal" id="customerModal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h3>زانیاری کەس: <span id="modalCustomerName">عەلی محەممەد</span></h3>
                <button class="modal-close" id="closeCustomerModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="tab-buttons">
                    <button class="tab-btn active" data-customer-tab="info">زانیاری کەس</button>
                    <button class="tab-btn" data-customer-tab="debt">پارەواسڵکردن</button>
                    <button class="tab-btn" data-customer-tab="invoices">فاکتوورەکان</button>
                </div>
                
                <div class="tab-content active" id="customerInfoTab">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editCustomerName">ناوی کەس</label>
                            <input type="text" id="editCustomerName" placeholder="ناوی کەس">
                        </div>
                        
                        <div class="form-group">
                            <label for="editCustomerPhone">ژمارەی موبایل</label>
                            <input type="text" id="editCustomerPhone" placeholder="٠٧٧٠١٢٣٤٥٦٧">
                        </div>
                        
                        <div class="form-group">
                            <label for="editCustomerAddress">ناونیشان</label>
                            <input type="text" id="editCustomerAddress" placeholder="ناونیشان">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="customerTotalDebt">کۆی قەرز</label>
                            <input type="text" id="customerTotalDebt" readonly style="background-color: var(--gray-light);">
                        </div>
                        
                        <div class="form-group">
                            <label for="customerLastPurchase">کۆتا فرۆشتن</label>
                            <input type="text" id="customerLastPurchase" readonly style="background-color: var(--gray-light);">
                        </div>
                        
                        <div class="form-group">
                            <label for="customerTotalPurchases">کۆی فرۆشتن</label>
                            <input type="text" id="customerTotalPurchases" readonly style="background-color: var(--gray-light);">
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button class="btn btn-danger" id="deleteCustomerBtn">
                            <i class="fas fa-trash"></i> سڕینەوەی کەس
                        </button>
                        <button class="btn btn-warning" id="printCustomerInfo" onclick="printCustomerInfo()">
                            <i class="fas fa-print"></i> پرێنتکردنی زانیاری
                        </button>
                        <button class="btn btn-success" id="saveCustomerChanges">
                            <i class="fas fa-save"></i> هەڵگرتنی گۆڕانکاریەکان
                        </button>
                    </div>
                </div>
                
                <div class="tab-content" id="customerDebtTab">
                    <div class="payment-container">
                        <h4 style="margin-bottom: 20px;">پارەواسڵکردن بۆ کەسەکە</h4>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="paymentAmount">بڕی پارە</label>
                                <input type="number" id="paymentAmount" placeholder="بڕی پارە بە دینار">
                            </div>
                            
                            <div class="form-group">
                                <label for="paymentDate">بەروار</label>
                                <input type="date" id="paymentDate">
                            </div>
                            
                            <div class="form-group">
                                <label for="paymentMethod">شێوازی پارەدان</label>
                                <select id="paymentMethod">
                                    <option value="cash">نەقدی</option>
                                    <option value="transfer">گوازینەوە</option>
                                    <option value="check">چەک</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="paymentNotes">تێبینی (ئارەزوومەندانە)</label>
                            <input type="text" id="paymentNotes" placeholder="تێبینی">
                        </div>
                        
                        <div class="action-buttons">
                            <button class="btn btn-success" id="submitPaymentBtnModal">
                                <i class="fas fa-check-circle"></i> تۆمارکردنی پارەواسڵکردن
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="tab-content" id="customerInvoicesTab">
                    <div class="search-container">
                        <div class="search-box">
                            <input type="text" id="customerInvoiceSearch" placeholder="گەڕان بە کۆدی فاکتوورە...">
                            <i class="fas fa-search"></i>
                        </div>
                    </div>
                    
                    <div class="list-box" style="margin-top: 20px;">
                        <div class="list-header">
                            <h3>فاکتوورەکانی کەسەکە</h3>
                            <div class="list-actions">
                                <button id="refreshCustomerInvoices">نوێکردنەوە</button>
                            </div>
                        </div>
                        <ul class="list-items" id="customerInvoicesList">
                            <!-- فاکتوورەکانی کەس لێرە زیاد دەکرێن -->
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- مۆدالی بینینی فاکتوور -->
    <div class="modal" id="invoiceDetailModal">
        <div class="modal-content" style="max-width: 1000px;">
            <div class="modal-header">
                <h3>فاکتوور: <span id="modalInvoiceCode">INV-2023-001</span></h3>
                <button class="modal-close" id="closeInvoiceModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="invoice" id="invoiceDetailContent">
                    <!-- نەخشەی فاکتوور لێرە کۆپی دەکرێت -->
                </div>
                
                <div class="print-options" style="margin-top: 30px;">
                    <button class="btn btn-warning" id="printInvoiceSmallDetail">
                        <i class="fas fa-print"></i> پرێنتی بچووک
                    </button>
                    <button class="btn btn-primary" id="printInvoiceA4Detail">
                        <i class="fas fa-print"></i> پرێنتی A4
                    </button>
                    <button class="btn btn-danger" id="deleteInvoiceBtn">
                        <i class="fas fa-trash"></i> سڕینەوەی فاکتوور
                    </button>
                    <button class="btn btn-info" id="editInvoiceBtn">
                        <i class="fas fa-edit"></i> گۆڕانکاری فاکتوور
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- هەموو JavaScript لێرە -->
    <script>
        // داتای نموونەیی بۆ سیستمەکە (داتاکان لە سفرەوە دەست پێدەکەن)
        const sampleData = {
            products: [],
            customers: [],
            partners: [],
            sales: [],
            purchases: [],
            cashBalance: 0,
            expenseHistory: [],
            paymentHistory: []
        };

        // داتای نموونەیی بۆ مێژووی کڕین
        const samplePurchaseData = {
            purchases: []
        };

        // دۆمینەکان
        let currentUser = null;
        let cart = [];
        let purchaseCart = [];
        let selectedPayment = "cash";
        let selectedCustomer = null;
        let selectedPartner = null;
        let editingProductId = null;
        let barcodeBuffer = '';
        let barcodeTimeout = null;

        // کۆدی چوونەژوورەوە
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // چێکی کردنی ناوی بەکارهێنەر و وشەی نهێنی
            if (username && password) {
                // فەرزاد یان admin دەتوانن بچنە ژوورەوە
                if ((username === 'farzad' && password === 'farzad1234') || 
                    (username === 'admin' && password === 'admin123') ||
                    (username === 'user' && password === 'user123')) {
                    currentUser = username;
                    
                    // نیشاندانی پەڕەی سەرەکی و شاردنەوەی پەڕەی چوونەژوورەوە
                    document.getElementById('loginPage').style.display = 'none';
                    document.getElementById('mainPage').style.display = 'flex';
                    
                    // زیادکردنی ناوی بەکارهێنەر
                    const userNames = {
                        'farzad': 'فەرزاد',
                        'admin': 'ئەدمین',
                        'user': 'بەکارهێنەر'
                    };
                    document.getElementById('currentUser').textContent = userNames[username] || username;
                    
                    // زیادکردنی داتای نموونەیی سادە بۆ ئەزموونکردن
                    addSampleDataForTesting();
                    
                    // چالاککردنی داشبۆرد وەک یەکەم بەش
                    showSection('dashboard');
                    
                    // چالاککردنی پیشبینینی وێنە
                    setupImagePreview();
                    
                    // دەستپێکردنی سیستەمی بارکۆد
                    initializeBarcodeScanner();
                } else {
                    showNotification('ناوی بەکارهێنەر یان وشەی نهێنی هەڵەە! تکایە دووبارە هەوڵ بدەرەوە.', 'error');
                }
            } else {
                showNotification('تکایە هەردوو خانە پڕ بکەرەوە!', 'error');
            }
        });

        // دەستپێکردنی سیستەمی بارکۆد
        function initializeBarcodeScanner() {
            document.addEventListener('keydown', function(e) {
                // تەنها کەلیلی ئاسایی قبوڵ بکە
                if (e.key.length === 1 && !e.ctrlKey && !e.altKey && !e.metaKey) {
                    barcodeBuffer += e.key;
                    
                    // پاککردنەوەی کاتی
                    if (barcodeTimeout) clearTimeout(barcodeTimeout);
                    
                    barcodeTimeout = setTimeout(function() {
                        if (barcodeBuffer.length >= 6) { // بارکۆدێکی دروست لەسەرەکانی 6 یان زیاتر
                            processBarcode(barcodeBuffer.trim());
                        }
                        barcodeBuffer = '';
                    }, 100); // 100ms چاوەروانی بۆ تەواوبوونی بارکۆد
                }
            });
        }

        // پرۆسەکردنی بارکۆد
        function processBarcode(barcode) {
            const product = sampleData.products.find(p => p.barcode === barcode);
            
            if (product) {
                addProductToCart(product.id, 1, null, null);
                updateCartDisplay();
                
                // نیشاندانی ئاگاداری کورت
                showNotification(`${product.name} زیاد کرا بۆ سەبەتە`, 'success');
            } else {
                showNotification('کاڵایەک بەم بارکۆدە نەدۆزرایەوە', 'error');
            }
        }

        // فەنکشنی زیادکردنی داتای نموونەیی سادە بۆ ئەزموونکردن
        function addSampleDataForTesting() {
            // زیادکردنی کۆی پارەی سەرەتا
            sampleData.cashBalance = 10000000; // 10 ملیۆن دینار
            
            // زیادکردنی کەس و شەریکی نموونەیی
            sampleData.customers = [
                { id: 1, name: "عەلی محەممەد", phone: "07701234567", address: "هەولێر", debt: 50000 },
                { id: 2, name: "حوسێن عەلی", phone: "07707654321", address: "سلێمانی", debt: 25000 },
                { id: 3, name: "کەریم عەبدوڵڵا", phone: "07705556677", address: "دهۆک", debt: 0 }
            ];
            
            sampleData.partners = [
                { id: 1, name: "کۆمپانیای ئەلکترۆنی", phone: "07701112233", address: "بەغدا", debt: -150000 },
                { id: 2, name: "کۆمپانیای کاڵا", phone: "07702223344", address: "هەولێر", debt: 75000 },
                { id: 3, name: "کۆمپانیای فرۆشتن", phone: "07703334455", address: "سلێمانی", debt: 0 }
            ];
            
            // زیادکردنی کاڵای نموونەیی
            sampleData.products = [
                { 
                    id: 1, 
                    name: "مۆبایل سامسۆنگ A50", 
                    barcode: "BR1001", 
                    purchasePrice: 500000, 
                    salePrice: 600000, 
                    stock: 10, 
                    unit: "piece",
                    image: null,
                    hasSecondaryUnit: false,
                    secondaryUnit: null,
                    secondaryUnitQuantity: 0
                },
                { 
                    id: 2, 
                    name: "تەلەفزیۆن ئێڵ جی 55 ئینچ", 
                    barcode: "BR1002", 
                    purchasePrice: 800000, 
                    salePrice: 950000, 
                    stock: 5, 
                    unit: "piece",
                    image: null,
                    hasSecondaryUnit: false,
                    secondaryUnit: null,
                    secondaryUnitQuantity: 0
                },
                { 
                    id: 3, 
                    name: "سەرعەی بێلایین", 
                    barcode: "BR1003", 
                    purchasePrice: 75000, 
                    salePrice: 90000, 
                    stock: 20, 
                    unit: "piece",
                    image: null,
                    hasSecondaryUnit: false,
                    secondaryUnit: null,
                    secondaryUnitQuantity: 0
                },
                { 
                    id: 4, 
                    name: "لاپتۆپ دێل", 
                    barcode: "BR1004", 
                    purchasePrice: 1200000, 
                    salePrice: 1500000, 
                    stock: 3, 
                    unit: "piece",
                    image: null,
                    hasSecondaryUnit: false,
                    secondaryUnit: null,
                    secondaryUnitQuantity: 0
                },
                { 
                    id: 5, 
                    name: "مۆبایل ئایفۆن 13", 
                    barcode: "BR1005", 
                    purchasePrice: 2500000, 
                    salePrice: 3000000, 
                    stock: 2, 
                    unit: "piece",
                    image: null,
                    hasSecondaryUnit: false,
                    secondaryUnit: null,
                    secondaryUnitQuantity: 0
                }
            ];
            
            // زیادکردنی فرۆشتنە نموونەییەکان
            sampleData.sales = [
                {
                    id: 1,
                    code: "INV-2023-001",
                    customer: "عەلی محەممەد",
                    date: "2023-12-15",
                    total: 600000,
                    payment: "credit",
                    items: [
                        { name: "مۆبایل سامسۆنگ A50", quantity: 1, unit: "piece", price: 600000, total: 600000 }
                    ]
                },
                {
                    id: 2,
                    code: "INV-2023-002",
                    customer: "حوسێن عەلی",
                    date: "2023-12-14",
                    total: 950000,
                    payment: "cash",
                    items: [
                        { name: "تەلەفزیۆن ئێڵ جی 55 ئینچ", quantity: 1, unit: "piece", price: 950000, total: 950000 }
                    ]
                }
            ];
            
            // نوێکردنەوەی داشبۆرد
            populateSampleData();
            
            showNotification('داتای نموونەیی بۆ تاقیکردنەوە زیاد کرا!', 'info');
        }

        // فەنکشنی نیشاندانی ئاگاداری
        function showNotification(message, type = 'info') {
            // لابردنی ئاگاداری پێشوو
            const existingNotification = document.querySelector('.notification');
            if (existingNotification) existingNotification.remove();
            
            // دروستکردنی ئاگاداری
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            const icon = type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle';
            
            notification.innerHTML = `
                <i class="fas ${icon}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            // لابردنی ئاگاداری دوای چەند چرکەیەک
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // فەنکشنی نیشاندانی بەش
        function showSection(sectionId) {
            // لابردنی چالاکی لە هەموو بەشەکان
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // لابردنی چالاکی لە هەموو بەستەرەکانی مێنیو
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // زیادکردنی چالاکی بۆ بەشەکە
            const sectionElement = document.getElementById(sectionId + 'Section');
            if (sectionElement) {
                sectionElement.classList.add('active');
            }
            
            // زیادکردنی چالاکی بۆ بەستەری مێنیو
            const navLink = document.querySelector(`.nav-link[data-section="${sectionId}"]`);
            if (navLink) {
                navLink.classList.add('active');
            }
            
            // داخستنی مێنیو لەسەر مۆبایل
            if (window.innerWidth <= 992) {
                document.getElementById('sidebar').classList.remove('active');
            }
            
            // دەستپێکردنی سیستەمی فرۆشتن کاتێ بەشەکە پیشان دەدرێت
            if (sectionId === 'salesPurchases') {
                setTimeout(() => {
                    const newSaleTab = document.querySelector('#newSale');
                    if (newSaleTab && newSaleTab.classList.contains('active')) {
                        initializeSaleSystem();
                    }
                }, 100);
            }
            
            // نوێکردنەوەی داشبۆرد کاتێ بەشی داشبۆرد پیشان دەدرێ
            if (sectionId === 'dashboard') {
                populateSampleData();
            }
        }

        // چوونەدەرەوە
        document.getElementById('logoutBtn').addEventListener('click', function() {
            currentUser = null;
            cart = [];
            purchaseCart = [];
            selectedCustomer = null;
            selectedPartner = null;
            selectedPayment = "cash";
            editingProductId = null;
            
            document.getElementById('mainPage').style.display = 'none';
            document.getElementById('loginPage').style.display = 'flex';
            
            // پاککردنەوەی خانەکانی چوونەژوورەوە
            document.getElementById('username').value = 'farzad';
            document.getElementById('password').value = 'farzad1234';
            
            // پاککردنەوەی سەبەتە
            updateCartDisplay();
            
            showNotification('بە سەرکەوتوویی چوویتە دەرەوە', 'info');
        });

        // ==============================================
        // سیستەمی فرۆشتن - فەنکشنە سەرەکییەکان
        // ==============================================

        // دەستپێکردنی سیستەمی فرۆشتن
        function initializeSaleSystem() {
            const cartContainer = document.getElementById('saleCartContainer');
            if (!cartContainer) return;
            
            cartContainer.innerHTML = `
                <div class="cart-header">
                    <h3>سەبەتە</h3>
                    <div class="list-actions">
                        <button id="clearCart" class="btn btn-danger btn-sm">
                            <i class="fas fa-trash"></i> سڕینەوەی هەموو سەبەتە
                        </button>
                    </div>
                </div>
                
                <!-- گەڕان بۆ کاڵا -->
                <div class="search-container" style="margin-bottom: 15px;">
                    <div class="search-box">
                        <input type="text" id="productSearchSale" placeholder="گەڕان بەدوای کاڵا یان بارکۆد...">
                        <i class="fas fa-search"></i>
                        <div class="suggestions" id="productSuggestionsSale"></div>
                    </div>
                </div>
                
                <!-- هەڵبژاردنی شێوازی پارەدان -->
                <div class="payment-options" style="margin-top: 20px;">
                    <div class="payment-option selected" data-payment="cash">
                        <i class="fas fa-money-bill-wave fa-2x"></i>
                        <div style="margin-top: 10px;">نەقدی</div>
                    </div>
                    <div class="payment-option" data-payment="credit">
                        <i class="fas fa-file-invoice-dollar fa-2x"></i>
                        <div style="margin-top: 10px;">قەرز</div>
                    </div>
                </div>
                
                <!-- هەڵبژاردنی کەس بۆ قەرز -->
                <div id="customerSelection" style="display: none; margin-top: 20px;">
                    <div class="search-box">
                        <input type="text" id="customerSearchSale" placeholder="گەڕان بەدوای کەس...">
                        <i class="fas fa-user"></i>
                        <div class="suggestions" id="customerSuggestionsSale"></div>
                    </div>
                    <div id="selectedCustomerInfo" style="margin-top: 10px; display: none; padding: 10px; background-color: var(--gray-light); border-radius: var(--border-radius);">
                        <p><strong>کەسی هەڵبژێردراو:</strong> <span id="selectedCustomerNameSale"></span></p>
                        <p><strong>قەرز:</strong> <span id="selectedCustomerDebtSale"></span> دینار</p>
                    </div>
                </div>
                
                <!-- لیستی کاڵاکانی سەبەتە -->
                <div style="margin-top: 20px;">
                    <div class="cart-items-container">
                        <ul class="cart-items" id="cartItemsSale">
                            <!-- کاڵاکان لێرە زیاد دەکرێن -->
                        </ul>
                    </div>
                    
                    <!-- کۆی گشتی -->
                    <div style="margin-top: 20px; padding: 15px; background-color: white; border-radius: var(--border-radius);">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <h4 style="margin: 0;">کۆی گشتی:</h4>
                            <div id="cartTotalSale" style="font-size: 1.5rem; font-weight: bold; color: var(--primary);">
                                ٠ دینار
                            </div>
                        </div>
                        
                        <div id="cartSummary" style="margin-top: 10px; font-size: 0.9rem; color: var(--gray);">
                            <!-- وەسفی کۆی گشتی -->
                        </div>
                    </div>
                    
                    <!-- دووگمەکانی کردار -->
                    <div class="action-buttons" style="margin-top: 20px;">
                        <button class="btn btn-warning" id="printInvoiceSale">
                            <i class="fas fa-print"></i> پرێنتکردن
                        </button>
                        <button class="btn btn-success" id="completeSaleBtn">
                            <i class="fas fa-check-circle"></i> تەواوکردنی فرۆشتن
                        </button>
                    </div>
                </div>
            `;
            
            // زیادکردنی کارگێڕەکان
            setupSaleEventHandlers();
            updateCartDisplay();
        }

        // ڕێکخستنی کارگێڕەکانی فرۆشتن
        function setupSaleEventHandlers() {
            // گەڕان بۆ کاڵا
            const productSearchSale = document.getElementById('productSearchSale');
            if (productSearchSale) {
                productSearchSale.addEventListener('input', function() {
                    const query = this.value.toLowerCase();
                    const suggestions = document.getElementById('productSuggestionsSale');
                    
                    if (!suggestions) return;
                    
                    if (query.length < 1) {
                        suggestions.style.display = 'none';
                        return;
                    }
                    
                    const filteredProducts = sampleData.products.filter(p => 
                        p.name.toLowerCase().includes(query) || 
                        (p.barcode && p.barcode.includes(query))
                    );
                    
                    suggestions.innerHTML = '';
                    
                    if (filteredProducts.length === 0) {
                        suggestions.style.display = 'none';
                        return;
                    }
                    
                    filteredProducts.forEach(product => {
                        const div = document.createElement('div');
                        div.className = 'suggestion-item';
                        
                        const imageHTML = product.image 
                            ? `<img src="${product.image}" style="width: 40px; height: 40px; border-radius: 5px; object-fit: cover; margin-left: 10px; float: right;">`
                            : '';
                        
                        div.innerHTML = `
                            <div style="display: flex; align-items: center;">
                                ${imageHTML}
                                <div style="flex: 1;">
                                    <div><strong>${product.name}</strong></div>
                                    <div style="font-size: 0.9rem; color: var(--gray);">
                                        ${product.salePrice.toLocaleString()} دینار | بەردەست: ${product.stock} ${getUnitName(product.unit)}
                                    </div>
                                    <div style="font-size: 0.8rem; color: var(--info);">
                                        بارکۆد: ${product.barcode}
                                    </div>
                                </div>
                            </div>
                        `;
                        
                        div.addEventListener('click', function() {
                            addProductToCart(product.id, 1, null, null);
                            productSearchSale.value = '';
                            suggestions.style.display = 'none';
                            updateCartDisplay();
                        });
                        
                        suggestions.appendChild(div);
                    });
                    
                    suggestions.style.display = 'block';
                });
            }
            
            // زیادکردنی کارگێڕی بۆ دووگمەی سڕینەوەی سەبەتە
            const clearCartBtn = document.getElementById('clearCart');
            if (clearCartBtn) {
                clearCartBtn.addEventListener('click', function() {
                    if (confirm('دڵنیای لە سڕینەوەی هەموو کاڵاکانی سەبەتە؟')) {
                        cart = [];
                        updateCartDisplay();
                    }
                });
            }
            
            // زیادکردنی کارگێڕی بۆ هەڵبژاردنی شێوازی پارەدان
            document.querySelectorAll('#newSale .payment-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('#newSale .payment-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    
                    this.classList.add('selected');
                    const paymentType = this.getAttribute('data-payment');
                    
                    const customerSelection = document.getElementById('customerSelection');
                    if (customerSelection) {
                        if (paymentType === 'credit') {
                            customerSelection.style.display = 'block';
                        } else {
                            customerSelection.style.display = 'none';
                            selectedCustomer = null;
                            document.getElementById('selectedCustomerInfo').style.display = 'none';
                        }
                    }
                    
                    updateCartSummary();
                });
            });
            
            // گەڕان بۆ کەسەکان
            const customerSearchSale = document.getElementById('customerSearchSale');
            if (customerSearchSale) {
                customerSearchSale.addEventListener('input', function() {
                    const query = this.value.toLowerCase();
                    const suggestions = document.getElementById('customerSuggestionsSale');
                    
                    if (!suggestions) return;
                    
                    if (query.length < 1) {
                        suggestions.style.display = 'none';
                        return;
                    }
                    
                    const filteredCustomers = sampleData.customers.filter(c => 
                        c.name.toLowerCase().includes(query) ||
                        c.phone.includes(query)
                    );
                    
                    suggestions.innerHTML = '';
                    
                    if (filteredCustomers.length === 0) {
                        suggestions.style.display = 'none';
                        return;
                    }
                    
                    filteredCustomers.forEach(customer => {
                        const div = document.createElement('div');
                        div.className = 'suggestion-item';
                        div.innerHTML = `
                            <div><strong>${customer.name}</strong></div>
                            <div style="font-size: 0.9rem; color: var(--gray);">
                                ${customer.phone} | <span class="${customer.debt > 0 ? 'debt-positive' : 'debt-zero'}">${customer.debt > 0 ? customer.debt.toLocaleString() + ' دینار قەرز' : 'بێ قەرز'}</span>
                            </div>
                        `;
                        
                        div.addEventListener('click', function() {
                            selectedCustomer = customer;
                            document.getElementById('customerSearchSale').value = customer.name;
                            document.getElementById('selectedCustomerNameSale').textContent = customer.name;
                            document.getElementById('selectedCustomerDebtSale').textContent = customer.debt.toLocaleString() + ' دینار';
                            document.getElementById('selectedCustomerInfo').style.display = 'block';
                            suggestions.style.display = 'none';
                        });
                        
                        suggestions.appendChild(div);
                    });
                    
                    suggestions.style.display = 'block';
                });
            }
            
            // دووگمەی پرێنتکردن
            const printInvoiceSale = document.getElementById('printInvoiceSale');
            if (printInvoiceSale) {
                printInvoiceSale.addEventListener('click', function() {
                    if (cart.length === 0) {
                        showNotification('سەبەتە بەتاڵە! یەکێک لە کاڵاکان زیاد بکە', 'error');
                        return;
                    }
                    
                    const paymentType = document.querySelector('#newSale .payment-option.selected')?.getAttribute('data-payment') || 'cash';
                    
                    if (paymentType === 'credit' && !selectedCustomer) {
                        showNotification('تکایە کەسێک هەڵبژێرە بۆ فرۆشتن بە قەرز', 'error');
                        return;
                    }
                    
                    // دروستکردنی فاکتوور
                    generateInvoice();
                });
            }
            
            // دووگمەی تەواوکردنی فرۆشتن
            const completeSaleBtn = document.getElementById('completeSaleBtn');
            if (completeSaleBtn) {
                completeSaleBtn.addEventListener('click', function() {
                    completeSale();
                });
            }
        }

        // زیادکردنی کاڵا بۆ سەبەتە
        function addProductToCart(productId, quantity = 1, customPrice = null, customUnit = null) {
            const product = sampleData.products.find(p => p.id === productId);
            if (!product) return false;
            
            // پشکنینی بەردەستبوونی کاڵا
            if (product.stock < quantity) {
                showNotification(`تەنها ${product.stock} ${getUnitName(product.unit)} بەردەستە!`, 'error');
                return false;
            }
            
            const price = customPrice || product.salePrice;
            const unit = customUnit || product.unit;
            
            // پشکنینی ئەگەر کاڵاکە پێشتر لە سەبەتەدا بوو
            const existingIndex = cart.findIndex(item => 
                item.id === productId && 
                item.price === price && 
                item.unit === unit
            );
            
            if (existingIndex !== -1) {
                // زیادکردنی بە بڕی نوێ
                cart[existingIndex].quantity += quantity;
            } else {
                // زیادکردنی کاڵای نوێ
                const cartItem = {
                    id: productId,
                    name: product.name,
                    price: price,
                    originalPrice: product.salePrice,
                    quantity: quantity,
                    unit: unit,
                    image: product.image,
                    barcode: product.barcode,
                    hasSecondaryUnit: product.hasSecondaryUnit,
                    secondaryUnit: product.secondaryUnit,
                    secondaryUnitQuantity: product.secondaryUnitQuantity
                };
                
                cart.push(cartItem);
            }
            
            updateCartDisplay();
            return true;
        }

        // نوێکردنەوەی نیشاندانی سەبەتە
        function updateCartDisplay() {
            const cartItemsSale = document.getElementById('cartItemsSale');
            const cartTotalSale = document.getElementById('cartTotalSale');
            const cartSummary = document.getElementById('cartSummary');
            
            if (!cartItemsSale || !cartTotalSale || !cartSummary) return;
            
            cartItemsSale.innerHTML = '';
            
            if (cart.length === 0) {
                cartItemsSale.innerHTML = `
                    <li style="padding: 30px; text-align: center; color: var(--gray);">
                        <i class="fas fa-shopping-cart fa-3x" style="margin-bottom: 15px;"></i>
                        <p>سەبەتە بەتاڵە</p>
                        <p style="font-size: 0.9rem;">کاڵایەک زیاد بکە یان بارکۆدێک بخوێنەرەوە</p>
                    </li>
                `;
                
                cartTotalSale.textContent = '٠ دینار';
                cartSummary.innerHTML = '';
                return;
            }
            
            let total = 0;
            let totalItems = 0;
            
            cart.forEach((item, index) => {
                const product = sampleData.products.find(p => p.id === item.id);
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                totalItems += item.quantity;
                
                const li = document.createElement('li');
                li.className = 'cart-item';
                
                const imageHTML = item.image 
                    ? `<img src="${item.image}" alt="${item.name}" style="width: 60px; height: 60px; border-radius: 8px; object-fit: cover;">`
                    : `<div style="width: 60px; height: 60px; background-color: var(--gray-light); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: var(--gray);">
                        <i class="fas fa-box fa-2x"></i>
                    </div>`;
                
                li.innerHTML = `
                    <div class="cart-item-info" style="display: flex; align-items: center; flex: 1;">
                        <div style="margin-left: 15px;">
                            ${imageHTML}
                        </div>
                        <div style="flex: 1;">
                            <div class="item-name">${item.name}</div>
                            <div style="font-size: 0.9rem; color: var(--gray); margin-top: 5px;">
                                بارکۆد: ${item.barcode}
                            </div>
                            <div style="display: flex; align-items: center; margin-top: 10px; gap: 10px;">
                                <div style="display: flex; align-items: center; background-color: var(--gray-light); border-radius: 5px; padding: 2px 5px;">
                                    <button class="btn-quantity" onclick="updateCartItemQuantity(${index}, -1)" style="border: none; background: none; padding: 5px 10px; cursor: pointer;">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                    <input type="number" value="${item.quantity}" min="1" max="${product ? product.stock : 999}" 
                                        style="width: 50px; text-align: center; border: none; background: none;" 
                                        onchange="updateCartItemQuantity(${index}, 0, this.value)">
                                    <button class="btn-quantity" onclick="updateCartItemQuantity(${index}, 1)" style="border: none; background: none; padding: 5px 10px; cursor: pointer;">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                                
                                <select onchange="updateCartItemUnit(${index}, this.value)" style="padding: 5px 10px; border-radius: 5px; border: 1px solid var(--gray-light);">
                                    <option value="${item.unit}" selected>${getUnitName(item.unit)}</option>
                                    ${item.hasSecondaryUnit ? `<option value="${item.secondaryUnit}">${getUnitName(item.secondaryUnit)}</option>` : ''}
                                </select>
                                
                                <input type="number" value="${item.price}" min="1" style="width: 120px; padding: 5px 10px; border-radius: 5px; border: 1px solid var(--gray-light); text-align: left;"
                                    onchange="updateCartItemPrice(${index}, this.value)" placeholder="نرخ">
                            </div>
                        </div>
                    </div>
                    <div style="text-align: left;">
                        <div class="item-value" style="font-size: 1.2rem; font-weight: bold; color: var(--primary); margin-bottom: 10px;">
                            ${itemTotal.toLocaleString()} دینار
                        </div>
                        <div style="display: flex; gap: 5px;">
                            <button class="btn btn-danger btn-sm" onclick="removeFromCart(${index})">
                                <i class="fas fa-trash"></i>
                            </button>
                            <button class="btn btn-info btn-sm" onclick="editCartItemDetails(${index})">
                                <i class="fas fa-edit"></i>
                            </button>
                        </div>
                    </div>
                `;
                
                cartItemsSale.appendChild(li);
            });
            
            cartTotalSale.textContent = total.toLocaleString() + ' دینار';
            
            // نوێکردنەوەی کورتەوەسف
            updateCartSummary();
        }

        // نوێکردنەوەی کورتەوەسفی سەبەتە
        function updateCartSummary() {
            const cartSummary = document.getElementById('cartSummary');
            if (!cartSummary) return;
            
            if (cart.length === 0) {
                cartSummary.innerHTML = '';
                return;
            }
            
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            
            const paymentType = document.querySelector('#newSale .payment-option.selected')?.getAttribute('data-payment') || 'cash';
            let summaryText = `${totalItems} کاڵا | ${total.toLocaleString()} دینار | ${paymentType === 'cash' ? 'نەقدی' : 'قەرز'}`;
            
            if (paymentType === 'credit' && selectedCustomer) {
                summaryText += ` | کەس: ${selectedCustomer.name}`;
            }
            
            cartSummary.innerHTML = summaryText;
        }

        // نوێکردنەوەی بڕی کاڵا لە سەبەتە
        window.updateCartItemQuantity = function(index, change, newValue = null) {
            if (index < 0 || index >= cart.length) return;
            
            const product = sampleData.products.find(p => p.id === cart[index].id);
            if (!product) return;
            
            let newQuantity;
            
            if (newValue !== null) {
                newQuantity = parseInt(newValue) || 1;
            } else {
                newQuantity = cart[index].quantity + change;
            }
            
            // پشکنینی بەردەستبوون
            if (newQuantity < 1) {
                newQuantity = 1;
            }
            
            if (newQuantity > product.stock) {
                showNotification(`تەنها ${product.stock} ${getUnitName(cart[index].unit)} بەردەستە!`, 'error');
                return;
            }
            
            cart[index].quantity = newQuantity;
            updateCartDisplay();
        };

        // نوێکردنەوەی یەکەی کاڵا لە سەبەتە
        window.updateCartItemUnit = function(index, newUnit) {
            if (index < 0 || index >= cart.length) return;
            
            const product = sampleData.products.find(p => p.id === cart[index].id);
            if (!product) return;
            
            // پشکنینی ئەگەر یەکەی نوێ بەردەستە
            if (newUnit === product.unit || (product.hasSecondaryUnit && newUnit === product.secondaryUnit)) {
                cart[index].unit = newUnit;
                
                // گۆڕینی نرخ بەپێی یەکە
                if (newUnit === product.unit) {
                    cart[index].price = cart[index].originalPrice;
                } else if (newUnit === product.secondaryUnit && product.secondaryUnitQuantity > 0) {
                    // هەژمارکردنی نرخی یەکەی دووەم
                    cart[index].price = Math.ceil(product.salePrice / product.secondaryUnitQuantity);
                }
                
                updateCartDisplay();
            }
        };

        // نوێکردنەوەی نرخی کاڵا لە سەبەتە
        window.updateCartItemPrice = function(index, newPrice) {
            if (index < 0 || index >= cart.length) return;
            
            newPrice = parseInt(newPrice) || cart[index].originalPrice;
            
            if (newPrice < 1) {
                newPrice = 1;
            }
            
            cart[index].price = newPrice;
            updateCartDisplay();
        };

        // سڕینەوەی کاڵا لە سەبەتە
        window.removeFromCart = function(index) {
            if (index >= 0 && index < cart.length) {
                cart.splice(index, 1);
                updateCartDisplay();
            }
        };

        // گۆڕانکاری لە کاڵا لە سەبەتە
        window.editCartItemDetails = function(index) {
            if (index < 0 || index >= cart.length) return;
            
            const item = cart[index];
            const product = sampleData.products.find(p => p.id === item.id);
            if (!product) return;
            
            // دروستکردنی مۆدالی گۆڕانکاری
            const modalHTML = `
                <div class="modal active" id="editCartItemModal">
                    <div class="modal-content" style="max-width: 500px;">
                        <div class="modal-header">
                            <h3>گۆڕانکاری لە کاڵا: ${item.name}</h3>
                            <button class="modal-close" onclick="document.getElementById('editCartItemModal').remove()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label>بڕ</label>
                                <input type="number" id="editQuantity" value="${item.quantity}" min="1" max="${product.stock}" style="width: 100%; padding: 10px;">
                            </div>
                            
                            <div class="form-group">
                                <label>یەکە</label>
                                <select id="editUnit" style="width: 100%; padding: 10px;">
                                    <option value="${product.unit}" ${item.unit === product.unit ? 'selected' : ''}>${getUnitName(product.unit)}</option>
                                    ${product.hasSecondaryUnit ? `<option value="${product.secondaryUnit}" ${item.unit === product.secondaryUnit ? 'selected' : ''}>${getUnitName(product.secondaryUnit)}</option>` : ''}
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>نرخی فرۆشتن</label>
                                <input type="number" id="editPrice" value="${item.price}" min="1" style="width: 100%; padding: 10px;">
                            </div>
                            
                            <div class="action-buttons" style="margin-top: 20px;">
                                <button class="btn btn-danger" onclick="document.getElementById('editCartItemModal').remove()">
                                    پاشگەزبوونەوە
                                </button>
                                <button class="btn btn-success" onclick="saveCartItemEdit(${index})">
                                    هەڵگرتن
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // لابردنی مۆدالی پێشوو
            const existingModal = document.getElementById('editCartItemModal');
            if (existingModal) existingModal.remove();
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
        };

        // هەڵگرتنی گۆڕانکارییەکانی کاڵا
        window.saveCartItemEdit = function(index) {
            const editQuantity = document.getElementById('editQuantity');
            const editUnit = document.getElementById('editUnit');
            const editPrice = document.getElementById('editPrice');
            
            if (!editQuantity || !editUnit || !editPrice) return;
            
            const newQuantity = parseInt(editQuantity.value) || 1;
            const newUnit = editUnit.value;
            const newPrice = parseInt(editPrice.value) || cart[index].originalPrice;
            
            const product = sampleData.products.find(p => p.id === cart[index].id);
            if (!product) return;
            
            // پشکنینی بەردەستبوون
            if (newQuantity > product.stock) {
                showNotification(`تەنها ${product.stock} ${getUnitName(newUnit)} بەردەستە!`, 'error');
                return;
            }
            
            cart[index].quantity = newQuantity;
            cart[index].unit = newUnit;
            cart[index].price = newPrice;
            
            updateCartDisplay();
            document.getElementById('editCartItemModal').remove();
        };

        // دروستکردنی فاکتوور
        function generateInvoice() {
            if (cart.length === 0) {
                showNotification('سەبەتە بەتاڵە!', 'error');
                return;
            }
            
            const paymentType = document.querySelector('#newSale .payment-option.selected')?.getAttribute('data-payment') || 'cash';
            
            if (paymentType === 'credit' && !selectedCustomer) {
                showNotification('تکایە کەسێک هەڵبژێرە بۆ فرۆشتن بە قەرز', 'error');
                return;
            }
            
            // دروستکردنی مۆدالی پرێنت
            const printModal = document.getElementById('printModal');
            if (!printModal) return;
            
            const invoiceCode = `INV-${new Date().getFullYear()}-${Math.floor(Math.random() * 1000)}`;
            const now = new Date();
            const dateStr = `${now.getFullYear()}/${now.getMonth() + 1}/${now.getDate()}`;
            
            // نوێکردنەوەی زانیاری فاکتوور
            document.getElementById('invoiceCode').textContent = invoiceCode;
            document.getElementById('invoiceDate').textContent = dateStr;
            
            // نوێکردنەوەی زانیاری کڕیار
            if (paymentType === 'credit' && selectedCustomer) {
                document.getElementById('customerName').textContent = `ناوی کڕیار: ${selectedCustomer.name}`;
                document.getElementById('customerPhone').textContent = `ژمارەی موبایل: ${selectedCustomer.phone}`;
                document.getElementById('customerAddress').textContent = `ناونیشان: ${selectedCustomer.address || 'نەزانراو'}`;
            } else {
                document.getElementById('customerName').textContent = `ناوی کڕیار: کڕیاری نەناسراو`;
                document.getElementById('customerPhone').textContent = `ژمارەی موبایل: نەزانراو`;
                document.getElementById('customerAddress').textContent = `ناونیشان: نەزانراو`;
            }
            
            // نوێکردنەوەی کاڵاکانی فاکتوور
            const invoiceItems = document.getElementById('invoiceItems');
            if (invoiceItems) {
                invoiceItems.innerHTML = '';
                
                let total = 0;
                cart.forEach((item, index) => {
                    const itemTotal = item.price * item.quantity;
                    total += itemTotal;
                    
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${item.name}</td>
                        <td>${getUnitName(item.unit)}</td>
                        <td>${item.quantity}</td>
                        <td>${item.price.toLocaleString()} دینار</td>
                        <td>${itemTotal.toLocaleString()} دینار</td>
                    `;
                    invoiceItems.appendChild(tr);
                });
                
                // نوێکردنەوەی کۆی گشتی و قەرزەکان
                const previousDebt = paymentType === 'credit' && selectedCustomer ? selectedCustomer.debt : 0;
                const currentDebt = paymentType === 'credit' ? total : 0;
                const totalDebt = previousDebt + currentDebt;
                
                document.getElementById('invoiceTotal').textContent = `${total.toLocaleString()} دینار`;
                document.getElementById('previousDebt').textContent = `${previousDebt.toLocaleString()} دینار`;
                document.getElementById('currentDebt').textContent = `${currentDebt.toLocaleString()} دینار`;
                document.getElementById('totalDebt').textContent = `${totalDebt.toLocaleString()} دینار`;
            }
            
            // نیشاندانی مۆدال
            printModal.classList.add('active');
        }

        // تەواوکردنی فرۆشتن
        function completeSale() {
            if (cart.length === 0) {
                showNotification('سەبەتە بەتاڵە!', 'error');
                return;
            }
            
            const paymentType = document.querySelector('#newSale .payment-option.selected')?.getAttribute('data-payment') || 'cash';
            
            if (paymentType === 'credit' && !selectedCustomer) {
                showNotification('تکایە کەسێک هەڵبژێرە بۆ فرۆشتن بە قەرز', 'error');
                return;
            }
            
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const invoiceCode = `INV-${new Date().getFullYear()}-${sampleData.sales.length + 1}`;
            
            // دروستکردنی فاکتووری نوێ
            const newSale = {
                id: sampleData.sales.length + 1,
                code: invoiceCode,
                customer: paymentType === 'credit' && selectedCustomer ? selectedCustomer.name : 'کڕیاری نەناسراو',
                date: new Date().toISOString().split('T')[0],
                total: total,
                payment: paymentType,
                items: cart.map(item => ({
                    name: item.name,
                    quantity: item.quantity,
                    unit: item.unit,
                    price: item.price,
                    total: item.price * item.quantity
                })),
                timestamp: new Date().toISOString()
            };
            
            sampleData.sales.unshift(newSale);
            
            // پرۆسەکردنی فرۆشتن
            if (paymentType === 'cash') {
                // زیادکردنی پارە بۆ کۆی نەقدی
                sampleData.cashBalance += total;
                updateDashboardCash();
            } else if (paymentType === 'credit' && selectedCustomer) {
                // کەمکردنەوەی قەرز
                selectedCustomer.debt += total;
            }
            
            // کەمکردنەوەی کاڵا لە مخزن
            cart.forEach(item => {
                const product = sampleData.products.find(p => p.id === item.id);
                if (product) {
                    product.stock -= item.quantity;
                    if (product.stock < 0) product.stock = 0;
                }
            });
            
            // پاککردنەوەی سەبەتە
            cart = [];
            selectedCustomer = null;
            
            // نوێکردنەوەی نیشاندانەکان
            updateCartDisplay();
            populateSampleData();
            
            // نیشاندانی ئاگاداری
            showNotification(`فرۆشتنەکە بە سەرکەوتوویی تەواو بوو! کۆدی فاکتوورە: ${invoiceCode}`, 'success');
            
            // داخستنی مۆدالی پرێنت ئەگەر کراوە بێت
            const printModal = document.getElementById('printModal');
            if (printModal) printModal.classList.remove('active');
        }

        // ==============================================
        // سیستەمی کڕین - فەنکشنە نوێیەکان
        // ==============================================

        // دەستپێکردنی سیستەمی کڕین
        function initializePurchaseSystem() {
            const purchaseTab = document.getElementById('newPurchase');
            if (!purchaseTab) return;
            
            purchaseTab.innerHTML = `
                <div class="cart-container" id="purchaseCartContainer">
                    <div class="cart-header">
                        <h3>سەبەتەی کڕین</h3>
                        <div class="list-actions">
                            <button id="clearPurchaseCart" class="btn btn-danger btn-sm">
                                <i class="fas fa-trash"></i> سڕینەوەی هەموو سەبەتە
                            </button>
                        </div>
                    </div>
                    
                    <!-- گەڕان بۆ کاڵا -->
                    <div class="search-container" style="margin-bottom: 15px;">
                        <div class="search-box">
                            <input type="text" id="productSearchPurchase" placeholder="گەڕان بەدوای کاڵا یان بارکۆد...">
                            <i class="fas fa-search"></i>
                            <div class="suggestions" id="productSuggestionsPurchase"></div>
                        </div>
                    </div>
                    
                    <!-- هەڵبژاردنی شەریک -->
                    <div class="form-group" style="margin-top: 20px;">
                        <label for="partnerSearchPurchase">شەریک (ئارەزوومەندانە)</label>
                        <div class="search-box">
                            <input type="text" id="partnerSearchPurchase" placeholder="گەڕان بەدوای ناوی شەریک...">
                            <i class="fas fa-handshake"></i>
                            <div class="suggestions" id="partnerSuggestionsPurchase"></div>
                        </div>
                        <div id="selectedPartnerInfoPurchase" style="margin-top: 10px; display: none; padding: 10px; background-color: var(--gray-light); border-radius: var(--border-radius);">
                            <p><strong>شەریکی هەڵبژێردراو:</strong> <span id="selectedPartnerNamePurchase"></span></p>
                            <p><strong>قەرزی ئێستا:</strong> <span id="selectedPartnerDebtPurchase"></span> دینار</p>
                        </div>
                    </div>
                    
                    <!-- هەڵبژاردنی شێوازی پارەدان -->
                    <div class="payment-options" style="margin-top: 20px;">
                        <div class="payment-option selected" data-payment="cash">
                            <i class="fas fa-money-bill-wave fa-2x"></i>
                            <div style="margin-top: 10px;">نەقدی</div>
                        </div>
                        <div class="payment-option" data-payment="credit">
                            <i class="fas fa-file-invoice-dollar fa-2x"></i>
                            <div style="margin-top: 10px;">قەرز</div>
                        </div>
                    </div>
                    
                    <!-- لیستی کاڵاکانی سەبەتەی کڕین -->
                    <div style="margin-top: 20px;">
                        <div class="cart-items-container">
                            <ul class="cart-items" id="cartItemsPurchase">
                                <!-- کاڵاکان لێرە زیاد دەکرێن -->
                            </ul>
                        </div>
                        
                        <!-- کۆی گشتی -->
                        <div style="margin-top: 20px; padding: 15px; background-color: white; border-radius: var(--border-radius);">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <h4 style="margin: 0;">کۆی گشتی:</h4>
                                <div id="cartTotalPurchase" style="font-size: 1.5rem; font-weight: bold; color: var(--primary);">
                                    ٠ دینار
                                </div>
                            </div>
                            
                            <div id="cartSummaryPurchase" style="margin-top: 10px; font-size: 0.9rem; color: var(--gray);">
                                <!-- وەسفی کۆی گشتی -->
                            </div>
                        </div>
                        
                        <!-- دووگمەکانی کردار -->
                        <div class="action-buttons" style="margin-top: 20px;">
                            <button class="btn btn-warning" id="printPurchaseInvoice">
                                <i class="fas fa-print"></i> پرێنتکردنی فاکتووری کڕین
                            </button>
                            <button class="btn btn-success" id="completePurchaseBtn">
                                <i class="fas fa-check-circle"></i> تەواوکردنی کڕین
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            // زیادکردنی کارگێڕەکان
            setupPurchaseEventHandlers();
            updatePurchaseCartDisplay();
        }

        // ڕێکخستنی کارگێڕەکانی کڕین
        function setupPurchaseEventHandlers() {
            // گەڕان بۆ کاڵا
            const productSearchPurchase = document.getElementById('productSearchPurchase');
            if (productSearchPurchase) {
                productSearchPurchase.addEventListener('input', function() {
                    const query = this.value.toLowerCase();
                    const suggestions = document.getElementById('productSuggestionsPurchase');
                    
                    if (!suggestions) return;
                    
                    if (query.length < 1) {
                        suggestions.style.display = 'none';
                        return;
                    }
                    
                    const filteredProducts = sampleData.products.filter(p => 
                        p.name.toLowerCase().includes(query) || 
                        (p.barcode && p.barcode.includes(query))
                    );
                    
                    suggestions.innerHTML = '';
                    
                    if (filteredProducts.length === 0) {
                        suggestions.style.display = 'none';
                        return;
                    }
                    
                    filteredProducts.forEach(product => {
                        const div = document.createElement('div');
                        div.className = 'suggestion-item';
                        
                        const imageHTML = product.image 
                            ? `<img src="${product.image}" style="width: 40px; height: 40px; border-radius: 5px; object-fit: cover; margin-left: 10px; float: right;">`
                            : '';
                        
                        div.innerHTML = `
                            <div style="display: flex; align-items: center;">
                                ${imageHTML}
                                <div style="flex: 1;">
                                    <div><strong>${product.name}</strong></div>
                                    <div style="font-size: 0.9rem; color: var(--gray);">
                                        نرخی کڕین: ${product.purchasePrice.toLocaleString()} دینار | بەردەست: ${product.stock} ${getUnitName(product.unit)}
                                    </div>
                                    <div style="font-size: 0.8rem; color: var(--info);">
                                        بارکۆد: ${product.barcode}
                                    </div>
                                </div>
                            </div>
                        `;
                        
                        div.addEventListener('click', function() {
                            addProductToPurchaseCart(product.id, 1, null, null);
                            productSearchPurchase.value = '';
                            suggestions.style.display = 'none';
                            updatePurchaseCartDisplay();
                        });
                        
                        suggestions.appendChild(div);
                    });
                    
                    suggestions.style.display = 'block';
                });
            }
            
            // زیادکردنی کارگێڕی بۆ دووگمەی سڕینەوەی سەبەتەی کڕین
            const clearPurchaseCartBtn = document.getElementById('clearPurchaseCart');
            if (clearPurchaseCartBtn) {
                clearPurchaseCartBtn.addEventListener('click', function() {
                    if (confirm('دڵنیای لە سڕینەوەی هەموو کاڵاکانی سەبەتەی کڕین؟')) {
                        purchaseCart = [];
                        updatePurchaseCartDisplay();
                    }
                });
            }
            
            // گەڕان بۆ شەریکەکان
            const partnerSearchPurchase = document.getElementById('partnerSearchPurchase');
            if (partnerSearchPurchase) {
                partnerSearchPurchase.addEventListener('input', function() {
                    const query = this.value.toLowerCase();
                    const suggestions = document.getElementById('partnerSuggestionsPurchase');
                    
                    if (!suggestions) return;
                    
                    if (query.length < 1) {
                        suggestions.style.display = 'none';
                        return;
                    }
                    
                    const filteredPartners = sampleData.partners.filter(p => 
                        p.name.toLowerCase().includes(query) ||
                        p.phone.includes(query)
                    );
                    
                    suggestions.innerHTML = '';
                    
                    if (filteredPartners.length === 0) {
                        suggestions.style.display = 'none';
                        return;
                    }
                    
                    filteredPartners.forEach(partner => {
                        const div = document.createElement('div');
                        div.className = 'suggestion-item';
                        
                        // دیاریکردنی جۆری قەرز
                        let debtText, debtClass;
                        if (partner.debt > 0) {
                            debtText = `${partner.debt.toLocaleString()} دینار (شەریک قەرزداری منە)`;
                            debtClass = 'debt-positive';
                        } else if (partner.debt < 0) {
                            debtText = `${Math.abs(partner.debt).toLocaleString()} دینار (من قەرزداری ئەوانم)`;
                            debtClass = 'debt-negative';
                        } else {
                            debtText = 'بێ قەرز';
                            debtClass = 'debt-zero';
                        }
                        
                        div.innerHTML = `
                            <div><strong>${partner.name}</strong></div>
                            <div style="font-size: 0.9rem; color: var(--gray);">
                                ${partner.phone} | <span class="${debtClass}">${debtText}</span>
                            </div>
                        `;
                        
                        div.addEventListener('click', function() {
                            selectedPartner = partner;
                            document.getElementById('partnerSearchPurchase').value = partner.name;
                            document.getElementById('selectedPartnerNamePurchase').textContent = partner.name;
                            document.getElementById('selectedPartnerDebtPurchase').textContent = debtText;
                            document.getElementById('selectedPartnerInfoPurchase').style.display = 'block';
                            suggestions.style.display = 'none';
                        });
                        
                        suggestions.appendChild(div);
                    });
                    
                    suggestions.style.display = 'block';
                });
            }
            
            // زیادکردنی کارگێڕی بۆ هەڵبژاردنی شێوازی پارەدان
            document.querySelectorAll('#newPurchase .payment-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('#newPurchase .payment-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    
                    this.classList.add('selected');
                    updatePurchaseCartSummary();
                });
            });
            
            // دووگمەی پرێنتکردنی فاکتووری کڕین
            const printPurchaseInvoiceBtn = document.getElementById('printPurchaseInvoice');
            if (printPurchaseInvoiceBtn) {
                printPurchaseInvoiceBtn.addEventListener('click', function() {
                    if (purchaseCart.length === 0) {
                        showNotification('سەبەتەی کڕین بەتاڵە! یەکێک لە کاڵاکان زیاد بکە', 'error');
                        return;
                    }
                    
                    generatePurchaseInvoice();
                });
            }
            
            // دووگمەی تەواوکردنی کڕین
            const completePurchaseBtn = document.getElementById('completePurchaseBtn');
            if (completePurchaseBtn) {
                completePurchaseBtn.addEventListener('click', function() {
                    completePurchase();
                });
            }
        }

        // زیادکردنی کاڵا بۆ سەبەتەی کڕین
        function addProductToPurchaseCart(productId, quantity = 1, customPrice = null, customUnit = null) {
            const product = sampleData.products.find(p => p.id === productId);
            if (!product) return false;
            
            const price = customPrice || product.purchasePrice;
            const unit = customUnit || product.unit;
            
            // پشکنینی ئەگەر کاڵاکە پێشتر لە سەبەتەدا بوو
            const existingIndex = purchaseCart.findIndex(item => 
                item.id === productId && 
                item.price === price && 
                item.unit === unit
            );
            
            if (existingIndex !== -1) {
                // زیادکردنی بە بڕی نوێ
                purchaseCart[existingIndex].quantity += quantity;
            } else {
                // زیادکردنی کاڵای نوێ
                const cartItem = {
                    id: productId,
                    name: product.name,
                    price: price,
                    originalPrice: product.purchasePrice,
                    quantity: quantity,
                    unit: unit,
                    image: product.image,
                    barcode: product.barcode,
                    hasSecondaryUnit: product.hasSecondaryUnit,
                    secondaryUnit: product.secondaryUnit,
                    secondaryUnitQuantity: product.secondaryUnitQuantity,
                    salePrice: product.salePrice, // هەڵگرتنی نرخی فرۆشتن بۆ پێشنیاری گۆڕانکاری
                    currentPurchasePrice: product.purchasePrice // نرخی کڕینی ئێستا
                };
                
                purchaseCart.push(cartItem);
            }
            
            updatePurchaseCartDisplay();
            return true;
        }

        // نوێکردنەوەی نیشاندانی سەبەتەی کڕین
        function updatePurchaseCartDisplay() {
            const cartItemsPurchase = document.getElementById('cartItemsPurchase');
            const cartTotalPurchase = document.getElementById('cartTotalPurchase');
            const cartSummaryPurchase = document.getElementById('cartSummaryPurchase');
            
            if (!cartItemsPurchase || !cartTotalPurchase || !cartSummaryPurchase) return;
            
            cartItemsPurchase.innerHTML = '';
            
            if (purchaseCart.length === 0) {
                cartItemsPurchase.innerHTML = `
                    <li style="padding: 30px; text-align: center; color: var(--gray);">
                        <i class="fas fa-shopping-cart fa-3x" style="margin-bottom: 15px;"></i>
                        <p>سەبەتەی کڕین بەتاڵە</p>
                        <p style="font-size: 0.9rem;">کاڵایەک زیاد بکە یان بارکۆدێک بخوێنەرەوە</p>
                    </li>
                `;
                
                cartTotalPurchase.textContent = '٠ دینار';
                cartSummaryPurchase.innerHTML = '';
                return;
            }
            
            let total = 0;
            let totalItems = 0;
            
            purchaseCart.forEach((item, index) => {
                const product = sampleData.products.find(p => p.id === item.id);
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                totalItems += item.quantity;
                
                const li = document.createElement('li');
                li.className = 'cart-item';
                
                const imageHTML = item.image 
                    ? `<img src="${item.image}" alt="${item.name}" style="width: 60px; height: 60px; border-radius: 8px; object-fit: cover;">`
                    : `<div style="width: 60px; height: 60px; background-color: var(--gray-light); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: var(--gray);">
                        <i class="fas fa-box fa-2x"></i>
                      </div>`;
                
                // پێشنیاری گۆڕینی نرخی فرۆشتن ئەگەر نرخی کڕین گۆڕابێت
                let priceChangeWarning = '';
                if (item.price !== item.currentPurchasePrice) {
                    const oldSalePrice = item.salePrice;
                    const purchasePriceDiff = item.price - item.currentPurchasePrice;
                    const suggestedSalePrice = Math.max(1, Math.round(oldSalePrice + purchasePriceDiff));
                    
                    priceChangeWarning = `
                        <div style="background-color: #fff3cd; border: 1px solid #ffeaa7; border-radius: 5px; padding: 8px; margin-top: 5px; font-size: 0.9rem;">
                            <i class="fas fa-exclamation-triangle" style="color: #f39c12;"></i>
                            نرخی کڕین گۆڕاوە! پێشنیاری نرخی فرۆشتن: 
                            <strong>${suggestedSalePrice.toLocaleString()} دینار</strong>
                            <button class="btn btn-sm" style="padding: 2px 5px; font-size: 0.8rem; margin-right: 5px;" 
                                onclick="updateProductSalePrice(${item.id}, ${suggestedSalePrice})">
                                <i class="fas fa-check"></i> قبوڵکردن
                            </button>
                        </div>
                    `;
                }
                
                li.innerHTML = `
                    <div class="cart-item-info" style="display: flex; align-items: center; flex: 1;">
                        <div style="margin-left: 15px;">
                            ${imageHTML}
                        </div>
                        <div style="flex: 1;">
                            <div class="item-name">${item.name}</div>
                            <div style="font-size: 0.9rem; color: var(--gray); margin-top: 5px;">
                                بارکۆد: ${item.barcode}
                            </div>
                            ${priceChangeWarning}
                            <div style="display: flex; align-items: center; margin-top: 10px; gap: 10px;">
                                <div style="display: flex; align-items: center; background-color: var(--gray-light); border-radius: 5px; padding: 2px 5px;">
                                    <button class="btn-quantity" onclick="updatePurchaseCartItemQuantity(${index}, -1)" style="border: none; background: none; padding: 5px 10px; cursor: pointer;">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                    <input type="number" value="${item.quantity}" min="1" 
                                        style="width: 50px; text-align: center; border: none; background: none;" 
                                        onchange="updatePurchaseCartItemQuantity(${index}, 0, this.value)">
                                    <button class="btn-quantity" onclick="updatePurchaseCartItemQuantity(${index}, 1)" style="border: none; background: none; padding: 5px 10px; cursor: pointer;">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                                
                                <select onchange="updatePurchaseCartItemUnit(${index}, this.value)" style="padding: 5px 10px; border-radius: 5px; border: 1px solid var(--gray-light);">
                                    <option value="${item.unit}" selected>${getUnitName(item.unit)}</option>
                                    ${item.hasSecondaryUnit ? `<option value="${item.secondaryUnit}">${getUnitName(item.secondaryUnit)}</option>` : ''}
                                </select>
                                
                                <input type="number" value="${item.price}" min="1" style="width: 120px; padding: 5px 10px; border-radius: 5px; border: 1px solid var(--gray-light); text-align: left;"
                                    onchange="updatePurchaseCartItemPrice(${index}, this.value)" placeholder="نرخی کڕین">
                            </div>
                        </div>
                    </div>
                    <div style="text-align: left;">
                        <div class="item-value" style="font-size: 1.2rem; font-weight: bold; color: var(--primary); margin-bottom: 10px;">
                            ${itemTotal.toLocaleString()} دینار
                        </div>
                        <div style="display: flex; gap: 5px;">
                            <button class="btn btn-danger btn-sm" onclick="removeFromPurchaseCart(${index})">
                                <i class="fas fa-trash"></i>
                            </button>
                            <button class="btn btn-info btn-sm" onclick="editPurchaseCartItemDetails(${index})">
                                <i class="fas fa-edit"></i>
                            </button>
                        </div>
                    </div>
                `;
                
                cartItemsPurchase.appendChild(li);
            });
            
            cartTotalPurchase.textContent = total.toLocaleString() + ' دینار';
            
            // نوێکردنەوەی کورتەوەسف
            updatePurchaseCartSummary();
        }

        // نوێکردنەوەی کورتەوەسفی سەبەتەی کڕین
        function updatePurchaseCartSummary() {
            const cartSummaryPurchase = document.getElementById('cartSummaryPurchase');
            if (!cartSummaryPurchase) return;
            
            if (purchaseCart.length === 0) {
                cartSummaryPurchase.innerHTML = '';
                return;
            }
            
            const total = purchaseCart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const totalItems = purchaseCart.reduce((sum, item) => sum + item.quantity, 0);
            
            const paymentType = document.querySelector('#newPurchase .payment-option.selected')?.getAttribute('data-payment') || 'cash';
            let summaryText = `${totalItems} کاڵا | ${total.toLocaleString()} دینار | ${paymentType === 'cash' ? 'نەقدی' : 'قەرز'}`;
            
            if (selectedPartner) {
                summaryText += ` | شەریک: ${selectedPartner.name}`;
            }
            
            cartSummaryPurchase.innerHTML = summaryText;
        }

        // نوێکردنەوەی بڕی کاڵا لە سەبەتەی کڕین
        window.updatePurchaseCartItemQuantity = function(index, change, newValue = null) {
            if (index < 0 || index >= purchaseCart.length) return;
            
            let newQuantity;
            
            if (newValue !== null) {
                newQuantity = parseInt(newValue) || 1;
            } else {
                newQuantity = purchaseCart[index].quantity + change;
            }
            
            if (newQuantity < 1) {
                newQuantity = 1;
            }
            
            purchaseCart[index].quantity = newQuantity;
            updatePurchaseCartDisplay();
        };

        // نوێکردنەوەی یەکەی کاڵا لە سەبەتەی کڕین
        window.updatePurchaseCartItemUnit = function(index, newUnit) {
            if (index < 0 || index >= purchaseCart.length) return;
            
            const product = sampleData.products.find(p => p.id === purchaseCart[index].id);
            if (!product) return;
            
            // پشکنینی ئەگەر یەکەی نوێ بەردەستە
            if (newUnit === product.unit || (product.hasSecondaryUnit && newUnit === product.secondaryUnit)) {
                purchaseCart[index].unit = newUnit;
                updatePurchaseCartDisplay();
            }
        };

        // نوێکردنەوەی نرخی کڕین لە سەبەتە
        window.updatePurchaseCartItemPrice = function(index, newPrice) {
            if (index < 0 || index >= purchaseCart.length) return;
            
            newPrice = parseInt(newPrice) || purchaseCart[index].originalPrice;
            
            if (newPrice < 1) {
                newPrice = 1;
            }
            
            purchaseCart[index].price = newPrice;
            updatePurchaseCartDisplay();
        };

        // سڕینەوەی کاڵا لە سەبەتەی کڕین
        window.removeFromPurchaseCart = function(index) {
            if (index >= 0 && index < purchaseCart.length) {
                purchaseCart.splice(index, 1);
                updatePurchaseCartDisplay();
            }
        };

        // گۆڕانکاری لە کاڵا لە سەبەتەی کڕین
        window.editPurchaseCartItemDetails = function(index) {
            if (index < 0 || index >= purchaseCart.length) return;
            
            const item = purchaseCart[index];
            const product = sampleData.products.find(p => p.id === item.id);
            if (!product) return;
            
            // دروستکردنی مۆدالی گۆڕانکاری
            const modalHTML = `
                <div class="modal active" id="editPurchaseCartItemModal">
                    <div class="modal-content" style="max-width: 500px;">
                        <div class="modal-header">
                            <h3>گۆڕانکاری لە کاڵا: ${item.name}</h3>
                            <button class="modal-close" onclick="document.getElementById('editPurchaseCartItemModal').remove()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label>بڕ</label>
                                <input type="number" id="editPurchaseQuantity" value="${item.quantity}" min="1" style="width: 100%; padding: 10px;">
                            </div>
                            
                            <div class="form-group">
                                <label>یەکە</label>
                                <select id="editPurchaseUnit" style="width: 100%; padding: 10px;">
                                    <option value="${product.unit}" ${item.unit === product.unit ? 'selected' : ''}>${getUnitName(product.unit)}</option>
                                    ${product.hasSecondaryUnit ? `<option value="${product.secondaryUnit}" ${item.unit === product.secondaryUnit ? 'selected' : ''}>${getUnitName(product.secondaryUnit)}</option>` : ''}
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>نرخی کڕین</label>
                                <input type="number" id="editPurchasePrice" value="${item.price}" min="1" style="width: 100%; padding: 10px;">
                            </div>
                            
                            <div class="action-buttons" style="margin-top: 20px;">
                                <button class="btn btn-danger" onclick="document.getElementById('editPurchaseCartItemModal').remove()">
                                    پاشگەزبوونەوە
                                </button>
                                <button class="btn btn-success" onclick="savePurchaseCartItemEdit(${index})">
                                    هەڵگرتن
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // لابردنی مۆدالی پێشوو
            const existingModal = document.getElementById('editPurchaseCartItemModal');
            if (existingModal) existingModal.remove();
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
        };

        // هەڵگرتنی گۆڕانکارییەکانی کاڵا لە سەبەتەی کڕین
        window.savePurchaseCartItemEdit = function(index) {
            const editPurchaseQuantity = document.getElementById('editPurchaseQuantity');
            const editPurchaseUnit = document.getElementById('editPurchaseUnit');
            const editPurchasePrice = document.getElementById('editPurchasePrice');
            
            if (!editPurchaseQuantity || !editPurchaseUnit || !editPurchasePrice) return;
            
            const newQuantity = parseInt(editPurchaseQuantity.value) || 1;
            const newUnit = editPurchaseUnit.value;
            const newPrice = parseInt(editPurchasePrice.value) || purchaseCart[index].originalPrice;
            
            purchaseCart[index].quantity = newQuantity;
            purchaseCart[index].unit = newUnit;
            purchaseCart[index].price = newPrice;
            
            updatePurchaseCartDisplay();
            document.getElementById('editPurchaseCartItemModal').remove();
        };

        // نوێکردنەوەی نرخی فرۆشتن کاتێ نرخی کڕین گۆڕابێت
        window.updateProductSalePrice = function(productId, newSalePrice) {
            const product = sampleData.products.find(p => p.id === productId);
            if (product) {
                product.salePrice = newSalePrice;
                
                // نوێکردنەوەی نرخی فرۆشتن لە سەبەتەی کڕین
                const cartItem = purchaseCart.find(item => item.id === productId);
                if (cartItem) {
                    cartItem.salePrice = newSalePrice;
                    cartItem.currentPurchasePrice = cartItem.price;
                }
                
                updatePurchaseCartDisplay();
                showNotification('نرخی فرۆشتن بە سەرکەوتوویی نوێ کرایەوە!', 'success');
            }
        };

        // دروستکردنی فاکتووری کڕین
        function generatePurchaseInvoice() {
            if (purchaseCart.length === 0) {
                showNotification('سەبەتەی کڕین بەتاڵە!', 'error');
                return;
            }
            
            // دروستکردنی مۆدالی پرێنتی کڕین
            const modalHTML = `
                <div class="modal active" id="purchasePrintModal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>فاکتووری کڕین</h3>
                            <button class="modal-close" onclick="document.getElementById('purchasePrintModal').remove()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="invoice">
                                <div class="invoice-header">
                                    <div class="invoice-logo">الکترۆنیات</div>
                                    <h2>فاکتووری کڕین</h2>
                                    <p>کۆدی فاکتوورە: <span id="purchaseInvoiceCode">PUR-${new Date().getFullYear()}-${Math.floor(Math.random() * 1000)}</span></p>
                                    <p>بەروار: <span id="purchaseInvoiceDate">${new Date().toLocaleDateString('ar-IQ')}</span></p>
                                </div>
                                
                                <div class="invoice-details">
                                    <div>
                                        <h4>زانیاری کڕار:</h4>
                                        <p>ناوی سیستەم: الکترۆنیات</p>
                                        <p>ژمارەی موبایل: ٠٧٧٠١٢٣٤٥٦٧</p>
                                        <p>ناونیشان: هەولێر، کوردستان</p>
                                    </div>
                                    
                                    <div>
                                        <h4>زانیاری شەریک:</h4>
                                        <p id="purchasePartnerName">ناوی شەریک: ${selectedPartner ? selectedPartner.name : 'نەناسراو'}</p>
                                        <p id="purchasePartnerPhone">ژمارەی موبایل: ${selectedPartner ? selectedPartner.phone : 'نەزانراو'}</p>
                                        <p id="purchasePartnerAddress">ناونیشان: ${selectedPartner ? selectedPartner.address || 'نەزانراو' : 'نەزانراو'}</p>
                                    </div>
                                </div>
                                
                                <table class="invoice-table">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>ناوی کاڵا</th>
                                            <th>یەکە</th>
                                            <th>بڕ</th>
                                            <th>نرخ (کڕین)</th>
                                            <th>کۆی گشتی</th>
                                        </tr>
                                    </thead>
                                    <tbody id="purchaseInvoiceItems">
                                        ${purchaseCart.map((item, index) => {
                                            const itemTotal = item.price * item.quantity;
                                            return `
                                                <tr>
                                                    <td>${index + 1}</td>
                                                    <td>${item.name}</td>
                                                    <td>${getUnitName(item.unit)}</td>
                                                    <td>${item.quantity}</td>
                                                    <td>${item.price.toLocaleString()} دینار</td>
                                                    <td>${itemTotal.toLocaleString()} دینار</td>
                                                </tr>
                                            `;
                                        }).join('')}
                                    </tbody>
                                </table>
                                
                                <div class="invoice-total">
                                    <p><strong>کۆی گشتی:</strong> <span id="purchaseInvoiceTotal">${purchaseCart.reduce((sum, item) => sum + (item.price * item.quantity), 0).toLocaleString()} دینار</span></p>
                                    <p><strong>شێوازی پارەدان:</strong> <span id="purchasePaymentType">${document.querySelector('#newPurchase .payment-option.selected')?.getAttribute('data-payment') === 'cash' ? 'نەقدی' : 'قەرز'}</span></p>
                                    ${selectedPartner ? `<p><strong>قەرز پێشتر:</strong> <span>${Math.abs(selectedPartner.debt).toLocaleString()} دینار</span></p>` : ''}
                                    ${selectedPartner && document.querySelector('#newPurchase .payment-option.selected')?.getAttribute('data-payment') === 'credit' ? 
                                        `<p><strong>کۆی قەرز دوای کڕین:</strong> <span>${(Math.abs(selectedPartner.debt) + purchaseCart.reduce((sum, item) => sum + (item.price * item.quantity), 0)).toLocaleString()} دینار</span></p>` : ''}
                                </div>
                                
                                <div class="print-options">
                                    <button class="btn btn-warning" onclick="printPurchaseRealInvoice('small')">
                                        <i class="fas fa-print"></i> پرێنتی بچووک
                                    </button>
                                    <button class="btn btn-primary" onclick="printPurchaseRealInvoice('A4')">
                                        <i class="fas fa-print"></i> پرێنتی A4
                                    </button>
                                    <button class="btn btn-danger" onclick="document.getElementById('purchasePrintModal').remove()">
                                        <i class="fas fa-times"></i> داخستن
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // لابردنی مۆدالی پێشوو
            const existingModal = document.getElementById('purchasePrintModal');
            if (existingModal) existingModal.remove();
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }

        // تەواوکردنی کڕین
        function completePurchase() {
            if (purchaseCart.length === 0) {
                showNotification('سەبەتەی کڕین بەتاڵە!', 'error');
                return;
            }
            
            const paymentType = document.querySelector('#newPurchase .payment-option.selected')?.getAttribute('data-payment') || 'cash';
            const total = purchaseCart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const purchaseCode = `PUR-${new Date().getFullYear()}-${samplePurchaseData.purchases.length + 1}`;
            
            // دروستکردنی کڕینی نوێ
            const newPurchase = {
                id: samplePurchaseData.purchases.length + 1,
                code: purchaseCode,
                partner: selectedPartner ? selectedPartner.name : 'نەناسراو',
                date: new Date().toISOString().split('T')[0],
                total: total,
                payment: paymentType,
                items: purchaseCart.map(item => ({
                    name: item.name,
                    quantity: item.quantity,
                    unit: item.unit,
                    price: item.price,
                    total: item.price * item.quantity
                })),
                timestamp: new Date().toISOString()
            };
            
            samplePurchaseData.purchases.unshift(newPurchase);
            
            // پرۆسەکردنی کڕین
            if (paymentType === 'cash') {
                // کەمکردنەوەی پارە لە کۆی نەقدی
                sampleData.cashBalance -= total;
                updateDashboardCash();
            } else if (paymentType === 'credit' && selectedPartner) {
                // زیادکردنی قەرز (من قەرزداری شەریکم دەبم)
                selectedPartner.debt -= total;
            }
            
            // زیادکردنی کاڵا بۆ مخزن
            purchaseCart.forEach(item => {
                const product = sampleData.products.find(p => p.id === item.id);
                if (product) {
                    // زیادکردنی کاڵا بۆ بەردەستایی
                    product.stock += item.quantity;
                    
                    // نوێکردنەوەی نرخی کڕین
                    product.purchasePrice = item.price;
                    
                    // نوێکردنەوەی نرخی فرۆشتن خۆکارانە ئەگەر پێشنیار کرابێت
                    if (item.price !== item.currentPurchasePrice) {
                        const priceDiff = item.price - item.currentPurchasePrice;
                        product.salePrice = Math.max(1, Math.round(product.salePrice + priceDiff));
                    }
                } else {
                    // دروستکردنی کاڵای نوێ ئەگەر بوونی نەبوو
                    const newProduct = {
                        id: sampleData.products.length + 1,
                        name: item.name,
                        barcode: item.barcode || `BR${sampleData.products.length + 1000}`,
                        purchasePrice: item.price,
                        salePrice: Math.round(item.price * 1.2), // نرخی فرۆشتن بە شێوەیەکی خۆکار (20% زیاتر)
                        stock: item.quantity,
                        unit: item.unit,
                        image: item.image,
                        hasSecondaryUnit: item.hasSecondaryUnit,
                        secondaryUnit: item.secondaryUnit,
                        secondaryUnitQuantity: item.secondaryUnitQuantity
                    };
                    
                    sampleData.products.push(newProduct);
                }
            });
            
            // پاککردنەوەی سەبەتە
            purchaseCart = [];
            selectedPartner = null;
            
            // نوێکردنەوەی نیشاندانەکان
            updatePurchaseCartDisplay();
            populateSampleData();
            
            // نیشاندانی ئاگاداری
            showNotification(`کڕینەکە بە سەرکەوتوویی تەواو بوو! کۆدی فاکتوورە: ${purchaseCode}`, 'success');
            
            // داخستنی مۆدالەکان
            const purchasePrintModal = document.getElementById('purchasePrintModal');
            if (purchasePrintModal) purchasePrintModal.remove();
        }

        // پرێنتکردنی ڕاستەقینەی فاکتووری کڕین
        window.printPurchaseRealInvoice = function(size = 'small') {
            const purchasePrintModal = document.getElementById('purchasePrintModal');
            if (!purchasePrintModal) {
                showNotification('مۆدالی پرێنتی کڕین نەدۆزرایەوە!', 'error');
                return;
            }
            
            // دروستکردنی پەڕەی نوێ بۆ پرێنت
            const printWindow = window.open('', '_blank');
            
            // دروستکردنی HTML بۆ پرێنت
            const invoiceContent = purchasePrintModal.querySelector('.invoice');
            if (!invoiceContent) return;
            
            const printHTML = `
                <!DOCTYPE html>
                <html lang="ar" dir="rtl">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>فاکتووری کڕین</title>
                    <style>
                        @media print {
                            body {
                                margin: 0;
                                padding: 0;
                                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                                font-size: ${size === 'small' ? '12px' : '14px'};
                                line-height: 1.4;
                            }
                            
                            .print-container {
                                width: ${size === 'small' ? '80mm' : '210mm'};
                                padding: ${size === 'small' ? '5px' : '20px'};
                                margin: 0 auto;
                            }
                            
                            .invoice-header {
                                text-align: center;
                                border-bottom: 2px solid #4361ee;
                                padding-bottom: 10px;
                                margin-bottom: 20px;
                            }
                            
                            .invoice-logo {
                                font-size: ${size === 'small' ? '1.5rem' : '2rem'};
                                font-weight: 800;
                                color: #4361ee;
                                margin-bottom: 5px;
                            }
                            
                            .invoice-title {
                                font-size: ${size === 'small' ? '1rem' : '1.5rem'};
                                margin: 5px 0;
                            }
                            
                            .invoice-details {
                                display: grid;
                                grid-template-columns: 1fr 1fr;
                                gap: 15px;
                                margin-bottom: 20px;
                            }
                            
                            .invoice-table {
                                width: 100%;
                                border-collapse: collapse;
                                margin-bottom: 20px;
                            }
                            
                            .invoice-table th, .invoice-table td {
                                padding: ${size === 'small' ? '3px 5px' : '8px 10px'};
                                text-align: right;
                                border-bottom: 1px solid #ddd;
                            }
                            
                            .invoice-table th {
                                background-color: #f8f9fa;
                                font-weight: bold;
                            }
                            
                            .invoice-total {
                                margin-top: 20px;
                                padding-top: 10px;
                                border-top: 2px solid #ddd;
                                text-align: left;
                            }
                            
                            .invoice-footer {
                                text-align: center;
                                margin-top: 30px;
                                padding-top: 10px;
                                border-top: 1px dashed #ddd;
                                color: #6c757d;
                                font-size: 0.9rem;
                            }
                            
                            .no-print {
                                display: none !important;
                            }
                        }
                        
                        @page {
                            margin: 0;
                            size: ${size === 'small' ? '80mm auto' : 'A4'};
                        }
                        
                        body {
                            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                            font-size: ${size === 'small' ? '12px' : '14px'};
                        }
                        
                        .print-container {
                            width: ${size === 'small' ? '80mm' : '210mm'};
                            padding: ${size === 'small' ? '5px' : '20px'};
                            margin: 0 auto;
                        }
                        
                        .invoice-header {
                            text-align: center;
                            border-bottom: 2px solid #4361ee;
                            padding-bottom: 10px;
                            margin-bottom: 20px;
                        }
                        
                        .invoice-logo {
                            font-size: ${size === 'small' ? '1.5rem' : '2rem'};
                            font-weight: 800;
                            color: #4361ee;
                            margin-bottom: 5px;
                        }
                        
                        .invoice-title {
                            font-size: ${size === 'small' ? '1rem' : '1.5rem'};
                            margin: 5px 0;
                        }
                        
                        .invoice-details {
                            display: grid;
                            grid-template-columns: 1fr 1fr;
                            gap: 15px;
                            margin-bottom: 20px;
                        }
                        
                        .invoice-table {
                            width: 100%;
                            border-collapse: collapse;
                            margin-bottom: 20px;
                        }
                        
                        .invoice-table th, .invoice-table td {
                            padding: ${size === 'small' ? '3px 5px' : '8px 10px'};
                            text-align: right;
                            border-bottom: 1px solid #ddd;
                        }
                        
                        .invoice-table th {
                            background-color: #f8f9fa;
                            font-weight: bold;
                        }
                        
                        .invoice-total {
                            margin-top: 20px;
                            padding-top: 10px;
                            border-top: 2px solid #ddd;
                            text-align: left;
                        }
                        
                        .invoice-footer {
                            text-align: center;
                            margin-top: 30px;
                            padding-top: 10px;
                            border-top: 1px dashed #ddd;
                            color: #6c757d;
                            font-size: 0.9rem;
                        }
                    </style>
                </head>
                <body>
                    <div class="print-container">
                        ${invoiceContent.innerHTML.replace('print-options', 'print-options no-print')}
                        <div class="invoice-footer">
                            <p>سپاس بۆ کڕین لە کۆمپانیای ئەلکترۆنیات</p>
                            <p>ژمارەی پەیوەندی: ٠٧٧٠١٢٣٤٥٦٧</p>
                            <p>بەروار: ${new Date().toLocaleDateString('ar-IQ')}</p>
                        </div>
                    </div>
                    
                    <script>
                        window.onload = function() {
                            // پرێنتکردن لەسەر بارکردنی پەڕەکە
                            setTimeout(function() {
                                window.print();
                                
                                // داخستنی پەڕە دوای پرێنتکردن
                                setTimeout(function() {
                                    window.close();
                                }, 1000);
                            }, 500);
                        };
                    <\/script>
                </body>
                </html>
            `;
            
            // نووسینی HTML بۆ پەڕەی نوێ
            printWindow.document.open();
            printWindow.document.write(printHTML);
            printWindow.document.close();
            
            // داخستنی مۆدال پاش پرێنتکردن
            setTimeout(() => {
                purchasePrintModal.remove();
            }, 1000);
        };

        // ==============================================
        // بەشی مێژووی کڕین - فەنکشنە نوێیەکان
        // ==============================================

        // نوێکردنەوەی مێژووی کڕین
        function updatePurchaseHistoryDisplay() {
            const purchaseHistoryTab = document.getElementById('purchaseHistory');
            if (!purchaseHistoryTab) return;
            
            purchaseHistoryTab.innerHTML = `
                <div class="history-container">
                    <div class="search-container">
                        <div class="search-box">
                            <input type="text" id="purchaseHistorySearch" placeholder="گەڕان بە کۆدی فاکتوورە یان ناوی شەریک...">
                            <i class="fas fa-search"></i>
                        </div>
                    </div>
                    
                    <div class="list-box">
                        <div class="list-header">
                            <h3>مێژووی کڕین</h3>
                            <div class="list-actions">
                                <button id="refreshPurchaseHistory">نوێکردنەوە</button>
                            </div>
                        </div>
                        <div class="history-list">
                            <ul class="list-items" id="purchaseHistoryList">
                                <!-- مێژووی کڕین لێرە زیاد دەکرێن -->
                            </ul>
                        </div>
                    </div>
                </div>
            `;
            
            // زیادکردنی کارگێڕەکان
            setupPurchaseHistoryEventHandlers();
            populatePurchaseHistory();
        }

        // ڕێکخستنی کارگێڕەکانی مێژووی کڕین
        function setupPurchaseHistoryEventHandlers() {
            // گەڕان لە مێژووی کڕین
            const purchaseHistorySearch = document.getElementById('purchaseHistorySearch');
            if (purchaseHistorySearch) {
                purchaseHistorySearch.addEventListener('input', function() {
                    const query = this.value.toLowerCase();
                    const items = document.querySelectorAll('#purchaseHistoryList .list-item');
                    
                    items.forEach(item => {
                        const text = item.textContent.toLowerCase();
                        if (text.includes(query)) {
                            item.style.display = 'flex';
                        } else {
                            item.style.display = 'none';
                        }
                    });
                });
            }
            
            // نوێکردنەوەی مێژووی کڕین
            const refreshPurchaseHistoryBtn = document.getElementById('refreshPurchaseHistory');
            if (refreshPurchaseHistoryBtn) {
                refreshPurchaseHistoryBtn.addEventListener('click', function() {
                    populatePurchaseHistory();
                    showNotification('مێژووی کڕین نوێ کرایەوە!', 'info');
                });
            }
        }

        // زیادکردنی مێژووی کڕین
        function populatePurchaseHistory() {
            const purchaseHistoryList = document.getElementById('purchaseHistoryList');
            if (!purchaseHistoryList) return;
            
            purchaseHistoryList.innerHTML = '';
            
            if (samplePurchaseData.purchases.length === 0) {
                purchaseHistoryList.innerHTML = '<li class="list-item">هیچ مێژووی کڕینی تۆمارنەکراوە</li>';
                return;
            }
            
            samplePurchaseData.purchases.forEach(purchase => {
                const li = document.createElement('li');
                li.className = 'list-item';
                li.setAttribute('data-purchase-id', purchase.id);
                li.innerHTML = `
                    <div>
                        <div class="item-name">${purchase.code} - ${purchase.partner}</div>
                        <div style="font-size: 0.9rem; color: var(--gray);">
                            ${purchase.date} - ${purchase.payment === 'cash' ? 'نەقدی' : 'قەرز'}
                        </div>
                        <div style="font-size: 0.9rem; color: var(--info);">
                            ${purchase.items.length} کاڵا
                        </div>
                    </div>
                    <div>
                        <div class="item-value">${purchase.total.toLocaleString()} دینار</div>
                        <div style="margin-top: 10px; display: flex; gap: 5px;">
                            <button class="btn btn-info btn-sm" onclick="viewPurchaseInvoiceDetails(${purchase.id})">
                                <i class="fas fa-eye"></i> بینین
                            </button>
                            <button class="btn btn-warning btn-sm" onclick="printPurchaseInvoiceFromHistory('${purchase.code}', 'small')">
                                <i class="fas fa-print"></i> بچووک
                            </button>
                            <button class="btn btn-primary btn-sm" onclick="printPurchaseInvoiceFromHistory('${purchase.code}', 'A4')">
                                <i class="fas fa-print"></i> A4
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="deletePurchaseInvoice(${purchase.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
                purchaseHistoryList.appendChild(li);
            });
        }

        // بینینی وردەکاری فاکتووری کڕین
        window.viewPurchaseInvoiceDetails = function(purchaseId) {
            const purchase = samplePurchaseData.purchases.find(p => p.id === purchaseId);
            if (!purchase) return;
            
            // چاک کردنی ئەگەر مۆدالێکی پێشوو هەبێت
            const existingModal = document.getElementById('purchaseInvoiceDetailModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            const partner = sampleData.partners.find(p => p.name === purchase.partner);
            
            const modalHTML = `
                <div class="modal active" id="purchaseInvoiceDetailModal">
                    <div class="modal-content" style="max-width: 1000px;">
                        <div class="modal-header">
                            <h3>فاکتووری کڕین: ${purchase.code}</h3>
                            <button class="modal-close" onclick="document.getElementById('purchaseInvoiceDetailModal').remove()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="invoice">
                                <div class="invoice-header">
                                    <div class="invoice-logo">الکترۆنیات</div>
                                    <h2>فاکتووری کڕین</h2>
                                    <p>کۆدی فاکتوورە: ${purchase.code}</p>
                                    <p>بەروار: ${purchase.date}</p>
                                </div>
                                
                                <div class="invoice-details">
                                    <div>
                                        <h4>زانیاری کڕار:</h4>
                                        <p>ناوی سیستەم: الکترۆنیات</p>
                                        <p>ژمارەی موبایل: ٠٧٧٠١٢٣٤٥٦٧</p>
                                        <p>ناونیشان: هەولێر، کوردستان</p>
                                    </div>
                                    
                                    <div>
                                        <h4>زانیاری شەریک:</h4>
                                        <p>ناوی شەریک: ${purchase.partner}</p>
                                        <p>ژمارەی موبایل: ${partner ? partner.phone : 'نەزانراو'}</p>
                                        <p>ناونیشان: ${partner ? partner.address : 'نەزانراو'}</p>
                                    </div>
                                </div>
                                
                                <table class="invoice-table">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>ناوی کاڵا</th>
                                            <th>یەکە</th>
                                            <th>بڕ</th>
                                            <th>نرخ (کڕین)</th>
                                            <th>کۆی گشتی</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${purchase.items.map((item, index) => `
                                            <tr>
                                                <td>${index + 1}</td>
                                                <td>${item.name}</td>
                                                <td>${getUnitName(item.unit)}</td>
                                                <td>${item.quantity}</td>
                                                <td>${item.price.toLocaleString()} دینار</td>
                                                <td>${item.total.toLocaleString()} دینار</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                                
                                <div class="invoice-total">
                                    <p><strong>کۆی گشتی:</strong> ${purchase.total.toLocaleString()} دینار</p>
                                    <p><strong>شێوازی پارەدان:</strong> ${purchase.payment === 'cash' ? 'نەقدی' : 'قەرز'}</p>
                                </div>
                            </div>
                            
                            <div class="print-options" style="margin-top: 30px;">
                                <button class="btn btn-warning" onclick="printPurchaseInvoiceFromHistory('${purchase.code}', 'small')">
                                    <i class="fas fa-print"></i> پرێنتی بچووک
                                </button>
                                <button class="btn btn-primary" onclick="printPurchaseInvoiceFromHistory('${purchase.code}', 'A4')">
                                    <i class="fas fa-print"></i> پرێنتی A4
                                </button>
                                <button class="btn btn-danger" onclick="document.getElementById('purchaseInvoiceDetailModal').remove()">
                                    <i class="fas fa-times"></i> داخستن
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
        };

        // پرێنتکردنی فاکتووری کڕین لە مێژوو
        window.printPurchaseInvoiceFromHistory = function(purchaseCode, size = 'small') {
            const purchase = samplePurchaseData.purchases.find(p => p.code === purchaseCode);
            if (!purchase) {
                showNotification('فاکتووری کڕین نەدۆزرایەوە!', 'error');
                return;
            }
            
            // دروستکردنی پەڕەی نوێ بۆ پرێنت
            const printWindow = window.open('', '_blank');
            
            // دروستکردنی HTML بۆ پرێنت
            const partner = sampleData.partners.find(p => p.name === purchase.partner);
            
            const printHTML = `
                <!DOCTYPE html>
                <html lang="ar" dir="rtl">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>فاکتووری کڕین - ${purchase.code}</title>
                    <style>
                        @media print {
                            body {
                                margin: 0;
                                padding: 0;
                                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                                font-size: ${size === 'small' ? '12px' : '14px'};
                                line-height: 1.4;
                            }
                            
                            .print-container {
                                width: ${size === 'small' ? '80mm' : '210mm'};
                                padding: ${size === 'small' ? '5px' : '20px'};
                                margin: 0 auto;
                            }
                            
                            .invoice-header {
                                text-align: center;
                                border-bottom: 2px solid #4361ee;
                                padding-bottom: 10px;
                                margin-bottom: 20px;
                            }
                            
                            .invoice-logo {
                                font-size: ${size === 'small' ? '1.5rem' : '2rem'};
                                font-weight: 800;
                                color: #4361ee;
                                margin-bottom: 5px;
                            }
                            
                            .invoice-title {
                                font-size: ${size === 'small' ? '1rem' : '1.5rem'};
                                margin: 5px 0;
                            }
                            
                            .invoice-details {
                                display: grid;
                                grid-template-columns: 1fr 1fr;
                                gap: 15px;
                                margin-bottom: 20px;
                            }
                            
                            .invoice-table {
                                width: 100%;
                                border-collapse: collapse;
                                margin-bottom: 20px;
                            }
                            
                            .invoice-table th, .invoice-table td {
                                padding: ${size === 'small' ? '3px 5px' : '8px 10px'};
                                text-align: right;
                                border-bottom: 1px solid #ddd;
                            }
                            
                            .invoice-table th {
                                background-color: #f8f9fa;
                                font-weight: bold;
                            }
                            
                            .invoice-total {
                                margin-top: 20px;
                                padding-top: 10px;
                                border-top: 2px solid #ddd;
                                text-align: left;
                            }
                            
                            .invoice-footer {
                                text-align: center;
                                margin-top: 30px;
                                padding-top: 10px;
                                border-top: 1px dashed #ddd;
                                color: #6c757d;
                                font-size: 0.9rem;
                            }
                            
                            .no-print {
                                display: none !important;
                            }
                        }
                        
                        @page {
                            margin: 0;
                            size: ${size === 'small' ? '80mm auto' : 'A4'};
                        }
                        
                        body {
                            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                            font-size: ${size === 'small' ? '12px' : '14px'};
                        }
                        
                        .print-container {
                            width: ${size === 'small' ? '80mm' : '210mm'};
                            padding: ${size === 'small' ? '5px' : '20px'};
                            margin: 0 auto;
                        }
                        
                        .invoice-header {
                            text-align: center;
                            border-bottom: 2px solid #4361ee;
                            padding-bottom: 10px;
                            margin-bottom: 20px;
                        }
                        
                        .invoice-logo {
                            font-size: ${size === 'small' ? '1.5rem' : '2rem'};
                            font-weight: 800;
                            color: #4361ee;
                            margin-bottom: 5px;
                        }
                        
                        .invoice-title {
                            font-size: ${size === 'small' ? '1rem' : '1.5rem'};
                            margin: 5px 0;
                        }
                        
                        .invoice-details {
                            display: grid;
                            grid-template-columns: 1fr 1fr;
                            gap: 15px;
                            margin-bottom: 20px;
                        }
                        
                        .invoice-table {
                            width: 100%;
                            border-collapse: collapse;
                            margin-bottom: 20px;
                        }
                        
                        .invoice-table th, .invoice-table td {
                            padding: ${size === 'small' ? '3px 5px' : '8px 10px'};
                            text-align: right;
                            border-bottom: 1px solid #ddd;
                        }
                        
                        .invoice-table th {
                            background-color: #f8f9fa;
                            font-weight: bold;
                        }
                        
                        .invoice-total {
                            margin-top: 20px;
                            padding-top: 10px;
                            border-top: 2px solid #ddd;
                            text-align: left;
                        }
                        
                        .invoice-footer {
                            text-align: center;
                            margin-top: 30px;
                            padding-top: 10px;
                            border-top: 1px dashed #ddd;
                            color: #6c757d;
                            font-size: 0.9rem;
                        }
                    </style>
                </head>
                <body>
                    <div class="print-container">
                        <div class="invoice">
                            <div class="invoice-header">
                                <div class="invoice-logo">الکترۆنیات</div>
                                <h2>فاکتووری کڕین</h2>
                                <p>کۆدی فاکتوورە: ${purchase.code}</p>
                                <p>بەروار: ${purchase.date}</p>
                            </div>
                            
                            <div class="invoice-details">
                                <div>
                                    <h4>زانیاری کڕار:</h4>
                                    <p>ناوی سیستەم: الکترۆنیات</p>
                                    <p>ژمارەی موبایل: ٠٧٧٠١٢٣٤٥٦٧</p>
                                    <p>ناونیشان: هەولێر، کوردستان</p>
                                </div>
                                
                                <div>
                                    <h4>زانیاری شەریک:</h4>
                                    <p>ناوی شەریک: ${purchase.partner}</p>
                                    <p>ژمارەی موبایل: ${partner ? partner.phone : 'نەزانراو'}</p>
                                    <p>ناونیشان: ${partner ? partner.address : 'نەزانراو'}</p>
                                </div>
                            </div>
                            
                            <table class="invoice-table">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>ناوی کاڵا</th>
                                        <th>یەکە</th>
                                        <th>بڕ</th>
                                        <th>نرخ (کڕین)</th>
                                        <th>کۆی گشتی</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${purchase.items.map((item, index) => `
                                        <tr>
                                            <td>${index + 1}</td>
                                            <td>${item.name}</td>
                                            <td>${getUnitName(item.unit)}</td>
                                            <td>${item.quantity}</td>
                                            <td>${item.price.toLocaleString()} دینار</td>
                                            <td>${item.total.toLocaleString()} دینار</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                            
                            <div class="invoice-total">
                                <p><strong>کۆی گشتی:</strong> ${purchase.total.toLocaleString()} دینار</p>
                                <p><strong>شێوازی پارەدان:</strong> ${purchase.payment === 'cash' ? 'نەقدی' : 'قەرز'}</p>
                            </div>
                        </div>
                        
                        <div class="invoice-footer">
                            <p>سپاس بۆ کڕین لە کۆمپانیای ئەلکترۆنیات</p>
                            <p>ژمارەی پەیوەندی: ٠٧٧٠١٢٣٤٥٦٧</p>
                            <p>بەروار: ${new Date().toLocaleDateString('ar-IQ')}</p>
                        </div>
                    </div>
                    
                    <script>
                        window.onload = function() {
                            // پرێنتکردن لەسەر بارکردنی پەڕەکە
                            setTimeout(function() {
                                window.print();
                                
                                // داخستنی پەڕە دوای پرێنتکردن
                                setTimeout(function() {
                                    window.close();
                                }, 1000);
                            }, 500);
                        };
                    <\/script>
                </body>
                </html>
            `;
            
            // نووسینی HTML بۆ پەڕەی نوێ
            printWindow.document.open();
            printWindow.document.write(printHTML);
            printWindow.document.close();
            
            // داخستنی مۆدالەکان پاش پرێنتکردن
            setTimeout(() => {
                const detailModal = document.getElementById('purchaseInvoiceDetailModal');
                if (detailModal) detailModal.remove();
            }, 1000);
        };

        // سڕینەوەی فاکتووری کڕین
        window.deletePurchaseInvoice = function(purchaseId) {
            if (confirm('دڵنیای لە سڕینەوەی ئەم فاکتووری کڕینە؟')) {
                const index = samplePurchaseData.purchases.findIndex(p => p.id === purchaseId);
                if (index !== -1) {
                    const purchase = samplePurchaseData.purchases[index];
                    const partner = sampleData.partners.find(p => p.name === purchase.partner);
                    
                    // گەڕاندنەوەی پارە ئەگەر کڕین بە نەقدی بوو
                    if (purchase.payment === 'cash') {
                        sampleData.cashBalance += purchase.total;
                        updateDashboardCash();
                    } else if (purchase.payment === 'credit' && partner) {
                        // گەڕاندنەوەی قەرز
                        partner.debt += purchase.total;
                    }
                    
                    // کەمکردنەوەی کاڵا لە مخزن
                    purchase.items.forEach(item => {
                        const product = sampleData.products.find(p => p.name === item.name);
                        if (product) {
                            product.stock -= item.quantity;
                            if (product.stock < 0) product.stock = 0;
                        }
                    });
                    
                    samplePurchaseData.purchases.splice(index, 1);
                    populatePurchaseHistory();
                    populateSampleData();
                    showNotification('فاکتووری کڕین بە سەرکەوتوویی سڕایەوە!', 'success');
                }
            }
        };

        // ==============================================
        // مێژووی فرۆشتن - فەنکشنە نوێیەکان
        // ==============================================

        // نوێکردنەوەی مێژووی فرۆشتن
        function updateSaleHistoryDisplay() {
            const saleHistoryList = document.getElementById('saleHistoryList');
            if (!saleHistoryList) return;
            
            saleHistoryList.innerHTML = '';
            
            if (sampleData.sales.length === 0) {
                saleHistoryList.innerHTML = '<li class="list-item">هیچ مێژووی فرۆشتنی تۆمارنەکراوە</li>';
                return;
            }
            
            sampleData.sales.forEach(sale => {
                const li = document.createElement('li');
                li.className = 'list-item';
                li.setAttribute('data-sale-id', sale.id);
                li.innerHTML = `
                    <div>
                        <div class="item-name">${sale.code} - ${sale.customer}</div>
                        <div style="font-size: 0.9rem; color: var(--gray);">
                            ${sale.date} - ${sale.payment === 'cash' ? 'نەقدی' : 'قەرز'}
                        </div>
                        <div style="font-size: 0.9rem; color: var(--info);">
                            ${sale.items.length} کاڵا
                        </div>
                    </div>
                    <div>
                        <div class="item-value">${sale.total.toLocaleString()} دینار</div>
                        <div style="margin-top: 10px; display: flex; gap: 5px;">
                            <button class="btn btn-info btn-sm" onclick="viewSaleInvoiceDetails(${sale.id})">
                                <i class="fas fa-eye"></i> بینین
                            </button>
                            <button class="btn btn-warning btn-sm" onclick="printRealInvoice('${sale.code}', 'small')">
                                <i class="fas fa-print"></i> بچووک
                            </button>
                            <button class="btn btn-primary btn-sm" onclick="printRealInvoice('${sale.code}', 'A4')">
                                <i class="fas fa-print"></i> A4
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="deleteSaleInvoice(${sale.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
                saleHistoryList.appendChild(li);
            });
        }

        // بینینی وردەکاری فاکتووری فرۆشتن
        window.viewSaleInvoiceDetails = function(saleId) {
            const sale = sampleData.sales.find(s => s.id === saleId);
            if (!sale) return;
            
            // چاک کردنی ئەگەر مۆدالێکی پێشوو هەبێت
            const existingModal = document.getElementById('saleInvoiceDetailModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            const customer = sampleData.customers.find(c => c.name === sale.customer);
            
            const modalHTML = `
                <div class="modal active" id="saleInvoiceDetailModal">
                    <div class="modal-content" style="max-width: 1000px;">
                        <div class="modal-header">
                            <h3>فاکتووری فرۆشتن: ${sale.code}</h3>
                            <button class="modal-close" onclick="document.getElementById('saleInvoiceDetailModal').remove()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="invoice">
                                <div class="invoice-header">
                                    <div class="invoice-logo">الکترۆنیات</div>
                                    <h2>فاکتووری فرۆشتن</h2>
                                    <p>کۆدی فاکتوورە: ${sale.code}</p>
                                    <p>بەروار: ${sale.date}</p>
                                </div>
                                
                                <div class="invoice-details">
                                    <div>
                                        <h4>زانیاری فرۆشەر:</h4>
                                        <p>ناوی سیستەم: الکترۆنیات</p>
                                        <p>ژمارەی موبایل: ٠٧٧٠١٢٣٤٥٦٧</p>
                                        <p>ناونیشان: هەولێر، کوردستان</p>
                                    </div>
                                    
                                    <div>
                                        <h4>زانیاری کڕیار:</h4>
                                        <p>ناوی کڕیار: ${sale.customer}</p>
                                        <p>ژمارەی موبایل: ${customer ? customer.phone : 'نەزانراو'}</p>
                                        <p>ناونیشان: ${customer ? customer.address : 'نەزانراو'}</p>
                                    </div>
                                </div>
                                
                                <table class="invoice-table">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>ناوی کاڵا</th>
                                            <th>یەکە</th>
                                            <th>بڕ</th>
                                            <th>نرخ</th>
                                            <th>کۆی گشتی</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${sale.items.map((item, index) => `
                                            <tr>
                                                <td>${index + 1}</td>
                                                <td>${item.name}</td>
                                                <td>${getUnitName(item.unit)}</td>
                                                <td>${item.quantity}</td>
                                                <td>${item.price.toLocaleString()} دینار</td>
                                                <td>${item.total.toLocaleString()} دینار</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                                
                                <div class="invoice-total">
                                    <p><strong>کۆی گشتی:</strong> ${sale.total.toLocaleString()} دینار</p>
                                    <p><strong>شێوازی پارەدان:</strong> ${sale.payment === 'cash' ? 'نەقدی' : 'قەرز'}</p>
                                </div>
                            </div>
                            
                            <div class="print-options" style="margin-top: 30px;">
                                <button class="btn btn-warning" onclick="printRealInvoice('${sale.code}', 'small')">
                                    <i class="fas fa-print"></i> پرێنتی بچووک
                                </button>
                                <button class="btn btn-primary" onclick="printRealInvoice('${sale.code}', 'A4')">
                                    <i class="fas fa-print"></i> پرێنتی A4
                                </button>
                                <button class="btn btn-danger" onclick="document.getElementById('saleInvoiceDetailModal').remove()">
                                    <i class="fas fa-times"></i> داخستن
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
        };

        // پرێنتکردنی ڕاستەقینە
        window.printRealInvoice = function(invoiceCode, size = 'small') {
            // دۆزینەوەی مۆدالی پرێنت
            const printModal = document.getElementById('printModal');
            if (!printModal) {
                showNotification('مۆدالی پرێنت نەدۆزرایەوە!', 'error');
                return;
            }
            
            // دۆزینەوەی بەشەی فاکتوور
            const invoiceContent = printModal.querySelector('.invoice');
            if (!invoiceContent) {
                showNotification('بەشی فاکتوور نەدۆزرایەوە!', 'error');
                return;
            }
            
            // دروستکردنی پەڕەی نوێ بۆ پرێنت
            const printWindow = window.open('', '_blank');
            
            // دروستکردنی HTML بۆ پرێنت
            const printHTML = `
                <!DOCTYPE html>
                <html lang="ar" dir="rtl">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>فاکتووری فرۆشتن - ${invoiceCode}</title>
                    <style>
                        @media print {
                            body {
                                margin: 0;
                                padding: 0;
                                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                                font-size: ${size === 'small' ? '12px' : '14px'};
                                line-height: 1.4;
                            }
                            
                            .print-container {
                                width: ${size === 'small' ? '80mm' : '210mm'};
                                padding: ${size === 'small' ? '5px' : '20px'};
                                margin: 0 auto;
                            }
                            
                            .invoice-header {
                                text-align: center;
                                border-bottom: 2px solid #4361ee;
                                padding-bottom: 10px;
                                margin-bottom: 20px;
                            }
                            
                            .invoice-logo {
                                font-size: ${size === 'small' ? '1.5rem' : '2rem'};
                                font-weight: 800;
                                color: #4361ee;
                                margin-bottom: 5px;
                            }
                            
                            .invoice-title {
                                font-size: ${size === 'small' ? '1rem' : '1.5rem'};
                                margin: 5px 0;
                            }
                            
                            .invoice-details {
                                display: grid;
                                grid-template-columns: 1fr 1fr;
                                gap: 15px;
                                margin-bottom: 20px;
                            }
                            
                            .invoice-table {
                                width: 100%;
                                border-collapse: collapse;
                                margin-bottom: 20px;
                            }
                            
                            .invoice-table th, .invoice-table td {
                                padding: ${size === 'small' ? '3px 5px' : '8px 10px'};
                                text-align: right;
                                border-bottom: 1px solid #ddd;
                            }
                            
                            .invoice-table th {
                                background-color: #f8f9fa;
                                font-weight: bold;
                            }
                            
                            .invoice-total {
                                margin-top: 20px;
                                padding-top: 10px;
                                border-top: 2px solid #ddd;
                                text-align: left;
                            }
                            
                            .invoice-footer {
                                text-align: center;
                                margin-top: 30px;
                                padding-top: 10px;
                                border-top: 1px dashed #ddd;
                                color: #6c757d;
                                font-size: 0.9rem;
                            }
                            
                            .no-print {
                                display: none !important;
                            }
                        }
                        
                        @page {
                            margin: 0;
                            size: ${size === 'small' ? '80mm auto' : 'A4'};
                        }
                        
                        body {
                            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                            font-size: ${size === 'small' ? '12px' : '14px'};
                        }
                        
                        .print-container {
                            width: ${size === 'small' ? '80mm' : '210mm'};
                            padding: ${size === 'small' ? '5px' : '20px'};
                            margin: 0 auto;
                        }
                        
                        .invoice-header {
                            text-align: center;
                            border-bottom: 2px solid #4361ee;
                            padding-bottom: 10px;
                            margin-bottom: 20px;
                        }
                        
                        .invoice-logo {
                            font-size: ${size === 'small' ? '1.5rem' : '2rem'};
                            font-weight: 800;
                            color: #4361ee;
                            margin-bottom: 5px;
                        }
                        
                        .invoice-title {
                            font-size: ${size === 'small' ? '1rem' : '1.5rem'};
                            margin: 5px 0;
                        }
                        
                        .invoice-details {
                            display: grid;
                            grid-template-columns: 1fr 1fr;
                            gap: 15px;
                            margin-bottom: 20px;
                        }
                        
                        .invoice-table {
                            width: 100%;
                            border-collapse: collapse;
                            margin-bottom: 20px;
                        }
                        
                        .invoice-table th, .invoice-table td {
                            padding: ${size === 'small' ? '3px 5px' : '8px 10px'};
                            text-align: right;
                            border-bottom: 1px solid #ddd;
                        }
                        
                        .invoice-table th {
                            background-color: #f8f9fa;
                            font-weight: bold;
                        }
                        
                        .invoice-total {
                            margin-top: 20px;
                            padding-top: 10px;
                            border-top: 2px solid #ddd;
                            text-align: left;
                        }
                        
                        .invoice-footer {
                            text-align: center;
                            margin-top: 30px;
                            padding-top: 10px;
                            border-top: 1px dashed #ddd;
                            color: #6c757d;
                            font-size: 0.9rem;
                        }
                    </style>
                </head>
                <body>
                    <div class="print-container">
                        ${invoiceContent.innerHTML.replace('print-options', 'print-options no-print')}
                        <div class="invoice-footer">
                            <p>سپاس بۆ بەکارهێنانی سیستەمی ئەلکترۆنیات</p>
                            <p>ژمارەی پەیوەندی: ٠٧٧٠١٢٣٤٥٦٧</p>
                            <p>بەروار: ${new Date().toLocaleDateString('ar-IQ')}</p>
                        </div>
                    </div>
                    
                    <script>
                        window.onload = function() {
                            // پرێنتکردن لەسەر بارکردنی پەڕەکە
                            setTimeout(function() {
                                window.print();
                                
                                // داخستنی پەڕە دوای پرێنتکردن
                                setTimeout(function() {
                                    window.close();
                                }, 1000);
                            }, 500);
                        };
                    <\/script>
                </body>
                </html>
            `;
            
            // نووسینی HTML بۆ پەڕەی نوێ
            printWindow.document.open();
            printWindow.document.write(printHTML);
            printWindow.document.close();
            
            // داخستنی مۆدالەکان پاش پرێنتکردن
            setTimeout(() => {
                document.getElementById('printModal').classList.remove('active');
                const detailModal = document.getElementById('invoiceDetailModal');
                if (detailModal) detailModal.classList.remove('active');
            }, 1000);
        };

        // سڕینەوەی فاکتووری فرۆشتن
        window.deleteSaleInvoice = function(saleId) {
            if (confirm('دڵنیای لە سڕینەوەی ئەم فاکتوورەی فرۆشتن؟')) {
                const index = sampleData.sales.findIndex(s => s.id === saleId);
                if (index !== -1) {
                    const sale = sampleData.sales[index];
                    
                    // گەڕاندنەوەی پارە ئەگەر فرۆشتن بە نەقدی بوو
                    if (sale.payment === 'cash') {
                        sampleData.cashBalance -= sale.total;
                        updateDashboardCash();
                    } else if (sale.payment === 'credit') {
                        // گەڕاندنەوەی قەرز
                        const customer = sampleData.customers.find(c => c.name === sale.customer);
                        if (customer) {
                            customer.debt -= sale.total;
                            if (customer.debt < 0) customer.debt = 0;
                        }
                    }
                    
                    // گەڕاندنەوەی کاڵاکان بۆ مخزن
                    sale.items.forEach(item => {
                        const product = sampleData.products.find(p => p.name === item.name);
                        if (product) {
                            product.stock += item.quantity;
                        }
                    });
                    
                    sampleData.sales.splice(index, 1);
                    updateSaleHistoryDisplay();
                    populateSampleData();
                    showNotification('فاکتووری فرۆشتن بە سەرکەوتوویی سڕایەوە!', 'success');
                }
            }
        };

        // گەڕان لە مێژووی فرۆشتن
        const saleHistorySearch = document.getElementById('saleHistorySearch');
        if (saleHistorySearch) {
            saleHistorySearch.addEventListener('input', function() {
                const query = this.value.toLowerCase();
                const items = document.querySelectorAll('#saleHistoryList .list-item');
                
                items.forEach(item => {
                    const text = item.textContent.toLowerCase();
                    if (text.includes(query)) {
                        item.style.display = 'flex';
                    } else {
                        item.style.display = 'none';
                    }
                });
            });
        }

        // نوێکردنەوەی مێژووی فرۆشتن
        const refreshSaleHistoryBtn = document.getElementById('refreshSaleHistory');
        if (refreshSaleHistoryBtn) {
            refreshSaleHistoryBtn.addEventListener('click', function() {
                updateSaleHistoryDisplay();
                showNotification('مێژووی فرۆشتن نوێ کرایەوە!', 'info');
            });
        }

        // ==============================================
        // فەنکشنە گشتییەکان
        // ==============================================

        // نوێکردنەوەی کۆی پارە لە داشبۆرد
        function updateDashboardCash() {
            const cashCard = document.getElementById('cashBalanceDisplay');
            if (cashCard) {
                cashCard.innerHTML = `${sampleData.cashBalance.toLocaleString()} <span>دینار</span>`;
            }
        }

        // فەنکشنی هەژمارکردنی کۆی سەرفکردنی مانگی ئێستا
        function calculateMonthlyExpense() {
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();
            
            const monthlyExpenses = sampleData.expenseHistory.filter(expense => {
                const expenseDate = new Date(expense.date);
                return expenseDate.getMonth() === currentMonth && 
                       expenseDate.getFullYear() === currentYear;
            });
            
            const total = monthlyExpenses.reduce((sum, expense) => sum + expense.amount, 0);
            
            // نیشاندانی لە داشبۆرد
            const monthlyExpenseElement = document.getElementById('monthlyExpenseTotal');
            const expenseChangeElement = document.getElementById('expenseChange');
            
            if (monthlyExpenseElement) {
                monthlyExpenseElement.innerHTML = `${total.toLocaleString()} <span>دینار</span>`;
            }
        }

        // فەنکشنی پێشبینینی وێنە
        function setupImagePreview() {
            const imageInput = document.getElementById('productImage');
            const imagePreview = document.getElementById('imagePreview');
            
            if (imageInput && imagePreview) {
                imageInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        // پشکنینی جۆری فایل
                        const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'];
                        if (!validTypes.includes(file.type)) {
                            showNotification('تەنها فایلی وێنە (JPG, PNG, GIF) قبوڵکراوە!', 'error');
                            this.value = '';
                            return;
                        }
                        
                        // پشکنینی قەبارەی فایل (زیاتر لە 5MB نەبێت)
                        if (file.size > 5 * 1024 * 1024) {
                            showNotification('قەبارەی وێنە نابێت لە 5MB زیاتر بێت!', 'error');
                            this.value = '';
                            return;
                        }
                        
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            imagePreview.innerHTML = `<img src="${e.target.result}" alt="پێشبینینی وێنە">`;
                        };
                        reader.readAsDataURL(file);
                    } else {
                        imagePreview.innerHTML = '<p style="color: var(--gray); font-size: 0.9rem;">هیچ وێنەیەک نییە</p>';
                    }
                });
            }
        }

        // زیادکردنی داتای نموونەیی
        function populateSampleData() {
            // زیادکردنی کاڵای کەم بووەکان
            const lowStockList = document.getElementById('lowStockList');
            if (lowStockList) {
                lowStockList.innerHTML = '';
                
                const lowStockProducts = sampleData.products.filter(p => p.stock <= 5);
                
                if (lowStockProducts.length === 0) {
                    lowStockList.innerHTML = '<li class="list-item">هیچ کاڵایەک کەم نییە</li>';
                } else {
                    lowStockProducts.forEach(product => {
                        const li = document.createElement('li');
                        li.className = 'list-item';
                        li.innerHTML = `
                            <div class="item-name">${product.name}</div>
                            <div class="item-value">${product.stock} ${getUnitName(product.unit)}</div>
                        `;
                        lowStockList.appendChild(li);
                    });
                }
                
                // نوێکردنەوەی ژمارەی کاڵای کەم بوو
                const lowStockCount = document.getElementById('lowStockCount');
                if (lowStockCount) {
                    lowStockCount.innerHTML = `${lowStockProducts.length} <span>جۆر</span>`;
                }
            }
            
            // زیادکردنی قەرزدارەکان
            const debtorsList = document.getElementById('debtorsList');
            if (debtorsList) {
                debtorsList.innerHTML = '';
                
                // قەرزدارەکان بریتین لە: کەسەکان کە قەرزداری منن (قەرز +) و شەریکەکان کە من قەرزداری ئەوانم (قەرز -)
                const allDebtors = [
                    ...sampleData.customers.filter(c => c.debt > 0).map(c => ({
                        name: c.name,
                        debt: c.debt,
                        type: 'کەس',
                        debtClass: 'debt-positive'
                    })),
                    ...sampleData.partners.filter(p => p.debt < 0).map(p => ({
                        name: p.name,
                        debt: Math.abs(p.debt),
                        type: 'شەریک',
                        debtClass: 'debt-negative'
                    }))
                ];
                
                if (allDebtors.length === 0) {
                    debtorsList.innerHTML = '<li class="list-item">هیچ قەرزدارێک نییە</li>';
                } else {
                    allDebtors.forEach(debtor => {
                        const li = document.createElement('li');
                        li.className = 'list-item';
                        li.innerHTML = `
                            <div class="item-name">${debtor.name} (${debtor.type})</div>
                            <div class="item-value ${debtor.debtClass}">${debtor.debt.toLocaleString()} دینار</div>
                        `;
                        debtorsList.appendChild(li);
                    });
                }
            }
            
            // زیادکردنی لیستی کاڵاکان بۆ مخزن
            const productList = document.getElementById('productList');
            if (productList) {
                productList.innerHTML = '';
                
                if (sampleData.products.length === 0) {
                    productList.innerHTML = '<li class="list-item">هیچ کاڵایەک نییە. دەتوانی یەکەم کاڵا زیاد بکەی!</li>';
                } else {
                    sampleData.products.forEach(product => {
                        const li = document.createElement('li');
                        li.className = 'list-item';
                        
                        // دروستکردنی وێنەی کاڵا
                        const imageHTML = product.image 
                            ? `<img src="${product.image}" class="product-image-small">`
                            : `<div style="width: 50px; height: 50px; background-color: var(--gray-light); border-radius: 5px; display: flex; align-items: center; justify-content: center; margin-left: 10px; color: var(--gray);"><i class="fas fa-image"></i></div>`;
                        
                        // دروستکردنی زانیاری یەکەی دووەم
                        const secondaryUnitInfo = product.hasSecondaryUnit 
                            ? `<div style="font-size: 0.9rem; color: var(--info);">${product.secondaryUnitQuantity} ${getUnitName(product.secondaryUnit)}</div>`
                            : '';
                        
                        li.innerHTML = `
                            <div style="display: flex; align-items: center;">
                                ${imageHTML}
                                <div>
                                    <div class="item-name">${product.name}</div>
                                    <div style="font-size: 0.9rem; color: var(--gray);">
                                        بارکۆد: ${product.barcode}
                                    </div>
                                    ${secondaryUnitInfo}
                                </div>
                            </div>
                            <div class="item-value">
                                <span style="margin-left: 15px;">${product.stock} ${getUnitName(product.unit)}</span>
                                <span>${product.salePrice.toLocaleString()} دینار</span>
                                <div style="margin-top: 10px; display: flex; gap: 5px;">
                                    <button class="btn btn-info btn-sm" onclick="editProduct(${product.id})">
                                        <i class="fas fa-edit"></i> گۆڕانکاری
                                    </button>
                                    <button class="btn btn-danger btn-sm" onclick="deleteProduct(${product.id})">
                                        <i class="fas fa-trash"></i> سڕینەوە
                                    </button>
                                </div>
                            </div>
                        `;
                        productList.appendChild(li);
                    });
                }
            }
            
            // زیادکردنی لیستی کەسەکان بۆ بەشی سەرەکی
            const customersMainList = document.getElementById('customersMainList');
            if (customersMainList) {
                customersMainList.innerHTML = '';
                
                if (sampleData.customers.length === 0) {
                    customersMainList.innerHTML = '<li class="list-item">هیچ کەسێک تۆمارنەکراوە</li>';
                } else {
                    sampleData.customers.forEach(customer => {
                        // دیاریکردنی رەنگ بەپێی قەرز
                        let debtClass = customer.debt > 0 ? 'debt-positive' : 'debt-zero';
                        
                        const li = document.createElement('li');
                        li.className = 'list-item';
                        li.setAttribute('data-customer-id', customer.id);
                        li.innerHTML = `
                            <div>
                                <div class="item-name">${customer.name}</div>
                                <div style="font-size: 0.9rem; color: var(--gray);">${customer.phone}</div>
                            </div>
                            <div>
                                <div class="item-value ${debtClass}">${customer.debt.toLocaleString()} دینار قەرز</div>
                                <div style="margin-top: 10px;">
                                    <button class="btn btn-info btn-sm" onclick="viewCustomerDetails(${customer.id})">
                                        <i class="fas fa-eye"></i> بینین
                                    </button>
                                </div>
                            </div>
                        `;
                        customersMainList.appendChild(li);
                    });
                }
            }
            
            // زیادکردنی لیستی شەریکەکان
            const partnersListItems = document.getElementById('partnersListItems');
            if (partnersListItems) {
                partnersListItems.innerHTML = '';
                
                if (sampleData.partners.length === 0) {
                    partnersListItems.innerHTML = '<li class="list-item">هیچ شەریکێک تۆمارنەکراوە</li>';
                } else {
                    sampleData.partners.forEach(partner => {
                        // دیاریکردنی رەنگ بەپێی جۆری قەرز
                        let debtText, debtClass;
                        
                        if (partner.debt > 0) {
                            // شەریک قەرزداری منە (مثبت) - سۆر
                            debtText = `${partner.debt.toLocaleString()} دینار (شەریک قەرزداری منە)`;
                            debtClass = 'debt-positive';
                        } else if (partner.debt < 0) {
                            // من قەرزداری شەریکم (منفی) - رەش
                            debtText = `${Math.abs(partner.debt).toLocaleString()} دینار (من قەرزداری ئەوانم)`;
                            debtClass = 'debt-negative';
                        } else {
                            // بێ قەرز - خۆڵەمێشی
                            debtText = 'بێ قەرز';
                            debtClass = 'debt-zero';
                        }
                        
                        const li = document.createElement('li');
                        li.className = 'list-item';
                        li.innerHTML = `
                            <div class="item-name">${partner.name}</div>
                            <div class="item-value ${debtClass}">${debtText}</div>
                        `;
                        partnersListItems.appendChild(li);
                    });
                }
            }
            
            // نوێکردنەوەی کۆی پارە
            updateDashboardCash();
            
            // هەژمارکردنی کۆی سەرفکردن
            calculateMonthlyExpense();
            
            // نوێکردنەوەی هەموو کارتەکانی داشبۆرد
            updateAllDashboardCards();
            
            // نوێکردنەوەی مێژووی فرۆشتن
            updateSaleHistoryDisplay();
        }

        // نوێکردنەوەی هەموو کارتەکانی داشبۆرد
        function updateAllDashboardCards() {
            // کۆی کڕین
            const totalPurchaseDisplay = document.getElementById('totalPurchaseDisplay');
            if (totalPurchaseDisplay) {
                const totalPurchases = samplePurchaseData.purchases.reduce((sum, purchase) => sum + purchase.total, 0);
                totalPurchaseDisplay.innerHTML = `${totalPurchases.toLocaleString()} <span>دینار</span>`;
            }
            
            // جیاوازی
            updateDifferenceCard();
            
            // کۆی قەرزداران
            const totalDebtDisplay = document.getElementById('totalDebtDisplay');
            if (totalDebtDisplay) {
                const totalCustomerDebt = sampleData.customers.reduce((sum, customer) => sum + customer.debt, 0);
                totalDebtDisplay.innerHTML = `${totalCustomerDebt.toLocaleString()} <span>دینار</span>`;
            }
            
            // قەرزدارم بە شەریکەکان
            const partnerDebtDisplay = document.getElementById('partnerDebtDisplay');
            if (partnerDebtDisplay) {
                const totalPartnerDebt = sampleData.partners
                    .filter(p => p.debt < 0)
                    .reduce((sum, partner) => sum + Math.abs(partner.debt), 0);
                partnerDebtDisplay.innerHTML = `${totalPartnerDebt.toLocaleString()} <span>دینار</span>`;
            }
        }

        // نوێکردنەوەی کارتی جیاوازی
        function updateDifferenceCard() {
            const differenceCard = document.getElementById('differenceDisplay');
            if (differenceCard) {
                // کۆی هەموو کڕینەکان
                const totalPurchases = samplePurchaseData.purchases.reduce((sum, purchase) => sum + purchase.total, 0);
                
                // کۆی هەموو سەرفەکان
                const totalExpenses = sampleData.expenseHistory.reduce((sum, expense) => sum + expense.amount, 0);
                
                // جیاوازی = پارەی واسڵ - (کڕین + سەرف)
                const difference = sampleData.cashBalance - (totalPurchases + totalExpenses);
                
                differenceCard.innerHTML = `${difference.toLocaleString()} <span>دینار</span>`;
                
                // نوێکردنەوەی تێبینی گۆڕانکاری
                const changeElement = document.querySelector('.card-3 .card-change');
                if (changeElement) {
                    if (difference > 0) {
                        changeElement.innerHTML = `<i class="fas fa-arrow-up"></i> سود`;
                        changeElement.className = 'card-change positive';
                    } else if (difference < 0) {
                        changeElement.innerHTML = `<i class="fas fa-arrow-down"></i> زەرەر`;
                        changeElement.className = 'card-change negative';
                    } else {
                        changeElement.innerHTML = `<i class="fas fa-minus"></i> بێ گۆڕانکاری`;
                        changeElement.className = 'card-change';
                    }
                }
            }
        }

        // فەنکشنی وەرگرتنی ناوی یەکە
        function getUnitName(unit) {
            const unitNames = {
                'piece': 'پارچە',
                'carton': 'کارتۆن',
                'unit': 'دانە',
                'meter': 'مەتر',
                'kg': 'کیلۆ',
                'box': 'بۆکس',
                'pack': 'پاکەت'
            };
            return unitNames[unit] || unit;
        }

        // ==============================================
        // بەشی مخزن - فەنکشنەکان
        // ==============================================

        // فەنکشنی سڕینەوەی کاڵا
        window.deleteProduct = function(productId) {
            if (confirm('دڵنیای لە سڕینەوەی ئەم کاڵایە؟')) {
                const productIndex = sampleData.products.findIndex(p => p.id === productId);
                
                if (productIndex !== -1) {
                    // پشکنین ئەگەر کاڵاکە لە فرۆشتن یان کڕینێکدا بەکارهاتووە
                    const product = sampleData.products[productIndex];
                    const usedInSales = sampleData.sales.some(sale => 
                        sale.items.some(item => item.name === product.name)
                    );
                    
                    const usedInPurchases = samplePurchaseData.purchases.some(purchase => 
                        purchase.items.some(item => item.name === product.name)
                    );
                    
                    if (usedInSales || usedInPurchases) {
                        showNotification('ناتوانرێت ئەم کاڵایە بسڕیتەوە چونکە لە فرۆشتن یان کڕینێکدا بەکارهاتووە!', 'error');
                        return;
                    }
                    
                    sampleData.products.splice(productIndex, 1);
                    populateSampleData();
                    showNotification('کاڵاکە بە سەرکەوتوویی سڕایەوە!', 'success');
                }
            }
        };

        // فەنکشنی گۆڕانکاری کاڵا
        window.editProduct = function(productId) {
            const product = sampleData.products.find(p => p.id === productId);
            if (!product) return;
            
            editingProductId = productId;
            
            // پڕکردنەوەی خانەکانی فۆرم
            document.getElementById('productName').value = product.name;
            document.getElementById('productBarcode').value = product.barcode;
            document.getElementById('purchasePrice').value = product.purchasePrice;
            document.getElementById('salePrice').value = product.salePrice;
            document.getElementById('stockQuantity').value = product.stock;
            document.getElementById('primaryUnit').value = product.unit;
            document.getElementById('secondaryUnit').value = product.secondaryUnit || '';
            document.getElementById('secondaryUnitQuantity').value = product.secondaryUnitQuantity || 0;
            
            // نیشاندانی وێنە
            const imagePreview = document.getElementById('imagePreview');
            if (product.image) {
                imagePreview.innerHTML = `<img src="${product.image}" alt="پێشبینینی وێنە">`;
            } else {
                imagePreview.innerHTML = '<p style="color: var(--gray); font-size: 0.9rem;">هیچ وێنەیەک نییە</p>';
            }
            
            // نیشاندانی فۆرم
            const productForm = document.getElementById('productForm');
            const addProductBtn = document.getElementById('addProductBtn');
            const saveBtn = document.getElementById('saveProductBtn');
            
            if (productForm && addProductBtn && saveBtn) {
                productForm.style.display = 'block';
                addProductBtn.style.display = 'none';
                saveBtn.innerHTML = '<i class="fas fa-save"></i> نوێکردنەوەی کاڵا';
            }
        };

        // فەنکشنی پاککردنەوەی خانەکانی فۆرم
        function resetProductForm() {
            document.getElementById('productName').value = '';
            document.getElementById('productBarcode').value = '';
            document.getElementById('purchasePrice').value = '';
            document.getElementById('salePrice').value = '';
            document.getElementById('stockQuantity').value = '';
            document.getElementById('primaryUnit').value = 'piece';
            document.getElementById('secondaryUnit').value = '';
            document.getElementById('secondaryUnitQuantity').value = '';
            document.getElementById('productImage').value = '';
            document.getElementById('imagePreview').innerHTML = '<p style="color: var(--gray); font-size: 0.9rem;">هیچ وێنەیەک نییە</p>';
            editingProductId = null;
            
            const saveBtn = document.getElementById('saveProductBtn');
            if (saveBtn) {
                saveBtn.innerHTML = '<i class="fas fa-save"></i> هەڵگرتن';
            }
        }

        // فەنکشنی هەڵگرتنی کاڵا
        const saveProductBtn = document.getElementById('saveProductBtn');
        if (saveProductBtn) {
            saveProductBtn.addEventListener('click', function() {
                if (editingProductId) {
                    // نوێکردنەوەی کاڵا
                    updateProduct(editingProductId);
                } else {
                    // زیادکردنی کاڵای نوێ
                    addNewProduct();
                }
            });
        }

        // فەنکشنی زیادکردنی کاڵای نوێ
        function addNewProduct() {
            const productName = document.getElementById('productName');
            const purchasePrice = document.getElementById('purchasePrice');
            const salePrice = document.getElementById('salePrice');
            const stockQuantity = document.getElementById('stockQuantity');
            
            if (!productName || !purchasePrice || !salePrice || !stockQuantity) {
                showNotification('تکایە هەموو خانە پڕەکان پڕ بکەرەوە!', 'error');
                return;
            }
            
            const name = productName.value.trim();
            const purchasePriceValue = parseInt(purchasePrice.value) || 0;
            const salePriceValue = parseInt(salePrice.value) || 0;
            const stock = parseInt(stockQuantity.value) || 0;
            
            if (!name || salePriceValue === 0) {
                showNotification('تکایە ناوی کاڵا و نرخی فرۆشتن پڕ بکەرەوە!', 'error');
                return;
            }
            
            // دروستکردنی کاڵای نوێ
            const newProduct = {
                id: sampleData.products.length + 1,
                name: name,
                barcode: document.getElementById('productBarcode').value.trim() || `BR${sampleData.products.length + 1000}`,
                purchasePrice: purchasePriceValue,
                salePrice: salePriceValue,
                stock: stock,
                unit: document.getElementById('primaryUnit').value,
                hasSecondaryUnit: document.getElementById('secondaryUnit').value !== '',
                secondaryUnit: document.getElementById('secondaryUnit').value || null,
                secondaryUnitQuantity: parseInt(document.getElementById('secondaryUnitQuantity').value) || 0,
                description: ''
            };
            
            // هەڵگرتنی وێنە
            const productImage = document.getElementById('productImage');
            if (productImage.files.length > 0) {
                const file = productImage.files[0];
                const reader = new FileReader();
                reader.onload = function(e) {
                    newProduct.image = e.target.result;
                    saveProduct(newProduct);
                };
                reader.readAsDataURL(file);
            } else {
                saveProduct(newProduct);
            }
        }

        // فەنکشنی هەڵگرتنی کاڵا
        function saveProduct(product) {
            sampleData.products.push(product);
            
            populateSampleData();
            
            const productForm = document.getElementById('productForm');
            const addProductBtn = document.getElementById('addProductBtn');
            
            if (productForm && addProductBtn) {
                productForm.style.display = 'none';
                addProductBtn.style.display = 'block';
            }
            
            resetProductForm();
            showNotification('کاڵای نوێ بە سەرکەوتوویی زیاد کرا!', 'success');
        }

        // فەنکشنی نوێکردنەوەی کاڵا
        function updateProduct(productId) {
            const product = sampleData.products.find(p => p.id === productId);
            if (!product) return;
            
            const productName = document.getElementById('productName');
            const purchasePrice = document.getElementById('purchasePrice');
            const salePrice = document.getElementById('salePrice');
            const stockQuantity = document.getElementById('stockQuantity');
            const productImage = document.getElementById('productImage');
            
            product.name = productName.value.trim();
            product.barcode = document.getElementById('productBarcode').value.trim() || product.barcode;
            product.purchasePrice = parseInt(purchasePrice.value) || product.purchasePrice;
            product.salePrice = parseInt(salePrice.value) || product.salePrice;
            product.stock = parseInt(stockQuantity.value) || product.stock;
            product.unit = document.getElementById('primaryUnit').value;
            product.hasSecondaryUnit = document.getElementById('secondaryUnit').value !== '';
            product.secondaryUnit = document.getElementById('secondaryUnit').value || null;
            product.secondaryUnitQuantity = parseInt(document.getElementById('secondaryUnitQuantity').value) || 0;
            
            // هەڵگرتنی وێنە
            if (productImage.files.length > 0) {
                const file = productImage.files[0];
                const reader = new FileReader();
                reader.onload = function(e) {
                    product.image = e.target.result;
                    finishUpdate();
                };
                reader.readAsDataURL(file);
            } else {
                finishUpdate();
            }
        }

        // تەواوکردنی نوێکردنەوە
        function finishUpdate() {
            populateSampleData();
            
            const productForm = document.getElementById('productForm');
            const addProductBtn = document.getElementById('addProductBtn');
            
            if (productForm && addProductBtn) {
                productForm.style.display = 'none';
                addProductBtn.style.display = 'block';
            }
            
            // پاککردنەوەی خانەکان
            resetProductForm();
            
            showNotification('کاڵاکە بە سەرکەوتوویی نوێ کرایەوە!', 'success');
        }

        // پاشگەزبوونەوە لە زیادکردنی/گۆڕانکاری کاڵا
        const cancelProductBtn = document.getElementById('cancelProductBtn');
        if (cancelProductBtn) {
            cancelProductBtn.addEventListener('click', function() {
                const productForm = document.getElementById('productForm');
                const addProductBtn = document.getElementById('addProductBtn');
                
                if (productForm && addProductBtn) {
                    productForm.style.display = 'none';
                    addProductBtn.style.display = 'block';
                    resetProductForm();
                }
            });
        }

        // زیادکردنی کاڵای نوێ لە مخزن
        const addProductBtn = document.getElementById('addProductBtn');
        if (addProductBtn) {
            addProductBtn.addEventListener('click', function() {
                const productForm = document.getElementById('productForm');
                if (productForm) {
                    productForm.style.display = 'block';
                    this.style.display = 'none';
                    resetProductForm();
                }
            });
        }

        // ==============================================
        // کارگێڕە گشتییەکان
        // ==============================================

        // نەخشەی مێنیو
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                const sectionId = this.getAttribute('data-section');
                showSection(sectionId);
            });
        });

        // نەخشەی مێنیوی مۆبایل
        document.getElementById('menuToggle').addEventListener('click', function() {
            document.getElementById('sidebar').classList.toggle('active');
        });

        document.getElementById('closeSidebar').addEventListener('click', function() {
            document.getElementById('sidebar').classList.remove('active');
        });

        // نەخشەی تاباتەکان لە بەشی فرۆشتن و کڕین
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const tabId = this.getAttribute('data-tab');
                
                const parent = this.closest('.tab-buttons');
                if (parent) {
                    parent.querySelectorAll('.tab-btn').forEach(b => {
                        b.classList.remove('active');
                    });
                }
                
                this.classList.add('active');
                
                const container = this.closest('.sale-purchase-container');
                if (container) {
                    container.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    const tabContent = document.getElementById(tabId);
                    if (tabContent) {
                        tabContent.classList.add('active');
                        
                        // دەستپێکردنی سیستەمی فرۆشتن کاتێ تابی فرۆشتن کرایەوە
                        if (tabId === 'newSale') {
                            setTimeout(() => {
                                initializeSaleSystem();
                            }, 100);
                        }
                        
                        // دەستپێکردنی سیستەمی کڕین کاتێ تابی کڕین کرایەوە
                        if (tabId === 'newPurchase') {
                            setTimeout(() => {
                                initializePurchaseSystem();
                            }, 100);
                        }
                        
                        // نوێکردنەوەی مێژووی فرۆشتن کاتێ تابی مێژوو کرایەوە
                        if (tabId === 'saleHistory') {
                            updateSaleHistoryDisplay();
                        }
                        
                        // نوێکردنەوەی مێژووی کڕین کاتێ تابی مێژوو کرایەوە
                        if (tabId === 'purchaseHistory') {
                            updatePurchaseHistoryDisplay();
                        }
                    }
                }
            });
        });

        // نوێکردنەوەی لیستی کاڵای کەم بوو
        const refreshLowStockBtn = document.getElementById('refreshLowStock');
        if (refreshLowStockBtn) {
            refreshLowStockBtn.addEventListener('click', function() {
                populateSampleData();
                showNotification('لیستی کاڵای کەم بووەکان نوێ کرایەوە!', 'info');
            });
        }

        // نوێکردنەوەی لیستی قەرزداران
        const refreshDebtorsBtn = document.getElementById('refreshDebtors');
        if (refreshDebtorsBtn) {
            refreshDebtorsBtn.addEventListener('click', function() {
                populateSampleData();
                showNotification('لیستی قەرزدارەکان نوێ کرایەوە!', 'info');
            });
        }

        // پرێنتی بچووک (لە مۆدالی سەرەمی)
        const printSmallBtn = document.getElementById('printSmall');
        if (printSmallBtn) {
            printSmallBtn.addEventListener('click', function() {
                const invoiceCode = document.getElementById('invoiceCode').textContent;
                window.printRealInvoice(invoiceCode, 'small');
            });
        }

        // پرێنتی A4 (لە مۆدالی سەرەمی)
        const printA4Btn = document.getElementById('printA4');
        if (printA4Btn) {
            printA4Btn.addEventListener('click', function() {
                const invoiceCode = document.getElementById('invoiceCode').textContent;
                window.printRealInvoice(invoiceCode, 'A4');
            });
        }

        // داخستنی مۆدالی پرێنت
        const closePrintModalBtn = document.getElementById('closePrintModal');
        if (closePrintModalBtn) {
            closePrintModalBtn.addEventListener('click', function() {
                document.getElementById('printModal').classList.remove('active');
            });
        }

        const closeInvoiceBtn = document.getElementById('closeInvoice');
        if (closeInvoiceBtn) {
            closeInvoiceBtn.addEventListener('click', function() {
                document.getElementById('printModal').classList.remove('active');
            });
        }

        // دەستپێکردنی سیستم کاتێ پەڕە بار دەکرێت
        document.addEventListener('DOMContentLoaded', function() {
            // چالاککردنی تابی فرۆشتن کاتێ بەشی فرۆشتن و کڕینەکان پیشان دەدرێت
            const saleHistoryTab = document.querySelector('.tab-btn[data-tab="saleHistory"]');
            if (saleHistoryTab) {
                saleHistoryTab.addEventListener('click', function() {
                    setTimeout(() => {
                        updateSaleHistoryDisplay();
                    }, 100);
                });
            }
            
            // چالاککردنی تابی کڕین
            const purchaseTabBtn = document.querySelector('.tab-btn[data-tab="newPurchase"]');
            if (purchaseTabBtn) {
                purchaseTabBtn.addEventListener('click', function() {
                    setTimeout(() => {
                        initializePurchaseSystem();
                    }, 100);
                });
            }
            
            // چالاککردنی تابی مێژووی کڕین
            const purchaseHistoryTabBtn = document.querySelector('.tab-btn[data-tab="purchaseHistory"]');
            if (purchaseHistoryTabBtn) {
                purchaseHistoryTabBtn.addEventListener('click', function() {
                    setTimeout(() => {
                        updatePurchaseHistoryDisplay();
                    }, 100);
                });
            }
        });
    </script>
</body>
</html>