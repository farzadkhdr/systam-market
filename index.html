<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام بيع الإلكترونيات - نظام إدارة المبيعات المتكامل</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --success: #4cc9f0;
            --danger: #f72585;
            --warning: #f8961e;
            --info: #7209b7;
            --light: #f8f9fa;
            --dark: #212529;
            --gradient: linear-gradient(135deg, #4361ee, #3a0ca3, #7209b7);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: #f5f7fb;
            color: #333;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* أنيميشن للخلفية */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
        }
        
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* صفحة تسجيل الدخول */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        
        .login-box {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 450px;
            padding: 40px;
            animation: slideUp 0.8s ease-out;
            backdrop-filter: blur(10px);
        }
        
        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .logo-container {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .logo {
            width: 120px;
            height: 120px;
            background: var(--gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            animation: pulse 2s infinite;
            box-shadow: 0 10px 20px rgba(67, 97, 238, 0.3);
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .logo i {
            font-size: 50px;
            color: white;
        }
        
        .system-name {
            color: var(--secondary);
            font-size: 28px;
            font-weight: 800;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .system-subtitle {
            color: var(--primary);
            font-size: 16px;
            margin-top: 5px;
        }
        
        .login-form h2 {
            color: var(--dark);
            margin-bottom: 25px;
            text-align: center;
            font-weight: 700;
            position: relative;
            padding-bottom: 10px;
        }
        
        .login-form h2:after {
            content: '';
            position: absolute;
            bottom: 0;
            right: 0;
            width: 80px;
            height: 4px;
            background: var(--gradient);
            border-radius: 2px;
            right: 50%;
            transform: translateX(50%);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--dark);
            font-weight: 600;
        }
        
        .form-control {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
            background: #f9f9f9;
        }
        
        .form-control:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
            outline: none;
            background: white;
        }
        
        .btn {
            display: inline-block;
            padding: 15px 30px;
            background: var(--gradient);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(67, 97, 238, 0.3);
        }
        
        .btn-secondary {
            background: var(--secondary);
        }
        
        .btn-success {
            background: var(--success);
        }
        
        .btn-danger {
            background: var(--danger);
        }
        
        .btn-warning {
            background: var(--warning);
        }
        
        .btn-info {
            background: var(--info);
        }
        
        /* النظام الرئيسي */
        .main-system {
            display: none;
            min-height: 100vh;
        }
        
        .header {
            background: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .header-logo .logo {
            width: 50px;
            height: 50px;
            animation: none;
        }
        
        .header-logo .logo i {
            font-size: 24px;
        }
        
        .header-info h1 {
            font-size: 22px;
            color: var(--secondary);
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-avatar {
            width: 45px;
            height: 45px;
            background: var(--gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .logout-btn {
            background: var(--danger);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .logout-btn:hover {
            background: #d1145a;
        }
        
        .sidebar {
            width: 250px;
            background: white;
            height: calc(100vh - 80px);
            position: fixed;
            right: 0;
            top: 80px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.05);
            overflow-y: auto;
            transition: all 0.3s;
        }
        
        .sidebar-menu {
            list-style: none;
            padding: 20px 0;
        }
        
        .sidebar-menu li {
            margin-bottom: 5px;
        }
        
        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 15px 25px;
            color: #555;
            text-decoration: none;
            transition: all 0.3s;
            gap: 12px;
            border-right: 4px solid transparent;
        }
        
        .sidebar-menu a:hover, .sidebar-menu a.active {
            background: rgba(67, 97, 238, 0.1);
            color: var(--primary);
            border-right-color: var(--primary);
        }
        
        .sidebar-menu a i {
            width: 20px;
            text-align: center;
        }
        
        .content {
            margin-right: 250px;
            padding: 30px;
            min-height: calc(100vh - 80px);
        }
        
        .section {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }
        
        .section.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .section-title {
            color: var(--secondary);
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
            font-size: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* بطاقات الإحصائيات */
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.06);
            transition: all 0.3s;
            border-top: 5px solid var(--primary);
            position: relative;
            overflow: hidden;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.1);
        }
        
        .stat-card:nth-child(2) { border-top-color: var(--success); }
        .stat-card:nth-child(3) { border-top-color: var(--warning); }
        .stat-card:nth-child(4) { border-top-color: var(--info); }
        .stat-card:nth-child(5) { border-top-color: #9d4edd; }
        .stat-card:nth-child(6) { border-top-color: #ff9e00; }
        
        .stat-icon {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 22px;
        }
        
        .stat-card:nth-child(1) .stat-icon { background: var(--primary); }
        .stat-card:nth-child(2) .stat-icon { background: var(--success); }
        .stat-card:nth-child(3) .stat-icon { background: var(--warning); }
        .stat-card:nth-child(4) .stat-icon { background: var(--info); }
        .stat-card:nth-child(5) .stat-icon { background: #9d4edd; }
        .stat-card:nth-child(6) .stat-icon { background: #ff9e00; }
        
        .stat-content {
            text-align: right;
            margin-right: 70px;
        }
        
        .stat-title {
            color: #777;
            font-size: 14px;
            margin-bottom: 8px;
        }
        
        .stat-value {
            color: var(--dark);
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .stat-change {
            font-size: 13px;
            font-weight: 600;
        }
        
        .stat-change.positive {
            color: #2ecc71;
        }
        
        .stat-change.negative {
            color: #e74c3c;
        }
        
        /* تصميم الجداول */
        .table-container {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.06);
            margin-bottom: 30px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        thead {
            background: var(--gradient);
            color: white;
        }
        
        th {
            padding: 18px 15px;
            text-align: right;
            font-weight: 600;
        }
        
        tbody tr {
            border-bottom: 1px solid #eee;
            transition: all 0.2s;
        }
        
        tbody tr:hover {
            background: #f9f9f9;
        }
        
        td {
            padding: 15px;
            color: #555;
        }
        
        /* أزرار العمل */
        .action-buttons {
            display: flex;
            gap: 8px;
        }
        
        .btn-small {
            padding: 6px 12px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .btn-edit {
            background: #4cc9f0;
            color: white;
        }
        
        .btn-delete {
            background: #f72585;
            color: white;
        }
        
        .btn-print {
            background: #4361ee;
            color: white;
        }
        
        .btn-view {
            background: #7209b7;
            color: white;
        }
        
        .btn-small:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        /* نموذج البحث */
        .search-container {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 25px;
        }
        
        .search-box {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .search-input {
            flex: 1;
            min-width: 250px;
            padding: 12px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
        }
        
        /* المنتجات في السلة */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .product-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.06);
            transition: all 0.3s;
            position: relative;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.1);
        }
        
        .product-img {
            height: 150px;
            background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-size: 50px;
            position: relative;
        }
        
        .product-info {
            padding: 20px;
        }
        
        .product-name {
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--dark);
        }
        
        .product-price {
            color: var(--primary);
            font-weight: 800;
            font-size: 18px;
            margin-bottom: 15px;
        }
        
        /* طباعة الفواتير */
        .print-options {
            display: flex;
            gap: 20px;
            margin: 25px 0;
            flex-wrap: wrap;
        }
        
        .print-option {
            flex: 1;
            min-width: 200px;
            background: white;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            cursor: pointer;
            transition: all 0.3s;
            border: 3px solid transparent;
        }
        
        .print-option:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border-color: var(--primary);
        }
        
        .print-icon {
            font-size: 50px;
            color: var(--primary);
            margin-bottom: 15px;
        }
        
        /* الطباعة A4 */
        .invoice-a4 {
            width: 210mm;
            min-height: 297mm;
            background: white;
            margin: 0 auto;
            padding: 20mm;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            position: relative;
        }
        
        .invoice-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eee;
        }
        
        .invoice-logo {
            width: 80px;
            height: 80px;
            background: var(--gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 30px;
        }
        
        /* الباركود */
        .barcode-container {
            text-align: center;
            padding: 30px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.06);
            margin: 30px 0;
        }
        
        .barcode {
            width: 100%;
            max-width: 300px;
            height: 120px;
            background: #f5f5f5;
            margin: 20px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: monospace;
            font-size: 24px;
            letter-spacing: 2px;
            color: #333;
            padding: 10px;
        }
        
        /* الفاتورة الصغيرة */
        .small-invoice {
            width: 80mm;
            background: white;
            padding: 15px;
            margin: 0 auto;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        
        /* النوافذ المنبثقة */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease-out;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #777;
        }
        
        /* التبويبات */
        .tabs {
            display: flex;
            border-bottom: 2px solid #eee;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 15px 25px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .tab.active {
            border-bottom-color: var(--primary);
            color: var(--primary);
            font-weight: 700;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* اقتراحات البحث */
        .search-suggestions {
            position: absolute;
            background: white;
            border: 1px solid #ddd;
            border-radius: 10px;
            max-height: 200px;
            overflow-y: auto;
            width: 100%;
            z-index: 100;
            margin-top: 5px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            display: none;
        }
        
        .suggestion-item {
            padding: 12px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.2s;
        }
        
        .suggestion-item:hover {
            background: #f5f7fb;
        }
        
        .suggestion-avatar {
            width: 40px;
            height: 40px;
            background: var(--gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .suggestion-details {
            flex: 1;
        }
        
        .suggestion-name {
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .suggestion-phone {
            font-size: 13px;
            color: #777;
        }
        
        /* سلة المشتريات */
        .cart-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .cart-item:last-child {
            border-bottom: none;
        }
        
        .cart-item-image {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-size: 24px;
        }
        
        .cart-item-details {
            flex: 1;
            margin-right: 15px;
        }
        
        .cart-item-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .cart-item-type {
            font-size: 14px;
            color: #777;
        }
        
        .cart-item-quantity {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .cart-item-price {
            font-weight: bold;
            color: var(--primary);
            min-width: 100px;
            text-align: left;
        }
        
        /* الألوان للاقتراح التلقائي */
        .color-suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .color-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
        }
        
        .color-option:hover {
            transform: scale(1.1);
        }
        
        .color-option.selected {
            border-color: #333;
        }
        
        /* التجاوب */
        @media (max-width: 992px) {
            .sidebar {
                right: -250px;
            }
            
            .sidebar.active {
                right: 0;
            }
            
            .content {
                margin-right: 0;
            }
            
            .menu-toggle {
                display: block;
                background: var(--primary);
                color: white;
                border: none;
                width: 45px;
                height: 45px;
                border-radius: 10px;
                font-size: 20px;
                cursor: pointer;
            }
        }
        
        @media (max-width: 768px) {
            .stats-cards {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
            
            .header {
                padding: 15px 20px;
                flex-wrap: wrap;
                gap: 15px;
            }
            
            .content {
                padding: 20px;
            }
            
            .search-box {
                flex-direction: column;
            }
            
            .search-input {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- أنيميشن الخلفية -->
    <div class="bg-animation"></div>
    
    <!-- صفحة تسجيل الدخول -->
    <div class="login-container" id="loginPage">
        <div class="login-box">
            <div class="logo-container">
                <div class="logo">
                    <i class="fas fa-shopping-cart"></i>
                </div>
                <h1 class="system-name">نظام إدارة بيع الإلكترونيات</h1>
                <p class="system-subtitle">متجرك الإلكتروني المتكامل لإدارة المبيعات والمخزون</p>
            </div>
            
            <form class="login-form" id="loginForm">
                <h2>تسجيل الدخول</h2>
                
                <div class="form-group">
                    <label for="username">اسم المستخدم</label>
                    <input type="text" id="username" class="form-control" placeholder="أدخل اسم المستخدم" required>
                </div>
                
                <div class="form-group">
                    <label for="password">كلمة المرور</label>
                    <input type="password" id="password" class="form-control" placeholder="أدخل كلمة المرور" required>
                </div>
                
                <button type="submit" class="btn">دخول إلى النظام</button>
                <p style="text-align: center; margin-top: 15px; color: #777;">
                    كلمة المرور الافتراضية: <strong>farzad1234</strong>
                </p>
            </form>
        </div>
    </div>
    
    <!-- النظام الرئيسي -->
    <div class="main-system" id="mainSystem">
        <!-- الهيدر -->
        <header class="header">
            <div class="header-logo">
                <div class="logo">
                    <i class="fas fa-shopping-cart"></i>
                </div>
                <div class="header-info">
                    <h1>نظام إدارة بيع الإلكترونيات</h1>
                </div>
            </div>
            
            <button class="menu-toggle" id="menuToggle">
                <i class="fas fa-bars"></i>
            </button>
            
            <div class="user-info">
                <div class="user-avatar">م</div>
                <div>
                    <div style="font-weight: 700;">مدير النظام</div>
                    <div style="font-size: 13px; color: #777;">مدير</div>
                </div>
                <button class="logout-btn" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i> خروج
                </button>
            </div>
        </header>
        
        <!-- القائمة الجانبية -->
        <nav class="sidebar" id="sidebar">
            <ul class="sidebar-menu">
                <li><a href="#" class="active" data-section="dashboard"><i class="fas fa-tachometer-alt"></i> لوحة التحكم</a></li>
                <li><a href="#" data-section="sales"><i class="fas fa-cash-register"></i> نقطة البيع</a></li>
                <li><a href="#" data-section="inventory"><i class="fas fa-boxes"></i> إدارة المخزون</a></li>
                <li><a href="#" data-section="purchases"><i class="fas fa-shopping-cart"></i> المشتريات</a></li>
                <li><a href="#" data-section="customers"><i class="fas fa-users"></i> العملاء والموردين</a></li>
                <li><a href="#" data-section="payments"><i class="fas fa-money-bill-wave"></i> الدفعات والمصروفات</a></li>
                <li><a href="#" data-section="invoices"><i class="fas fa-file-invoice"></i> الفواتير</a></li>
                <li><a href="#" data-section="reports"><i class="fas fa-chart-bar"></i> التقارير</a></li>
                <li><a href="#" data-section="users"><i class="fas fa-user-shield"></i> المستخدمين والصلاحيات</a></li>
                <li><a href="#" data-section="settings"><i class="fas fa-cog"></i> الإعدادات</a></li>
                <li><a href="#" data-section="backup"><i class="fas fa-database"></i> النسخ الاحتياطي</a></li>
            </ul>
        </nav>
        
        <!-- المحتوى الرئيسي -->
        <main class="content">
            <!-- لوحة التحكم -->
            <section class="section active" id="dashboard">
                <h2 class="section-title"><i class="fas fa-tachometer-alt"></i> لوحة التحكم</h2>
                
                <div class="stats-cards">
                    <!-- إحصائيات الشهر -->
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-shopping-bag"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-title">إجمالي المبيعات (شهري)</div>
                            <div class="stat-value">125,750 <span style="font-size: 16px;">د.ع</span></div>
                            <div class="stat-change positive"><i class="fas fa-arrow-up"></i> 12.5% عن الشهر الماضي</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-cart-arrow-down"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-title">إجمالي المشتريات (شهري)</div>
                            <div class="stat-value">89,500 <span style="font-size: 16px;">د.ع</span></div>
                            <div class="stat-change positive"><i class="fas fa-arrow-up"></i> 8.3% عن الشهر الماضي</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-title">الفرق (المبيعات - المشتريات)</div>
                            <div class="stat-value">36,250 <span style="font-size: 16px;">د.ع</span></div>
                            <div class="stat-change positive"><i class="fas fa-arrow-up"></i> 24.7% عن الشهر الماضي</div>
                        </div>
                    </div>
                    
                    <!-- إحصائيات الأسبوع -->
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-shopping-bag"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-title">إجمالي المبيعات (أسبوعي)</div>
                            <div class="stat-value">32,400 <span style="font-size: 16px;">د.ع</span></div>
                            <div class="stat-change positive"><i class="fas fa-arrow-up"></i> 5.2% عن الأسبوع الماضي</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-cart-arrow-down"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-title">إجمالي المشتريات (أسبوعي)</div>
                            <div class="stat-value">21,800 <span style="font-size: 16px;">د.ع</span></div>
                            <div class="stat-change negative"><i class="fas fa-arrow-down"></i> 3.1% عن الأسبوع الماضي</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-title">الفرق (المبيعات - المشتريات)</div>
                            <div class="stat-value">10,600 <span style="font-size: 16px;">د.ع</span></div>
                            <div class="stat-change positive"><i class="fas fa-arrow-up"></i> 18.5% عن الأسبوع الماضي</div>
                        </div>
                    </div>
                    
                    <!-- إحصائيات اليوم -->
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-shopping-bag"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-title">إجمالي المبيعات (اليوم)</div>
                            <div class="stat-value">5,850 <span style="font-size: 16px;">د.ع</span></div>
                            <div class="stat-change positive"><i class="fas fa-arrow-up"></i> 15% عن الأمس</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-cart-arrow-down"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-title">إجمالي المشتريات (اليوم)</div>
                            <div class="stat-value">3,200 <span style="font-size: 16px;">د.ع</span></div>
                            <div class="stat-change negative"><i class="fas fa-arrow-down"></i> 7% عن الأمس</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-title">الفرق (المبيعات - المشتريات)</div>
                            <div class="stat-value">2,650 <span style="font-size: 16px;">د.ع</span></div>
                            <div class="stat-change positive"><i class="fas fa-arrow-up"></i> 42% عن الأمس</div>
                        </div>
                    </div>
                    
                    <!-- إحصائيات إضافية -->
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-box"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-title">إجمالي المنتجات في المخزون</div>
                            <div class="stat-value">1,248</div>
                            <div class="stat-change positive"><i class="fas fa-arrow-up"></i> 34 منتج جديد</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-user-friends"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-title">إجمالي العملاء</div>
                            <div class="stat-value">342</div>
                            <div class="stat-change positive"><i class="fas fa-arrow-up"></i> 12 عميل جديد</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-title">إجمالي الديون على العملاء</div>
                            <div class="stat-value">45,300 <span style="font-size: 16px;">د.ع</span></div>
                            <div class="stat-change negative"><i class="fas fa-arrow-up"></i> 2,500 د.ع زيادة</div>
                        </div>
                    </div>
                </div>
                
                <!-- أحدث الفواتير -->
                <div class="table-container">
                    <h3 style="padding: 20px; margin: 0; border-bottom: 1px solid #eee;">أحدث الفواتير</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>رقم الفاتورة</th>
                                <th>التاريخ</th>
                                <th>العميل</th>
                                <th>إجمالي الفاتورة</th>
                                <th>طريقة الدفع</th>
                                <th>الإجراءات</th>
                            </tr>
                        </thead>
                        <tbody id="recentInvoices">
                            <!-- سيتم ملء أحدث الفواتير ديناميكيا -->
                        </tbody>
                    </table>
                </div>
            </section>
            
            <!-- نقطة البيع -->
            <section class="section" id="sales">
                <h2 class="section-title"><i class="fas fa-cash-register"></i> نقطة البيع</h2>
                
                <div class="search-container">
                    <div class="search-box">
                        <div style="position: relative; flex: 1;">
                            <input type="text" id="productSearch" class="search-input" placeholder="ابحث عن المنتج بالاسم أو النوع..." onkeyup="searchProducts()">
                            <div id="productSuggestions" class="search-suggestions"></div>
                        </div>
                        <button class="btn" onclick="scanBarcode()"><i class="fas fa-barcode"></i> مسح باركود</button>
                        <button class="btn btn-success" onclick="clearCart()"><i class="fas fa-trash"></i> تفريغ السلة</button>
                    </div>
                </div>
                
                <div class="products-grid" id="productsGrid">
                    <!-- سيتم ملء المنتجات ديناميكيا -->
                </div>
                
                <div class="table-container">
                    <h3 style="padding: 20px; margin: 0; border-bottom: 1px solid #eee;">سلة المشتريات</h3>
                    <div id="cartItemsContainer">
                        <!-- سيتم ملء عناصر السلة ديناميكيا -->
                    </div>
                </div>
                
                <div style="display: flex; justify-content: space-between; margin-top: 30px; flex-wrap: wrap; gap: 20px;">
                    <div style="background: white; padding: 20px; border-radius: 15px; flex: 1; min-width: 300px;">
                        <h3 style="margin-bottom: 15px;">معلومات العميل</h3>
                        <div style="position: relative;">
                            <input type="text" id="customerSearch" class="search-input" placeholder="ابحث عن العميل..." onkeyup="searchCustomers()">
                            <div id="customerSuggestions" class="search-suggestions"></div>
                        </div>
                        <div id="selectedCustomerInfo" style="margin-top: 15px; display: none;">
                            <div style="padding: 10px; background: #f9f9f9; border-radius: 10px;">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <strong>العميل المحدد:</strong> <span id="selectedCustomerName"></span><br>
                                        <strong>الديون السابقة:</strong> <span id="customerPreviousDebt">0</span> د.ع
                                    </div>
                                    <button class="btn-small btn-danger" onclick="removeCustomer()"><i class="fas fa-times"></i></button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- معلومات المورد للدفع النقدي -->
                        <div style="margin-top: 20px;">
                            <h4 style="margin-bottom: 10px;">معلومات المورد (للدفع النقدي)</h4>
                            <div style="position: relative;">
                                <input type="text" id="supplierSearchCart" class="search-input" placeholder="ابحث عن مورد..." onkeyup="searchSuppliersCart()">
                                <div id="supplierCartSuggestions" class="search-suggestions"></div>
                            </div>
                            <div id="selectedSupplierInfo" style="margin-top: 15px; display: none;">
                                <div style="padding: 10px; background: #f9f9f9; border-radius: 10px;">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <div>
                                            <strong>المورد المحدد:</strong> <span id="selectedSupplierName"></span><br>
                                            <strong>الديون الحالية:</strong> <span id="supplierCurrentDebt">0</span> د.ع
                                        </div>
                                        <button class="btn-small btn-danger" onclick="removeSupplier()"><i class="fas fa-times"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 15px;">
                            <h4 style="margin-bottom: 10px;">طريقة الدفع</h4>
                            <label style="display: block; margin-bottom: 10px;">
                                <input type="radio" name="paymentType" value="cash" checked> نقداً
                            </label>
                            <label style="display: block; margin-bottom: 10px;">
                                <input type="radio" name="paymentType" value="credit"> بالدين
                            </label>
                        </div>
                        
                        <div id="creditSection" style="display: none; margin-top: 15px;">
                            <div class="form-group">
                                <label>اختر العميل للدين:</label>
                                <div style="position: relative;">
                                    <input type="text" id="creditCustomerSearch" class="form-control" placeholder="ابحث عن عميل للدين..." onkeyup="searchCreditCustomers()">
                                    <div id="creditCustomerSuggestions" class="search-suggestions"></div>
                                </div>
                            </div>
                            <div id="selectedCreditCustomerInfo" style="display: none; padding: 10px; background: #f9f9f9; border-radius: 10px; margin-top: 10px;">
                                <strong>العميل للدين:</strong> <span id="selectedCreditCustomerName"></span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: white; padding: 20px; border-radius: 15px; flex: 2; min-width: 300px;">
                        <h3 style="margin-bottom: 15px;">ملخص الفاتورة</h3>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>إجمالي المنتجات:</span>
                            <span style="font-weight: 700;" id="subtotal">0 د.ع</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>الخصم:</span>
                            <span style="font-weight: 700;" id="discount">0 د.ع</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>الضريبة:</span>
                            <span style="font-weight: 700;" id="tax">0 د.ع</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 20px; padding-top: 15px; border-top: 2px solid #eee;">
                            <span style="font-size: 18px; font-weight: 700;">الإجمالي النهائي:</span>
                            <span style="font-size: 24px; font-weight: 800; color: var(--primary);" id="totalAmount">0 د.ع</span>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <input type="number" id="discountInput" class="form-control" placeholder="مبلغ الخصم" style="margin-bottom: 10px;" onchange="updateDiscount()">
                            <button class="btn btn-warning" onclick="applyDiscount(10)" style="width: auto; margin-right: 5px;">خصم 10%</button>
                            <button class="btn btn-warning" onclick="applyDiscount(20)" style="width: auto;">خصم 20%</button>
                        </div>
                        
                        <!-- خيارات الطباعة -->
                        <div class="print-options">
                            <div class="print-option" id="printSmall">
                                <div class="print-icon">
                                    <i class="fas fa-print"></i>
                                </div>
                                <h4>طباعة إيصال صغير</h4>
                                <p>مناسب للطابعات المحمولة</p>
                            </div>
                            
                            <div class="print-option" id="printA4">
                                <div class="print-icon">
                                    <i class="fas fa-file-invoice"></i>
                                </div>
                                <h4>طباعة فاتورة A4</h4>
                                <p>فاتورة كاملة في صفحة واحدة</p>
                            </div>
                        </div>
                        
                        <button class="btn btn-success" style="margin-top: 20px; width: 100%;" onclick="completeSale()">
                            <i class="fas fa-check-circle"></i> إتمام البيع
                        </button>
                    </div>
                </div>
            </section>
            
            <!-- إدارة المخزون -->
            <section class="section" id="inventory">
                <h2 class="section-title"><i class="fas fa-boxes"></i> إدارة المخزون</h2>
                
                <div class="search-container">
                    <div class="search-box">
                        <input type="text" id="inventorySearch" class="search-input" placeholder="ابحث عن المنتج..." onkeyup="searchInventory()">
                        <button class="btn"><i class="fas fa-search"></i> بحث</button>
                        <button class="btn btn-success" onclick="openAddProductModal()"><i class="fas fa-plus"></i> إضافة منتج جديد</button>
                    </div>
                </div>
                
                <div class="table-container">
                    <table id="inventoryTable">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>المنتج</th>
                                <th>الصورة</th>
                                <th>الكمية المتاحة</th>
                                <th>سعر الشراء</th>
                                <th>سعر البيع</th>
                                <th>النوع</th>
                                <th>اللون</th>
                                <th>الإجراءات</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- سيتم ملء بيانات المخزون ديناميكيا -->
                        </tbody>
                    </table>
                </div>
            </section>
            
            <!-- المشتريات -->
            <section class="section" id="purchases">
                <h2 class="section-title"><i class="fas fa-shopping-cart"></i> المشتريات</h2>
                
                <div class="search-container">
                    <div class="search-box">
                        <input type="text" id="purchaseSearch" class="search-input" placeholder="ابحث عن فاتورة شراء...">
                        <button class="btn"><i class="fas fa-search"></i> بحث</button>
                        <button class="btn btn-success" onclick="openAddPurchaseModal()"><i class="fas fa-plus"></i> عملية شراء جديدة</button>
                    </div>
                </div>
                
                <div class="table-container">
                    <table id="purchasesTable">
                        <thead>
                            <tr>
                                <th>رقم الفاتورة</th>
                                <th>التاريخ</th>
                                <th>المورد</th>
                                <th>إجمالي الفاتورة</th>
                                <th>طريقة الدفع</th>
                                <th>الحالة</th>
                                <th>الإجراءات</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- سيتم ملء بيانات المشتريات ديناميكيا -->
                        </tbody>
                    </table>
                </div>
            </section>
            
            <!-- العملاء والموردين -->
            <section class="section" id="customers">
                <h2 class="section-title"><i class="fas fa-users"></i> العملاء والموردين</h2>
                
                <div class="tabs">
                    <div class="tab active" data-tab="customers">العملاء</div>
                    <div class="tab" data-tab="suppliers">الموردين</div>
                </div>
                
                <!-- تبويب العملاء -->
                <div class="tab-content active" id="customersTab">
                    <div class="search-container">
                        <div class="search-box">
                            <div style="position: relative; flex: 1;">
                                <input type="text" id="customerListSearch" class="search-input" placeholder="ابحث عن عميل..." onkeyup="searchCustomerList()">
                                <div id="customerListSuggestions" class="search-suggestions"></div>
                            </div>
                            <button class="btn"><i class="fas fa-search"></i> بحث</button>
                            <button class="btn btn-success" onclick="openAddCustomerModal()"><i class="fas fa-user-plus"></i> إضافة عميل جديد</button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table id="customersTable">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>الصورة</th>
                                    <th>الاسم</th>
                                    <th>رقم الهاتف</th>
                                    <th>البريد الإلكتروني</th>
                                    <th>إجمالي المشتريات</th>
                                    <th>الديون الحالية</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody id="customersTableBody">
                                <!-- سيتم ملء بيانات العملاء ديناميكيا -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- تبويب الموردين -->
                <div class="tab-content" id="suppliersTab">
                    <div class="search-container">
                        <div class="search-box">
                            <div style="position: relative; flex: 1;">
                                <input type="text" id="supplierListSearch" class="search-input" placeholder="ابحث عن مورد..." onkeyup="searchSupplierList()">
                                <div id="supplierListSuggestions" class="search-suggestions"></div>
                            </div>
                            <button class="btn"><i class="fas fa-search"></i> بحث</button>
                            <button class="btn btn-success" onclick="openAddSupplierModal()"><i class="fas fa-user-plus"></i> إضافة مورد جديد</button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table id="suppliersTable">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>الصورة</th>
                                    <th>الاسم</th>
                                    <th>رقم الهاتف</th>
                                    <th>البريد الإلكتروني</th>
                                    <th>إجمالي المشتريات</th>
                                    <th>الديون الحالية</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody id="suppliersTableBody">
                                <!-- سيتم ملء بيانات الموردين دینامیکیا -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
            
            <!-- الدفعات والمصروفات -->
            <section class="section" id="payments">
                <h2 class="section-title"><i class="fas fa-money-bill-wave"></i> الدفعات والمصروفات</h2>
                
                <div class="tabs">
                    <div class="tab active" data-tab="customerPayments">دفعات العملاء</div>
                    <div class="tab" data-tab="supplierPayments">دفعات الموردين</div>
                    <div class="tab" data-tab="expenses">المصروفات</div>
                </div>
                
                <!-- تبويب دفعات العملاء -->
                <div class="tab-content active" id="customerPaymentsTab">
                    <div class="search-container">
                        <div class="search-box">
                            <input type="text" id="customerPaymentSearch" class="search-input" placeholder="ابحث عن دفعة عميل...">
                            <button class="btn"><i class="fas fa-search"></i> بحث</button>
                            <button class="btn btn-success" onclick="openAddCustomerPaymentModal()"><i class="fas fa-money-bill"></i> إضافة دفعة عميل</button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table id="customerPaymentsTable">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>العميل</th>
                                    <th>المبلغ</th>
                                    <th>التاريخ</th>
                                    <th>الطريقة</th>
                                    <th>ملاحظات</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- سيتم ملء بيانات دفعات العملاء ديناميكيا -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- تبويب دفعات الموردين -->
                <div class="tab-content" id="supplierPaymentsTab">
                    <div class="search-container">
                        <div class="search-box">
                            <input type="text" id="supplierPaymentSearch" class="search-input" placeholder="ابحث عن دفعة مورد...">
                            <button class="btn"><i class="fas fa-search"></i> بحث</button>
                            <button class="btn btn-success" onclick="openAddSupplierPaymentModal()"><i class="fas fa-money-bill"></i> إضافة دفعة مورد</button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table id="supplierPaymentsTable">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>المورد</th>
                                    <th>المبلغ</th>
                                    <th>التاريخ</th>
                                    <th>الطريقة</th>
                                    <th>ملاحظات</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- سيتم ملء بيانات دفعات الموردين ديناميكيا -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- تبويب المصروفات -->
                <div class="tab-content" id="expensesTab">
                    <div class="search-container">
                        <div class="search-box">
                            <input type="text" id="expenseSearch" class="search-input" placeholder="ابحث عن مصروف...">
                            <button class="btn"><i class="fas fa-search"></i> بحث</button>
                            <button class="btn btn-success" onclick="openAddExpenseModal()"><i class="fas fa-money-bill"></i> إضافة مصروف</button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table id="expensesTable">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>النوع</th>
                                    <th>المبلغ</th>
                                    <th>التاريخ</th>
                                    <th>المستلم</th>
                                    <th>ملاحظات</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- سيتم ملء بيانات المصروفات ديناميكيا -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
            
            <!-- الفواتير -->
            <section class="section" id="invoices">
                <h2 class="section-title"><i class="fas fa-file-invoice"></i> الفواتير</h2>
                
                <div class="search-container">
                    <div class="search-box">
                        <input type="text" id="invoiceSearch" class="search-input" placeholder="ابحث برقم الفاتورة أو اسم العميل..." onkeyup="searchInvoices()">
                        <button class="btn"><i class="fas fa-search"></i> بحث</button>
                        <button class="btn btn-info" onclick="exportInvoices()"><i class="fas fa-file-export"></i> تصدير</button>
                    </div>
                </div>
                
                <div class="table-container">
                    <table id="invoicesTable">
                        <thead>
                            <tr>
                                <th>رقم الفاتورة</th>
                                <th>التاريخ</th>
                                <th>العميل</th>
                                <th>إجمالي الفاتورة</th>
                                <th>طريقة الدفع</th>
                                <th>الحالة</th>
                                <th>الإجراءات</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- سيتم ملء بيانات الفواتير ديناميكيا -->
                        </tbody>
                    </table>
                </div>
            </section>
            
            <!-- التقارير -->
            <section class="section" id="reports">
                <h2 class="section-title"><i class="fas fa-chart-bar"></i> التقارير والإحصائيات</h2>
                
                <div class="search-container">
                    <div class="search-box">
                        <select id="reportType" class="search-input" style="flex: 1;">
                            <option value="daily">تقرير يومي</option>
                            <option value="weekly">تقرير أسبوعي</option>
                            <option value="monthly">تقرير شهري</option>
                            <option value="yearly">تقرير سنوي</option>
                        </select>
                        <input type="date" id="reportDate" class="search-input" style="width: 200px;">
                        <button class="btn" onclick="generateReport()"><i class="fas fa-chart-line"></i> توليد التقرير</button>
                        <button class="btn btn-info" onclick="printReport()"><i class="fas fa-print"></i> طباعة التقرير</button>
                    </div>
                </div>
                
                <div id="reportResults">
                    <!-- سيتم عرض نتائج التقرير هنا -->
                </div>
            </section>
            
            <!-- المستخدمين والصلاحيات -->
            <section class="section" id="users">
                <h2 class="section-title"><i class="fas fa-user-shield"></i> المستخدمين والصلاحيات</h2>
                
                <div class="tabs">
                    <div class="tab active" data-tab="users">المستخدمين</div>
                    <div class="tab" data-tab="roles">الصلاحيات</div>
                </div>
                
                <!-- تبويب المستخدمين -->
                <div class="tab-content active" id="usersTab">
                    <div class="search-container">
                        <div class="search-box">
                            <input type="text" id="userSearch" class="search-input" placeholder="ابحث عن مستخدم...">
                            <button class="btn"><i class="fas fa-search"></i> بحث</button>
                            <button class="btn btn-success" onclick="openAddUserModal()"><i class="fas fa-user-plus"></i> إضافة مستخدم جديد</button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table id="usersTable">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>اسم المستخدم</th>
                                    <th>الاسم الكامل</th>
                                    <th>الدور</th>
                                    <th>تاريخ الإنشاء</th>
                                    <th>الحالة</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- سيتم ملء بيانات المستخدمين ديناميكيا -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- تبويب الصلاحيات -->
                <div class="tab-content" id="rolesTab">
                    <div class="search-container">
                        <div class="search-box">
                            <input type="text" id="roleSearch" class="search-input" placeholder="ابحث عن صلاحية...">
                            <button class="btn"><i class="fas fa-search"></i> بحث</button>
                            <button class="btn btn-success" onclick="openAddRoleModal()"><i class="fas fa-plus"></i> إضافة صلاحية جديدة</button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table id="rolesTable">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>اسم الصلاحية</th>
                                    <th>عدد المستخدمين</th>
                                    <th>الوصف</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- سيتم ملء بيانات الصلاحيات ديناميكيا -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
            
            <!-- الإعدادات -->
            <section class="section" id="settings">
                <h2 class="section-title"><i class="fas fa-cog"></i> الإعدادات</h2>
                
                <div class="tabs">
                    <div class="tab active" data-tab="general">عام</div>
                    <div class="tab" data-tab="printing">الطباعة</div>
                    <div class="tab" data-tab="products">المنتجات</div>
                    <div class="tab" data-tab="company">الشركة</div>
                </div>
                
                <!-- تبويب الإعدادات العامة -->
                <div class="tab-content active" id="generalTab">
                    <div class="search-container">
                        <div class="search-box" style="flex-direction: column; align-items: flex-start; gap: 25px;">
                            <div style="width: 100%;">
                                <h3 style="margin-bottom: 15px;">تغيير كلمة المرور</h3>
                                <div class="form-group">
                                    <label>كلمة المرور الحالية</label>
                                    <input type="password" id="currentPassword" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label>كلمة المرور الجديدة</label>
                                    <input type="password" id="newPassword" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label>تأكيد كلمة المرور الجديدة</label>
                                    <input type="password" id="confirmPassword" class="form-control">
                                </div>
                                <button class="btn btn-success" style="width: auto; padding: 12px 40px;" onclick="changePassword()">
                                    <i class="fas fa-save"></i> تغيير كلمة المرور
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- تبويب إعدادات الطباعة -->
                <div class="tab-content" id="printingTab">
                    <div class="search-container">
                        <div class="search-box" style="flex-direction: column; align-items: flex-start; gap: 25px;">
                            <div style="width: 100%;">
                                <h3 style="margin-bottom: 15px;">إعدادات الطباعة</h3>
                                <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                                    <label style="display: flex; align-items: center; gap: 10px;">
                                        <input type="checkbox" id="autoPrint" checked> الطباعة التلقائية بعد البيع
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 10px;">
                                        <input type="checkbox" id="showPrintOptions" checked> عرض خيارات الطباعة
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 10px;">
                                        <input type="checkbox" id="showBarcodeInInvoice"> إظهار الباركود في الفاتورة
                                    </label>
                                </div>
                            </div>
                            
                            <div style="width: 100%;">
                                <h3 style="margin-bottom: 15px;">إعدادات الفواتير</h3>
                                <div class="form-group">
                                    <label>تذييل الفاتورة</label>
                                    <textarea id="invoiceFooter" class="form-control" rows="3" placeholder="النص الذي يظهر في أسفل الفاتورة..."></textarea>
                                </div>
                            </div>
                            
                            <button class="btn" style="width: auto; padding: 12px 40px;" onclick="savePrintSettings()">
                                <i class="fas fa-save"></i> حفظ الإعدادات
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- تبويب إعدادات المنتجات -->
                <div class="tab-content" id="productsTab">
                    <div class="search-container">
                        <div class="search-box" style="flex-direction: column; align-items: flex-start; gap: 25px;">
                            <div style="width: 100%;">
                                <h3 style="margin-bottom: 15px;">إعدادات المنتجات</h3>
                                <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                                    <label style="display: flex; align-items: center; gap: 10px;">
                                        <input type="checkbox" id="autoGenerateBarcode" checked> توليد الباركود تلقائياً
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 10px;">
                                        <input type="checkbox" id="autoSuggestColors" checked> اقتراح الألوان تلقائياً
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 10px;">
                                        <input type="checkbox" id="lowStockAlert"> تنبيه عند انخفاض الكمية
                                    </label>
                                </div>
                            </div>
                            
                            <div style="width: 100%;">
                                <h3 style="margin-bottom: 15px;">كمية التنبيه</h3>
                                <div class="form-group">
                                    <input type="number" id="lowStockThreshold" class="form-control" placeholder="الحد الأدنى للتنبيه" value="10">
                                </div>
                            </div>
                            
                            <button class="btn" style="width: auto; padding: 12px 40px;" onclick="saveProductSettings()">
                                <i class="fas fa-save"></i> حفظ الإعدادات
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- تبويب إعدادات الشركة -->
                <div class="tab-content" id="companyTab">
                    <div class="search-container">
                        <div class="search-box" style="flex-direction: column; align-items: flex-start; gap: 25px;">
                            <div style="width: 100%;">
                                <h3 style="margin-bottom: 15px;">معلومات الشركة</h3>
                                <div class="form-group">
                                    <label>اسم الشركة</label>
                                    <input type="text" id="companyName" class="form-control" placeholder="اسم الشركة">
                                </div>
                                <div class="form-group">
                                    <label>الشعار</label>
                                    <input type="file" id="companyLogo" class="form-control" accept="image/*">
                                    <div id="logoPreview" style="margin-top: 10px;"></div>
                                </div>
                                <div class="form-group">
                                    <label>العنوان</label>
                                    <textarea id="companyAddress" class="form-control" rows="3" placeholder="عنوان الشركة..."></textarea>
                                </div>
                                <div class="form-group">
                                    <label>رقم الهاتف</label>
                                    <input type="text" id="companyPhone" class="form-control" placeholder="رقم هاتف الشركة">
                                </div>
                            </div>
                            
                            <button class="btn" style="width: auto; padding: 12px 40px;" onclick="saveCompanySettings()">
                                <i class="fas fa-save"></i> حفظ معلومات الشركة
                            </button>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- النسخ الاحتياطي -->
            <section class="section" id="backup">
                <h2 class="section-title"><i class="fas fa-database"></i> النسخ الاحتياطي</h2>
                
                <div class="search-container">
                    <div class="search-box" style="flex-direction: column; align-items: flex-start; gap: 25px;">
                        <div style="width: 100%;">
                            <h3 style="margin-bottom: 15px;">إنشاء نسخة احتياطية</h3>
                            <p style="margin-bottom: 15px; color: #777;">
                                قم بإنشاء نسخة احتياطية من جميع بيانات النظام لحفظها واستعادتها عند الحاجة.
                            </p>
                            <button class="btn btn-success" onclick="createBackup()">
                                <i class="fas fa-download"></i> إنشاء نسخة احتياطية
                            </button>
                        </div>
                        
                        <div style="width: 100%;">
                            <h3 style="margin-bottom: 15px;">استعادة نسخة احتياطية</h3>
                            <div class="form-group">
                                <label>اختر ملف النسخة الاحتياطية</label>
                                <input type="file" id="backupFile" class="form-control" accept=".json">
                            </div>
                            <button class="btn btn-warning" onclick="restoreBackup()">
                                <i class="fas fa-upload"></i> استعادة النسخة الاحتياطية
                            </button>
                        </div>
                        
                        <div style="width: 100%;">
                            <h3 style="margin-bottom: 15px;">النسخ الاحتياطية السابقة</h3>
                            <div class="table-container">
                                <table id="backupsTable">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>اسم الملف</th>
                                            <th>التاريخ</th>
                                            <th>الحجم</th>
                                            <th>الإجراءات</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- سيتم ملء النسخ الاحتياطية ديناميكيا -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- النوافذ المنبثقة -->
    
    <!-- نافذة إضافة منتج -->
    <div class="modal" id="addProductModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-plus"></i> إضافة منتج جديد</h3>
                <button class="close-modal" onclick="closeModal('addProductModal')">&times;</button>
            </div>
            <form id="addProductForm">
                <div class="form-group">
                    <label>اسم المنتج</label>
                    <input type="text" id="productName" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label>سعر الشراء</label>
                    <input type="number" id="purchasePrice" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label>سعر البيع</label>
                    <input type="number" id="salePrice" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label>الكمية</label>
                    <input type="number" id="productQuantity" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label>النوع</label>
                    <select id="productType" class="form-control">
                        <option value="هواتف">هواتف</option>
                        <option value="أجهزة كمبيوتر">أجهزة كمبيوتر</option>
                        <option value="سماعات">سماعات</option>
                        <option value="ساعات ذكية">ساعات ذكية</option>
                        <option value="كاميرات">كاميرات</option>
                        <option value="تابلت">تابلت</option>
                        <option value="أخرى">أخرى</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>اللون</label>
                    <div class="color-suggestions" id="colorSuggestions">
                        <!-- سيتم ملء اقتراحات الألوان ديناميكيا -->
                    </div>
                    <input type="text" id="productColor" class="form-control" placeholder="أدخل لون جديد (كود HEX)">
                    <small style="color: #777;">اضغط على لون من القائمة أو أدخل كود HEX جديد</small>
                </div>
                
                <div class="form-group">
                    <label>باركود</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="productBarcode" class="form-control" placeholder="باركود المنتج">
                        <button type="button" class="btn btn-info" onclick="generateBarcode()">توليد باركود</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>صورة المنتج (اختياري)</label>
                    <input type="file" id="productImage" class="form-control" accept="image/*">
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="btn btn-success" style="flex: 1;">إضافة المنتج</button>
                    <button type="button" class="btn btn-danger" style="flex: 1;" onclick="closeModal('addProductModal')">إلغاء</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- نافذة طباعة الفاتورة A4 -->
    <div class="modal" id="printA4Modal">
        <div class="modal-content" style="max-width: 210mm;">
            <div class="modal-header">
                <h3><i class="fas fa-print"></i> طباعة فاتورة A4</h3>
                <button class="close-modal" onclick="closeModal('printA4Modal')">&times;</button>
            </div>
            <div class="invoice-a4" id="a4InvoiceContent">
                <!-- سيتم ملء محتوى الفاتورة ديناميكيا -->
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-success" onclick="printA4Invoice()"><i class="fas fa-print"></i> طباعة</button>
                <button class="btn btn-danger" onclick="closeModal('printA4Modal')">إغلاق</button>
            </div>
        </div>
    </div>
    
    <!-- نافذة طباعة الباركود -->
    <div class="modal" id="printBarcodeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-barcode"></i> طباعة باركود</h3>
                <button class="close-modal" onclick="closeModal('printBarcodeModal')">&times;</button>
            </div>
            <div class="barcode-container" id="barcodePrintContent">
                <!-- سيتم ملء محتوى الباركود ديناميكيا -->
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-success" onclick="printBarcodeOnly()"><i class="fas fa-print"></i> طباعة الباركود</button>
                                <button class="btn btn-danger" onclick="closeModal('printBarcodeModal')">إغلاق</button>
            </div>
        </div>
    </div>
    
    <!-- نافذة إضافة عميل -->
    <div class="modal" id="addCustomerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user-plus"></i> إضافة عميل جديد</h3>
                <button class="close-modal" onclick="closeModal('addCustomerModal')">&times;</button>
            </div>
            <form id="addCustomerForm">
                <div class="form-group">
                    <label>الاسم الكامل</label>
                    <input type="text" id="newCustomerName" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label>رقم الهاتف</label>
                    <input type="text" id="newCustomerPhone" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label>البريد الإلكتروني</label>
                    <input type="email" id="newCustomerEmail" class="form-control">
                </div>
                
                <div class="form-group">
                    <label>العنوان</label>
                    <textarea id="newCustomerAddress" class="form-control" rows="3"></textarea>
                </div>
                
                <div class="form-group">
                    <label>الديون الأولية (إن وجدت)</label>
                    <input type="number" id="newCustomerInitialDebt" class="form-control" value="0">
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="btn btn-success" style="flex: 1;">إضافة العميل</button>
                    <button type="button" class="btn btn-danger" style="flex: 1;" onclick="closeModal('addCustomerModal')">إلغاء</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- نافذة إضافة مورد -->
    <div class="modal" id="addSupplierModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-truck"></i> إضافة مورد جديد</h3>
                <button class="close-modal" onclick="closeModal('addSupplierModal')">&times;</button>
            </div>
            <form id="addSupplierForm">
                <div class="form-group">
                    <label>اسم المورد</label>
                    <input type="text" id="newSupplierName" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label>رقم الهاتف</label>
                    <input type="text" id="newSupplierPhone" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label>البريد الإلكتروني</label>
                    <input type="email" id="newSupplierEmail" class="form-control">
                </div>
                
                <div class="form-group">
                    <label>العنوان</label>
                    <textarea id="newSupplierAddress" class="form-control" rows="3"></textarea>
                </div>
                
                <div class="form-group">
                    <label>الديون الأولية (إن وجدت)</label>
                    <input type="number" id="newSupplierInitialDebt" class="form-control" value="0">
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="btn btn-success" style="flex: 1;">إضافة المورد</button>
                    <button type="button" class="btn btn-danger" style="flex: 1;" onclick="closeModal('addSupplierModal')">إلغاء</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // بيانات النظام
        let systemData = {
            users: [
                { id: 1, username: "admin", password: "farzad1234", fullName: "مدير النظام", role: "مدير", createdAt: "2023-01-01", active: true }
            ],
            products: [
                { id: 1, name: "هاتف سامسونج جالاكسي S23", purchasePrice: 1000000, salePrice: 1250000, quantity: 50, type: "هواتف", color: "#000000", barcode: "123456789012", image: "mobile", description: "هاتف ذكي مع شاشة 6.1 بوصة وكاميرا 50 ميجابكسل" },
                { id: 2, name: "لاب توب ديل XPS 13", purchasePrice: 1500000, salePrice: 1850000, quantity: 30, type: "أجهزة كمبيوتر", color: "#808080", barcode: "123456789013", image: "laptop", description: "لاب توب فائق النحافة مع معالج i7 وذاكرة 16GB" },
                { id: 3, name: "سماعات سوني WH-1000XM5", purchasePrice: 350000, salePrice: 450000, quantity: 100, type: "سماعات", color: "#000000", barcode: "123456789014", image: "headphones", description: "سماعات لاسلكية مع إلغاء الضوضاء النشط" },
                { id: 4, name: "ساعة أبل ووتش سيريز 8", purchasePrice: 600000, salePrice: 750000, quantity: 40, type: "ساعات ذكية", color: "#FFFFFF", barcode: "123456789015", image: "smartwatch", description: "ساعة ذكية مع مراقبة الصحة واللياقة البدنية" },
                { id: 5, name: "كاميرا كانون EOS R6", purchasePrice: 2500000, salePrice: 3200000, quantity: 20, type: "كاميرات", color: "#000000", barcode: "123456789016", image: "camera", description: "كاميرا احترافية مع حساس 20.1 ميجابكسل" },
                { id: 6, name: "تابلت سامسونج تاب S8", purchasePrice: 750000, salePrice: 950000, quantity: 60, type: "تابلت", color: "#808080", barcode: "123456789017", image: "tablet", description: "تابلت مع شاشة 11 بوصة وقلم S-Pen" }
            ],
            customers: [
                { id: 1, name: "أحمد محمد", phone: "07701234567", email: "ahmed@example.com", address: "بغداد - المنصور", totalPurchases: 1250000, debt: 150000, image: "user", type: "عميل دائم" },
                { id: 2, name: "سارة علي", phone: "07702345678", email: "sara@example.com", address: "البصرة", totalPurchases: 850000, debt: 0, image: "user", type: "عميل جديد" },
                { id: 3, name: "عمر خالد", phone: "07703456789", email: "omar@example.com", address: "الموصل", totalPurchases: 2100000, debt: 300000, image: "user", type: "عميل دائم" }
            ],
            suppliers: [
                { id: 1, name: "شركة الإلكترونيات المتقدمة", phone: "07704567890", email: "info@advanced.com", address: "بغداد", totalPurchases: 5000000, debt: 250000, image: "truck", type: "مورد رئيسي" },
                { id: 2, name: "مورد الأجهزة الذكية", phone: "07705678901", email: "contact@smartdevices.com", address: "أربيل", totalPurchases: 3200000, debt: 0, image: "truck", type: "مورد جديد" }
            ],
            invoices: [],
            purchases: [],
            customerPayments: [],
            supplierPayments: [],
            expenses: [],
            cart: [],
            selectedSupplierId: null,
            selectedCustomerId: null,
            selectedCreditCustomerId: null,
            totalSales: 10000000, // كۆی فرۆشتن
            settings: {
                companyName: "متجر الإلكترونيات",
                companyAddress: "بغداد - المنصور",
                companyPhone: "07700000000",
                autoPrint: true,
                showPrintOptions: true,
                autoGenerateBarcode: true,
                autoSuggestColors: true,
                lowStockAlert: false,
                lowStockThreshold: 10,
                invoiceFooter: "شكراً لتعاملكم معنا"
            },
            colorSuggestions: [
                '#FF0000', '#00FF00', '#0000FF', '#FFFF00', '#FF00FF', '#00FFFF',
                '#FFA500', '#800080', '#008080', '#FFC0CB', '#A52A2A', '#808080',
                '#FF5733', '#33FF57', '#3357FF', '#F3FF33', '#FF33F3', '#33FFF3',
                '#8B4513', '#2E8B57', '#4682B4', '#D2691E', '#6495ED', '#DC143C'
            ]
        };
        
        // العناصر الرئيسية في DOM
        const loginPage = document.getElementById('loginPage');
        const mainSystem = document.getElementById('mainSystem');
        const loginForm = document.getElementById('loginForm');
        const logoutBtn = document.getElementById('logoutBtn');
        const menuToggle = document.getElementById('menuToggle');
        const sidebar = document.getElementById('sidebar');
        const sidebarLinks = document.querySelectorAll('.sidebar-menu a');
        const sections = document.querySelectorAll('.section');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        
        // سلة المشتريات
        let invoiceCounter = 1;
        
        // تسجيل الدخول
        loginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // التحقق من بيانات الدخول
            const user = systemData.users.find(u => u.username === username && u.password === password);
            
            if (user) {
                // إخفاء صفحة تسجيل الدخول وإظهار النظام الرئيسي
                loginPage.style.display = 'none';
                mainSystem.style.display = 'block';
                
                // تحميل بيانات النظام
                loadSystemData();
            } else {
                alert('اسم المستخدم أو كلمة المرور غير صحيحة');
            }
        });
        
        // تسجيل الخروج
        logoutBtn.addEventListener('click', function() {
            mainSystem.style.display = 'none';
            loginPage.style.display = 'flex';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            systemData.cart = [];
            systemData.selectedSupplierId = null;
            systemData.selectedCustomerId = null;
            systemData.selectedCreditCustomerId = null;
        });
        
        // تبديل القائمة الجانبية على الأجهزة الصغيرة
        menuToggle.addEventListener('click', function() {
            sidebar.classList.toggle('active');
        });
        
        // تبديل بين الأقسام
        sidebarLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                // إزالة النشاط من جميع الروابط
                sidebarLinks.forEach(l => l.classList.remove('active'));
                
                // إضافة النشاط للرابط المختار
                this.classList.add('active');
                
                // إخفاء جميع الأقسام
                sections.forEach(section => section.classList.remove('active'));
                
                // إظهار القسم المختار
                const sectionId = this.getAttribute('data-section');
                document.getElementById(sectionId).classList.add('active');
                
                // إغلاق القائمة الجانبية على الأجهزة الصغيرة
                if (window.innerWidth <= 992) {
                    sidebar.classList.remove('active');
                }
            });
        });
        
        // تحميل بيانات النظام
        function loadSystemData() {
            // تحميل المنتجات في قسم المبيعات
            loadProducts();
            
            // تحميل بيانات المخزون
            loadInventory();
            
            // تحميل بيانات العملاء
            loadCustomers();
            
            // تحميل بيانات الموردين
            loadSuppliers();
            
            // تحميل الفواتير
            loadInvoices();
            
            // تحميل المشتريات
            loadPurchases();
            
            // تحميل أحدث الفواتير في لوحة التحكم
            loadRecentInvoices();
            
            // تحميل إعدادات الطباعة
            loadPrintSettings();
            
            // تحميل اقتراحات الألوان
            loadColorSuggestions();
            
            // إضافة أحداث للتبويبات
            setupTabs();
            
            // إضافة أحداث لخيارات الدفع
            setupPaymentEvents();
            
            // إضافة أحداث للطباعة
            setupPrintEvents();
            
            // تحميل البيانات المحفوظة
            loadSavedData();
        }
        
        // تحميل المنتجات مع وێنە و جۆر
        function loadProducts() {
            const productsGrid = document.getElementById('productsGrid');
            if (!productsGrid) return;
            
            productsGrid.innerHTML = '';
            systemData.products.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                productCard.innerHTML = `
                    <div class="product-img" style="background: ${product.color || '#f5f7fa'};">
                        <i class="fas fa-${product.image || 'box'}"></i>
                        ${product.type ? `<div style="position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.7); color: white; padding: 2px 8px; border-radius: 10px; font-size: 12px;">${product.type}</div>` : ''}
                    </div>
                    <div class="product-info">
                        <div class="product-name">${product.name}</div>
                        <div class="product-type" style="font-size: 14px; color: #777; margin-bottom: 10px;">${product.type || 'بێ جۆر'}</div>
                        <div class="product-price">${product.salePrice.toLocaleString()} د.ع</div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn" style="padding: 8px 15px; font-size: 14px; flex: 1;" onclick="addToCart(${product.id})">
                                <i class="fas fa-cart-plus"></i> زیادکردن
                            </button>
                            <button class="btn btn-info" style="padding: 8px; font-size: 14px;" onclick="showProductDetails(${product.id})">
                                <i class="fas fa-info"></i>
                            </button>
                        </div>
                    </div>
                `;
                productsGrid.appendChild(productCard);
            });
        }
        
        // تحميل المخزون
        function loadInventory() {
            const inventoryTable = document.querySelector('#inventoryTable tbody');
            if (!inventoryTable) return;
            
            inventoryTable.innerHTML = '';
            systemData.products.forEach((product, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${product.name}</td>
                    <td><i class="fas fa-${product.image}" style="font-size: 24px;"></i></td>
                    <td>${product.quantity}</td>
                    <td>${product.purchasePrice.toLocaleString()} د.ع</td>
                    <td>${product.salePrice.toLocaleString()} د.ع</td>
                    <td>${product.type}</td>
                    <td><div style="width: 20px; height: 20px; background: ${product.color}; border-radius: 50%;"></div></td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-small btn-edit" onclick="editProduct(${product.id})"><i class="fas fa-edit"></i></button>
                            <button class="btn-small btn-delete" onclick="deleteProduct(${product.id})"><i class="fas fa-trash"></i></button>
                            <button class="btn-small btn-print" onclick="openPrintBarcodeModal(${product.id})"><i class="fas fa-barcode"></i></button>
                        </div>
                    </td>
                `;
                inventoryTable.appendChild(row);
            });
        }
        
        // تحميل العملاء مع وێنە
        function loadCustomers() {
            const customersTableBody = document.getElementById('customersTableBody');
            if (customersTableBody) {
                customersTableBody.innerHTML = '';
                systemData.customers.forEach((customer, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>
                            <div class="suggestion-avatar">
                                ${customer.name.charAt(0)}
                            </div>
                        </td>
                        <td>
                            <div style="font-weight: bold;">${customer.name}</div>
                            <div style="font-size: 12px; color: #777;">${customer.type || 'عميل'}</div>
                        </td>
                        <td>${customer.phone}</td>
                        <td>${customer.email}</td>
                        <td>${customer.totalPurchases.toLocaleString()} د.ع</td>
                        <td>${customer.debt.toLocaleString()} د.ع</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn-small btn-edit" onclick="editCustomer(${customer.id})"><i class="fas fa-edit"></i></button>
                                <button class="btn-small btn-delete" onclick="deleteCustomer(${customer.id})"><i class="fas fa-trash"></i></button>
                                <button class="btn-small btn-view" onclick="viewCustomerDetails(${customer.id})"><i class="fas fa-eye"></i></button>
                            </div>
                        </td>
                    `;
                    customersTableBody.appendChild(row);
                });
            }
        }
        
        // تحميل الموردين مع وێنە
        function loadSuppliers() {
            const suppliersTableBody = document.getElementById('suppliersTableBody');
            if (suppliersTableBody) {
                suppliersTableBody.innerHTML = '';
                systemData.suppliers.forEach((supplier, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>
                            <div style="width: 40px; height: 40px; background: var(--warning); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white;">
                                <i class="fas fa-truck"></i>
                            </div>
                        </td>
                        <td>
                            <div style="font-weight: bold;">${supplier.name}</div>
                            <div style="font-size: 12px; color: #777;">${supplier.type || 'مورد'}</div>
                        </td>
                        <td>${supplier.phone}</td>
                        <td>${supplier.email}</td>
                        <td>${supplier.totalPurchases.toLocaleString()} د.ع</td>
                        <td>${supplier.debt.toLocaleString()} د.ع</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn-small btn-edit" onclick="editSupplier(${supplier.id})"><i class="fas fa-edit"></i></button>
                                <button class="btn-small btn-delete" onclick="deleteSupplier(${supplier.id})"><i class="fas fa-trash"></i></button>
                                <button class="btn-small btn-view" onclick="viewSupplierDetails(${supplier.id})"><i class="fas fa-eye"></i></button>
                            </div>
                        </td>
                    `;
                    suppliersTableBody.appendChild(row);
                });
            }
        }
        
        // تحميل الفواتير
        function loadInvoices() {
            const invoicesTable = document.querySelector('#invoicesTable tbody');
            if (invoicesTable) {
                invoicesTable.innerHTML = '';
                systemData.invoices.forEach((invoice, index) => {
                    const customer = systemData.customers.find(c => c.id === invoice.customerId) || { name: "زائر" };
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${invoice.id}</td>
                        <td>${invoice.date}</td>
                        <td>${customer.name}</td>
                        <td>${invoice.total.toLocaleString()} د.ع</td>
                        <td>${invoice.paymentType === 'cash' ? 'نقداً' : 'بالدين'}</td>
                        <td><span style="padding: 5px 10px; border-radius: 20px; background: #4CAF50; color: white;">مكتمل</span></td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn-small btn-view" onclick="viewInvoice(${invoice.id})"><i class="fas fa-eye"></i></button>
                                <button class="btn-small btn-print" onclick="printInvoice(${invoice.id})"><i class="fas fa-print"></i></button>
                                <button class="btn-small btn-delete" onclick="deleteInvoice(${invoice.id})"><i class="fas fa-trash"></i></button>
                            </div>
                        </td>
                    `;
                    invoicesTable.appendChild(row);
                });
            }
        }
        
        // تحميل المشتريات
        function loadPurchases() {
            const purchasesTable = document.querySelector('#purchasesTable tbody');
            if (purchasesTable) {
                purchasesTable.innerHTML = '';
                systemData.purchases.forEach((purchase, index) => {
                    const supplier = systemData.suppliers.find(s => s.id === purchase.supplierId) || { name: "غير محدد" };
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${purchase.id}</td>
                        <td>${purchase.date}</td>
                        <td>${supplier.name}</td>
                        <td>${purchase.total.toLocaleString()} د.ع</td>
                        <td>${purchase.paymentType === 'cash' ? 'نقداً' : 'بالدين'}</td>
                        <td><span style="padding: 5px 10px; border-radius: 20px; background: #4CAF50; color: white;">مكتمل</span></td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn-small btn-view" onclick="viewPurchase(${purchase.id})"><i class="fas fa-eye"></i></button>
                                <button class="btn-small btn-print" onclick="printPurchase(${purchase.id})"><i class="fas fa-print"></i></button>
                                <button class="btn-small btn-delete" onclick="deletePurchase(${purchase.id})"><i class="fas fa-trash"></i></button>
                            </div>
                        </td>
                    `;
                    purchasesTable.appendChild(row);
                });
            }
        }
        
        // تحميل أحدث الفواتير
        function loadRecentInvoices() {
            const recentInvoices = document.getElementById('recentInvoices');
            if (recentInvoices) {
                recentInvoices.innerHTML = '';
                const recent = systemData.invoices.slice(-5).reverse();
                recent.forEach(invoice => {
                    const customer = systemData.customers.find(c => c.id === invoice.customerId) || { name: "زائر" };
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${invoice.id}</td>
                        <td>${invoice.date}</td>
                        <td>${customer.name}</td>
                        <td>${invoice.total.toLocaleString()} د.ع</td>
                        <td>${invoice.paymentType === 'cash' ? 'نقداً' : 'بالدين'}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn-small btn-view" onclick="viewInvoice(${invoice.id})"><i class="fas fa-eye"></i></button>
                                <button class="btn-small btn-print" onclick="printInvoice(${invoice.id})"><i class="fas fa-print"></i></button>
                            </div>
                        </td>
                    `;
                    recentInvoices.appendChild(row);
                });
            }
        }
        
        // تحميل إعدادات الطباعة
        function loadPrintSettings() {
            if (document.getElementById('autoPrint')) {
                document.getElementById('autoPrint').checked = systemData.settings.autoPrint;
                document.getElementById('showPrintOptions').checked = systemData.settings.showPrintOptions;
                document.getElementById('autoGenerateBarcode').checked = systemData.settings.autoGenerateBarcode;
                document.getElementById('autoSuggestColors').checked = systemData.settings.autoSuggestColors;
                document.getElementById('lowStockAlert').checked = systemData.settings.lowStockAlert;
                document.getElementById('lowStockThreshold').value = systemData.settings.lowStockThreshold;
                document.getElementById('invoiceFooter').value = systemData.settings.invoiceFooter;
                document.getElementById('companyName').value = systemData.settings.companyName;
                document.getElementById('companyAddress').value = systemData.settings.companyAddress;
                document.getElementById('companyPhone').value = systemData.settings.companyPhone;
            }
        }
        
        // تحميل اقتراحات الألوان
        function loadColorSuggestions() {
            const colorContainer = document.getElementById('colorSuggestions');
            if (colorContainer) {
                colorContainer.innerHTML = '';
                systemData.colorSuggestions.forEach(color => {
                    const colorOption = document.createElement('div');
                    colorOption.className = 'color-option';
                    colorOption.style.backgroundColor = color;
                    colorOption.title = color;
                    colorOption.onclick = function() {
                        document.getElementById('productColor').value = color;
                    };
                    colorContainer.appendChild(colorOption);
                });
            }
        }
        
        // ڕێکخستنی تابەکان
        function setupTabs() {
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    const parent = this.closest('.section') || this.closest('.modal-content');
                    
                    // إزالة النشاط من جميع التبويبات
                    parent.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    
                    // إضافة النشاط للتبويب المختار
                    this.classList.add('active');
                    
                    // إخفاء جميع محتويات التبويبات
                    parent.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                    
                    // إظهار محتوى التبويب المختار
                    parent.querySelector(`#${tabId}Tab`).classList.add('active');
                });
            });
        }
        
        // ڕێکخستنی ڕویداوەکانی پارەدان
        function setupPaymentEvents() {
            const paymentRadios = document.querySelectorAll('input[name="paymentType"]');
            paymentRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    const creditSection = document.getElementById('creditSection');
                    if (this.value === 'credit') {
                        creditSection.style.display = 'block';
                    } else {
                        creditSection.style.display = 'none';
                        systemData.selectedCreditCustomerId = null;
                        if (document.getElementById('creditCustomerSearch')) {
                            document.getElementById('creditCustomerSearch').value = '';
                        }
                        if (document.getElementById('selectedCreditCustomerInfo')) {
                            document.getElementById('selectedCreditCustomerInfo').style.display = 'none';
                        }
                    }
                });
            });
        }
        
        // ڕێکخستنی ڕویداوەکانی چاپکردن
        function setupPrintEvents() {
            const printSmall = document.getElementById('printSmall');
            const printA4 = document.getElementById('printA4');
            
            if (printSmall) {
                printSmall.addEventListener('click', function() {
                    printSmallInvoice();
                });
            }
            
            if (printA4) {
                printA4.addEventListener('click', function() {
                    openPrintA4Modal();
                });
            }
        }
        
        // گەڕان بەدوای کاڵا لە بەشی فرۆشتن
        function searchProducts() {
            const searchTerm = document.getElementById('productSearch').value.toLowerCase();
            const suggestions = document.getElementById('productSuggestions');
            
            if (searchTerm.length === 0) {
                suggestions.style.display = 'none';
                return;
            }
            
            const filteredProducts = systemData.products.filter(product => 
                product.name.toLowerCase().includes(searchTerm) || 
                product.type.toLowerCase().includes(searchTerm)
            );
            
            suggestions.innerHTML = '';
            filteredProducts.forEach(product => {
                const suggestion = document.createElement('div');
                suggestion.className = 'suggestion-item';
                suggestion.innerHTML = `
                    <div style="width: 40px; height: 40px; background: ${product.color || '#f5f7fa'}; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: var(--primary);">
                        <i class="fas fa-${product.image || 'box'}"></i>
                    </div>
                    <div class="suggestion-details">
                        <div class="suggestion-name">${product.name}</div>
                        <div style="font-size: 13px; color: #777;">${product.type} | ${product.salePrice.toLocaleString()} د.ع</div>
                    </div>
                `;
                suggestion.onclick = function() {
                    addToCart(product.id);
                    document.getElementById('productSearch').value = '';
                    suggestions.style.display = 'none';
                };
                suggestions.appendChild(suggestion);
            });
            
            suggestions.style.display = 'block';
        }
        
        // گەڕان بەدوای کڕیار لە بەشی فرۆشتن
        function searchCustomers() {
            const searchTerm = document.getElementById('customerSearch').value.toLowerCase();
            const suggestions = document.getElementById('customerSuggestions');
            
            if (searchTerm.length === 0) {
                suggestions.style.display = 'none';
                return;
            }
            
            const filteredCustomers = systemData.customers.filter(customer => 
                customer.name.toLowerCase().includes(searchTerm) || 
                customer.phone.includes(searchTerm) ||
                customer.email.toLowerCase().includes(searchTerm)
            );
            
            suggestions.innerHTML = '';
            filteredCustomers.forEach(customer => {
                const suggestion = document.createElement('div');
                suggestion.className = 'suggestion-item';
                suggestion.innerHTML = `
                    <div class="suggestion-avatar">
                        ${customer.name.charAt(0)}
                    </div>
                    <div class="suggestion-details">
                        <div class="suggestion-name">${customer.name}</div>
                        <div class="suggestion-phone">${customer.phone}</div>
                        <div style="font-size: 12px; color: #777;">${customer.type || 'عميل'}</div>
                    </div>
                `;
                suggestion.onclick = function() {
                    selectCustomer(customer.id);
                    document.getElementById('customerSearch').value = customer.name;
                    suggestions.style.display = 'none';
                };
                suggestions.appendChild(suggestion);
            });
            
            suggestions.style.display = 'block';
        }
        
        // گەڕان بەدوای مورد لە بەشی فرۆشتن
        function searchSuppliersCart() {
            const searchTerm = document.getElementById('supplierSearchCart').value.toLowerCase();
            const suggestions = document.getElementById('supplierCartSuggestions');
            
            if (searchTerm.length === 0) {
                suggestions.style.display = 'none';
                return;
            }
            
            const filteredSuppliers = systemData.suppliers.filter(supplier => 
                supplier.name.toLowerCase().includes(searchTerm) || 
                supplier.phone.includes(searchTerm)
            );
            
            suggestions.innerHTML = '';
            filteredSuppliers.forEach(supplier => {
                const suggestion = document.createElement('div');
                suggestion.className = 'suggestion-item';
                suggestion.innerHTML = `
                    <div style="width: 40px; height: 40px; background: var(--warning); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white;">
                        <i class="fas fa-truck"></i>
                    </div>
                    <div class="suggestion-details">
                        <div class="suggestion-name">${supplier.name}</div>
                        <div class="suggestion-phone">${supplier.phone}</div>
                        <div style="font-size: 12px; color: #777;">الديون: ${supplier.debt.toLocaleString()} د.ع</div>
                    </div>
                `;
                suggestion.onclick = function() {
                    selectSupplier(supplier.id);
                    document.getElementById('supplierSearchCart').value = supplier.name;
                    suggestions.style.display = 'none';
                };
                suggestions.appendChild(suggestion);
            });
            
            suggestions.style.display = 'block';
        }
        
        // گەڕان بەدوای کڕیار بۆ قەرز
        function searchCreditCustomers() {
            const searchTerm = document.getElementById('creditCustomerSearch').value.toLowerCase();
            const suggestions = document.getElementById('creditCustomerSuggestions');
            
            if (searchTerm.length === 0) {
                suggestions.style.display = 'none';
                return;
            }
            
            const filteredCustomers = systemData.customers.filter(customer => 
                customer.name.toLowerCase().includes(searchTerm) || 
                customer.phone.includes(searchTerm)
            );
            
            suggestions.innerHTML = '';
            filteredCustomers.forEach(customer => {
                const suggestion = document.createElement('div');
                suggestion.className = 'suggestion-item';
                suggestion.innerHTML = `
                    <div class="suggestion-avatar">
                        ${customer.name.charAt(0)}
                    </div>
                    <div class="suggestion-details">
                        <div class="suggestion-name">${customer.name}</div>
                        <div class="suggestion-phone">${customer.phone}</div>
                        <div style="font-size: 12px; color: #777;">الديون الحالية: ${customer.debt.toLocaleString()} د.ع</div>
                    </div>
                `;
                suggestion.onclick = function() {
                    selectCreditCustomer(customer.id);
                    document.getElementById('creditCustomerSearch').value = customer.name;
                    suggestions.style.display = 'none';
                };
                suggestions.appendChild(suggestion);
            });
            
            suggestions.style.display = 'block';
        }
        
        // گەڕان بەدوای کڕیار لە بەشی کڕیارەکان
        function searchCustomerList() {
            const searchTerm = document.getElementById('customerListSearch').value.toLowerCase();
            const suggestions = document.getElementById('customerListSuggestions');
            
            if (searchTerm.length === 0) {
                if (suggestions) suggestions.style.display = 'none';
                return;
            }
            
            const filteredCustomers = systemData.customers.filter(customer => 
                customer.name.toLowerCase().includes(searchTerm) || 
                customer.phone.includes(searchTerm)
            );
            
            if (suggestions) {
                suggestions.innerHTML = '';
                filteredCustomers.forEach(customer => {
                    const suggestion = document.createElement('div');
                    suggestion.className = 'suggestion-item';
                    suggestion.innerHTML = `
                        <div class="suggestion-avatar">
                            ${customer.name.charAt(0)}
                        </div>
                        <div class="suggestion-details">
                            <div class="suggestion-name">${customer.name}</div>
                            <div class="suggestion-phone">${customer.phone}</div>
                        </div>
                    `;
                    suggestion.onclick = function() {
                        document.getElementById('customerListSearch').value = customer.name;
                        suggestions.style.display = 'none';
                    };
                    suggestions.appendChild(suggestion);
                });
                
                suggestions.style.display = 'block';
            }
        }
        
        // گەڕان بەدوای مورد لە بەشی موردەکان
        function searchSupplierList() {
            const searchTerm = document.getElementById('supplierListSearch').value.toLowerCase();
            const suggestions = document.getElementById('supplierListSuggestions');
            
            if (searchTerm.length === 0) {
                if (suggestions) suggestions.style.display = 'none';
                return;
            }
            
            const filteredSuppliers = systemData.suppliers.filter(supplier => 
                supplier.name.toLowerCase().includes(searchTerm) || 
                supplier.phone.includes(searchTerm)
            );
            
            if (suggestions) {
                suggestions.innerHTML = '';
                filteredSuppliers.forEach(supplier => {
                    const suggestion = document.createElement('div');
                    suggestion.className = 'suggestion-item';
                    suggestion.innerHTML = `
                        <div style="width: 40px; height: 40px; background: var(--warning); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white;">
                            <i class="fas fa-truck"></i>
                        </div>
                        <div class="suggestion-details">
                            <div class="suggestion-name">${supplier.name}</div>
                            <div class="suggestion-phone">${supplier.phone}</div>
                        </div>
                    `;
                    suggestion.onclick = function() {
                        document.getElementById('supplierListSearch').value = supplier.name;
                        suggestions.style.display = 'none';
                    };
                    suggestions.appendChild(suggestion);
                });
                
                suggestions.style.display = 'block';
            }
        }
        
        // هەڵبژاردنی کڕیار
        function selectCustomer(customerId) {
            systemData.selectedCustomerId = customerId;
            const customer = systemData.customers.find(c => c.id === customerId);
            
            if (customer) {
                document.getElementById('selectedCustomerName').textContent = customer.name;
                document.getElementById('customerPreviousDebt').textContent = customer.debt.toLocaleString();
                document.getElementById('selectedCustomerInfo').style.display = 'block';
            }
        }
        
        // هەڵبژاردنی مورد
        function selectSupplier(supplierId) {
            systemData.selectedSupplierId = supplierId;
            const supplier = systemData.suppliers.find(s => s.id === supplierId);
            
            if (supplier) {
                document.getElementById('selectedSupplierName').textContent = supplier.name;
                document.getElementById('supplierCurrentDebt').textContent = supplier.debt.toLocaleString();
                document.getElementById('selectedSupplierInfo').style.display = 'block';
            }
        }
        
        // هەڵبژاردنی کڕیار بۆ قەرز
        function selectCreditCustomer(customerId) {
            systemData.selectedCreditCustomerId = customerId;
            const customer = systemData.customers.find(c => c.id === customerId);
            
            if (customer) {
                document.getElementById('selectedCreditCustomerName').textContent = customer.name;
                document.getElementById('selectedCreditCustomerInfo').style.display = 'block';
            }
        }
        
        // لابردنی کڕیار
        window.removeCustomer = function() {
            systemData.selectedCustomerId = null;
            document.getElementById('selectedCustomerInfo').style.display = 'none';
            document.getElementById('customerSearch').value = '';
        };
        
        // لابردنی مورد
        window.removeSupplier = function() {
            systemData.selectedSupplierId = null;
            document.getElementById('selectedSupplierInfo').style.display = 'none';
            document.getElementById('supplierSearchCart').value = '';
        };
        
        // زیادکردنی کاڵا بۆ سەبەتە
        window.addToCart = function(productId) {
            const product = systemData.products.find(p => p.id === productId);
            if (!product) return;
            
            // التحقق من توفر المنتج
            if (product.quantity <= 0) {
                alert('المنتج غير متوفر في المخزون');
                return;
            }
            
            // التحقق إذا كان المنتج موجود بالفعل في السلة
            const existingItem = systemData.cart.find(item => item.productId === productId);
            
            if (existingItem) {
                // زيادة الكمية إذا المنتج موجود
                existingItem.quantity += 1;
            } else {
                // إضافة منتج جديد للسلة
                systemData.cart.push({
                    productId: productId,
                    name: product.name,
                    price: product.salePrice,
                    quantity: 1,
                    type: product.type,
                    image: product.image,
                    color: product.color
                });
            }
            
            updateCartDisplay();
            updateInvoiceSummary();
            saveData();
        };
        
        // نوێکردنەوەی پیشاندانی سەبەتە
        function updateCartDisplay() {
            const cartItemsContainer = document.getElementById('cartItemsContainer');
            if (!cartItemsContainer) return;
            
            cartItemsContainer.innerHTML = '';
            
            if (systemData.cart.length === 0) {
                cartItemsContainer.innerHTML = `
                    <div style="padding: 40px; text-align: center; color: #777;">
                        <i class="fas fa-shopping-cart" style="font-size: 50px; margin-bottom: 20px;"></i>
                        <p>السلة فارغة. قم بإضافة منتجات من الأعلى.</p>
                    </div>
                `;
                return;
            }
            
            const table = document.createElement('table');
            table.style.width = '100%';
            table.style.borderCollapse = 'collapse';
            
            const thead = document.createElement('thead');
            thead.innerHTML = `
                <tr style="background: #f5f5f5;">
                    <th style="padding: 15px; text-align: right;">#</th>
                    <th style="padding: 15px; text-align: right;">المنتج</th>
                    <th style="padding: 15px; text-align: center;">السعر</th>
                    <th style="padding: 15px; text-align: center;">الكمية</th>
                    <th style="padding: 15px; text-align: left;">الإجمالي</th>
                    <th style="padding: 15px; text-align: center;">الإجراءات</th>
                </tr>
            `;
            table.appendChild(thead);
            
            const tbody = document.createElement('tbody');
            
            systemData.cart.forEach((item, index) => {
                const product = systemData.products.find(p => p.id === item.productId);
                const row = document.createElement('tr');
                row.style.borderBottom = '1px solid #eee';
                row.innerHTML = `
                    <td style="padding: 15px;">${index + 1}</td>
                    <td style="padding: 15px;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="width: 40px; height: 40px; background: ${product?.color || '#f5f7fa'}; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-${product?.image || 'box'}" style="color: var(--primary);"></i>
                            </div>
                            <div>
                                <div style="font-weight: bold;">${item.name}</div>
                                <div style="font-size: 12px; color: #777;">${product?.type || ''}</div>
                            </div>
                        </div>
                    </td>
                    <td style="padding: 15px; text-align: center;">${item.price.toLocaleString()} د.ع</td>
                    <td style="padding: 15px; text-align: center;">
                        <div style="display: flex; align-items: center; justify-content: center; gap: 10px;">
                            <button class="btn-small" onclick="updateCartQuantity(${item.productId}, -1)" style="padding: 2px 8px;">-</button>
                            <span style="min-width: 30px; text-align: center;">${item.quantity}</span>
                            <button class="btn-small" onclick="updateCartQuantity(${item.productId}, 1)" style="padding: 2px 8px;">+</button>
                        </div>
                    </td>
                    <td style="padding: 15px; text-align: left; font-weight: bold; color: var(--primary);">
                        ${(item.price * item.quantity).toLocaleString()} د.ع
                    </td>
                    <td style="padding: 15px; text-align: center;">
                        <div class="action-buttons">
                            <button class="btn-small btn-edit" onclick="editCartItem(${item.productId})"><i class="fas fa-edit"></i></button>
                            <button class="btn-small btn-delete" onclick="removeFromCart(${item.productId})"><i class="fas fa-trash"></i></button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            table.appendChild(tbody);
            cartItemsContainer.appendChild(table);
        }
        
        // نوێکردنەوەی چەندی کاڵا لە سەبەتە
        window.updateCartQuantity = function(productId, change) {
            const item = systemData.cart.find(item => item.productId === productId);
            if (!item) return;
            
            const product = systemData.products.find(p => p.id === productId);
            
            if (item.quantity + change <= 0) {
                removeFromCart(productId);
            } else if (item.quantity + change > product.quantity) {
                alert(`الكمية المتاحة في المخزون: ${product.quantity}`);
            } else {
                item.quantity += change;
                updateCartDisplay();
                updateInvoiceSummary();
                saveData();
            }
        };
        
        // دەستکاریکردنی کاڵا لە سەبەتە
        window.editCartItem = function(productId) {
            const item = systemData.cart.find(item => item.productId === productId);
            if (!item) return;
            
            const newQuantity = prompt('أدخل الكمية الجديدة:', item.quantity);
            
            if (newQuantity && !isNaN(newQuantity) && newQuantity > 0) {
                const product = systemData.products.find(p => p.id === productId);
                
                if (parseInt(newQuantity) > product.quantity) {
                    alert(`الكمية المتاحة في المخزون: ${product.quantity}`);
                } else {
                    item.quantity = parseInt(newQuantity);
                    updateCartDisplay();
                    updateInvoiceSummary();
                    saveData();
                }
            }
        };
        
        // لابردنی کاڵا لە سەبەتە
        window.removeFromCart = function(productId) {
            systemData.cart = systemData.cart.filter(item => item.productId !== productId);
            updateCartDisplay();
            updateInvoiceSummary();
            saveData();
        };
        
        // بەتاڵکردنەوەی سەبەتە
        window.clearCart = function() {
            if (systemData.cart.length === 0) {
                alert('السلة فارغة بالفعل');
                return;
            }
            
            if (confirm('هل أنت متأكد من تفريغ السلة؟')) {
                systemData.cart = [];
                systemData.selectedCustomerId = null;
                systemData.selectedSupplierId = null;
                systemData.selectedCreditCustomerId = null;
                
                document.getElementById('selectedCustomerInfo').style.display = 'none';
                document.getElementById('selectedSupplierInfo').style.display = 'none';
                document.getElementById('selectedCreditCustomerInfo').style.display = 'none';
                document.getElementById('customerSearch').value = '';
                document.getElementById('supplierSearchCart').value = '';
                if (document.getElementById('creditCustomerSearch')) {
                    document.getElementById('creditCustomerSearch').value = '';
                }
                
                updateCartDisplay();
                updateInvoiceSummary();
                saveData();
            }
        };
        
        // نوێکردنەوەی کورتەی پسوولە
        function updateInvoiceSummary() {
            let subtotal = 0;
            
            systemData.cart.forEach(item => {
                subtotal += item.price * item.quantity;
            });
            
            const discount = parseFloat(document.getElementById('discountInput')?.value) || 0;
            const tax = subtotal * 0.05; // 5% ضريبة
            
            const total = subtotal - discount + tax;
            
            if (document.getElementById('subtotal')) {
                document.getElementById('subtotal').textContent = subtotal.toLocaleString() + ' د.ع';
                document.getElementById('discount').textContent = discount.toLocaleString() + ' د.ع';
                document.getElementById('tax').textContent = tax.toLocaleString() + ' د.ع';
                document.getElementById('totalAmount').textContent = total.toLocaleString() + ' د.ع';
            }
        }
        
        // بەکارهێنانی خەڵاتی لەسەدان
        window.applyDiscount = function(percentage) {
            let subtotal = 0;
            
            systemData.cart.forEach(item => {
                subtotal += item.price * item.quantity;
            });
            
            const discount = subtotal * (percentage / 100);
            if (document.getElementById('discountInput')) {
                document.getElementById('discountInput').value = discount;
                updateInvoiceSummary();
            }
        };
        
        // نوێکردنەوەی خەڵات
        window.updateDiscount = function() {
            updateInvoiceSummary();
        };
        
        // تەواوکردنی فرۆشتن
        window.completeSale = function() {
            if (systemData.cart.length === 0) {
                alert('السلة فارغة. الرجاء إضافة منتجات قبل إتمام البيع.');
                return;
            }
            
            const paymentType = document.querySelector('input[name="paymentType"]:checked').value;
            const discount = parseFloat(document.getElementById('discountInput').value) || 0;
            
            // ئەگەر نەقدە، پێویستە لەگەڵ مورد کار بکات
            if (paymentType === 'cash' && !systemData.selectedSupplierId) {
                alert('للمشتريات النقدية، يرجى تحديد المورد أولاً');
                return;
            }
            
            // ئەگەر قەرزە، پێویستە لەگەڵ کڕیار کار بکات
            if (paymentType === 'credit' && !systemData.selectedCreditCustomerId) {
                alert('للمشتريات بالدين، يرجى تحديد العميل أولاً');
                return;
            }
            
            // حساب الإجمالي
            let subtotal = 0;
            systemData.cart.forEach(item => {
                subtotal += item.price * item.quantity;
            });
            
            const tax = subtotal * 0.05;
            const total = subtotal - discount + tax;
            
            // دروستکردنی پسوولە
            const invoice = {
                id: `INV-${Date.now()}`,
                date: new Date().toLocaleDateString('ar-EG'),
                time: new Date().toLocaleTimeString('ar-EG'),
                customerId: paymentType === 'credit' ? systemData.selectedCreditCustomerId : systemData.selectedCustomerId,
                supplierId: systemData.selectedSupplierId,
                items: [...systemData.cart],
                subtotal: subtotal,
                discount: discount,
                tax: tax,
                total: total,
                paymentType: paymentType,
                status: 'مكتمل'
            };
            
            // نوێکردنەوەی کۆگا
            systemData.cart.forEach(item => {
                const product = systemData.products.find(p => p.id === item.productId);
                if (product) {
                    product.quantity -= item.quantity;
                }
            });
            
            // سیستەمی پارە:
            // 1. ئەگەر نەقدە: کەمکردنەوەی بڕی پارە لە کۆی فرۆشتن
            if (paymentType === 'cash' && systemData.selectedSupplierId) {
                systemData.totalSales -= total;
                console.log(`کەمکردنەوەی ${total} لە کۆی فرۆشتن بەهۆی کڕینی نەقد`);
                
                // زیادکردنی قەرز بۆ مورد (کاتێک کڕینەکە نەقدە بەڵام قەرزی موردەکە زیاد دەبێت)
                const supplier = systemData.suppliers.find(s => s.id === systemData.selectedSupplierId);
                if (supplier) {
                    supplier.debt += total;
                    supplier.totalPurchases += total;
                }
            }
            
            // 2. ئەگەر قەرزە: زیادکردنی قەرز بۆ کڕیار
            if (paymentType === 'credit' && systemData.selectedCreditCustomerId) {
                const customer = systemData.customers.find(c => c.id === systemData.selectedCreditCustomerId);
                if (customer) {
                    customer.debt += total;
                    customer.totalPurchases += total;
                }
            }
            
            // زیادکردنی پسوولە بۆ سیستەم
            systemData.invoices.push(invoice);
            
            // پاشەکەوتکردنی دراوەکان
            saveData();
            
            // چاپکردنی پسوولە ئەگەر ڕێکخستن چالاک بێت
            if (systemData.settings.autoPrint) {
                printSmallInvoice();
            } else if (systemData.settings.showPrintOptions) {
                alert('تم إتمام البيع بنجاح. الرجاء اختيار خيار الطباعة.');
            } else {
                alert('تم إتمام البيع بنجاح!');
            }
            
            // ڕێکخستنەوەی سەبەتە
            systemData.cart = [];
            systemData.selectedCustomerId = null;
            systemData.selectedSupplierId = null;
            systemData.selectedCreditCustomerId = null;
            
            // ڕێکخستنەوەی فیلدەکان
            document.getElementById('customerSearch').value = '';
            document.getElementById('supplierSearchCart').value = '';
            document.getElementById('creditCustomerSearch').value = '';
            document.getElementById('discountInput').value = '';
            document.getElementById('selectedCustomerInfo').style.display = 'none';
            document.getElementById('selectedSupplierInfo').style.display = 'none';
            document.getElementById('selectedCreditCustomerInfo').style.display = 'none';
            
            // نوێکردنەوەی پیشاندان
            updateCartDisplay();
            updateInvoiceSummary();
            loadInventory();
            loadCustomers();
            loadSuppliers();
            loadInvoices();
            loadRecentInvoices();
        };
        
        // چاپکردنی پسوولەی بچووک
        function printSmallInvoice() {
            if (systemData.cart.length === 0) {
                alert('لا توجد فاتورة للطباعة');
                return;
            }
            
            const customerId = systemData.selectedCustomerId || systemData.selectedCreditCustomerId;
            const customer = customerId ? systemData.customers.find(c => c.id === customerId) : null;
            const supplier = systemData.selectedSupplierId ? systemData.suppliers.find(s => s.id === systemData.selectedSupplierId) : null;
            const paymentType = document.querySelector('input[name="paymentType"]:checked').value;
            
            // حساب الإجمالي
            let subtotal = 0;
            systemData.cart.forEach(item => {
                subtotal += item.price * item.quantity;
            });
            const discount = parseFloat(document.getElementById('discountInput').value) || 0;
            const tax = subtotal * 0.05;
            const total = subtotal - discount + tax;
            
            const printContent = `
                <div class="small-invoice">
                    <div style="text-align: center; margin-bottom: 15px;">
                        <h3>${systemData.settings.companyName}</h3>
                        <p>${systemData.settings.companyAddress}</p>
                        <p>${systemData.settings.companyPhone}</p>
                    </div>
                    
                    <div style="border-bottom: 1px dashed #000; margin-bottom: 15px; padding-bottom: 10px;">
                        <p><strong>رقم الفاتورة:</strong> INV-${Date.now()}</p>
                        <p><strong>التاريخ:</strong> ${new Date().toLocaleDateString('ar-EG')}</p>
                        <p><strong>الوقت:</strong> ${new Date().toLocaleTimeString('ar-EG')}</p>
                    </div>
                    
                    <table style="width: 100%; margin-bottom: 15px;">
                        <thead>
                            <tr>
                                <th style="text-align: right; border-bottom: 1px solid #000;">المنتج</th>
                                <th style="text-align: center; border-bottom: 1px solid #000;">الكمية</th>
                                <th style="text-align: left; border-bottom: 1px solid #000;">السعر</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${systemData.cart.map(item => `
                                <tr>
                                    <td style="text-align: right;">${item.name}</td>
                                    <td style="text-align: center;">${item.quantity}</td>
                                    <td style="text-align: left;">${item.price.toLocaleString()} د.ع</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    
                    <div style="border-top: 1px dashed #000; padding-top: 10px; margin-bottom: 15px;">
                        ${customer ? `<p><strong>العميل:</strong> ${customer.name}</p>` : ''}
                        ${supplier ? `<p><strong>المورد:</strong> ${supplier.name}</p>` : ''}
                        <p><strong>طريقة الدفع:</strong> ${paymentType === 'cash' ? 'نقداً' : 'بالدين'}</p>
                        <p><strong>الإجمالي:</strong> ${total.toLocaleString()} د.ع</p>
                    </div>
                    
                    <div style="text-align: center; font-size: 12px; color: #777;">
                        <p>${systemData.settings.invoiceFooter}</p>
                        <p>شكراً لتعاملكم معنا</p>
                    </div>
                </div>
            `;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>طباعة الفاتورة</title>
                        <style>
                            body { font-family: Arial, sans-serif; direction: rtl; }
                            @media print {
                                body { margin: 0; padding: 0; }
                            }
                        </style>
                    </head>
                    <body>
                        ${printContent}
                        <script>
                            window.onload = function() {
                                window.print();
                                setTimeout(function() {
                                    window.close();
                                }, 1000);
                            };
                        <\/script>
                    </body>
                </html>
            `);
            printWindow.document.close();
        }
        
        // کردنەوەی پەنجەرەی چاپکردنی پسوولەی A4
        function openPrintA4Modal() {
            if (systemData.cart.length === 0) {
                alert('لا توجد فاتورة للطباعة');
                return;
            }
            
            const customerId = systemData.selectedCustomerId || systemData.selectedCreditCustomerId;
            const customer = customerId ? systemData.customers.find(c => c.id === customerId) : null;
            const supplier = systemData.selectedSupplierId ? systemData.suppliers.find(s => s.id === systemData.selectedSupplierId) : null;
            const paymentType = document.querySelector('input[name="paymentType"]:checked').value;
            
            // حساب الإجمالي
            let subtotal = 0;
            systemData.cart.forEach(item => {
                subtotal += item.price * item.quantity;
            });
            const discount = parseFloat(document.getElementById('discountInput').value) || 0;
            const tax = subtotal * 0.05;
            const total = subtotal - discount + tax;
            
            const invoiceContent = document.getElementById('a4InvoiceContent');
            invoiceContent.innerHTML = `
                <div class="invoice-header">
                    <div>
                        <h2>${systemData.settings.companyName}</h2>
                        <p>${systemData.settings.companyAddress}</p>
                        <p>${systemData.settings.companyPhone}</p>
                    </div>
                    <div class="invoice-logo">
                        <i class="fas fa-shopping-cart"></i>
                    </div>
                </div>
                
                <div style="display: flex; justify-content: space-between; margin-bottom: 30px;">
                    <div>
                        <h3>فاتورة بيع</h3>
                        <p><strong>رقم الفاتورة:</strong> INV-${Date.now()}</p>
                        <p><strong>التاريخ:</strong> ${new Date().toLocaleDateString('ar-EG')}</p>
                        <p><strong>الوقت:</strong> ${new Date().toLocaleTimeString('ar-EG')}</p>
                    </div>
                    <div>
                        ${customer ? `
                            <h3>معلومات العميل</h3>
                            <p><strong>الاسم:</strong> ${customer.name}</p>
                            <p><strong>الهاتف:</strong> ${customer.phone}</p>
                            ${customer.email ? `<p><strong>البريد:</strong> ${customer.email}</p>` : ''}
                            <p><strong>الديون السابقة:</strong> ${customer.debt.toLocaleString()} د.ع</p>
                        ` : supplier ? `
                            <h3>معلومات المورد</h3>
                            <p><strong>الاسم:</strong> ${supplier.name}</p>
                            <p><strong>الهاتف:</strong> ${supplier.phone}</p>
                            <p><strong>الديون السابقة:</strong> ${supplier.debt.toLocaleString()} د.ع</p>
                        ` : '<h3>زبون نقدي</h3>'}
                    </div>
                </div>
                
                <table style="width: 100%; border-collapse: collapse; margin-bottom: 30px;">
                    <thead>
                        <tr style="background: #f5f5f5;">
                            <th style="padding: 10px; text-align: right; border: 1px solid #ddd;">#</th>
                            <th style="padding: 10px; text-align: right; border: 1px solid #ddd;">المنتج</th>
                            <th style="padding: 10px; text-align: center; border: 1px solid #ddd;">الكمية</th>
                            <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">السعر</th>
                            <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">الإجمالي</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${systemData.cart.map((item, index) => `
                            <tr>
                                <td style="padding: 10px; border: 1px solid #ddd;">${index + 1}</td>
                                <td style="padding: 10px; border: 1px solid #ddd;">${item.name}</td>
                                <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">${item.quantity}</td>
                                <td style="padding: 10px; border: 1px solid #ddd;">${item.price.toLocaleString()} د.ع</td>
                                <td style="padding: 10px; border: 1px solid #ddd;">${(item.price * item.quantity).toLocaleString()} د.ع</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
                
                <div style="display: flex; justify-content: space-between; margin-bottom: 30px;">
                    <div style="flex: 1;"></div>
                    <div style="flex: 1;">
                        <div style="background: #f9f9f9; padding: 20px; border-radius: 10px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span>إجمالي المنتجات:</span>
                                <span>${subtotal.toLocaleString()} د.ع</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span>الخصم:</span>
                                <span>${discount.toLocaleString()} د.ع</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span>الضريبة (5%):</span>
                                <span>${tax.toLocaleString()} د.ع</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px; padding-top: 10px; border-top: 2px solid #ddd; font-size: 18px; font-weight: bold;">
                                <span>الإجمالي النهائي:</span>
                                <span>${total.toLocaleString()} د.ع</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div style="border-top: 2px solid #eee; padding-top: 20px; margin-top: 40px;">
                    <div style="display: flex; justify-content: space-between;">
                        <div>
                            <p><strong>طريقة الدفع:</strong> ${paymentType === 'cash' ? 'نقداً' : 'بالدين'}</p>
                            ${customer && paymentType === 'credit' ? `
                                <p><strong>الديون الجديدة:</strong> ${total.toLocaleString()} د.ع</p>
                                <p><strong>إجمالي الديون:</strong> ${(customer.debt + total).toLocaleString()} د.ع</p>
                            ` : ''}
                        </div>
                        <div style="text-align: left;">
                            <p>التوقيع: ________________</p>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 30px; color: #777; font-size: 14px;">
                        <p>${systemData.settings.invoiceFooter}</p>
                        <p>شكراً لتعاملكم معنا</p>
                    </div>
                </div>
            `;
            
            openModal('printA4Modal');
        }
        
        // چاپکردنی پسوولەی A4
        function printA4Invoice() {
            const printContent = document.getElementById('a4InvoiceContent').innerHTML;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>طباعة فاتورة A4</title>
                        <style>
                            body { 
                                font-family: Arial, sans-serif; 
                                direction: rtl; 
                                margin: 0;
                                padding: 0;
                            }
                            @page {
                                size: A4;
                                margin: 20mm;
                            }
                            @media print {
                                body { margin: 0; }
                            }
                        </style>
                    </head>
                    <body>
                        ${printContent}
                        <script>
                            window.onload = function() {
                                window.print();
                                setTimeout(function() {
                                    window.close();
                                }, 1000);
                            };
                        <\/script>
                    </body>
                </html>
            `);
            printWindow.document.close();
        }
        
        // کردنەوەی پەنجەرەی زیادکردنی کاڵا
        window.openAddProductModal = function() {
            document.getElementById('addProductForm').reset();
            openModal('addProductModal');
        };
        
        // دروستکردنی بارکۆد
        window.generateBarcode = function() {
            const barcode = Math.floor(100000000000 + Math.random() * 900000000000).toString();
            document.getElementById('productBarcode').value = barcode;
        };
        
        // زیادکردنی کاڵای نوێ
        document.getElementById('addProductForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const newProduct = {
                id: systemData.products.length + 1,
                name: document.getElementById('productName').value,
                purchasePrice: parseFloat(document.getElementById('purchasePrice').value),
                salePrice: parseFloat(document.getElementById('salePrice').value),
                quantity: parseInt(document.getElementById('productQuantity').value),
                type: document.getElementById('productType').value,
                color: document.getElementById('productColor').value || '#000000',
                barcode: document.getElementById('productBarcode').value || Math.floor(100000000000 + Math.random() * 900000000000).toString(),
                image: 'box',
                description: ''
            };
            
            // زیادکردنی ڕەنگی نوێ بۆ پێشنیارەکان ئەگەر بوونی نەبێت
            if (newProduct.color && !systemData.colorSuggestions.includes(newProduct.color)) {
                systemData.colorSuggestions.push(newProduct.color);
            }
            
            systemData.products.push(newProduct);
            saveData();
            
            // نوێکردنەوەی پیشاندان
            loadProducts();
            loadInventory();
            loadColorSuggestions();
            
            closeModal('addProductModal');
            alert('تم إضافة المنتج بنجاح!');
        });
        
        // دەستکاریکردنی کاڵا
        window.editProduct = function(productId) {
            const product = systemData.products.find(p => p.id === productId);
            if (!product) return;
            
            // کردنەوەی پەنجەرەی دەستکاری
            document.getElementById('productName').value = product.name;
            document.getElementById('purchasePrice').value = product.purchasePrice;
            document.getElementById('salePrice').value = product.salePrice;
            document.getElementById('productQuantity').value = product.quantity;
            document.getElementById('productType').value = product.type;
            document.getElementById('productColor').value = product.color;
            document.getElementById('productBarcode').value = product.barcode;
            
            // گۆڕینی دەق لەسەر دوگمە
            const submitBtn = document.querySelector('#addProductForm button[type="submit"]');
            submitBtn.textContent = 'تحديث المنتج';
            submitBtn.onclick = function(e) {
                e.preventDefault();
                updateProduct(productId);
            };
            
            openModal('addProductModal');
        };
        
        // نوێکردنەوەی کاڵا
        function updateProduct(productId) {
            const productIndex = systemData.products.findIndex(p => p.id === productId);
            if (productIndex === -1) return;
            
            systemData.products[productIndex] = {
                ...systemData.products[productIndex],
                name: document.getElementById('productName').value,
                purchasePrice: parseFloat(document.getElementById('purchasePrice').value),
                salePrice: parseFloat(document.getElementById('salePrice').value),
                quantity: parseInt(document.getElementById('productQuantity').value),
                type: document.getElementById('productType').value,
                color: document.getElementById('productColor').value || '#000000',
                barcode: document.getElementById('productBarcode').value
            };
            
            saveData();
            
            // نوێکردنەوەی پیشاندان
            loadProducts();
            loadInventory();
            
            closeModal('addProductModal');
            alert('تم تحديث المنتج بنجاح!');
        };
        
        // سڕینەوەی کاڵا
        window.deleteProduct = function(productId) {
            if (confirm('هل أنت متأكد من حذف هذا المنتج؟')) {
                systemData.products = systemData.products.filter(p => p.id !== productId);
                saveData();
                
                loadProducts();
                loadInventory();
                alert('تم حذف المنتج بنجاح!');
            }
        };
        
        // کردنەوەی پەنجەرەی چاپکردنی بارکۆد
        window.openPrintBarcodeModal = function(productId) {
            const product = systemData.products.find(p => p.id === productId);
            if (!product) return;
            
            const barcodeContent = document.getElementById('barcodePrintContent');
            barcodeContent.innerHTML = `
                <h3>${product.name}</h3>
                <p>النوع: ${product.type}</p>
                <p>السعر: ${product.salePrice.toLocaleString()} د.ع</p>
                <div class="barcode">
                    ${product.barcode}
                </div>
                <p>باركود: ${product.barcode}</p>
            `;
            
            openModal('printBarcodeModal');
        };
        
        // چاپکردنی بارکۆد
        function printBarcodeOnly() {
            const printContent = document.getElementById('barcodePrintContent').innerHTML;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>طباعة الباركود</title>
                        <style>
                            body { 
                                font-family: Arial, sans-serif; 
                                direction: rtl; 
                                text-align: center;
                                margin: 0;
                                padding: 20px;
                            }
                            .barcode {
                                font-family: monospace;
                                font-size: 24px;
                                letter-spacing: 2px;
                                padding: 20px;
                                border: 1px solid #000;
                                margin: 20px auto;
                                width: 300px;
                            }
                        </style>
                    </head>
                    <body>
                        ${printContent}
                        <script>
                            window.onload = function() {
                                window.print();
                                setTimeout(function() {
                                    window.close();
                                }, 1000);
                            };
                        <\/script>
                    </body>
                </html>
            `);
            printWindow.document.close();
        };
        
        // کردنەوەی پەنجەرەی زیادکردنی کڕیار
        window.openAddCustomerModal = function() {
            document.getElementById('addCustomerForm').reset();
            openModal('addCustomerModal');
        };
        
        // زیادکردنی کڕیاری نوێ
        document.getElementById('addCustomerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const newCustomer = {
                id: systemData.customers.length + 1,
                name: document.getElementById('newCustomerName').value,
                phone: document.getElementById('newCustomerPhone').value,
                email: document.getElementById('newCustomerEmail').value,
                address: document.getElementById('newCustomerAddress').value,
                totalPurchases: 0,
                debt: parseFloat(document.getElementById('newCustomerInitialDebt').value) || 0,
                image: 'user',
                type: "عميل جديد"
            };
            
            systemData.customers.push(newCustomer);
            saveData();
            loadCustomers();
            closeModal('addCustomerModal');
            
            alert('تم إضافة العميل بنجاح!');
        });
        
        // کردنەوەی پەنجەرەی زیادکردنی مورد
        window.openAddSupplierModal = function() {
            document.getElementById('addSupplierForm').reset();
            openModal('addSupplierModal');
        };
        
        // زیادکردنی مۆردی نوێ
        document.getElementById('addSupplierForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const newSupplier = {
                id: systemData.suppliers.length + 1,
                name: document.getElementById('newSupplierName').value,
                phone: document.getElementById('newSupplierPhone').value,
                email: document.getElementById('newSupplierEmail').value,
                address: document.getElementById('newSupplierAddress').value,
                totalPurchases: 0,
                debt: parseFloat(document.getElementById('newSupplierInitialDebt').value) || 0,
                image: 'truck',
                type: "مورد جديد"
            };
            
            systemData.suppliers.push(newSupplier);
            saveData();
            loadSuppliers();
            closeModal('addSupplierModal');
            
            alert('تم إضافة المورد بنجاح!');
        };
        
        // دەستکاریکردنی کڕیار
        window.editCustomer = function(customerId) {
            const customer = systemData.customers.find(c => c.id === customerId);
            if (!customer) return;
            
            const newName = prompt('الاسم الجديد للعميل:', customer.name);
            if (newName && newName.trim() !== '') {
                customer.name = newName;
                saveData();
                loadCustomers();
                alert('تم تحديث بيانات العميل بنجاح!');
            }
        };
        
        // دەستکاریکردنی مورد
        window.editSupplier = function(supplierId) {
            const supplier = systemData.suppliers.find(s => s.id === supplierId);
            if (!supplier) return;
            
            const newName = prompt('الاسم الجديد للمورد:', supplier.name);
            if (newName && newName.trim() !== '') {
                supplier.name = newName;
                saveData();
                loadSuppliers();
                alert('تم تحديث بيانات المورد بنجاح!');
            }
        };
        
        // سڕینەوەی کڕیار
        window.deleteCustomer = function(customerId) {
            if (confirm('هل أنت متأكد من حذف هذا العميل؟')) {
                systemData.customers = systemData.customers.filter(c => c.id !== customerId);
                saveData();
                loadCustomers();
                alert('تم حذف العميل بنجاح!');
            }
        };
        
        // سڕینەوەی مورد
        window.deleteSupplier = function(supplierId) {
            if (confirm('هل أنت متأكد من حذف هذا المورد؟')) {
                systemData.suppliers = systemData.suppliers.filter(s => s.id !== supplierId);
                saveData();
                loadSuppliers();
                alert('تم حذف المورد بنجاح!');
            }
        };
        
        // بینینی وردەکاریی کڕیار
        window.viewCustomerDetails = function(customerId) {
            const customer = systemData.customers.find(c => c.id === customerId);
            if (!customer) return;
            
            alert(`
                تفاصيل العميل:
                الاسم: ${customer.name}
                الهاتف: ${customer.phone}
                البريد: ${customer.email || 'لا يوجد'}
                العنوان: ${customer.address || 'لا يوجد'}
                نوع العميل: ${customer.type}
                إجمالي المشتريات: ${customer.totalPurchases.toLocaleString()} د.ع
                الديون الحالية: ${customer.debt.toLocaleString()} د.ع
            `);
        };
        
        // بینینی وردەکاریی مورد
        window.viewSupplierDetails = function(supplierId) {
            const supplier = systemData.suppliers.find(s => s.id === supplierId);
            if (!supplier) return;
            
            alert(`
                تفاصيل المورد:
                الاسم: ${supplier.name}
                الهاتف: ${supplier.phone}
                البريد: ${supplier.email || 'لا يوجد'}
                العنوان: ${supplier.address || 'لا يوجد'}
                نوع المورد: ${supplier.type}
                إجمالي المشتريات: ${supplier.totalPurchases.toLocaleString()} د.ع
                الديون الحالية: ${supplier.debt.toLocaleString()} د.ع
            `);
        };
        
        // نیشاندانی وردەکاریی کاڵا
        window.showProductDetails = function(productId) {
            const product = systemData.products.find(p => p.id === productId);
            if (!product) return;
            
            alert(`
                وردەکاریی کاڵا:
                ناو: ${product.name}
                جۆر: ${product.type || 'بێ جۆر'}
                نرخی کڕین: ${product.purchasePrice.toLocaleString()} د.ع
                نرخی فرۆشتن: ${product.salePrice.toLocaleString()} د.ع
                بەردەست: ${product.quantity}
                ڕەنگ: ${product.color}
                بارکۆد: ${product.barcode}
                ${product.description ? `\nشرح: ${product.description}` : ''}
            `);
        };
        
        // پاشەکەوتکردنی دراوەکان
        function saveData() {
            localStorage.setItem('electronicsSalesSystem', JSON.stringify(systemData));
        }
        
        // بارکردنی دراوە پاشەکەوتکراوەکان
        function loadSavedData() {
            const savedData = localStorage.getItem('electronicsSalesSystem');
            if (savedData) {
                const parsedData = JSON.parse(savedData);
                systemData = {
                    ...systemData,
                    ...parsedData,
                    cart: parsedData.cart || [],
                    selectedSupplierId: parsedData.selectedSupplierId || null,
                    selectedCustomerId: parsedData.selectedCustomerId || null,
                    selectedCreditCustomerId: parsedData.selectedCreditCustomerId || null,
                    totalSales: parsedData.totalSales || 10000000
                };
                
                loadProducts();
                loadInventory();
                loadCustomers();
                loadSuppliers();
                updateCartDisplay();
                updateInvoiceSummary();
            }
        }
        
        // کردنەوەی پەنجەرە
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }
        
        // داخستنی پەنجەرە
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }
        
        // گۆڕینی وشەی نهێنی
        window.changePassword = function() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (currentPassword !== systemData.users[0].password) {
                alert('كلمة المرور الحالية غير صحيحة');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                alert('كلمة المرور الجديدة وتأكيدها غير متطابقتين');
                return;
            }
            
            systemData.users[0].password = newPassword;
            saveData();
            alert('تم تغيير كلمة المرور بنجاح!');
        };
        
        // پاشەکەوتکردنی ڕێکخستنەکانی چاپکردن
        window.savePrintSettings = function() {
            systemData.settings.autoPrint = document.getElementById('autoPrint').checked;
            systemData.settings.showPrintOptions = document.getElementById('showPrintOptions').checked;
            systemData.settings.invoiceFooter = document.getElementById('invoiceFooter').value;
            
            saveData();
            alert('تم حفظ إعدادات الطباعة بنجاح!');
        };
        
        // پاشەکەوتکردنی ڕێکخستنەکانی کاڵا
        window.saveProductSettings = function() {
            systemData.settings.autoGenerateBarcode = document.getElementById('autoGenerateBarcode').checked;
            systemData.settings.autoSuggestColors = document.getElementById('autoSuggestColors').checked;
            systemData.settings.lowStockAlert = document.getElementById('lowStockAlert').checked;
            systemData.settings.lowStockThreshold = parseInt(document.getElementById('lowStockThreshold').value);
            
            saveData();
            alert('تم حفظ إعدادات المنتجات بنجاح!');
        };
        
        // پاشەکەوتکردنی ڕێکخستنەکانی کۆمپانیا
        window.saveCompanySettings = function() {
            systemData.settings.companyName = document.getElementById('companyName').value;
            systemData.settings.companyAddress = document.getElementById('companyAddress').value;
            systemData.settings.companyPhone = document.getElementById('companyPhone').value;
            
            saveData();
            alert('تم حفظ معلومات الشركة بنجاح!');
        };
        
        // دروستکردنی پاشەکەوت
        window.createBackup = function() {
            const dataStr = JSON.stringify(systemData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `backup-${new Date().toISOString().slice(0,10)}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            alert('تم إنشاء النسخة الاحتياطية بنجاح!');
        };
        
        // گەڕاندنەوەی پاشەکەوت
        window.restoreBackup = function() {
            const fileInput = document.getElementById('backupFile');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('الرجاء اختيار ملف النسخة الاحتياطية');
                return;
            }
            
            if (confirm('هل أنت متأكد من استعادة النسخة الاحتياطية؟ سيتم استبدال جميع البيانات الحالية.')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const restoredData = JSON.parse(e.target.result);
                        systemData = restoredData;
                        saveData();
                        loadSystemData();
                        alert('تم استعادة النسخة الاحتياطية بنجاح!');
                    } catch (error) {
                        alert('خطأ في ملف النسخة الاحتياطية: ' + error.message);
                    }
                };
                reader.readAsText(file);
            }
        };
        
        // گەڕان لە کۆگادا
        window.searchInventory = function() {
            const searchTerm = document.getElementById('inventorySearch').value.toLowerCase();
            const rows = document.querySelectorAll('#inventoryTable tbody tr');
            
            rows.forEach(row => {
                const productName = row.cells[1].textContent.toLowerCase();
                const productType = row.cells[6].textContent.toLowerCase();
                
                if (productName.includes(searchTerm) || productType.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        };
        
        // گەڕان لە پسوولەکاندا
        window.searchInvoices = function() {
            const searchTerm = document.getElementById('invoiceSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#invoicesTable tbody tr');
            
            rows.forEach(row => {
                const invoiceId = row.cells[0].textContent.toLowerCase();
                const customerName = row.cells[2].textContent.toLowerCase();
                
                if (invoiceId.includes(searchTerm) || customerName.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        };
        
        // مسح الباركود
        window.scanBarcode = function() {
            alert('في التطبيق الفعلي، سيتم فتح كاميرا الجهاز لمسح الباركود');
        };
        
        // دروستکردنی ڕاپۆرت
        window.generateReport = function() {
            const reportType = document.getElementById('reportType').value;
            const reportDate = document.getElementById('reportDate').value;
            
            let reportContent = '';
            
            switch(reportType) {
                case 'daily':
                    reportContent = '<h3>تقرير المبيعات اليومي</h3>';
                    break;
                case 'weekly':
                    reportContent = '<h3>تقرير المبيعات الأسبوعي</h3>';
                    break;
                case 'monthly':
                    reportContent = '<h3>تقرير المبيعات الشهري</h3>';
                    break;
                case 'yearly':
                    reportContent = '<h3>تقرير المبيعات السنوي</h3>';
                    break;
            }
            
            // إضافة إحصائيات وهمية
            reportContent += `
                <div class="stats-cards" style="margin-top: 20px;">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-shopping-bag"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-title">إجمالي المبيعات</div>
                            <div class="stat-value">125,750 <span style="font-size: 16px;">د.ع</span></div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-cart-arrow-down"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-title">إجمالي المشتريات</div>
                            <div class="stat-value">89,500 <span style="font-size: 16px;">د.ع</span></div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-title">صافي الربح</div>
                            <div class="stat-value">36,250 <span style="font-size: 16px;">د.ع</span></div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('reportResults').innerHTML = reportContent;
        };
        
        // چاپکردنی ڕاپۆرت
        window.printReport = function() {
            const reportContent = document.getElementById('reportResults').innerHTML;
            
            if (!reportContent) {
                alert('الرجاء توليد التقرير أولاً');
                return;
            }
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>طباعة التقرير</title>
                        <style>
                            body { 
                                font-family: Arial, sans-serif; 
                                direction: rtl; 
                                padding: 20px;
                            }
                        </style>
                    </head>
                    <body>
                        ${reportContent}
                        <script>
                            window.onload = function() {
                                window.print();
                                setTimeout(function() {
                                    window.close();
                                }, 1000);
                            };
                        <\/script>
                    </body>
                </html>
            `);
            printWindow.document.close();
        };
        
        // هەناردەی پسوولەکان
        window.exportInvoices = function() {
            const dataStr = JSON.stringify(systemData.invoices, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `invoices-${new Date().toISOString().slice(0,10)}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        };
        
        // بینینی پسوولە
        window.viewInvoice = function(invoiceId) {
            const invoice = systemData.invoices.find(inv => inv.id === invoiceId);
            if (!invoice) return;
            
            alert(`عرض الفاتورة ${invoiceId}\n\nفي التطبيق الكامل، سيتم عرض تفاصيل الفاتورة الكاملة.`);
        };
        
        // چاپکردنی پسوولە
        window.printInvoice = function(invoiceId) {
            const invoice = systemData.invoices.find(inv => inv.id === invoiceId);
            if (!invoice) return;
            
            alert(`طباعة الفاتورة ${invoiceId}\n\nفي التطبيق الكامل، سيتم فتح نافذة الطباعة.`);
        };
        
        // سڕینەوەی پسوولە
        window.deleteInvoice = function(invoiceId) {
            if (confirm('هل أنت متأكد من حذف هذه الفاتورة؟')) {
                systemData.invoices = systemData.invoices.filter(inv => inv.id !== invoiceId);
                saveData();
                loadInvoices();
                loadRecentInvoices();
                alert('تم حذف الفاتورة بنجاح!');
            }
        };
        
        // بینینی کڕین
        window.viewPurchase = function(purchaseId) {
            const purchase = systemData.purchases.find(p => p.id === purchaseId);
            if (!purchase) return;
            
            alert(`عرض فاتورة الشراء ${purchaseId}\n\nفي التطبيق الكامل، سيتم عرض تفاصيل الفاتورة الكاملة.`);
        };
        
        // چاپکردنی کڕین
        window.printPurchase = function(purchaseId) {
            const purchase = systemData.purchases.find(p => p.id === purchaseId);
            if (!purchase) return;
            
            alert(`طباعة فاتورة الشراء ${purchaseId}\n\nفي التطبيق الكامل، سيتم فتح نافذة الطباعة.`);
        };
        
        // سڕینەوەی کڕین
        window.deletePurchase = function(purchaseId) {
            if (confirm('هل أنت متأكد من حذف فاتورة الشراء هذه؟')) {
                systemData.purchases = systemData.purchases.filter(p => p.id !== purchaseId);
                saveData();
                loadPurchases();
                alert('تم حذف فاتورة الشراء بنجاح!');
            }
        };
        
        // کردنەوەی پەنجەرەی زیادکردنی کڕین
        window.openAddPurchaseModal = function() {
            alert('في التطبيق الكامل، سيتم فتح نافذة لإضافة عملية شراء جديدة');
        };
        
        // کردنەوەی پەنجەرەی زیادکردنی پارەدانی کڕیار
        window.openAddCustomerPaymentModal = function() {
            alert('في التطبيق الكامل، سيتم فتح نافذة لإضافة دفعة عميل');
        };
        
        // کردنەوەی پەنجەرەی زیادکردنی پارەدانی مورد
        window.openAddSupplierPaymentModal = function() {
            alert('في التطبيق الكامل، سيتم فتح نافذة لإضافة دفعة مورد');
        };
        
        // کردنەوەی پەنجەرەی زیادکردنی خەرجی
        window.openAddExpenseModal = function() {
            alert('في التطبيق الكامل، سيتم فتح نافذة لإضافة مصروف');
        };
        
        // کردنەوەی پەنجەرەی زیادکردنی بەکارهێنەر
        window.openAddUserModal = function() {
            alert('في التطبيق الكامل، سيتم فتح نافذة لإضافة مستخدم جديد');
        };
        
        // کردنەوەی پەنجەرەی زیادکردنی ڕێگەپێدان
        window.openAddRoleModal = function() {
            alert('في التطبيق الكامل، سيتم فتح نافذة لإضافة صلاحية جديدة');
        };
        
        // بارکردنی سیستەم کاتێک پەڕەکە دەکرێتەوە
        window.addEventListener('load', function() {
            // بارکردنی دراوە پاشەکەوتکراوەکان
            loadSavedData();
            
            // نیشاندانی پەڕەی چوونەژوورەوە و شاردنەوەی سیستەمی سەرەکی
            mainSystem.style.display = 'none';
            loginPage.style.display = 'flex';
            
            // ئەنیمەیشنی بۆ کارتەکان
            setTimeout(() => {
                document.querySelectorAll('.stat-card').forEach((card, index) => {
                    card.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                });
            }, 500);
        });
        
        // داخستنی پەنجەرەکان بە کلیککردن لە دەرەوە
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('active');
                }
            });
        });
    </script>
</body>
</html>