<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>سیستەمی فرۆشگا</title>
    <style>
        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #166088;
            --accent-color: #4cb5f5;
            --text-color: #333;
            --bg-color: #f5f5f5;
            --card-bg: #fff;
            --border-color: #ddd;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
        }

        [data-theme="dark"] {
            --primary-color: #2c3e50;
            --secondary-color: #34495e;
            --accent-color: #3498db;
            --text-color: #ecf0f1;
            --bg-color: #1a1a1a;
            --card-bg: #2c2c2c;
            --border-color: #444;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: all 0.3s ease;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        header {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
        }

        nav ul {
            display: flex;
            list-style: none;
        }

        nav ul li {
            margin-left: 1.5rem;
        }

        nav ul li a {
            color: white;
            text-decoration: none;
            padding: 0.5rem;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        nav ul li a:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .theme-toggle {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1.2rem;
        }

        .login-section {
            display: flex;
            align-items: center;
        }

        .login-form {
            display: flex;
            align-items: center;
        }

        .login-form input {
            padding: 0.5rem;
            border: none;
            border-radius: 4px;
            margin-left: 0.5rem;
        }

        .login-form button {
            padding: 0.5rem 1rem;
            background-color: var(--accent-color);
            border: none;
            border-radius: 4px;
            color: white;
            cursor: pointer;
            margin-left: 0.5rem;
        }

        .main-content {
            padding: 2rem 0;
        }

        .section {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .section-title {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--primary-color);
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 0.5rem;
        }

        .search-box {
            display: flex;
            margin-bottom: 1rem;
            position: relative;
        }

        .search-box input {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 4px 0 0 4px;
            background-color: var(--card-bg);
            color: var(--text-color);
        }

        .search-box button {
            padding: 0.75rem 1rem;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
        }

        .suggestions {
            position: absolute;
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            width: calc(100% - 32px);
            max-height: 200px;
            overflow-y: auto;
            z-index: 10;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            top: 100%;
            right: 0;
        }

        .suggestion-item {
            padding: 0.75rem;
            cursor: pointer;
            border-bottom: 1px solid var(--border-color);
        }

        .suggestion-item:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .product-card {
            background-color: var(--card-bg);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
        }

        .product-card:hover {
            transform: translateY(-5px);
        }

        .product-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .product-info {
            padding: 1rem;
        }

        .product-name {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .product-price {
            font-weight: bold;
            color: var(--secondary-color);
            margin-bottom: 1rem;
        }

        .product-actions {
            display: flex;
            justify-content: space-between;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--secondary-color);
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: #bd2130;
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background-color: #218838;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        table th, table td {
            padding: 0.75rem;
            text-align: right;
            border-bottom: 1px solid var(--border-color);
        }

        table th {
            background-color: var(--primary-color);
            color: white;
        }

        table tr:hover {
            background-color: rgba(0, 0, 0, 0.03);
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .cart-item-info {
            flex: 1;
        }

        .cart-item-actions {
            display: flex;
            align-items: center;
        }

        .quantity-control {
            display: flex;
            align-items: center;
            margin-left: 1rem;
        }

        .quantity-control button {
            width: 30px;
            height: 30px;
            border: 1px solid var(--border-color);
            background-color: var(--card-bg);
            color: var(--text-color);
            cursor: pointer;
        }

        .quantity-control input {
            width: 40px;
            height: 30px;
            text-align: center;
            border: 1px solid var(--border-color);
            margin: 0 5px;
            background-color: var(--card-bg);
            color: var(--text-color);
        }

        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .dashboard-card {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .dashboard-card h3 {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            color: var(--primary-color);
        }

        .dashboard-card .value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--secondary-color);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 2rem;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-color);
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--card-bg);
            color: var(--text-color);
        }

        .tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 1.5rem;
        }

        .tab {
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }

        .tab.active {
            border-bottom-color: var(--accent-color);
            color: var(--accent-color);
            font-weight: bold;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        footer {
            background-color: var(--primary-color);
            color: white;
            text-align: center;
            padding: 1.5rem 0;
            margin-top: 2rem;
        }

        .hidden {
            display: none;
        }

        .barcode-scanner {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 1rem 0;
        }

        #barcode-video {
            width: 100%;
            max-width: 400px;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                align-items: flex-start;
            }

            nav ul {
                margin-top: 1rem;
                flex-wrap: wrap;
            }

            nav ul li {
                margin: 0.5rem;
            }

            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }

            .dashboard-cards {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container header-content">
            <div class="logo">سیستەمی فرۆشگا</div>
            <nav>
                <ul>
                    <li><a href="#" data-section="dashboard">داشبۆرد</a></li>
                    <li><a href="#" data-section="products">کاڵاکان</a></li>
                    <li><a href="#" data-section="sales">فرۆشتن</a></li>
                    <li><a href="#" data-section="purchases">کڕین</a></li>
                    <li><a href="#" data-section="customers">کڕیارەکان</a></li>
                    <li><a href="#" data-section="warehouse">کۆگا</a></li>
                    <li><a href="#" data-section="settings">ڕێکخستنەکان</a></li>
                </ul>
            </nav>
            <div class="login-section">
                <div class="login-form">
                    <input type="password" id="password-input" placeholder="پاسۆرد">
                    <button id="login-btn">چوونەژوورەوە</button>
                </div>
                <button class="theme-toggle" id="theme-toggle">🌙</button>
            </div>
        </div>
    </header>

    <main class="container main-content">
        <!-- داشبۆرد -->
        <section id="dashboard-section" class="section hidden">
            <h2 class="section-title">داشبۆرد</h2>
            <div class="dashboard-cards">
                <div class="dashboard-card">
                    <h3>کۆی فرۆشتن</h3>
                    <div class="value" id="total-sales">0 دینار</div>
                </div>
                <div class="dashboard-card">
                    <h3>کۆی کڕین</h3>
                    <div class="value" id="total-purchases">0 دینار</div>
                </div>
                <div class="dashboard-card">
                    <h3>کۆی سەرف</h3>
                    <div class="value" id="total-expenses">0 دینار</div>
                </div>
                <div class="dashboard-card">
                    <h3>کۆی گشتی</h3>
                    <div class="value" id="total-balance">0 دینار</div>
                </div>
            </div>

            <div class="section">
                <h3 class="section-title">داهاتو خەرجییەکان</h3>
                <canvas id="finance-chart" width="400" height="200"></canvas>
            </div>
        </section>

        <!-- بەشی کاڵاکان -->
        <section id="products-section" class="section hidden">
            <h2 class="section-title">کاڵاکان</h2>
            
            <div class="search-box">
                <input type="text" id="product-search" placeholder="گەڕان بەدوای کاڵا...">
                <button id="product-search-btn">گەڕان</button>
                <div class="suggestions hidden" id="product-suggestions"></div>
            </div>

            <div class="barcode-scanner hidden" id="barcode-scanner">
                <video id="barcode-video" autoplay></video>
                <button id="start-scan" class="btn btn-primary">دەستپێکردنی سکانەری بارکۆد</button>
                <button id="stop-scan" class="btn btn-danger hidden">وەستاندنی سکانەر</button>
            </div>

            <div class="products-grid" id="products-grid">
                <!-- کاڵاکان لێرە دەخرێنەرەوە -->
            </div>
        </section>

        <!-- بەشی فرۆشتن -->
        <section id="sales-section" class="section hidden">
            <h2 class="section-title">فرۆشتن</h2>
            
            <div class="search-box">
                <input type="text" id="customer-search" placeholder="گەڕان بەدوای کڕیار...">
                <button id="customer-search-btn">گەڕان</button>
                <div class="suggestions hidden" id="customer-suggestions"></div>
            </div>

            <div class="cart-items" id="cart-items">
                <!-- کاڵاکانی سەبەتە لێرە دەخرێنەرەوە -->
                <p id="empty-cart-message">هیچ کاڵایەک لە سەبەتەدا نییە.</p>
            </div>

            <div class="cart-total">
                <h3>کۆی گشتی: <span id="cart-total-amount">0 دینار</span></h3>
            </div>

            <div class="payment-options">
                <button class="btn btn-success" id="cash-payment">نەقدی</button>
                <button class="btn btn-primary" id="credit-payment">قەرز</button>
            </div>

            <div class="sales-history">
                <h3 class="section-title">مێژووی فرۆشتن</h3>
                <table>
                    <thead>
                        <tr>
                            <th>ژمارەی فرۆشتن</th>
                            <th>کڕیار</th>
                            <th>بڕ</th>
                            <th>جۆری پارەدان</th>
                            <th>کات</th>
                            <th>کردارەکان</th>
                        </tr>
                    </thead>
                    <tbody id="sales-history-body">
                        <!-- مێژووی فرۆشتن لێرە دەخرێنەرەوە -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- بەشی کڕین -->
        <section id="purchases-section" class="section hidden">
            <h2 class="section-title">کڕین</h2>
            
            <div class="search-box">
                <input type="text" id="supplier-search" placeholder="گەڕان بەدوای فرۆشیار...">
                <button id="supplier-search-btn">گەڕان</button>
                <div class="suggestions hidden" id="supplier-suggestions"></div>
            </div>

            <div class="search-box">
                <input type="text" id="purchase-search" placeholder="گەڕان بەدوای کاڵا...">
                <button id="purchase-search-btn">گەڕان</button>
                <div class="suggestions hidden" id="purchase-suggestions"></div>
            </div>

            <div class="products-grid" id="purchase-products">
                <!-- کاڵاکانی کڕین لێرە دەخرێنەرەوە -->
            </div>

            <div class="purchase-history">
                <h3 class="section-title">مێژووی کڕین</h3>
                <table>
                    <thead>
                        <tr>
                            <th>ژمارەی کڕین</th>
                            <th>کاڵا</th>
                            <th>فرۆشیار</th>
                            <th>بڕ</th>
                            <th>نرخ</th>
                            <th>کات</th>
                            <th>کردارەکان</th>
                        </tr>
                    </thead>
                    <tbody id="purchase-history-body">
                        <!-- مێژووی کڕین لێرە دەخرێنەرەوە -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- بەشی کڕیارەکان -->
        <section id="customers-section" class="section hidden">
            <h2 class="section-title">کڕیارەکان</h2>
            
            <button class="btn btn-primary" id="add-customer-btn">زیادکردنی کڕیاری نوێ</button>

            <div class="search-box">
                <input type="text" id="customer-list-search" placeholder="گەڕان بەدوای کڕیار...">
                <button id="customer-list-search-btn">گەڕان</button>
                <div class="suggestions hidden" id="customer-list-suggestions"></div>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>ناو</th>
                        <th>ژمارەی مۆبایل</th>
                        <th>ناونیشان</th>
                        <th>کۆی قەرز</th>
                        <th>کردارەکان</th>
                    </tr>
                </thead>
                <tbody id="customers-table-body">
                    <!-- لیستی کڕیارەکان لێرە دەخرێنەرەوە -->
                </tbody>
            </table>
        </section>

        <!-- بەشی کۆگا -->
        <section id="warehouse-section" class="section hidden">
            <h2 class="section-title">کۆگا</h2>
            
            <button class="btn btn-primary" id="add-product-btn">زیادکردنی کاڵای نوێ</button>

            <div class="search-box">
                <input type="text" id="warehouse-search" placeholder="گەڕان بەدوای کاڵا...">
                <button id="warehouse-search-btn">گەڕان</button>
                <div class="suggestions hidden" id="warehouse-suggestions"></div>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>ناو</th>
                        <th>بارکۆد</th>
                        <th>نرخی کڕین</th>
                        <th>نرخی فرۆشتن</th>
                        <th>بڕ</th>
                        <th>کردارەکان</th>
                    </tr>
                </thead>
                <tbody id="warehouse-table-body">
                    <!-- لیستی کاڵاکانی کۆگا لێرە دەخرێنەرەوە -->
                </tbody>
            </table>
        </section>

        <!-- بەشی ڕێکخستنەکان -->
        <section id="settings-section" class="section hidden">
            <h2 class="section-title">ڕێکخستنەکان</h2>
            
            <div class="tabs">
                <div class="tab active" data-tab="backup">باکەپ</div>
                <div class="tab" data-tab="expenses">سەرفەکان</div>
                <div class="tab" data-tab="currency">پارە گۆڕین</div>
            </div>

            <div class="tab-content active" id="backup-tab">
                <h3>باکەپ و گەڕاندنەوە</h3>
                <button class="btn btn-primary" id="backup-btn">وەرگرتنی باکەپ</button>
                <div class="form-group">
                    <label for="restore-file">هەڵگرتنی فایلێکی باکەپ</label>
                    <input type="file" id="restore-file" accept=".json">
                </div>
                <button class="btn btn-success" id="restore-btn">گەڕاندنەوەی باکەپ</button>
            </div>

            <div class="tab-content" id="expenses-tab">
                <h3>بەڕێوەبردنی سەرفەکان</h3>
                <button class="btn btn-primary" id="add-expense-btn">زیادکردنی سەرف</button>
                
                <table>
                    <thead>
                        <tr>
                            <th>بڕ</th>
                            <th>هۆکار</th>
                            <th>کات</th>
                            <th>کردارەکان</th>
                        </tr>
                    </thead>
                    <tbody id="expenses-table-body">
                        <!-- لیستی سەرفەکان لێرە دەخرێنەرەوە -->
                    </tbody>
                </table>
            </div>

            <div class="tab-content" id="currency-tab">
                <h3>پارە گۆڕین</h3>
                <div class="form-group">
                    <label for="currency-rate">نرخی دۆلار بە دینار</label>
                    <input type="number" id="currency-rate" step="0.01" min="1" value="1450">
                </div>
                <button class="btn btn-primary" id="save-currency-btn">پاشەکەوتکردن</button>
            </div>
        </section>
    </main>

    <!-- مۆدال بۆ پیشاندانی وەسڵ -->
    <div class="modal" id="receipt-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>وەسڵی فرۆشتن</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div id="receipt-content">
                <!-- ناوەڕۆکی وەسڵ لێرە دەخرێتەوە -->
            </div>
            <div class="modal-actions">
                <button class="btn btn-primary" id="print-receipt-btn">چاپکردن</button>
                <button class="btn btn-danger" id="close-receipt-btn">داخستن</button>
            </div>
        </div>
    </div>

    <!-- مۆدال بۆ زیادکردنی کاڵا -->
    <div class="modal" id="add-product-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>زیادکردنی کاڵای نوێ</h3>
                <button class="close-modal">&times;</button>
            </div>
            <form id="add-product-form">
                <div class="form-group">
                    <label for="product-name">ناوی کاڵا</label>
                    <input type="text" id="product-name" required>
                </div>
                <div class="form-group">
                    <label for="product-barcode">بارکۆد</label>
                    <input type="text" id="product-barcode" required>
                </div>
                <div class="form-group">
                    <label for="product-buy-price">نرخی کڕین</label>
                    <input type="number" id="product-buy-price" step="0.01" min="0" required>
                </div>
                <div class="form-group">
                    <label for="product-sell-price">نرخی فرۆشتن</label>
                    <input type="number" id="product-sell-price" step="0.01" min="0" required>
                </div>
                <div class="form-group">
                    <label for="product-quantity">بڕ</label>
                    <input type="number" id="product-quantity" min="0" required>
                </div>
                <div class="form-group">
                    <label for="product-image">وێنەی کاڵا (URL)</label>
                    <input type="text" id="product-image">
                </div>
                <button type="submit" class="btn btn-success">زیادکردن</button>
            </form>
        </div>
    </div>

    <!-- مۆدال بۆ زیادکردنی سەرف -->
    <div class="modal" id="add-expense-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>زیادکردنی سەرف</h3>
                <button class="close-modal">&times;</button>
            </div>
            <form id="add-expense-form">
                <div class="form-group">
                    <label for="expense-amount">بڕی سەرف</label>
                    <input type="number" id="expense-amount" step="0.01" min="0" required>
                </div>
                <div class="form-group">
                    <label for="expense-reason">هۆکاری سەرف</label>
                    <textarea id="expense-reason" required></textarea>
                </div>
                <button type="submit" class="btn btn-success">زیادکردن</button>
            </form>
        </div>
    </div>

    <!-- مۆدال بۆ زیادکردنی کڕیار -->
    <div class="modal" id="add-customer-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>زیادکردنی کڕیاری نوێ</h3>
                <button class="close-modal">&times;</button>
            </div>
            <form id="add-customer-form">
                <div class="form-group">
                    <label for="customer-name">ناوی کڕیار</label>
                    <input type="text" id="customer-name" required>
                </div>
                <div class="form-group">
                    <label for="customer-phone">ژمارەی مۆبایل</label>
                    <input type="text" id="customer-phone" required>
                </div>
                <div class="form-group">
                    <label for="customer-address">ناونیشان</label>
                    <textarea id="customer-address"></textarea>
                </div>
                <button type="submit" class="btn btn-success">زیادکردن</button>
            </form>
        </div>
    </div>

    <!-- مۆدال بۆ زیادکردنی فرۆشیار -->
    <div class="modal" id="add-supplier-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>زیادکردنی فرۆشیاری نوێ</h3>
                <button class="close-modal">&times;</button>
            </div>
            <form id="add-supplier-form">
                <div class="form-group">
                    <label for="supplier-name">ناوی فرۆشیار</label>
                    <input type="text" id="supplier-name" required>
                </div>
                <div class="form-group">
                    <label for="supplier-phone">ژمارەی مۆبایل</label>
                    <input type="text" id="supplier-phone" required>
                </div>
                <div class="form-group">
                    <label for="supplier-address">ناونیشان</label>
                    <textarea id="supplier-address"></textarea>
                </div>
                <button type="submit" class="btn btn-success">زیادکردن</button>
            </form>
        </div>
    </div>

    <footer>
        <div class="container">
            <p>سیستەمی فرۆشگا &copy; 2023</p>
        </div>
    </footer>

    <script>
        // زانیارییە بنەڕەتییەکان
        const SYSTEM_PASSWORD = 'farzad1234';
        let currentTheme = 'light';
        let isLoggedIn = false;
        let products = JSON.parse(localStorage.getItem('products')) || [];
        let customers = JSON.parse(localStorage.getItem('customers')) || [];
        let suppliers = JSON.parse(localStorage.getItem('suppliers')) || [];
        let sales = JSON.parse(localStorage.getItem('sales')) || [];
        let purchases = JSON.parse(localStorage.getItem('purchases')) || [];
        let expenses = JSON.parse(localStorage.getItem('expenses')) || [];
        let cart = [];
        let currencyRate = parseFloat(localStorage.getItem('currencyRate')) || 1450;
        let currentCustomer = null;
        let currentSupplier = null;
        let scanner = null;

        // DOM Elements
        const themeToggle = document.getElementById('theme-toggle');
        const loginBtn = document.getElementById('login-btn');
        const passwordInput = document.getElementById('password-input');
        const sections = document.querySelectorAll('.section');
        const navLinks = document.querySelectorAll('nav a');

        // چالاککردنی گۆڕینی ڕەنگ
        themeToggle.addEventListener('click', toggleTheme);

        // چالاککردنی سیستمەکە
        loginBtn.addEventListener('click', login);

        // چالاککردنی لیستەی گەشەکردن
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                if (!isLoggedIn) {
                    alert('تکایە یەکەم چوونەژوورەوە!');
                    return;
                }
                const sectionId = link.getAttribute('data-section') + '-section';
                showSection(sectionId);
                
                // بارکردنی داتای پێویست بۆ هەر بەشێک
                if (sectionId === 'dashboard-section') {
                    loadDashboardData();
                } else if (sectionId === 'products-section') {
                    loadProducts();
                } else if (sectionId === 'sales-section') {
                    loadSalesSection();
                } else if (sectionId === 'purchases-section') {
                    loadPurchasesSection();
                } else if (sectionId === 'customers-section') {
                    loadCustomers();
                } else if (sectionId === 'warehouse-section') {
                    loadWarehouse();
                } else if (sectionId === 'settings-section') {
                    loadSettings();
                }
            });
        });

        // فەنکشنی چوونەژوورەوە
        function login() {
            if (passwordInput.value === SYSTEM_PASSWORD) {
                isLoggedIn = true;
                passwordInput.value = '';
                alert('بە سەرکەوتوویی چوویتەژوورەوە!');
                showSection('dashboard-section');
                loadDashboardData();
            } else {
                alert('پاسۆرد هەڵەە!');
            }
        }

        // فەنکشنی گۆڕینی ڕەنگ
        function toggleTheme() {
            if (currentTheme === 'light') {
                document.documentElement.setAttribute('data-theme', 'dark');
                currentTheme = 'dark';
                themeToggle.textContent = '☀️';
            } else {
                document.documentElement.removeAttribute('data-theme');
                currentTheme = 'light';
                themeToggle.textContent = '🌙';
            }
            localStorage.setItem('theme', currentTheme);
        }

        // فەنکشنی پیشاندانی بەش
        function showSection(sectionId) {
            sections.forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById(sectionId).classList.remove('hidden');
        }

        // فەنکشنی بارکردنی داتاکانی داشبۆرد
        function loadDashboardData() {
            const totalSales = sales.reduce((total, sale) => total + sale.total, 0);
            const totalPurchases = purchases.reduce((total, purchase) => total + (purchase.price * purchase.quantity), 0);
            const totalExpenses = expenses.reduce((total, expense) => total + expense.amount, 0);
            const totalBalance = totalSales - totalPurchases - totalExpenses;

            document.getElementById('total-sales').textContent = totalSales.toLocaleString() + ' دینار';
            document.getElementById('total-purchases').textContent = totalPurchases.toLocaleString() + ' دینار';
            document.getElementById('total-expenses').textContent = totalExpenses.toLocaleString() + ' دینار';
            document.getElementById('total-balance').textContent = totalBalance.toLocaleString() + ' دینار';
        }

        // فەنکشنی بارکردنی کاڵاکان
        function loadProducts() {
            const productsGrid = document.getElementById('products-grid');
            productsGrid.innerHTML = '';
            
            if (products.length === 0) {
                productsGrid.innerHTML = '<p>هیچ کاڵایەک بوونی نییە.</p>';
                return;
            }
            
            products.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                productCard.innerHTML = `
                    <img src="${product.image || 'https://via.placeholder.com/250x150?text=No+Image'}" alt="${product.name}" class="product-image">
                    <div class="product-info">
                        <h3 class="product-name">${product.name}</h3>
                        <div class="product-price">${product.sellPrice.toLocaleString()} دینار</div>
                        <div class="product-actions">
                            <button class="btn btn-primary" onclick="addToCart(${product.id})">زیادکردن بۆ سەبەتە</button>
                        </div>
                    </div>
                `;
                productsGrid.appendChild(productCard);
            });
            
            // چالاککردنی گەڕان و پێشنیار
            setupSearch('product-search', 'product-suggestions', products, 'name', (product) => {
                document.getElementById('products-grid').innerHTML = '';
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                productCard.innerHTML = `
                    <img src="${product.image || 'https://via.placeholder.com/250x150?text=No+Image'}" alt="${product.name}" class="product-image">
                    <div class="product-info">
                        <h3 class="product-name">${product.name}</h3>
                        <div class="product-price">${product.sellPrice.toLocaleString()} دینار</div>
                        <div class="product-actions">
                            <button class="btn btn-primary" onclick="addToCart(${product.id})">زیادکردن بۆ سەبەتە</button>
                        </div>
                    </div>
                `;
                document.getElementById('products-grid').appendChild(productCard);
            });
        }

        // فەنکشنی بارکردنی بەشی فرۆشتن
        function loadSalesSection() {
            loadSalesHistory();
            
            // چالاککردنی گەڕانی کڕیار
            setupSearch('customer-search', 'customer-suggestions', customers, 'name', (customer) => {
                currentCustomer = customer;
                document.getElementById('customer-search').value = customer.name;
            });
            
            // چالاککردنی دوگمەکانی پارەدان
            document.getElementById('cash-payment').addEventListener('click', () => processPayment('cash'));
            document.getElementById('credit-payment').addEventListener('click', () => processPayment('credit'));
            
            updateCart();
        }

        // فەنکشنی بارکردنی مێژووی فرۆشتن
        function loadSalesHistory() {
            const salesHistoryBody = document.getElementById('sales-history-body');
            salesHistoryBody.innerHTML = '';
            
            if (sales.length === 0) {
                salesHistoryBody.innerHTML = '<tr><td colspan="6">هیچ فرۆشتنێکی تۆمارنەکراوە.</td></tr>';
                return;
            }
            
            sales.forEach(sale => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${sale.id}</td>
                    <td>${sale.customer ? sale.customer.name : 'نەزانراو'}</td>
                    <td>${sale.total.toLocaleString()} دینار</td>
                    <td>${sale.paymentType === 'cash' ? 'نەقدی' : 'قەرز'}</td>
                    <td>${new Date(sale.date).toLocaleString('ku')}</td>
                    <td>
                        <button class="btn btn-primary" onclick="showReceipt(${sale.id})">بینینی وەسڵ</button>
                        <button class="btn btn-danger" onclick="deleteSale(${sale.id})">سڕینەوە</button>
                    </td>
                `;
                salesHistoryBody.appendChild(row);
            });
        }

        // فەنکشنی بارکردنی بەشی کڕین
        function loadPurchasesSection() {
            const purchaseProducts = document.getElementById('purchase-products');
            purchaseProducts.innerHTML = '';
            
            if (products.length === 0) {
                purchaseProducts.innerHTML = '<p>هیچ کاڵایەک بوونی نییە.</p>';
                return;
            }
            
            products.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                productCard.innerHTML = `
                    <img src="${product.image || 'https://via.placeholder.com/250x150?text=No+Image'}" alt="${product.name}" class="product-image">
                    <div class="product-info">
                        <h3 class="product-name">${product.name}</h3>
                        <div class="product-price">نرخی کڕین: ${product.buyPrice.toLocaleString()} دینار</div>
                        <div class="product-actions">
                            <button class="btn btn-primary" onclick="purchaseProduct(${product.id})">کڕین</button>
                        </div>
                    </div>
                `;
                purchaseProducts.appendChild(productCard);
            });
            
            // چالاککردنی گەڕانی فرۆشیار
            setupSearch('supplier-search', 'supplier-suggestions', suppliers, 'name', (supplier) => {
                currentSupplier = supplier;
                document.getElementById('supplier-search').value = supplier.name;
            });
            
            // چالاککردنی گەڕانی کاڵا
            setupSearch('purchase-search', 'purchase-suggestions', products, 'name', (product) => {
                document.getElementById('purchase-products').innerHTML = '';
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                productCard.innerHTML = `
                    <img src="${product.image || 'https://via.placeholder.com/250x150?text=No+Image'}" alt="${product.name}" class="product-image">
                    <div class="product-info">
                        <h3 class="product-name">${product.name}</h3>
                        <div class="product-price">نرخی کڕین: ${product.buyPrice.toLocaleString()} دینار</div>
                        <div class="product-actions">
                            <button class="btn btn-primary" onclick="purchaseProduct(${product.id})">کڕین</button>
                        </div>
                    </div>
                `;
                document.getElementById('purchase-products').appendChild(productCard);
            });
            
            loadPurchaseHistory();
        }

        // فەنکشنی بارکردنی مێژووی کڕین
        function loadPurchaseHistory() {
            const purchaseHistoryBody = document.getElementById('purchase-history-body');
            purchaseHistoryBody.innerHTML = '';
            
            if (purchases.length === 0) {
                purchaseHistoryBody.innerHTML = '<tr><td colspan="7">هیچ کڕینێکی تۆمارنەکراوە.</td></tr>';
                return;
            }
            
            purchases.forEach(purchase => {
                const product = products.find(p => p.id === purchase.productId);
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${purchase.id}</td>
                    <td>${product ? product.name : 'نەزانراو'}</td>
                    <td>${purchase.supplier ? purchase.supplier.name : 'نەزانراو'}</td>
                    <td>${purchase.quantity}</td>
                    <td>${purchase.price.toLocaleString()} دینار</td>
                    <td>${new Date(purchase.date).toLocaleString('ku')}</td>
                    <td>
                        <button class="btn btn-danger" onclick="deletePurchase(${purchase.id})">سڕینەوە</button>
                    </td>
                `;
                purchaseHistoryBody.appendChild(row);
            });
        }

        // فەنکشنی بارکردنی کڕیارەکان
        function loadCustomers() {
            const customersTableBody = document.getElementById('customers-table-body');
            customersTableBody.innerHTML = '';
            
            if (customers.length === 0) {
                customersTableBody.innerHTML = '<tr><td colspan="5">هیچ کڕیارێکی تۆمارنەکراوە.</td></tr>';
                return;
            }
            
            customers.forEach(customer => {
                const totalDebt = sales
                    .filter(sale => sale.customer && sale.customer.id === customer.id && sale.paymentType === 'credit')
                    .reduce((total, sale) => total + sale.total, 0);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${customer.name}</td>
                    <td>${customer.phone}</td>
                    <td>${customer.address || 'نییە'}</td>
                    <td>${totalDebt.toLocaleString()} دینار</td>
                    <td>
                        <button class="btn btn-primary" onclick="showCustomerDetails(${customer.id})">بینینی وەسڵ</button>
                        <button class="btn btn-danger" onclick="deleteCustomer(${customer.id})">سڕینەوە</button>
                    </td>
                `;
                customersTableBody.appendChild(row);
            });
            
            // چالاککردنی گەڕان
            setupSearch('customer-list-search', 'customer-list-suggestions', customers, 'name', (customer) => {
                document.getElementById('customers-table-body').innerHTML = '';
                const totalDebt = sales
                    .filter(sale => sale.customer && sale.customer.id === customer.id && sale.paymentType === 'credit')
                    .reduce((total, sale) => total + sale.total, 0);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${customer.name}</td>
                    <td>${customer.phone}</td>
                    <td>${customer.address || 'نییە'}</td>
                    <td>${totalDebt.toLocaleString()} دینار</td>
                    <td>
                        <button class="btn btn-primary" onclick="showCustomerDetails(${customer.id})">بینینی وەسڵ</button>
                        <button class="btn btn-danger" onclick="deleteCustomer(${customer.id})">سڕینەوە</button>
                    </td>
                `;
                document.getElementById('customers-table-body').appendChild(row);
            });
            
            // چالاککردنی زیادکردنی کڕیاری نوێ
            document.getElementById('add-customer-btn').addEventListener('click', () => {
                document.getElementById('add-customer-modal').style.display = 'flex';
            });
        }

        // فەنکشنی بارکردنی کۆگا
        function loadWarehouse() {
            const warehouseTableBody = document.getElementById('warehouse-table-body');
            warehouseTableBody.innerHTML = '';
            
            if (products.length === 0) {
                warehouseTableBody.innerHTML = '<tr><td colspan="6">هیچ کاڵایەک بوونی نییە.</td></tr>';
                return;
            }
            
            products.forEach(product => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${product.name}</td>
                    <td>${product.barcode}</td>
                    <td>${product.buyPrice.toLocaleString()} دینار</td>
                    <td>${product.sellPrice.toLocaleString()} دینار</td>
                    <td>${product.quantity}</td>
                    <td>
                        <button class="btn btn-primary" onclick="editProduct(${product.id})">دەستکاری</button>
                        <button class="btn btn-danger" onclick="deleteProduct(${product.id})">سڕینەوە</button>
                    </td>
                `;
                warehouseTableBody.appendChild(row);
            });
            
            // چالاککردنی گەڕان
            setupSearch('warehouse-search', 'warehouse-suggestions', products, 'name', (product) => {
                document.getElementById('warehouse-table-body').innerHTML = '';
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${product.name}</td>
                    <td>${product.barcode}</td>
                    <td>${product.buyPrice.toLocaleString()} دینار</td>
                    <td>${product.sellPrice.toLocaleString()} دینار</td>
                    <td>${product.quantity}</td>
                    <td>
                        <button class="btn btn-primary" onclick="editProduct(${product.id})">دەستکاری</button>
                        <button class="btn btn-danger" onclick="deleteProduct(${product.id})">سڕینەوە</button>
                    </td>
                `;
                document.getElementById('warehouse-table-body').appendChild(row);
            });
            
            // چالاککردنی زیادکردنی کاڵای نوێ
            document.getElementById('add-product-btn').addEventListener('click', () => {
                document.getElementById('add-product-modal').style.display = 'flex';
            });
        }

        // فەنکشنی بارکردنی ڕێکخستنەکان
        function loadSettings() {
            document.getElementById('currency-rate').value = currencyRate;
            
            // چالاککردنی تابەکان
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabName = tab.getAttribute('data-tab');
                    
                    // دەستکاریکردنی چالاکی تابەکان
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // نیشاندانی ناوەڕۆکی تابی هەڵبژێردراو
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(`${tabName}-tab`).classList.add('active');
                    
                    // بارکردنی داتای پێویست
                    if (tabName === 'expenses') {
                        loadExpenses();
                    }
                });
            });
            
            // چالاککردنی زیادکردنی سەرف
            document.getElementById('add-expense-btn').addEventListener('click', () => {
                document.getElementById('add-expense-modal').style.display = 'flex';
            });
            
            // چالاککردنی پارە گۆڕین
            document.getElementById('save-currency-btn').addEventListener('click', () => {
                currencyRate = parseFloat(document.getElementById('currency-rate').value);
                localStorage.setItem('currencyRate', currencyRate.toString());
                alert('نرخی پارە گۆڕین پاشەکەوتکرا!');
            });
        }

        // فەنکشنی بارکردنی سەرفەکان
        function loadExpenses() {
            const expensesTableBody = document.getElementById('expenses-table-body');
            expensesTableBody.innerHTML = '';
            
            if (expenses.length === 0) {
                expensesTableBody.innerHTML = '<tr><td colspan="4">هیچ سەرفێکی تۆمارنەکراوە.</td></tr>';
                return;
            }
            
            expenses.forEach(expense => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${expense.amount.toLocaleString()} دینار</td>
                    <td>${expense.reason}</td>
                    <td>${new Date(expense.date).toLocaleString('ku')}</td>
                    <td>
                        <button class="btn btn-danger" onclick="deleteExpense(${expense.id})">سڕینەوە</button>
                    </td>
                `;
                expensesTableBody.appendChild(row);
            });
        }

        // فەنکشنی ڕێکخستنی گەڕان و پێشنیار
        function setupSearch(inputId, suggestionsId, data, property, callback) {
            const searchInput = document.getElementById(inputId);
            const suggestions = document.getElementById(suggestionsId);
            
            searchInput.addEventListener('input', () => {
                const value = searchInput.value.toLowerCase();
                suggestions.innerHTML = '';
                suggestions.classList.add('hidden');
                
                if (value.length < 2) return;
                
                const filtered = data.filter(item => 
                    item[property].toLowerCase().includes(value)
                );
                
                if (filtered.length > 0) {
                    suggestions.classList.remove('hidden');
                    filtered.forEach(item => {
                        const div = document.createElement('div');
                        div.className = 'suggestion-item';
                        div.textContent = item[property];
                        div.addEventListener('click', () => {
                            searchInput.value = item[property];
                            suggestions.classList.add('hidden');
                            callback(item);
                        });
                        suggestions.appendChild(div);
                    });
                }
            });
            
            document.addEventListener('click', (e) => {
                if (!searchInput.contains(e.target) && !suggestions.contains(e.target)) {
                    suggestions.classList.add('hidden');
                }
            });
        }

        // فەنکشنی زیادکردنی کاڵا بۆ سەبەتە
        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            const existingItem = cart.find(item => item.product.id === productId);
            
            if (existingItem) {
                if (existingItem.quantity < product.quantity) {
                    existingItem.quantity++;
                } else {
                    alert('بڕی ئەم کاڵایە لە کۆگادا نییە!');
                }
            } else {
                if (product.quantity > 0) {
                    cart.push({
                        product: product,
                        quantity: 1
                    });
                } else {
                    alert('بڕی ئەم کاڵایە لە کۆگادا نییە!');
                }
            }
            
            updateCart();
        }

        // فەنکشنی نوێکردنەوەی سەبەتە
        function updateCart() {
            const cartItems = document.getElementById('cart-items');
            const emptyCartMessage = document.getElementById('empty-cart-message');
            const cartTotalAmount = document.getElementById('cart-total-amount');
            
            if (cart.length === 0) {
                emptyCartMessage.classList.remove('hidden');
                cartTotalAmount.textContent = '0 دینار';
                return;
            }
            
            emptyCartMessage.classList.add('hidden');
            cartItems.innerHTML = '';
            
            let total = 0;
            
            cart.forEach(item => {
                const itemTotal = item.product.sellPrice * item.quantity;
                total += itemTotal;
                
                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item';
                cartItem.innerHTML = `
                    <div class="cart-item-info">
                        <h4>${item.product.name}</h4>
                        <p>نرخ: ${item.product.sellPrice.toLocaleString()} دینار</p>
                        <p>کۆی: ${itemTotal.toLocaleString()} دینار</p>
                    </div>
                    <div class="cart-item-actions">
                        <div class="quantity-control">
                            <button onclick="decreaseQuantity(${item.product.id})">-</button>
                            <input type="number" value="${item.quantity}" min="1" max="${item.product.quantity}" onchange="changeQuantity(${item.product.id}, this.value)">
                            <button onclick="increaseQuantity(${item.product.id})">+</button>
                        </div>
                        <button class="btn btn-danger" onclick="removeFromCart(${item.product.id})">سڕینەوە</button>
                    </div>
                `;
                cartItems.appendChild(cartItem);
            });
            
            cartTotalAmount.textContent = total.toLocaleString() + ' دینار';
        }

        // فەنکشنی کەمکردنەوەی بڕی کاڵا لە سەبەتە
        function decreaseQuantity(productId) {
            const item = cart.find(item => item.product.id === productId);
            if (item && item.quantity > 1) {
                item.quantity--;
                updateCart();
            }
        }

        // فەنکشنی زیادکردنی بڕی کاڵا لە سەبەتە
        function increaseQuantity(productId) {
            const item = cart.find(item => item.product.id === productId);
            const product = products.find(p => p.id === productId);
            
            if (item && product && item.quantity < product.quantity) {
                item.quantity++;
                updateCart();
            } else {
                alert('بڕی ئەم کاڵایە لە کۆگادا نییە!');
            }
        }

        // فەنکشنی گۆڕینی بڕی کاڵا لە سەبەتە
        function changeQuantity(productId, newQuantity) {
            const item = cart.find(item => item.product.id === productId);
            const product = products.find(p => p.id === productId);
            const quantity = parseInt(newQuantity);
            
            if (item && product && quantity > 0 && quantity <= product.quantity) {
                item.quantity = quantity;
                updateCart();
            } else {
                alert('بڕی ئەم کاڵایە لە کۆگادا نییە!');
                if (item) {
                    item.quantity = 1;
                    updateCart();
                }
            }
        }

        // فەنکشنی سڕینەوەی کاڵا لە سەبەتە
        function removeFromCart(productId) {
            cart = cart.filter(item => item.product.id !== productId);
            updateCart();
        }

        // فەنکشنی پڕۆسەکردنی پارەدان
        function processPayment(paymentType) {
            if (cart.length === 0) {
                alert('سەبەتە بەتاڵە!');
                return;
            }
            
            if (paymentType === 'credit' && !currentCustomer) {
                alert('تکایە یەکەم کڕیار هەڵبژێرە!');
                return;
            }
            
            const sale = {
                id: Date.now(),
                items: [...cart],
                total: cart.reduce((total, item) => total + (item.product.sellPrice * item.quantity), 0),
                paymentType: paymentType,
                customer: currentCustomer,
                date: new Date().toISOString()
            };
            
            // نوێکردنەوەی بڕی کاڵاکان لە کۆگا
            cart.forEach(item => {
                const product = products.find(p => p.id === item.product.id);
                if (product) {
                    product.quantity -= item.quantity;
                }
            });
            
            sales.push(sale);
            saveData();
            
            // پاککردنەوەی سەبەتە
            cart = [];
            updateCart();
            currentCustomer = null;
            document.getElementById('customer-search').value = '';
            
            alert('فرۆشتن بە سەرکەوتوویی تەواوبوو!');
            showReceipt(sale.id);
            loadSalesHistory();
            loadDashboardData();
        }

        // فەنکشنی پیشاندانی وەسڵ
        function showReceipt(saleId) {
            const sale = sales.find(s => s.id === saleId);
            if (!sale) return;
            
            const receiptContent = document.getElementById('receipt-content');
            receiptContent.innerHTML = `
                <h4>ژمارەی وەسڵ: ${sale.id}</h4>
                <p>کات: ${new Date(sale.date).toLocaleString('ku')}</p>
                ${sale.customer ? `<p>کڕیار: ${sale.customer.name}</p>` : ''}
                <p>جۆری پارەدان: ${sale.paymentType === 'cash' ? 'نەقدی' : 'قەرز'}</p>
                <hr>
                <h4>کاڵاکان:</h4>
                <ul>
                    ${sale.items.map(item => `
                        <li>${item.product.name} - ${item.quantity} x ${item.product.sellPrice.toLocaleString()} = ${(item.quantity * item.product.sellPrice).toLocaleString()} دینار</li>
                    `).join('')}
                </ul>
                <hr>
                <h4>کۆی گشتی: ${sale.total.toLocaleString()} دینار</h4>
            `;
            
            document.getElementById('receipt-modal').style.display = 'flex';
        }

        // فەنکشنی سڕینەوەی فرۆشتن
        function deleteSale(saleId) {
            if (confirm('دڵنیایت دەتەوێت ئەم فرۆشتنە بسڕیتەوە؟')) {
                const saleIndex = sales.findIndex(s => s.id === saleId);
                if (saleIndex !== -1) {
                    // گەڕاندنەوەی کاڵاکان بۆ کۆگا
                    sales[saleIndex].items.forEach(item => {
                        const product = products.find(p => p.id === item.product.id);
                        if (product) {
                            product.quantity += item.quantity;
                        }
                    });
                    
                    sales.splice(saleIndex, 1);
                    saveData();
                    loadSalesHistory();
                    loadDashboardData();
                    alert('فرۆشتن سڕدرایەوە!');
                }
            }
        }

        // فەنکشنی کڕینی کاڵا
        function purchaseProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            if (!currentSupplier) {
                alert('تکایە یەکەم فرۆشیار هەڵبژێرە!');
                return;
            }
            
            const quantity = prompt(`چەند بڕی ${product.name} دەکڕیت؟`, '1');
            const qty = parseInt(quantity);
            
            if (isNaN(qty) || qty <= 0) {
                alert('تکایە بڕێکی دروست بنووسە!');
                return;
            }
            
            const purchase = {
                id: Date.now(),
                productId: productId,
                supplier: currentSupplier,
                quantity: qty,
                price: product.buyPrice,
                date: new Date().toISOString()
            };
            
            // زیادکردنی بڕی نوێ بۆ کاڵا لە کۆگا
            product.quantity += qty;
            
            purchases.push(purchase);
            saveData();
            
            alert('کڕین بە سەرکەوتوویی تەواوبوو!');
            loadPurchaseHistory();
            loadDashboardData();
        }

        // فەنکشنی سڕینەوەی کڕین
        function deletePurchase(purchaseId) {
            if (confirm('دڵنیایت دەتەوێت ئەم کڕینە بسڕیتەوە؟')) {
                const purchaseIndex = purchases.findIndex(p => p.id === purchaseId);
                if (purchaseIndex !== -1) {
                    const purchase = purchases[purchaseIndex];
                    const product = products.find(p => p.id === purchase.productId);
                    
                    if (product) {
                        // لابردنی بڕی کڕین لە کۆگا
                        product.quantity -= purchase.quantity;
                        if (product.quantity < 0) product.quantity = 0;
                    }
                    
                    purchases.splice(purchaseIndex, 1);
                    saveData();
                    loadPurchaseHistory();
                    loadDashboardData();
                    alert('کڕین سڕدرایەوە!');
                }
            }
        }

        // فەنکشنی پیشاندانی زانیارییەکانی کڕیار
        function showCustomerDetails(customerId) {
            const customer = customers.find(c => c.id === customerId);
            if (!customer) return;
            
            const customerSales = sales.filter(s => s.customer && s.customer.id === customerId);
            const totalDebt = customerSales
                .filter(s => s.paymentType === 'credit')
                .reduce((total, sale) => total + sale.total, 0);
            
            const receiptContent = document.getElementById('receipt-content');
            receiptContent.innerHTML = `
                <h4>زانیارییەکانی کڕیار</h4>
                <p>ناو: ${customer.name}</p>
                <p>ژمارەی مۆبایل: ${customer.phone}</p>
                <p>ناونیشان: ${customer.address || 'نییە'}</p>
                <p>کۆی قەرز: ${totalDebt.toLocaleString()} دینار</p>
                <hr>
                <h4>مێژووی فرۆشتن:</h4>
                <ul>
                    ${customerSales.map(sale => `
                        <li>${new Date(sale.date).toLocaleString('ku')} - ${sale.total.toLocaleString()} دینار (${sale.paymentType === 'cash' ? 'نەقدی' : 'قەرز'})</li>
                    `).join('')}
                </ul>
            `;
            
            document.getElementById('receipt-modal').style.display = 'flex';
        }

        // فەنکشنی سڕینەوەی کڕیار
        function deleteCustomer(customerId) {
            if (confirm('دڵنیایت دەتەوێت ئەم کڕیارە بسڕیتەوە؟')) {
                const customerIndex = customers.findIndex(c => c.id === customerId);
                if (customerIndex !== -1) {
                    customers.splice(customerIndex, 1);
                    saveData();
                    loadCustomers();
                    alert('کڕیار سڕدرایەوە!');
                }
            }
        }

        // فەنکشنی دەستکاری کاڵا
        function editProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            document.getElementById('product-name').value = product.name;
            document.getElementById('product-barcode').value = product.barcode;
            document.getElementById('product-buy-price').value = product.buyPrice;
            document.getElementById('product-sell-price').value = product.sellPrice;
            document.getElementById('product-quantity').value = product.quantity;
            document.getElementById('product-image').value = product.image || '';
            
            document.getElementById('add-product-modal').style.display = 'flex';
            
            // گۆڕینی فەرمێک بۆ دەستکاری
            const form = document.getElementById('add-product-form');
            form.onsubmit = (e) => {
                e.preventDefault();
                
                product.name = document.getElementById('product-name').value;
                product.barcode = document.getElementById('product-barcode').value;
                product.buyPrice = parseFloat(document.getElementById('product-buy-price').value);
                product.sellPrice = parseFloat(document.getElementById('product-sell-price').value);
                product.quantity = parseInt(document.getElementById('product-quantity').value);
                product.image = document.getElementById('product-image').value;
                
                saveData();
                loadWarehouse();
                document.getElementById('add-product-modal').style.display = 'none';
                alert('کاڵا نوێکرایەوە!');
                
                // گەڕاندنەوەی فەرمەکە بۆ زیادکردن
                form.onsubmit = addProduct;
            };
        }

        // فەنکشنی سڕینەوەی کاڵا
        function deleteProduct(productId) {
            if (confirm('دڵنیایت دەتەوێت ئەم کاڵایە بسڕیتەوە؟')) {
                const productIndex = products.findIndex(p => p.id === productId);
                if (productIndex !== -1) {
                    products.splice(productIndex, 1);
                    saveData();
                    loadWarehouse();
                    alert('کاڵا سڕدرایەوە!');
                }
            }
        }

        // فەنکشنی سڕینەوەی سەرف
        function deleteExpense(expenseId) {
            if (confirm('دڵنیایت دەتەوێت ئەم سەرفە بسڕیتەوە؟')) {
                const expenseIndex = expenses.findIndex(e => e.id === expenseId);
                if (expenseIndex !== -1) {
                    expenses.splice(expenseIndex, 1);
                    saveData();
                    loadExpenses();
                    loadDashboardData();
                    alert('سەرف سڕدرایەوە!');
                }
            }
        }

        // فەنکشنی زیادکردنی کاڵا
        function addProduct(e) {
            e.preventDefault();
            
            const product = {
                id: Date.now(),
                name: document.getElementById('product-name').value,
                barcode: document.getElementById('product-barcode').value,
                buyPrice: parseFloat(document.getElementById('product-buy-price').value),
                sellPrice: parseFloat(document.getElementById('product-sell-price').value),
                quantity: parseInt(document.getElementById('product-quantity').value),
                image: document.getElementById('product-image').value
            };
            
            products.push(product);
            saveData();
            loadWarehouse();
            document.getElementById('add-product-modal').style.display = 'none';
            document.getElementById('add-product-form').reset();
            alert('کاڵا زیادکرا!');
        }

        // فەنکشنی زیادکردنی سەرف
        function addExpense(e) {
            e.preventDefault();
            
            const expense = {
                id: Date.now(),
                amount: parseFloat(document.getElementById('expense-amount').value),
                reason: document.getElementById('expense-reason').value,
                date: new Date().toISOString()
            };
            
            expenses.push(expense);
            saveData();
            loadExpenses();
            loadDashboardData();
            document.getElementById('add-expense-modal').style.display = 'none';
            document.getElementById('add-expense-form').reset();
            alert('سەرف زیادکرا!');
        }

        // فەنکشنی زیادکردنی کڕیار
        function addCustomer(e) {
            e.preventDefault();
            
            const customer = {
                id: Date.now(),
                name: document.getElementById('customer-name').value,
                phone: document.getElementById('customer-phone').value,
                address: document.getElementById('customer-address').value
            };
            
            customers.push(customer);
            saveData();
            loadCustomers();
            document.getElementById('add-customer-modal').style.display = 'none';
            document.getElementById('add-customer-form').reset();
            alert('کڕیار زیادکرا!');
        }

        // فەنکشنی زیادکردنی فرۆشیار
        function addSupplier(e) {
            e.preventDefault();
            
            const supplier = {
                id: Date.now(),
                name: document.getElementById('supplier-name').value,
                phone: document.getElementById('supplier-phone').value,
                address: document.getElementById('supplier-address').value
            };
            
            suppliers.push(supplier);
            saveData();
            document.getElementById('add-supplier-modal').style.display = 'none';
            document.getElementById('add-supplier-form').reset();
            alert('فرۆشیار زیادکرا!');
        }

        // فەنکشنی پاشەکەوتکردنی داتا
        function saveData() {
            localStorage.setItem('products', JSON.stringify(products));
            localStorage.setItem('customers', JSON.stringify(customers));
            localStorage.setItem('suppliers', JSON.stringify(suppliers));
            localStorage.setItem('sales', JSON.stringify(sales));
            localStorage.setItem('purchases', JSON.stringify(purchases));
            localStorage.setItem('expenses', JSON.stringify(expenses));
            localStorage.setItem('currencyRate', currencyRate.toString());
        }

        // فەنکشنی باکەپ
        document.getElementById('backup-btn').addEventListener('click', () => {
            const data = {
                products,
                customers,
                suppliers,
                sales,
                purchases,
                expenses,
                currencyRate
            };
            
            const dataStr = JSON.stringify(data);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `system-backup-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        });

        // فەنکشنی گەڕاندنەوەی باکەپ
        document.getElementById('restore-btn').addEventListener('click', () => {
            const fileInput = document.getElementById('restore-file');
            if (!fileInput.files.length) {
                alert('تکایە یەکەم فایلێک هەڵبگرە!');
                return;
            }
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const backupData = JSON.parse(e.target.result);
                    
                    // داتاکانی پێشوو دەسڕینەوە و داتای نوێ جێگیر دەکرێت
                    products = backupData.products || [];
                    customers = backupData.customers || [];
                    suppliers = backupData.suppliers || [];
                    sales = backupData.sales || [];
                    purchases = backupData.purchases || [];
                    expenses = backupData.expenses || [];
                    currencyRate = backupData.currencyRate || 1450;
                    
                    saveData();
                    alert('باکەپ بە سەرکەوتوویی گەڕێندرایەوە!');
                    location.reload();
                } catch (error) {
                    alert('هەڵە لە خوێندنەوەی فایلەکە: ' + error.message);
                }
            };
            
            reader.readAsText(file);
        });

        // چالاککردنی فەرمەکان
        document.getElementById('add-product-form').addEventListener('submit', addProduct);
        document.getElementById('add-expense-form').addEventListener('submit', addExpense);
        document.getElementById('add-customer-form').addEventListener('submit', addCustomer);
        document.getElementById('add-supplier-form').addEventListener('submit', addSupplier);

        // چالاککردنی داخستنی مۆدالەکان
        document.querySelectorAll('.close-modal').forEach(button => {
            button.addEventListener('click', () => {
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.style.display = 'none';
                });
            });
        });

        // چالاککردنی چاپکردنی وەسڵ
        document.getElementById('print-receipt-btn').addEventListener('click', () => {
            window.print();
        });

        // چالاککردنی داخستنی وەسڵ
        document.getElementById('close-receipt-btn').addEventListener('click', () => {
            document.getElementById('receipt-modal').style.display = 'none';
        });

        // بارکردنی ڕەنگەکە لە localStorage
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
            currentTheme = savedTheme;
            if (currentTheme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
                themeToggle.textContent = '☀️';
            }
        }

        // دەستپێکردنی سیستمەکە
        if (isLoggedIn) {
            showSection('dashboard-section');
            loadDashboardData();
        }
    </script>
</body>
</html>
