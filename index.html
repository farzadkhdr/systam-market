<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام بيع الاحتياجات الإلكترونية</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* CSS Variables */
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #27ae60;
            --danger: #e74c3c;
            --warning: #f39c12;
            --info: #1abc9c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
            --border-radius: 12px;
        }

        /* Reset & Base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Cairo', sans-serif;
        }

        body {
            background: #f5f7fa;
            overflow-x: hidden;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideInLeft {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* Login Page */
        .login-page {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .login-container {
            width: 100%;
            max-width: 400px;
            animation: fadeIn 1s ease;
        }

        .login-box {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .login-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, var(--secondary), var(--info));
            animation: slideInRight 2s ease;
        }

        .logo-section {
            text-align: center;
            margin-bottom: 30px;
        }

        .logo {
            width: 100px;
            height: 100px;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: bounce 2s infinite;
        }

        .logo i {
            font-size: 48px;
            color: white;
        }

        .system-name {
            color: var(--primary);
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 5px;
            background: linear-gradient(90deg, var(--secondary), var(--info));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: pulse 2s infinite;
        }

        .system-subtitle {
            color: var(--dark);
            font-size: 16px;
            opacity: 0.8;
        }

        .form-group {
            margin-bottom: 25px;
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--dark);
            font-weight: 600;
            font-size: 14px;
        }

        .input-with-icon {
            position: relative;
        }

        .input-with-icon i {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--secondary);
            font-size: 18px;
        }

        .input-with-icon input {
            width: 100%;
            padding: 15px 45px 15px 15px;
            border: 2px solid #e0e0e0;
            border-radius: var(--border-radius);
            font-size: 16px;
            transition: var(--transition);
            background: var(--light);
        }

        .input-with-icon input:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
            background: white;
        }

        .password-toggle {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--dark);
            cursor: pointer;
            font-size: 18px;
        }

        .login-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(90deg, var(--secondary), var(--info));
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(52, 152, 219, 0.3);
        }

        .currency-display {
            text-align: center;
            margin-top: 20px;
            padding: 10px;
            background: linear-gradient(90deg, #f8f9fa, #e9ecef);
            border-radius: 10px;
            border: 2px solid var(--success);
            animation: float 3s ease-in-out infinite;
        }

        .currency-text {
            color: var(--success);
            font-weight: 700;
            font-size: 16px;
        }

        /* Main App Layout - Hidden Initially */
        .app-container {
            display: none;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 260px;
            background: linear-gradient(180deg, var(--primary), #34495e);
            color: white;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            transition: var(--transition);
            z-index: 1000;
        }

        .sidebar-header {
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-logo {
            width: 60px;
            height: 60px;
            background: linear-gradient(45deg, var(--secondary), var(--info));
            border-radius: 50%;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sidebar-logo i {
            font-size: 28px;
            color: white;
        }

        .sidebar-title {
            font-size: 18px;
            font-weight: 700;
            background: linear-gradient(90deg, var(--secondary), var(--info));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .sidebar-menu {
            padding: 20px 0;
        }

        .menu-item {
            padding: 15px 25px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: var(--transition);
            border-right: 3px solid transparent;
        }

        .menu-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-right-color: var(--secondary);
        }

        .menu-item.active {
            background: rgba(52, 152, 219, 0.2);
            border-right-color: var(--secondary);
        }

        .menu-item i {
            font-size: 20px;
            width: 24px;
            text-align: center;
        }

        .menu-item span {
            font-size: 16px;
            font-weight: 500;
        }

        .submenu {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            background: rgba(0, 0, 0, 0.2);
        }

        .submenu.active {
            max-height: 300px;
        }

        .submenu-item {
            padding: 12px 25px 12px 60px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 14px;
        }

        .submenu-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        /* Main Content */
        .main-content {
            margin-right: 260px;
            padding: 20px;
            transition: var(--transition);
        }

        /* Header */
        .header {
            background: white;
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            animation: fadeIn 0.5s ease;
        }

        .header-left h1 {
            color: var(--primary);
            font-size: 24px;
            margin-bottom: 5px;
        }

        .header-left p {
            color: #666;
            font-size: 14px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(45deg, var(--secondary), var(--info));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .logout-btn {
            background: var(--danger);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: var(--border-radius);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: var(--transition);
        }

        .logout-btn:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        /* Dashboard */
        .dashboard {
            animation: fadeIn 0.5s ease;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            animation: fadeIn 0.5s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--secondary), var(--info));
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            font-size: 24px;
            color: white;
        }

        .stat-icon.sales { background: linear-gradient(45deg, var(--success), #2ecc71); }
        .stat-icon.purchase { background: linear-gradient(45deg, var(--warning), #f1c40f); }
        .stat-icon.inventory { background: linear-gradient(45deg, var(--info), #16a085); }
        .stat-icon.debt { background: linear-gradient(45deg, var(--danger), #e67e22); }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .stat-change {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
            font-weight: 500;
        }

        .stat-change.positive { color: var(--success); }
        .stat-change.negative { color: var(--danger); }

        /* Charts Section */
        .charts-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: white;
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            animation: fadeIn 0.5s ease;
        }

        .chart-card h3 {
            color: var(--primary);
            margin-bottom: 20px;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Recent Activity */
        .recent-activity {
            background: white;
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            animation: fadeIn 0.5s ease;
        }

        .recent-activity h3 {
            color: var(--primary);
            margin-bottom: 20px;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .activity-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: var(--light);
            border-radius: 10px;
            transition: var(--transition);
        }

        .activity-item:hover {
            background: #e0e0e0;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
        }

        .activity-icon.sale { background: var(--success); }
        .activity-icon.purchase { background: var(--warning); }
        .activity-icon.debt { background: var(--danger); }

        .activity-details {
            flex: 1;
        }

        .activity-title {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 3px;
        }

        .activity-time {
            color: #666;
            font-size: 12px;
        }

        /* Page Content */
        .page-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .page-content.active {
            display: block;
        }

        /* Search Bar */
        .search-bar {
            background: white;
            padding: 15px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            display: flex;
            gap: 10px;
        }

        .search-input {
            flex: 1;
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: var(--border-radius);
            font-size: 16px;
            transition: var(--transition);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        .search-btn {
            background: var(--secondary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: var(--border-radius);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
        }

        .search-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        /* Data Table */
        .data-table {
            background: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            animation: fadeIn 0.5s ease;
        }

        .table-header {
            background: linear-gradient(90deg, var(--primary), #34495e);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-header h3 {
            font-size: 18px;
            font-weight: 600;
        }

        .table-actions {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: var(--transition);
        }

        .action-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: var(--light);
            padding: 15px;
            text-align: right;
            font-weight: 600;
            color: var(--primary);
            border-bottom: 2px solid #e0e0e0;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
            transition: var(--transition);
        }

        tr:hover td {
            background: #f9f9f9;
        }

        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }

        .status-success { background: #d4edda; color: #155724; }
        .status-warning { background: #fff3cd; color: #856404; }
        .status-danger { background: #f8d7da; color: #721c24; }

        /* Forms */
        .form-container {
            background: white;
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            animation: fadeIn 0.5s ease;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--dark);
            font-weight: 600;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: var(--border-radius);
            font-size: 16px;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 30px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
        }

        .btn-primary {
            background: linear-gradient(90deg, var(--secondary), var(--info));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            animation: fadeIn 0.3s ease;
        }

        .modal.active {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 500px;
            animation: slideInRight 0.3s ease;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--light);
        }

        .modal-title {
            color: var(--primary);
            font-size: 20px;
            font-weight: 700;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            color: #666;
            cursor: pointer;
            transition: var(--transition);
        }

        .modal-close:hover {
            color: var(--danger);
            transform: rotate(90deg);
        }

        /* Barcode */
        .barcode-container {
            text-align: center;
            padding: 20px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }

        .barcode {
            font-family: 'Libre Barcode 128', cursive;
            font-size: 40px;
            margin: 20px 0;
        }

        /* Invoice */
        .invoice-preview {
            background: white;
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }

        .invoice-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--light);
        }

        .invoice-logo {
            width: 100px;
            height: 100px;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 40px;
        }

        /* Print Styles */
        @media print {
            .sidebar, .header, .search-bar, .form-actions, .no-print {
                display: none !important;
            }
            
            .main-content {
                margin: 0;
                padding: 0;
            }
            
            .invoice-preview {
                box-shadow: none;
                padding: 0;
            }
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: 70px;
            }
            
            .sidebar-title, .menu-item span, .submenu-item {
                display: none;
            }
            
            .main-content {
                margin-right: 70px;
            }
            
            .menu-item {
                justify-content: center;
                padding: 15px;
            }
            
            .stats-grid, .charts-section {
                grid-template-columns: 1fr;
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
        }

        /* Loading Spinner */
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--secondary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 50px 20px;
            color: #666;
        }

        .empty-state i {
            font-size: 60px;
            color: #ddd;
            margin-bottom: 20px;
        }

        /* Tooltip */
        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltip-text {
            visibility: hidden;
            background: var(--dark);
            color: white;
            text-align: center;
            padding: 5px 10px;
            border-radius: 6px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            right: 50%;
            transform: translateX(50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
            white-space: nowrap;
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: var(--border-radius);
            color: white;
            font-weight: 600;
            z-index: 3000;
            animation: slideInRight 0.3s ease, fadeOut 0.3s ease 2.7s forwards;
            box-shadow: var(--shadow);
        }

        .notification.success { background: var(--success); }
        .notification.error { background: var(--danger); }
        .notification.warning { background: var(--warning); }
        .notification.info { background: var(--info); }

        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div class="login-page" id="loginPage">
        <div class="login-container">
            <div class="login-box">
                <div class="logo-section">
                    <div class="logo">
                        <i class="fas fa-shopping-cart"></i>
                    </div>
                    <h1 class="system-name">نظام بيع الاحتياجات الإلكترونية</h1>
                    <p class="system-subtitle">إدارة المبيعات والمشتريات والمخزون</p>
                </div>

                <div class="currency-display">
                    <span class="currency-text">
                        <i class="fas fa-money-bill-wave"></i>
                        العملة المعتمدة: الدينار العراقي (IQD)
                    </span>
                </div>

                <form class="login-form" id="loginForm">
                    <div class="form-group">
                        <label for="username"><i class="fas fa-user"></i> اسم المستخدم</label>
                        <div class="input-with-icon">
                            <input type="text" id="username" placeholder="أدخل اسم المستخدم" required>
                            <i class="fas fa-user-circle"></i>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="password"><i class="fas fa-lock"></i> كلمة المرور</label>
                        <div class="input-with-icon">
                            <input type="password" id="password" placeholder="أدخل كلمة المرور" required>
                            <i class="fas fa-key"></i>
                            <button type="button" class="password-toggle" onclick="togglePassword()">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>

                    <div class="error-message" id="errorMessage"></div>

                    <button type="submit" class="login-btn">
                        <i class="fas fa-sign-in-alt"></i>
                        تسجيل الدخول
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div class="app-container" id="appContainer">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <i class="fas fa-shopping-cart"></i>
                </div>
                <div class="sidebar-title">نظام البيع الإلكتروني</div>
            </div>

            <div class="sidebar-menu">
                <div class="menu-item active" onclick="showPage('dashboard')">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>لوحة التحكم</span>
                </div>

                <div class="menu-item" onclick="toggleSubmenu('salesMenu')">
                    <i class="fas fa-cash-register"></i>
                    <span>المبيعات</span>
                    <i class="fas fa-chevron-down" style="margin-right: auto;"></i>
                </div>
                <div class="submenu" id="salesMenu">
                    <div class="submenu-item" onclick="showPage('newSale')">بيع جديد</div>
                    <div class="submenu-item" onclick="showPage('salesHistory')">سجل المبيعات</div>
                    <div class="submenu-item" onclick="showPage('invoices')">الفواتير</div>
                </div>

                <div class="menu-item" onclick="toggleSubmenu('purchaseMenu')">
                    <i class="fas fa-shopping-basket"></i>
                    <span>المشتريات</span>
                    <i class="fas fa-chevron-down" style="margin-right: auto;"></i>
                </div>
                <div class="submenu" id="purchaseMenu">
                    <div class="submenu-item" onclick="showPage('newPurchase')">شراء جديد</div>
                    <div class="submenu-item" onclick="showPage('purchaseHistory')">سجل المشتريات</div>
                </div>

                <div class="menu-item" onclick="toggleSubmenu('inventoryMenu')">
                    <i class="fas fa-warehouse"></i>
                    <span>المخزون</span>
                    <i class="fas fa-chevron-down" style="margin-right: auto;"></i>
                </div>
                <div class="submenu" id="inventoryMenu">
                    <div class="submenu-item" onclick="showPage('products')">المنتجات</div>
                    <div class="submenu-item" onclick="showPage('addProduct')">إضافة منتج</div>
                    <div class="submenu-item" onclick="showPage('barcode')">باركود المنتجات</div>
                    <div class="submenu-item" onclick="showPage('categories')">الأصناف</div>
                </div>

                <div class="menu-item" onclick="toggleSubmenu('peopleMenu')">
                    <i class="fas fa-users"></i>
                    <span>العملاء والموردين</span>
                    <i class="fas fa-chevron-down" style="margin-right: auto;"></i>
                </div>
                <div class="submenu" id="peopleMenu">
                    <div class="submenu-item" onclick="showPage('customers')">العملاء</div>
                    <div class="submenu-item" onclick="showPage('suppliers')">الموردين</div>
                    <div class="submenu-item" onclick="showPage('addCustomer')">إضافة عميل</div>
                    <div class="submenu-item" onclick="showPage('addSupplier')">إضافة مورد</div>
                </div>

                <div class="menu-item" onclick="toggleSubmenu('financeMenu')">
                    <i class="fas fa-money-bill-wave"></i>
                    <span>الماليات</span>
                    <i class="fas fa-chevron-down" style="margin-right: auto;"></i>
                </div>
                <div class="submenu" id="financeMenu">
                    <div class="submenu-item" onclick="showPage('expenses')">المصروفات</div>
                    <div class="submenu-item" onclick="showPage('payments')">المدفوعات</div>
                    <div class="submenu-item" onclick="showPage('debt')">الدين</div>
                    <div class="submenu-item" onclick="showPage('reports')">التقارير</div>
                </div>

                <div class="menu-item" onclick="showPage('settings')">
                    <i class="fas fa-cog"></i>
                    <span>الإعدادات</span>
                </div>

                <div class="menu-item" onclick="showPage('users')">
                    <i class="fas fa-user-shield"></i>
                    <span>المستخدمين</span>
                </div>

                <div class="menu-item" onclick="showPage('backup')">
                    <i class="fas fa-database"></i>
                    <span>النسخ الاحتياطي</span>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <div class="header">
                <div class="header-left">
                    <h1 id="pageTitle">لوحة التحكم</h1>
                    <p id="pageDescription">نظام إدارة المبيعات والمشتريات والمخزون</p>
                </div>
                <div class="header-right">
                    <div class="user-info">
                        <div class="user-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div>
                            <div id="userName">المسؤول</div>
                            <div style="font-size: 12px; color: #666;" id="userRole">مدير النظام</div>
                        </div>
                    </div>
                    <button class="logout-btn" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i>
                        تسجيل الخروج
                    </button>
                </div>
            </div>

            <!-- Pages Content -->
            <div id="pagesContainer">
                <!-- Dashboard -->
                <div class="page-content active" id="dashboard">
                    <div class="dashboard">
                        <!-- Statistics Grid -->
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-icon sales">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <div class="stat-value" id="monthlySales">0 د.ع</div>
                                <div class="stat-label">إجمالي المبيعات الشهرية</div>
                                <div class="stat-change positive">
                                    <i class="fas fa-arrow-up"></i>
                                    <span id="salesChange">0%</span>
                                </div>
                            </div>

                            <div class="stat-card">
                                <div class="stat-icon purchase">
                                    <i class="fas fa-shopping-cart"></i>
                                </div>
                                <div class="stat-value" id="monthlyPurchases">0 د.ع</div>
                                <div class="stat-label">إجمالي المشتريات الشهرية</div>
                                <div class="stat-change negative">
                                    <i class="fas fa-arrow-down"></i>
                                    <span id="purchaseChange">0%</span>
                                </div>
                            </div>

                            <div class="stat-card">
                                <div class="stat-icon inventory">
                                    <i class="fas fa-boxes"></i>
                                </div>
                                <div class="stat-value" id="inventoryValue">0 د.ع</div>
                                <div class="stat-label">قيمة المخزون</div>
                                <div class="stat-label" id="inventoryCount">0 منتج</div>
                            </div>

                            <div class="stat-card">
                                <div class="stat-icon debt">
                                    <i class="fas fa-hand-holding-usd"></i>
                                </div>
                                <div class="stat-value" id="totalDebt">0 د.ع</div>
                                <div class="stat-label">إجمالي الديون</div>
                                <div class="stat-label" id="debtCount">0 عميل</div>
                            </div>
                        </div>

                        <!-- Weekly Stats -->
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-value" id="weeklySales">0 د.ع</div>
                                <div class="stat-label">مبيعات الأسبوع</div>
                                <div class="stat-change positive">
                                    <i class="fas fa-arrow-up"></i>
                                    <span id="weeklySalesChange">0%</span>
                                </div>
                            </div>

                            <div class="stat-card">
                                <div class="stat-value" id="weeklyPurchases">0 د.ع</div>
                                <div class="stat-label">مشتريات الأسبوع</div>
                                <div class="stat-change negative">
                                    <i class="fas fa-arrow-down"></i>
                                    <span id="weeklyPurchaseChange">0%</span>
                                </div>
                            </div>

                            <div class="stat-card">
                                <div class="stat-value" id="dailySales">0 د.ع</div>
                                <div class="stat-label">مبيعات اليوم</div>
                                <div class="stat-change positive">
                                    <i class="fas fa-arrow-up"></i>
                                    <span id="dailySalesChange">0%</span>
                                </div>
                            </div>

                            <div class="stat-card">
                                <div class="stat-value" id="dailyPurchases">0 د.ع</div>
                                <div class="stat-label">مشتريات اليوم</div>
                                <div class="stat-change negative">
                                    <i class="fas fa-arrow-down"></i>
                                    <span id="dailyPurchaseChange">0%</span>
                                </div>
                            </div>
                        </div>

                        <!-- Charts -->
                        <div class="charts-section">
                            <div class="chart-card">
                                <h3><i class="fas fa-chart-bar"></i> إحصائيات المبيعات</h3>
                                <canvas id="salesChart"></canvas>
                            </div>
                            <div class="chart-card">
                                <h3><i class="fas fa-chart-pie"></i> توزيع المنتجات</h3>
                                <canvas id="inventoryChart"></canvas>
                            </div>
                        </div>

                        <!-- Recent Activity -->
                        <div class="recent-activity">
                            <h3><i class="fas fa-history"></i> النشاطات الأخيرة</h3>
                            <div class="activity-list" id="activityList">
                                <!-- Activity items will be added here by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- New Sale Page -->
                <div class="page-content" id="newSale">
                    <div class="search-bar">
                        <input type="text" class="search-input" placeholder="بحث عن منتج بالاسم أو الباركود..." id="productSearch">
                        <button class="search-btn" onclick="searchProduct()">
                            <i class="fas fa-search"></i> بحث
                        </button>
                        <button class="btn btn-primary" onclick="showCustomerModal()">
                            <i class="fas fa-user-plus"></i> إضافة عميل
                        </button>
                    </div>

                    <div class="form-container">
                        <div class="form-row">
                            <div class="form-group">
                                <label>اسم العميل</label>
                                <select class="form-control" id="customerSelect">
                                    <option value="">اختر عميل</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>طريقة الدفع</label>
                                <select class="form-control" id="paymentMethod">
                                    <option value="cash">نقدي</option>
                                    <option value="credit">آجل</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>تاريخ الفاتورة</label>
                                <input type="datetime-local" class="form-control" id="invoiceDate" value="">
                            </div>
                        </div>

                        <div class="data-table">
                            <div class="table-header">
                                <h3>سلة المشتريات</h3>
                                <div class="table-actions">
                                    <button class="action-btn" onclick="clearCart()">
                                        <i class="fas fa-trash"></i> تفريغ السلة
                                    </button>
                                    <button class="action-btn" onclick="scanBarcode()">
                                        <i class="fas fa-barcode"></i> مسح باركود
                                    </button>
                                </div>
                            </div>
                            <table>
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>المنتج</th>
                                        <th>الكمية</th>
                                        <th>السعر</th>
                                        <th>الإجمالي</th>
                                        <th>الإجراءات</th>
                                    </tr>
                                </thead>
                                <tbody id="cartTable">
                                    <!-- Cart items will be added here -->
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <td colspan="4" style="text-align: left; font-weight: bold;">الإجمالي:</td>
                                        <td id="cartTotal">0 د.ع</td>
                                        <td></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>

                        <div class="form-actions">
                            <button class="btn btn-secondary" onclick="printInvoice('small')">
                                <i class="fas fa-print"></i> طباعة صغيرة
                            </button>
                            <button class="btn btn-secondary" onclick="printInvoice('a4')">
                                <i class="fas fa-print"></i> طباعة A4
                            </button>
                            <button class="btn btn-success" onclick="completeSale()">
                                <i class="fas fa-check"></i> إتمام البيع
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Products Page -->
                <div class="page-content" id="products">
                    <div class="search-bar">
                        <input type="text" class="search-input" placeholder="بحث عن منتج..." id="productSearchInventory">
                        <button class="search-btn" onclick="searchInventory()">
                            <i class="fas fa-search"></i> بحث
                        </button>
                        <button class="btn btn-primary" onclick="showPage('addProduct')">
                            <i class="fas fa-plus"></i> إضافة منتج
                        </button>
                        <button class="btn btn-warning" onclick="exportProducts()">
                            <i class="fas fa-file-export"></i> تصدير
                        </button>
                    </div>

                    <div class="data-table">
                        <div class="table-header">
                            <h3>قائمة المنتجات</h3>
                            <div class="table-actions">
                                <button class="action-btn" onclick="printBarcodes()">
                                    <i class="fas fa-barcode"></i> طباعة الباركود
                                </button>
                                <button class="action-btn" onclick="importProducts()">
                                    <i class="fas fa-file-import"></i> استيراد
                                </button>
                            </div>
                        </div>
                        <table id="productsTable">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>الصورة</th>
                                    <th>الاسم</th>
                                    <th>الفئة</th>
                                    <th>الكمية</th>
                                    <th>سعر الشراء</th>
                                    <th>سعر البيع</th>
                                    <th>القيمة</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Products will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Add Product Page -->
                <div class="page-content" id="addProduct">
                    <div class="form-container">
                        <h2 style="color: var(--primary); margin-bottom: 30px;">
                            <i class="fas fa-box"></i> إضافة منتج جديد
                        </h2>

                        <div class="form-row">
                            <div class="form-group">
                                <label>اسم المنتج *</label>
                                <input type="text" class="form-control" id="productName" placeholder="أدخل اسم المنتج">
                            </div>
                            <div class="form-group">
                                <label>الفئة *</label>
                                <select class="form-control" id="productCategory">
                                    <option value="">اختر الفئة</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>سعر الشراء (د.ع) *</label>
                                <input type="number" class="form-control" id="purchasePrice" placeholder="سعر الشراء">
                            </div>
                            <div class="form-group">
                                <label>سعر البيع (د.ع) *</label>
                                <input type="number" class="form-control" id="salePrice" placeholder="سعر البيع">
                            </div>
                            <div class="form-group">
                                <label>الكمية *</label>
                                <input type="number" class="form-control" id="quantity" placeholder="الكمية المتاحة">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>لون المنتج</label>
                                <input type="text" class="form-control" id="productColor" placeholder="أدخل اللون" list="colorSuggestions">
                                <datalist id="colorSuggestions">
                                    <option value="أحمر">
                                    <option value="أزرق">
                                    <option value="أخضر">
                                    <option value="أسود">
                                    <option value="أبيض">
                                    <option value="رمادي">
                                    <option value="ذهبي">
                                    <option value="فضي">
                                </datalist>
                            </div>
                            <div class="form-group">
                                <label>باركود</label>
                                <div style="display: flex; gap: 10px;">
                                    <input type="text" class="form-control" id="barcode" placeholder="باركود المنتج">
                                    <button type="button" class="btn btn-secondary" onclick="generateBarcode()">
                                        <i class="fas fa-barcode"></i> توليد
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>صورة المنتج</label>
                            <input type="file" class="form-control" id="productImage" accept="image/*" onchange="previewImage(this)">
                            <div id="imagePreview" style="margin-top: 10px;"></div>
                        </div>

                        <div class="form-group">
                            <label>وصف المنتج</label>
                            <textarea class="form-control" id="productDescription" rows="3" placeholder="وصف المنتج"></textarea>
                        </div>

                        <div class="form-actions">
                            <button class="btn btn-secondary" onclick="showPage('products')">
                                <i class="fas fa-times"></i> إلغاء
                            </button>
                            <button class="btn btn-success" onclick="saveProduct()">
                                <i class="fas fa-save"></i> حفظ المنتج
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Customers Page -->
                <div class="page-content" id="customers">
                    <div class="search-bar">
                        <input type="text" class="search-input" placeholder="بحث عن عميل..." id="customerSearch">
                        <button class="search-btn" onclick="searchCustomer()">
                            <i class="fas fa-search"></i> بحث
                        </button>
                        <button class="btn btn-primary" onclick="showPage('addCustomer')">
                            <i class="fas fa-user-plus"></i> إضافة عميل
                        </button>
                    </div>

                    <div class="data-table">
                        <div class="table-header">
                            <h3>قائمة العملاء</h3>
                            <div class="table-actions">
                                <button class="action-btn" onclick="exportCustomers()">
                                    <i class="fas fa-file-export"></i> تصدير
                                </button>
                            </div>
                        </div>
                        <table id="customersTable">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>الاسم</th>
                                    <th>الهاتف</th>
                                    <th>العنوان</th>
                                    <th>الدين</th>
                                    <th>آخر معاملة</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Customers will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Add Customer Page -->
                <div class="page-content" id="addCustomer">
                    <div class="form-container">
                        <h2 style="color: var(--primary); margin-bottom: 30px;">
                            <i class="fas fa-user-plus"></i> إضافة عميل جديد
                        </h2>

                        <div class="form-row">
                            <div class="form-group">
                                <label>اسم العميل *</label>
                                <input type="text" class="form-control" id="customerName" placeholder="اسم العميل الكامل">
                            </div>
                            <div class="form-group">
                                <label>رقم الهاتف *</label>
                                <input type="tel" class="form-control" id="customerPhone" placeholder="07XX-XXX-XXXX">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>العنوان</label>
                            <input type="text" class="form-control" id="customerAddress" placeholder="عنوان العميل">
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>الدين الحالي (د.ع)</label>
                                <input type="number" class="form-control" id="customerDebt" placeholder="0" value="0">
                            </div>
                            <div class="form-group">
                                <label>هل لديه دين سابق؟</label>
                                <div style="margin-top: 10px;">
                                    <label style="margin-left: 20px;">
                                        <input type="radio" name="hasDebt" value="yes" onclick="toggleDebtInput(true)"> نعم
                                    </label>
                                    <label style="margin-left: 20px;">
                                        <input type="radio" name="hasDebt" value="no" checked onclick="toggleDebtInput(false)"> لا
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button class="btn btn-secondary" onclick="showPage('customers')">
                                <i class="fas fa-times"></i> إلغاء
                            </button>
                            <button class="btn btn-success" onclick="saveCustomer()">
                                <i class="fas fa-save"></i> حفظ العميل
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Settings Page -->
                <div class="page-content" id="settings">
                    <div class="form-container">
                        <h2 style="color: var(--primary); margin-bottom: 30px;">
                            <i class="fas fa-cog"></i> إعدادات النظام
                        </h2>

                        <div class="form-row">
                            <div class="form-group">
                                <label>اسم النظام</label>
                                <input type="text" class="form-control" id="systemName" value="نظام بيع الاحتياجات الإلكترونية">
                            </div>
                            <div class="form-group">
                                <label>لوجو النظام</label>
                                <input type="file" class="form-control" id="systemLogo" accept="image/*">
                                <small style="color: #666;">الحجم الموصى به: 200x200 بكسل</small>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>العملة</label>
                                <select class="form-control" id="systemCurrency">
                                    <option value="IQD" selected>دينار عراقي (د.ع)</option>
                                    <option value="USD">دولار أمريكي ($)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>اللغة</label>
                                <select class="form-control" id="systemLanguage">
                                    <option value="ar" selected>العربية</option>
                                    <option value="en">English</option>
                                </select>
                            </div>
                        </div>

                        <h3 style="color: var(--primary); margin: 30px 0 20px 0;">
                            <i class="fas fa-key"></i> تغيير كلمة المرور
                        </h3>

                        <div class="form-row">
                            <div class="form-group">
                                <label>كلمة المرور الحالية</label>
                                <input type="password" class="form-control" id="currentPassword">
                            </div>
                            <div class="form-group">
                                <label>كلمة المرور الجديدة</label>
                                <input type="password" class="form-control" id="newPassword">
                            </div>
                            <div class="form-group">
                                <label>تأكيد كلمة المرور</label>
                                <input type="password" class="form-control" id="confirmPassword">
                            </div>
                        </div>

                        <div class="form-actions">
                            <button class="btn btn-primary" onclick="saveSettings()">
                                <i class="fas fa-save"></i> حفظ الإعدادات
                            </button>
                            <button class="btn btn-secondary" onclick="resetSettings()">
                                <i class="fas fa-undo"></i> إعادة تعيين
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Users Page -->
                <div class="page-content" id="users">
                    <div class="search-bar">
                        <input type="text" class="search-input" placeholder="بحث عن مستخدم..." id="userSearch">
                        <button class="search-btn" onclick="searchUser()">
                            <i class="fas fa-search"></i> بحث
                        </button>
                        <button class="btn btn-primary" onclick="showAddUserModal()">
                            <i class="fas fa-user-plus"></i> إضافة مستخدم
                        </button>
                    </div>

                    <div class="data-table">
                        <div class="table-header">
                            <h3>إدارة المستخدمين</h3>
                        </div>
                        <table id="usersTable">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>الصورة</th>
                                    <th>اسم المستخدم</th>
                                    <th>الدور</th>
                                    <th>الحالة</th>
                                    <th>آخر نشاط</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Users will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Backup Page -->
                <div class="page-content" id="backup">
                    <div class="form-container">
                        <h2 style="color: var(--primary); margin-bottom: 30px;">
                            <i class="fas fa-database"></i> النسخ الاحتياطي والاستعادة
                        </h2>

                        <div class="form-row">
                            <div class="form-group">
                                <div class="stat-card">
                                    <div class="stat-icon" style="background: linear-gradient(45deg, var(--info), #16a085);">
                                        <i class="fas fa-database"></i>
                                    </div>
                                    <div class="stat-value" id="backupSize">0 MB</div>
                                    <div class="stat-label">حجم البيانات</div>
                                    <button class="btn btn-primary" style="margin-top: 15px;" onclick="createBackup()">
                                        <i class="fas fa-save"></i> إنشاء نسخة احتياطية
                                    </button>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="stat-card">
                                    <div class="stat-icon" style="background: linear-gradient(45deg, var(--success), #27ae60);">
                                        <i class="fas fa-history"></i>
                                    </div>
                                    <div class="stat-value" id="backupCount">0</div>
                                    <div class="stat-label">عدد النسخ</div>
                                    <button class="btn btn-success" style="margin-top: 15px;" onclick="showBackupHistory()">
                                        <i class="fas fa-list"></i> عرض السجل
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <h3 style="color: var(--primary); margin: 20px 0;">
                                <i class="fas fa-upload"></i> استعادة نسخة احتياطية
                            </h3>
                            <input type="file" class="form-control" id="restoreFile" accept=".json,.backup">
                            <button class="btn btn-warning" style="margin-top: 15px;" onclick="restoreBackup()">
                                <i class="fas fa-upload"></i> استعادة البيانات
                            </button>
                            <small style="color: #666; display: block; margin-top: 10px;">
                                تحذير: استعادة البيانات ستحل محل جميع البيانات الحالية
                            </small>
                        </div>

                        <div class="form-group">
                            <h3 style="color: var(--primary); margin: 20px 0;">
                                <i class="fas fa-download"></i> تحميل النسخ الاحتياطية
                            </h3>
                            <div id="backupList">
                                <!-- Backup files will be listed here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- More pages can be added here -->
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal" id="customerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">إضافة عميل جديد</h3>
                <button class="modal-close" onclick="closeModal('customerModal')">&times;</button>
            </div>
            <div id="customerModalContent">
                <!-- Customer form will be loaded here -->
            </div>
        </div>
    </div>

    <div class="modal" id="productModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">تفاصيل المنتج</h3>
                <button class="modal-close" onclick="closeModal('productModal')">&times;</button>
            </div>
            <div id="productModalContent">
                <!-- Product details will be loaded here -->
            </div>
        </div>
    </div>

    <div class="modal" id="invoiceModal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3 class="modal-title">معاينة الفاتورة</h3>
                <button class="modal-close" onclick="closeModal('invoiceModal')">&times;</button>
            </div>
            <div id="invoicePreviewContent">
                <!-- Invoice preview will be loaded here -->
            </div>
            <div class="form-actions" style="margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeModal('invoiceModal')">
                    <i class="fas fa-times"></i> إغلاق
                </button>
                <button class="btn btn-primary" onclick="printCurrentInvoice()">
                    <i class="fas fa-print"></i> طباعة
                </button>
            </div>
        </div>
    </div>

    <div class="modal" id="userModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">إضافة مستخدم جديد</h3>
                <button class="modal-close" onclick="closeModal('userModal')">&times;</button>
            </div>
            <div id="userModalContent">
                <!-- User form will be loaded here -->
            </div>
        </div>
    </div>

    <div class="modal" id="barcodeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">طباعة الباركود</h3>
                <button class="modal-close" onclick="closeModal('barcodeModal')">&times;</button>
            </div>
            <div class="barcode-container" id="barcodeContent">
                <!-- Barcode will be generated here -->
            </div>
            <div class="form-actions" style="margin-top: 20px;">
                <button class="btn btn-primary" onclick="printBarcode()">
                    <i class="fas fa-print"></i> طباعة الباركود
                </button>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer"></div>

    <script>
        // ============================================
        // SYSTEM CONFIGURATION
        // ============================================
        const SYSTEM_CONFIG = {
            name: "نظام بيع الاحتياجات الإلكترونية",
            currency: "دينار عراقي",
            symbol: "د.ع",
            password: "farzad1234",
            language: "ar",
            version: "1.0.0"
        };

        // ============================================
        // DATA STORAGE (Using localStorage)
        // ============================================
        class DataStorage {
            constructor() {
                this.initializeStorage();
            }

            initializeStorage() {
                if (!localStorage.getItem('system_data')) {
                    const initialData = {
                        users: [
                            {
                                id: 1,
                                username: 'admin',
                                password: SYSTEM_CONFIG.password,
                                name: 'المسؤول',
                                role: 'admin',
                                email: 'admin@system.com',
                                phone: '0770XXXXXXX',
                                image: null,
                                permissions: ['all'],
                                lastLogin: new Date().toISOString(),
                                isActive: true
                            }
                        ],
                        products: [
                            {
                                id: 1,
                                name: 'هاتف سامسونج S22',
                                category: 'هواتف',
                                barcode: '123456789012',
                                purchasePrice: 850000,
                                salePrice: 1000000,
                                quantity: 15,
                                color: 'أسود',
                                image: null,
                                description: 'هاتف ذكي بمواصفات عالية',
                                createdAt: new Date().toISOString(),
                                updatedAt: new Date().toISOString()
                            },
                            {
                                id: 2,
                                name: 'لابتوب ديل',
                                category: 'حواسيب',
                                barcode: '987654321098',
                                purchasePrice: 1200000,
                                salePrice: 1500000,
                                quantity: 8,
                                color: 'فضي',
                                image: null,
                                description: 'لابتوب للعمل والألعاب',
                                createdAt: new Date().toISOString(),
                                updatedAt: new Date().toISOString()
                            }
                        ],
                        customers: [
                            {
                                id: 1,
                                name: 'أحمد محمد',
                                phone: '07701234567',
                                address: 'بغداد - المنصور',
                                debt: 250000,
                                totalPurchases: 1500000,
                                lastPurchase: '2024-01-15',
                                createdAt: new Date().toISOString()
                            },
                            {
                                id: 2,
                                name: 'سعاد علي',
                                phone: '07707654321',
                                address: 'أربيل - العاصمة',
                                debt: 0,
                                totalPurchases: 800000,
                                lastPurchase: '2024-01-14',
                                createdAt: new Date().toISOString()
                            }
                        ],
                        suppliers: [],
                        sales: [],
                        purchases: [],
                        expenses: [],
                        payments: [],
                        categories: ['هواتف', 'حواسيب', 'أجهزة كهربائية', 'إكسسوارات'],
                        colors: ['أحمر', 'أزرق', 'أخضر', 'أسود', 'أبيض', 'رمادي', 'ذهبي', 'فضي'],
                        settings: {
                            systemName: SYSTEM_CONFIG.name,
                            currency: SYSTEM_CONFIG.currency,
                            logo: null,
                            taxRate: 0,
                            printType: 'small',
                            backupAuto: true
                        },
                        activities: [
                            {
                                id: 1,
                                type: 'sale',
                                description: 'بيع منتجات إلى أحمد محمد',
                                amount: 150000,
                                user: 'admin',
                                date: new Date().toISOString()
                            },
                            {
                                id: 2,
                                type: 'purchase',
                                description: 'شراء منتجات جديدة',
                                amount: 850000,
                                user: 'admin',
                                date: new Date().toISOString()
                            }
                        ],
                        backups: []
                    };
                    localStorage.setItem('system_data', JSON.stringify(initialData));
                }
            }

            getData() {
                return JSON.parse(localStorage.getItem('system_data')) || {};
            }

            saveData(data) {
                localStorage.setItem('system_data', JSON.stringify(data));
            }

            update(key, value) {
                const data = this.getData();
                data[key] = value;
                this.saveData(data);
            }

            addItem(key, item) {
                const data = this.getData();
                if (!data[key]) data[key] = [];
                item.id = data[key].length > 0 ? Math.max(...data[key].map(i => i.id)) + 1 : 1;
                data[key].push(item);
                this.saveData(data);
                return item;
            }

            updateItem(key, id, updates) {
                const data = this.getData();
                if (data[key]) {
                    const index = data[key].findIndex(item => item.id === id);
                    if (index !== -1) {
                        data[key][index] = { ...data[key][index], ...updates, updatedAt: new Date().toISOString() };
                        this.saveData(data);
                        return true;
                    }
                }
                return false;
            }

            deleteItem(key, id) {
                const data = this.getData();
                if (data[key]) {
                    data[key] = data[key].filter(item => item.id !== id);
                    this.saveData(data);
                    return true;
                }
                return false;
            }
        }

        // ============================================
        // APPLICATION STATE
        // ============================================
        const storage = new DataStorage();
        let currentUser = null;
        let currentCart = [];
        let currentPage = 'dashboard';

        // ============================================
        // UTILITY FUNCTIONS
        // ============================================
        function formatCurrency(amount) {
            return new Intl.NumberFormat('ar-IQ').format(amount) + ' ' + SYSTEM_CONFIG.symbol;
        }

        function showNotification(message, type = 'info') {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'times' : type === 'warning' ? 'exclamation' : 'info'}-circle"></i>
                ${message}
            `;
            container.appendChild(notification);
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        function showLoading() {
            const spinner = document.createElement('div');
            spinner.className = 'spinner';
            spinner.id = 'loadingSpinner';
            document.body.appendChild(spinner);
        }

        function hideLoading() {
            const spinner = document.getElementById('loadingSpinner');
            if (spinner) spinner.remove();
        }

        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // ============================================
        // AUTHENTICATION
        // ============================================
        function togglePassword() {
            const passwordInput = document.getElementById('password');
            const toggleIcon = document.querySelector('.password-toggle i');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleIcon.classList.remove('fa-eye');
                toggleIcon.classList.add('fa-eye-slash');
            } else {
                passwordInput.type = 'password';
                toggleIcon.classList.remove('fa-eye-slash');
                toggleIcon.classList.add('fa-eye');
            }
        }

        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const errorMessage = document.getElementById('errorMessage');

            if (!username || !password) {
                errorMessage.textContent = 'يرجى إدخال اسم المستخدم وكلمة المرور';
                return;
            }

            const data = storage.getData();
            const user = data.users.find(u => u.username === username && u.password === password);

            if (user) {
                currentUser = user;
                
                // Update last login
                storage.updateItem('users', user.id, { lastLogin: new Date().toISOString() });
                
                // Add activity
                storage.addItem('activities', {
                    type: 'login',
                    description: 'تسجيل دخول المستخدم',
                    user: user.name,
                    date: new Date().toISOString()
                });

                // Switch to app
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('appContainer').style.display = 'block';
                
                // Initialize dashboard
                initializeDashboard();
                showNotification('تم تسجيل الدخول بنجاح', 'success');
            } else {
                errorMessage.textContent = 'اسم المستخدم أو كلمة المرور غير صحيحة';
                showNotification('فشل تسجيل الدخول', 'error');
            }
        }

        function logout() {
            if (confirm('هل أنت متأكد من تسجيل الخروج؟')) {
                storage.addItem('activities', {
                    type: 'logout',
                    description: 'تسجيل خروج المستخدم',
                    user: currentUser.name,
                    date: new Date().toISOString()
                });

                currentUser = null;
                currentCart = [];
                
                document.getElementById('appContainer').style.display = 'none';
                document.getElementById('loginPage').style.display = 'flex';
                
                // Reset login form
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
                document.getElementById('errorMessage').textContent = '';
                
                showNotification('تم تسجيل الخروج', 'info');
            }
        }

        // ============================================
        // PAGE NAVIGATION
        // ============================================
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.remove('active');
            });

            // Remove active class from all menu items
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });

            // Show selected page
            document.getElementById(pageId).classList.add('active');
            currentPage = pageId;

            // Update page title
            const titles = {
                'dashboard': { title: 'لوحة التحكم', desc: 'نظرة عامة على النظام' },
                'newSale': { title: 'بيع جديد', desc: 'إضافة فاتورة بيع جديدة' },
                'products': { title: 'المنتجات', desc: 'إدارة المنتجات والمخزون' },
                'addProduct': { title: 'إضافة منتج', desc: 'إضافة منتج جديد للمخزون' },
                'customers': { title: 'العملاء', desc: 'إدارة قاعدة بيانات العملاء' },
                'addCustomer': { title: 'إضافة عميل', desc: 'إضافة عميل جديد للنظام' },
                'settings': { title: 'الإعدادات', desc: 'تخصيص إعدادات النظام' },
                'users': { title: 'المستخدمين', desc: 'إدارة مستخدمي النظام' },
                'backup': { title: 'النسخ الاحتياطي', desc: 'نسخ واستعادة البيانات' }
            };

            if (titles[pageId]) {
                document.getElementById('pageTitle').textContent = titles[pageId].title;
                document.getElementById('pageDescription').textContent = titles[pageId].desc;
            }

            // Load page data
            switch(pageId) {
                case 'dashboard':
                    loadDashboardData();
                    break;
                case 'products':
                    loadProducts();
                    break;
                case 'customers':
                    loadCustomers();
                    break;
                case 'users':
                    loadUsers();
                    break;
                case 'newSale':
                    initializeSalePage();
                    break;
            }
        }

        function toggleSubmenu(menuId) {
            const menu = document.getElementById(menuId);
            menu.classList.toggle('active');
        }

        // ============================================
        // DASHBOARD FUNCTIONS
        // ============================================
        function initializeDashboard() {
            loadDashboardData();
            initializeCharts();
        }

        function loadDashboardData() {
            const data = storage.getData();
            
            // Calculate statistics
            let monthlySales = 0;
            let monthlyPurchases = 0;
            let weeklySales = 0;
            let weeklyPurchases = 0;
            let dailySales = 0;
            let dailyPurchases = 0;
            let inventoryValue = 0;
            let totalDebt = 0;

            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();

            // Calculate sales and purchases
            data.sales.forEach(sale => {
                const saleDate = new Date(sale.date);
                const amount = sale.total || 0;
                
                if (saleDate.getMonth() === currentMonth && saleDate.getFullYear() === currentYear) {
                    monthlySales += amount;
                }
                
                // Weekly calculation (last 7 days)
                const daysDiff = Math.floor((now - saleDate) / (1000 * 60 * 60 * 24));
                if (daysDiff <= 7) {
                    weeklySales += amount;
                }
                
                // Daily calculation
                if (saleDate.toDateString() === now.toDateString()) {
                    dailySales += amount;
                }
            });

            data.purchases.forEach(purchase => {
                const purchaseDate = new Date(purchase.date);
                const amount = purchase.total || 0;
                
                if (purchaseDate.getMonth() === currentMonth && purchaseDate.getFullYear() === currentYear) {
                    monthlyPurchases += amount;
                }
                
                const daysDiff = Math.floor((now - purchaseDate) / (1000 * 60 * 60 * 24));
                if (daysDiff <= 7) {
                    weeklyPurchases += amount;
                }
                
                if (purchaseDate.toDateString() === now.toDateString()) {
                    dailyPurchases += amount;
                }
            });

            // Calculate inventory value
            data.products.forEach(product => {
                inventoryValue += (product.salePrice || 0) * (product.quantity || 0);
            });

            // Calculate total debt
            data.customers.forEach(customer => {
                totalDebt += customer.debt || 0;
            });

            // Update UI
            document.getElementById('monthlySales').textContent = formatCurrency(monthlySales);
            document.getElementById('monthlyPurchases').textContent = formatCurrency(monthlyPurchases);
            document.getElementById('weeklySales').textContent = formatCurrency(weeklySales);
            document.getElementById('weeklyPurchases').textContent = formatCurrency(weeklyPurchases);
            document.getElementById('dailySales').textContent = formatCurrency(dailySales);
            document.getElementById('dailyPurchases').textContent = formatCurrency(dailyPurchases);
            document.getElementById('inventoryValue').textContent = formatCurrency(inventoryValue);
            document.getElementById('inventoryCount').textContent = `${data.products.length} منتج`;
            document.getElementById('totalDebt').textContent = formatCurrency(totalDebt);
            document.getElementById('debtCount').textContent = `${data.customers.filter(c => c.debt > 0).length} عميل`;

            // Load activities
            loadRecentActivities();
        }

        function initializeCharts() {
            const data = storage.getData();
            
            // Sales Chart
            const salesCtx = document.getElementById('salesChart').getContext('2d');
            const salesChart = new Chart(salesCtx, {
                type: 'line',
                data: {
                    labels: ['يناير', 'فبراير', 'مارس', 'أبريل', 'مايو', 'يونيو'],
                    datasets: [{
                        label: 'المبيعات',
                        data: [1200000, 1900000, 1500000, 2500000, 2000000, 2300000],
                        borderColor: '#27ae60',
                        backgroundColor: 'rgba(39, 174, 96, 0.1)',
                        tension: 0.4,
                        fill: true
                    }, {
                        label: 'المشتريات',
                        data: [800000, 1100000, 900000, 1400000, 1200000, 1500000],
                        borderColor: '#f39c12',
                        backgroundColor: 'rgba(243, 156, 18, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                            rtl: true
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        }
                    }
                }
            });

            // Inventory Chart
            const inventoryCtx = document.getElementById('inventoryChart').getContext('2d');
            const inventoryChart = new Chart(inventoryCtx, {
                type: 'doughnut',
                data: {
                    labels: data.categories || ['هواتف', 'حواسيب', 'إكسسوارات'],
                    datasets: [{
                        data: [40, 30, 20, 10],
                        backgroundColor: [
                            '#3498db',
                            '#2ecc71',
                            '#e74c3c',
                            '#f39c12',
                            '#9b59b6'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                            rtl: true
                        }
                    }
                }
            });
        }

        function loadRecentActivities() {
            const data = storage.getData();
            const activityList = document.getElementById('activityList');
            activityList.innerHTML = '';

            const activities = data.activities.slice(-5).reverse();
            
            activities.forEach(activity => {
                const iconClass = activity.type === 'sale' ? 'fas fa-cash-register sale' :
                                activity.type === 'purchase' ? 'fas fa-shopping-cart purchase' :
                                activity.type === 'login' ? 'fas fa-sign-in-alt success' :
                                activity.type === 'logout' ? 'fas fa-sign-out-alt warning' : 'fas fa-info-circle info';

                const item = document.createElement('div');
                item.className = 'activity-item';
                item.innerHTML = `
                    <div class="activity-icon ${activity.type}">
                        <i class="${iconClass}"></i>
                    </div>
                    <div class="activity-details">
                        <div class="activity-title">${activity.description}</div>
                        <div class="activity-time">${new Date(activity.date).toLocaleString('ar-IQ')}</div>
                    </div>
                    <div style="font-weight: bold; color: var(--primary);">
                        ${activity.amount ? formatCurrency(activity.amount) : ''}
                    </div>
                `;
                activityList.appendChild(item);
            });
        }

        // ============================================
        // PRODUCT MANAGEMENT
        // ============================================
        function loadProducts() {
            const data = storage.getData();
            const table = document.querySelector('#productsTable tbody');
            table.innerHTML = '';

            data.products.forEach((product, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>
                        ${product.image ? 
                            `<img src="${product.image}" width="40" height="40" style="border-radius: 5px;">` : 
                            '<i class="fas fa-box" style="font-size: 24px; color: #ccc;"></i>'
                        }
                    </td>
                    <td>${product.name}</td>
                    <td>${product.category}</td>
                    <td>
                        <span class="status-badge ${product.quantity > 10 ? 'status-success' : product.quantity > 0 ? 'status-warning' : 'status-danger'}">
                            ${product.quantity}
                        </span>
                    </td>
                    <td>${formatCurrency(product.purchasePrice)}</td>
                    <td>${formatCurrency(product.salePrice)}</td>
                    <td>${formatCurrency(product.salePrice * product.quantity)}</td>
                    <td>
                        <button class="action-btn" onclick="viewProduct(${product.id})" title="عرض">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="action-btn" onclick="editProduct(${product.id})" title="تعديل">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn" onclick="deleteProduct(${product.id})" title="حذف">
                            <i class="fas fa-trash"></i>
                        </button>
                        <button class="action-btn" onclick="printProductBarcode(${product.id})" title="باركود">
                            <i class="fas fa-barcode"></i>
                        </button>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        function searchInventory() {
            const searchTerm = document.getElementById('productSearchInventory').value.toLowerCase();
            const data = storage.getData();
            const filteredProducts = data.products.filter(product =>
                product.name.toLowerCase().includes(searchTerm) ||
                product.barcode?.includes(searchTerm) ||
                product.category?.toLowerCase().includes(searchTerm)
            );

            const table = document.querySelector('#productsTable tbody');
            table.innerHTML = '';

            filteredProducts.forEach((product, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>
                        ${product.image ? 
                            `<img src="${product.image}" width="40" height="40" style="border-radius: 5px;">` : 
                            '<i class="fas fa-box" style="font-size: 24px; color: #ccc;"></i>'
                        }
                    </td>
                    <td>${product.name}</td>
                    <td>${product.category}</td>
                    <td>${product.quantity}</td>
                    <td>${formatCurrency(product.purchasePrice)}</td>
                    <td>${formatCurrency(product.salePrice)}</td>
                    <td>${formatCurrency(product.salePrice * product.quantity)}</td>
                    <td>
                        <button class="action-btn" onclick="viewProduct(${product.id})">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="action-btn" onclick="editProduct(${product.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn" onclick="deleteProduct(${product.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        function saveProduct() {
            const productName = document.getElementById('productName').value;
            const productCategory = document.getElementById('productCategory').value;
            const purchasePrice = parseFloat(document.getElementById('purchasePrice').value) || 0;
            const salePrice = parseFloat(document.getElementById('salePrice').value) || 0;
            const quantity = parseInt(document.getElementById('quantity').value) || 0;
            const productColor = document.getElementById('productColor').value;
            const barcode = document.getElementById('barcode').value;
            const description = document.getElementById('productDescription').value;

            if (!productName || !productCategory || purchasePrice <= 0 || salePrice <= 0) {
                showNotification('يرجى ملء جميع الحقول المطلوبة بشكل صحيح', 'error');
                return;
            }

            const product = {
                name: productName,
                category: productCategory,
                purchasePrice: purchasePrice,
                salePrice: salePrice,
                quantity: quantity,
                color: productColor,
                barcode: barcode || `PRD${Date.now()}`,
                description: description,
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };

            storage.addItem('products', product);
            showNotification('تم حفظ المنتج بنجاح', 'success');
            
            // Add color to suggestions if new
            if (productColor && !storage.getData().colors.includes(productColor)) {
                storage.getData().colors.push(productColor);
                storage.saveData(storage.getData());
            }
            
            showPage('products');
        }

        function deleteProduct(id) {
            if (confirm('هل أنت متأكد من حذف هذا المنتج؟')) {
                if (storage.deleteItem('products', id)) {
                    showNotification('تم حذف المنتج بنجاح', 'success');
                    loadProducts();
                }
            }
        }

        function generateBarcode() {
            const barcode = `BC${Date.now()}${Math.floor(Math.random() * 1000)}`;
            document.getElementById('barcode').value = barcode;
            showNotification('تم توليد باركود جديد', 'success');
        }

        function printProductBarcode(productId) {
            const data = storage.getData();
            const product = data.products.find(p => p.id === productId);
            
            if (product) {
                document.getElementById('barcodeContent').innerHTML = `
                    <h3>${product.name}</h3>
                    <div class="barcode">${product.barcode || product.id}</div>
                    <p>السعر: ${formatCurrency(product.salePrice)}</p>
                    <p>الكود: ${product.barcode}</p>
                `;
                openModal('barcodeModal');
            }
        }

        function printBarcode() {
            window.print();
        }

        // ============================================
        // SALE MANAGEMENT
        // ============================================
        function initializeSalePage() {
            loadCustomersForSale();
            loadProductsForSale();
            updateCartDisplay();
        }

        function loadCustomersForSale() {
            const data = storage.getData();
            const select = document.getElementById('customerSelect');
            select.innerHTML = '<option value="">اختر عميل</option>';
            
            data.customers.forEach(customer => {
                const option = document.createElement('option');
                option.value = customer.id;
                option.textContent = `${customer.name} - ${customer.phone}`;
                select.appendChild(option);
            });
        }

        function loadProductsForSale() {
            // This would load products for search suggestions
            // Implement based on your needs
        }

        function searchProduct() {
            const searchTerm = document.getElementById('productSearch').value.toLowerCase();
            const data = storage.getData();
            const results = data.products.filter(product =>
                product.name.toLowerCase().includes(searchTerm) ||
                product.barcode?.includes(searchTerm)
            );

            // Show search results modal
            const modalContent = document.getElementById('productModalContent');
            modalContent.innerHTML = `
                <h4>نتائج البحث</h4>
                <div style="max-height: 300px; overflow-y: auto;">
                    ${results.map(product => `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #eee;">
                            <div>
                                <strong>${product.name}</strong><br>
                                <small>${product.category} - ${formatCurrency(product.salePrice)}</small>
                            </div>
                            <button class="btn btn-primary btn-sm" onclick="addToCart(${product.id})">
                                <i class="fas fa-plus"></i> إضافة
                            </button>
                        </div>
                    `).join('')}
                </div>
            `;
            openModal('productModal');
        }

        function addToCart(productId) {
            const data = storage.getData();
            const product = data.products.find(p => p.id === productId);
            
            if (product) {
                const existingItem = currentCart.find(item => item.productId === productId);
                
                if (existingItem) {
                    existingItem.quantity += 1;
                } else {
                    currentCart.push({
                        productId: product.id,
                        name: product.name,
                        price: product.salePrice,
                        quantity: 1,
                        total: product.salePrice
                    });
                }
                
                updateCartDisplay();
                closeModal('productModal');
                showNotification('تم إضافة المنتج إلى السلة', 'success');
            }
        }

        function updateCartDisplay() {
            const table = document.getElementById('cartTable');
            const totalElement = document.getElementById('cartTotal');
            
            table.innerHTML = '';
            let total = 0;
            
            currentCart.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${item.name}</td>
                    <td>
                        <input type="number" value="${item.quantity}" min="1" 
                               onchange="updateCartQuantity(${index}, this.value)" 
                               style="width: 60px; padding: 5px;">
                    </td>
                    <td>${formatCurrency(item.price)}</td>
                    <td>${formatCurrency(item.price * item.quantity)}</td>
                    <td>
                        <button class="action-btn" onclick="removeFromCart(${index})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                table.appendChild(row);
                total += item.price * item.quantity;
            });
            
            totalElement.textContent = formatCurrency(total);
        }

        function updateCartQuantity(index, quantity) {
            quantity = parseInt(quantity) || 1;
            currentCart[index].quantity = quantity;
            currentCart[index].total = currentCart[index].price * quantity;
            updateCartDisplay();
        }

        function removeFromCart(index) {
            currentCart.splice(index, 1);
            updateCartDisplay();
        }

        function clearCart() {
            if (currentCart.length > 0 && confirm('هل أنت متأكد من تفريغ السلة؟')) {
                currentCart = [];
                updateCartDisplay();
                showNotification('تم تفريغ السلة', 'info');
            }
        }

        function completeSale() {
            if (currentCart.length === 0) {
                showNotification('السلة فارغة', 'error');
                return;
            }

            const customerId = document.getElementById('customerSelect').value;
            const paymentMethod = document.getElementById('paymentMethod').value;
            const invoiceDate = document.getElementById('invoiceDate').value || new Date().toISOString();

            const total = currentCart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            const sale = {
                customerId: customerId ? parseInt(customerId) : null,
                items: [...currentCart],
                total: total,
                paymentMethod: paymentMethod,
                date: invoiceDate,
                invoiceNumber: `INV${Date.now()}`,
                createdBy: currentUser.name,
                createdAt: new Date().toISOString()
            };

            // Update product quantities
            currentCart.forEach(item => {
                const product = storage.getData().products.find(p => p.id === item.productId);
                if (product) {
                    product.quantity -= item.quantity;
                    if (product.quantity < 0) product.quantity = 0;
                }
            });

            // Update customer debt if credit
            if (paymentMethod === 'credit' && customerId) {
                const customer = storage.getData().customers.find(c => c.id === parseInt(customerId));
                if (customer) {
                    customer.debt = (customer.debt || 0) + total;
                }
            }

            storage.addItem('sales', sale);
            
            // Add activity
            storage.addItem('activities', {
                type: 'sale',
                description: `بيع جديد - الفاتورة: ${sale.invoiceNumber}`,
                amount: total,
                user: currentUser.name,
                date: new Date().toISOString()
            });

            // Show success message and reset
            showNotification('تم إتمام البيع بنجاح', 'success');
            
            // Print invoice
            printInvoice('small');
            
            // Reset cart
            currentCart = [];
            updateCartDisplay();
            document.getElementById('customerSelect').value = '';
            document.getElementById('paymentMethod').value = 'cash';
        }

        function printInvoice(type) {
            if (currentCart.length === 0) {
                showNotification('لا يوجد عناصر لطباعة الفاتورة', 'error');
                return;
            }

            const customerId = document.getElementById('customerSelect').value;
            const paymentMethod = document.getElementById('paymentMethod').value;
            const data = storage.getData();
            const customer = customerId ? data.customers.find(c => c.id === parseInt(customerId)) : null;
            
            const total = currentCart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            let invoiceContent = `
                <div class="invoice-preview">
                    <div class="invoice-header">
                        <div class="invoice-logo">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                        <h2>${SYSTEM_CONFIG.name}</h2>
                        <p>فاتورة بيع</p>
                        <p>رقم الفاتورة: INV${Date.now()}</p>
                        <p>التاريخ: ${new Date().toLocaleString('ar-IQ')}</p>
                    </div>
                    
                    <div style="margin: 20px 0;">
                        ${customer ? `
                            <p><strong>العميل:</strong> ${customer.name}</p>
                            <p><strong>الهاتف:</strong> ${customer.phone}</p>
                            ${customer.address ? `<p><strong>العنوان:</strong> ${customer.address}</p>` : ''}
                            ${customer.debt ? `<p><strong>الدين السابق:</strong> ${formatCurrency(customer.debt)}</p>` : ''}
                        ` : '<p>بيع نقدي</p>'}
                        <p><strong>طريقة الدفع:</strong> ${paymentMethod === 'cash' ? 'نقدي' : 'آجل'}</p>
                    </div>
                    
                    <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
                        <thead>
                            <tr style="background: #f5f5f5;">
                                <th style="padding: 10px; text-align: right;">#</th>
                                <th style="padding: 10px; text-align: right;">المنتج</th>
                                <th style="padding: 10px; text-align: right;">الكمية</th>
                                <th style="padding: 10px; text-align: right;">السعر</th>
                                <th style="padding: 10px; text-align: right;">الإجمالي</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            currentCart.forEach((item, index) => {
                invoiceContent += `
                    <tr>
                        <td style="padding: 10px; border-bottom: 1px solid #eee;">${index + 1}</td>
                        <td style="padding: 10px; border-bottom: 1px solid #eee;">${item.name}</td>
                        <td style="padding: 10px; border-bottom: 1px solid #eee;">${item.quantity}</td>
                        <td style="padding: 10px; border-bottom: 1px solid #eee;">${formatCurrency(item.price)}</td>
                        <td style="padding: 10px; border-bottom: 1px solid #eee;">${formatCurrency(item.price * item.quantity)}</td>
                    </tr>
                `;
            });

            invoiceContent += `
                        </tbody>
                        <tfoot>
                            <tr>
                                <td colspan="4" style="padding: 10px; text-align: left; font-weight: bold;">الإجمالي:</td>
                                <td style="padding: 10px; font-weight: bold;">${formatCurrency(total)}</td>
                            </tr>
                        </tfoot>
                    </table>
                    
                    <div style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #eee;">
                        <div style="display: flex; justify-content: space-between; margin-top: 40px;">
                            <div>
                                <p>توقيع البائع</p>
                                <p>${currentUser.name}</p>
                            </div>
                            <div>
                                <p>توقيع العميل</p>
                                <p>___________________</p>
                            </div>
                        </div>
                        <p style="text-align: center; margin-top: 20px; color: #666; font-size: 12px;">
                            شكراً لتعاملكم معنا
                        </p>
                    </div>
                </div>
            `;

            document.getElementById('invoicePreviewContent').innerHTML = invoiceContent;
            openModal('invoiceModal');
        }

        function printCurrentInvoice() {
            window.print();
        }

        // ============================================
        // CUSTOMER MANAGEMENT
        // ============================================
        function loadCustomers() {
            const data = storage.getData();
            const table = document.querySelector('#customersTable tbody');
            table.innerHTML = '';

            data.customers.forEach((customer, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${customer.name}</td>
                    <td>${customer.phone}</td>
                    <td>${customer.address || '-'}</td>
                    <td>
                        <span class="status-badge ${customer.debt > 0 ? 'status-danger' : 'status-success'}">
                            ${formatCurrency(customer.debt || 0)}
                        </span>
                    </td>
                    <td>${customer.lastPurchase ? new Date(customer.lastPurchase).toLocaleDateString('ar-IQ') : '-'}</td>
                    <td>
                        <button class="action-btn" onclick="viewCustomer(${customer.id})">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="action-btn" onclick="editCustomer(${customer.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn" onclick="deleteCustomer(${customer.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        function searchCustomer() {
            const searchTerm = document.getElementById('customerSearch').value.toLowerCase();
            const data = storage.getData();
            const filteredCustomers = data.customers.filter(customer =>
                customer.name.toLowerCase().includes(searchTerm) ||
                customer.phone.includes(searchTerm)
            );

            const table = document.querySelector('#customersTable tbody');
            table.innerHTML = '';

            filteredCustomers.forEach((customer, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${customer.name}</td>
                    <td>${customer.phone}</td>
                    <td>${customer.address || '-'}</td>
                    <td>${formatCurrency(customer.debt || 0)}</td>
                    <td>${customer.lastPurchase ? new Date(customer.lastPurchase).toLocaleDateString('ar-IQ') : '-'}</td>
                    <td>
                        <button class="action-btn" onclick="viewCustomer(${customer.id})">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="action-btn" onclick="editCustomer(${customer.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn" onclick="deleteCustomer(${customer.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        function saveCustomer() {
            const customerName = document.getElementById('customerName').value;
            const customerPhone = document.getElementById('customerPhone').value;
            const customerAddress = document.getElementById('customerAddress').value;
            const customerDebt = parseFloat(document.getElementById('customerDebt').value) || 0;

            if (!customerName || !customerPhone) {
                showNotification('يرجى إدخال الاسم والهاتف', 'error');
                return;
            }

            const customer = {
                name: customerName,
                phone: customerPhone,
                address: customerAddress,
                debt: customerDebt,
                totalPurchases: 0,
                createdAt: new Date().toISOString()
            };

            storage.addItem('customers', customer);
            showNotification('تم حفظ العميل بنجاح', 'success');
            showPage('customers');
        }

        function toggleDebtInput(show) {
            document.getElementById('customerDebt').disabled = !show;
            if (!show) {
                document.getElementById('customerDebt').value = 0;
            }
        }

        function deleteCustomer(id) {
            if (confirm('هل أنت متأكد من حذف هذا العميل؟')) {
                if (storage.deleteItem('customers', id)) {
                    showNotification('تم حذف العميل بنجاح', 'success');
                    loadCustomers();
                }
            }
        }

        // ============================================
        // USER MANAGEMENT
        // ============================================
        function loadUsers() {
            const data = storage.getData();
            const table = document.querySelector('#usersTable tbody');
            table.innerHTML = '';

            data.users.forEach((user, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>
                        ${user.image ? 
                            `<img src="${user.image}" width="40" height="40" style="border-radius: 50%;">` : 
                            '<div class="user-avatar" style="width: 40px; height: 40px;">' +
                            '<i class="fas fa-user"></i></div>'
                        }
                    </td>
                    <td>${user.name}</td>
                    <td>${user.role}</td>
                    <td>
                        <span class="status-badge ${user.isActive ? 'status-success' : 'status-danger'}">
                            ${user.isActive ? 'نشط' : 'غير نشط'}
                        </span>
                    </td>
                    <td>${user.lastLogin ? new Date(user.lastLogin).toLocaleString('ar-IQ') : '-'}</td>
                    <td>
                        <button class="action-btn" onclick="editUser(${user.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn" onclick="deleteUser(${user.id})" ${user.role === 'admin' ? 'disabled' : ''}>
                            <i class="fas fa-trash"></i>
                        </button>
                        <button class="action-btn" onclick="manageUserPermissions(${user.id})">
                            <i class="fas fa-key"></i>
                        </button>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        function showAddUserModal() {
            const modalContent = document.getElementById('userModalContent');
            modalContent.innerHTML = `
                <div class="form-group">
                    <label>اسم المستخدم *</label>
                    <input type="text" class="form-control" id="newUsername" placeholder="اسم المستخدم">
                </div>
                <div class="form-group">
                    <label>كلمة المرور *</label>
                    <input type="password" class="form-control" id="newPassword" placeholder="كلمة المرور">
                </div>
                <div class="form-group">
                    <label>الاسم الكامل *</label>
                    <input type="text" class="form-control" id="newFullName" placeholder="الاسم الكامل">
                </div>
                <div class="form-group">
                    <label>الدور</label>
                    <select class="form-control" id="newUserRole">
                        <option value="admin">مدير</option>
                        <option value="user">مستخدم</option>
                        <option value="cashier">كاشير</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>صورة المستخدم</label>
                    <input type="file" class="form-control" id="newUserImage" accept="image/*">
                </div>
                <div class="form-actions">
                    <button class="btn btn-secondary" onclick="closeModal('userModal')">إلغاء</button>
                    <button class="btn btn-success" onclick="saveNewUser()">حفظ</button>
                </div>
            `;
            openModal('userModal');
        }

        function saveNewUser() {
            const username = document.getElementById('newUsername').value;
            const password = document.getElementById('newPassword').value;
            const fullName = document.getElementById('newFullName').value;
            const role = document.getElementById('newUserRole').value;

            if (!username || !password || !fullName) {
                showNotification('يرجى ملء جميع الحقول المطلوبة', 'error');
                return;
            }

            const user = {
                username: username,
                password: password,
                name: fullName,
                role: role,
                email: '',
                phone: '',
                image: null,
                permissions: role === 'admin' ? ['all'] : ['read'],
                lastLogin: null,
                isActive: true,
                createdAt: new Date().toISOString()
            };

            storage.addItem('users', user);
            closeModal('userModal');
            showNotification('تم إضافة المستخدم بنجاح', 'success');
            loadUsers();
        }

        // ============================================
        // SETTINGS MANAGEMENT
        // ============================================
        function saveSettings() {
            const systemName = document.getElementById('systemName').value;
            const systemCurrency = document.getElementById('systemCurrency').value;
            const systemLanguage = document.getElementById('systemLanguage').value;
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            const data = storage.getData();
            
            // Update system settings
            data.settings.systemName = systemName;
            data.settings.currency = systemCurrency;
            storage.saveData(data);

            // Update password if provided
            if (currentPassword && newPassword && confirmPassword) {
                if (newPassword !== confirmPassword) {
                    showNotification('كلمة المرور الجديدة غير متطابقة', 'error');
                    return;
                }

                if (currentPassword !== currentUser.password) {
                    showNotification('كلمة المرور الحالية غير صحيحة', 'error');
                    return;
                }

                storage.updateItem('users', currentUser.id, { password: newPassword });
                showNotification('تم تحديث كلمة المرور', 'success');
                
                // Clear password fields
                document.getElementById('currentPassword').value = '';
                document.getElementById('newPassword').value = '';
                document.getElementById('confirmPassword').value = '';
            }

            showNotification('تم حفظ الإعدادات بنجاح', 'success');
        }

        // ============================================
        // BACKUP MANAGEMENT
        // ============================================
        function createBackup() {
            const data = storage.getData();
            const backup = {
                id: Date.now(),
                date: new Date().toISOString(),
                data: JSON.stringify(data),
                size: JSON.stringify(data).length / 1024 / 1024, // MB
                createdBy: currentUser.name
            };

            storage.addItem('backups', backup);
            
            // Create download link
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `backup_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showNotification('تم إنشاء نسخة احتياطية بنجاح', 'success');
            updateBackupStats();
        }

        function restoreBackup() {
            const fileInput = document.getElementById('restoreFile');
            const file = fileInput.files[0];
            
            if (!file) {
                showNotification('يرجى اختيار ملف النسخة الاحتياطية', 'error');
                return;
            }

            if (!confirm('تحذير: سيتم استبدال جميع البيانات الحالية. هل أنت متأكد؟')) {
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    localStorage.setItem('system_data', JSON.stringify(data));
                    
                    // Add activity
                    storage.addItem('activities', {
                        type: 'backup',
                        description: 'استعادة نسخة احتياطية',
                        user: currentUser.name,
                        date: new Date().toISOString()
                    });

                    showNotification('تم استعادة البيانات بنجاح', 'success');
                    location.reload(); // Reload to apply changes
                } catch (error) {
                    showNotification('خطأ في قراءة الملف', 'error');
                }
            };
            reader.readAsText(file);
        }

        function updateBackupStats() {
            const data = storage.getData();
            const totalSize = data.backups.reduce((sum, backup) => sum + (backup.size || 0), 0);
            
            document.getElementById('backupSize').textContent = totalSize.toFixed(2) + ' MB';
            document.getElementById('backupCount').textContent = data.backups.length;
        }

        // ============================================
        // INITIALIZATION
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            // Set current date for invoice
            const now = new Date();
            const localDateTime = new Date(now.getTime() - now.getTimezoneOffset() * 60000).toISOString().slice(0, 16);
            document.getElementById('invoiceDate').value = localDateTime;

            // Load categories for product form
            const data = storage.getData();
            const categorySelect = document.getElementById('productCategory');
            data.categories?.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categorySelect.appendChild(option);
            });

            // Setup login form
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                login();
            });

            // Initialize backup stats
            updateBackupStats();
        });

        // ============================================
        // EVENT LISTENERS FOR REAL-TIME UPDATES
        // ============================================
        document.getElementById('productSearch').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchProduct();
            }
        });

        document.getElementById('productSearchInventory').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchInventory();
            }
        });

        document.getElementById('customerSearch').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchCustomer();
            }
        });
    </script>
</body>
</html>