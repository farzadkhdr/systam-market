<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام بيع الإلكترونيات - نظام إدارة المبيعات المتكامل</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --success: #4cc9f0;
            --danger: #f72585;
            --warning: #f8961e;
            --info: #7209b7;
            --light: #f8f9fa;
            --dark: #212529;
            --gradient: linear-gradient(135deg, #4361ee, #3a0ca3, #7209b7);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: #f5f7fb;
            color: #333;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* أنيميشن للخلفية */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
        }
        
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* صفحة تسجيل الدخول */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        
        .login-box {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 450px;
            padding: 40px;
            animation: slideUp 0.8s ease-out;
            backdrop-filter: blur(10px);
        }
        
        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .logo-container {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .logo {
            width: 120px;
            height: 120px;
            background: var(--gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            animation: pulse 2s infinite;
            box-shadow: 0 10px 20px rgba(67, 97, 238, 0.3);
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .logo i {
            font-size: 50px;
            color: white;
        }
        
        .system-name {
            color: var(--secondary);
            font-size: 28px;
            font-weight: 800;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .system-subtitle {
            color: var(--primary);
            font-size: 16px;
            margin-top: 5px;
        }
        
        .login-form h2 {
            color: var(--dark);
            margin-bottom: 25px;
            text-align: center;
            font-weight: 700;
            position: relative;
            padding-bottom: 10px;
        }
        
        .login-form h2:after {
            content: '';
            position: absolute;
            bottom: 0;
            right: 0;
            width: 80px;
            height: 4px;
            background: var(--gradient);
            border-radius: 2px;
            right: 50%;
            transform: translateX(50%);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--dark);
            font-weight: 600;
        }
        
        .form-control {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
            background: #f9f9f9;
        }
        
        .form-control:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
            outline: none;
            background: white;
        }
        
        .btn {
            display: inline-block;
            padding: 15px 30px;
            background: var(--gradient);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(67, 97, 238, 0.3);
        }
        
        .btn-secondary {
            background: var(--secondary);
        }
        
        .btn-success {
            background: var(--success);
        }
        
        .btn-danger {
            background: var(--danger);
        }
        
        .btn-warning {
            background: var(--warning);
        }
        
        .btn-info {
            background: var(--info);
        }
        
        /* النظام الرئيسي */
        .main-system {
            display: none;
            min-height: 100vh;
        }
        
        .header {
            background: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .header-logo .logo {
            width: 50px;
            height: 50px;
            animation: none;
        }
        
        .header-logo .logo i {
            font-size: 24px;
        }
        
        .header-info h1 {
            font-size: 22px;
            color: var(--secondary);
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-avatar {
            width: 45px;
            height: 45px;
            background: var(--gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .logout-btn {
            background: var(--danger);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .logout-btn:hover {
            background: #d1145a;
        }
        
        .sidebar {
            width: 250px;
            background: white;
            height: calc(100vh - 80px);
            position: fixed;
            right: 0;
            top: 80px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.05);
            overflow-y: auto;
            transition: all 0.3s;
        }
        
        .sidebar-menu {
            list-style: none;
            padding: 20px 0;
        }
        
        .sidebar-menu li {
            margin-bottom: 5px;
        }
        
        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 15px 25px;
            color: #555;
            text-decoration: none;
            transition: all 0.3s;
            gap: 12px;
            border-right: 4px solid transparent;
        }
        
        .sidebar-menu a:hover, .sidebar-menu a.active {
            background: rgba(67, 97, 238, 0.1);
            color: var(--primary);
            border-right-color: var(--primary);
        }
        
        .sidebar-menu a i {
            width: 20px;
            text-align: center;
        }
        
        .content {
            margin-right: 250px;
            padding: 30px;
            min-height: calc(100vh - 80px);
        }
        
        .section {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }
        
        .section.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .section-title {
            color: var(--secondary);
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
            font-size: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* بطاقات الإحصائيات */
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.06);
            transition: all 0.3s;
            border-top: 5px solid var(--primary);
            position: relative;
            overflow: hidden;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.1);
        }
        
        .stat-card:nth-child(2) { border-top-color: var(--success); }
        .stat-card:nth-child(3) { border-top-color: var(--warning); }
        .stat-card:nth-child(4) { border-top-color: var(--info); }
        .stat-card:nth-child(5) { border-top-color: #9d4edd; }
        .stat-card:nth-child(6) { border-top-color: #ff9e00; }
        
        .stat-icon {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 22px;
        }
        
        .stat-card:nth-child(1) .stat-icon { background: var(--primary); }
        .stat-card:nth-child(2) .stat-icon { background: var(--success); }
        .stat-card:nth-child(3) .stat-icon { background: var(--warning); }
        .stat-card:nth-child(4) .stat-icon { background: var(--info); }
        .stat-card:nth-child(5) .stat-icon { background: #9d4edd; }
        .stat-card:nth-child(6) .stat-icon { background: #ff9e00; }
        
        .stat-content {
            text-align: right;
            margin-right: 70px;
        }
        
        .stat-title {
            color: #777;
            font-size: 14px;
            margin-bottom: 8px;
        }
        
        .stat-value {
            color: var(--dark);
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .stat-change {
            font-size: 13px;
            font-weight: 600;
        }
        
        .stat-change.positive {
            color: #2ecc71;
        }
        
        .stat-change.negative {
            color: #e74c3c;
        }
        
        /* تصميم الجداول */
        .table-container {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.06);
            margin-bottom: 30px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        thead {
            background: var(--gradient);
            color: white;
        }
        
        th {
            padding: 18px 15px;
            text-align: right;
            font-weight: 600;
        }
        
        tbody tr {
            border-bottom: 1px solid #eee;
            transition: all 0.2s;
        }
        
        tbody tr:hover {
            background: #f9f9f9;
        }
        
        td {
            padding: 15px;
            color: #555;
        }
        
        /* أزرار العمل */
        .action-buttons {
            display: flex;
            gap: 8px;
        }
        
        .btn-small {
            padding: 6px 12px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .btn-edit {
            background: #4cc9f0;
            color: white;
        }
        
        .btn-delete {
            background: #f72585;
            color: white;
        }
        
        .btn-print {
            background: #4361ee;
            color: white;
        }
        
        .btn-view {
            background: #7209b7;
            color: white;
        }
        
        .btn-small:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        /* نموذج البحث */
        .search-container {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 25px;
        }
        
        .search-box {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .search-input {
            flex: 1;
            min-width: 250px;
            padding: 12px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
        }
        
        /* المنتجات في السلة */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .product-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.06);
            transition: all 0.3s;
            position: relative;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.1);
        }
        
        .product-img {
            height: 150px;
            background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-size: 50px;
        }
        
        .product-info {
            padding: 20px;
        }
        
        .product-name {
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--dark);
        }
        
        .product-price {
            color: var(--primary);
            font-weight: 800;
            font-size: 18px;
            margin-bottom: 15px;
        }
        
        /* طباعة الفواتير */
        .print-options {
            display: flex;
            gap: 20px;
            margin: 25px 0;
            flex-wrap: wrap;
        }
        
        .print-option {
            flex: 1;
            min-width: 200px;
            background: white;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            cursor: pointer;
            transition: all 0.3s;
            border: 3px solid transparent;
        }
        
        .print-option:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border-color: var(--primary);
        }
        
        .print-icon {
            font-size: 50px;
            color: var(--primary);
            margin-bottom: 15px;
        }
        
        /* الطباعة A4 */
        .invoice-a4 {
            width: 210mm;
            min-height: 297mm;
            background: white;
            margin: 0 auto;
            padding: 20mm;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            position: relative;
        }
        
        .invoice-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eee;
        }
        
        .invoice-logo {
            width: 80px;
            height: 80px;
            background: var(--gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 30px;
        }
        
        /* الباركود */
        .barcode-container {
            text-align: center;
            padding: 30px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.06);
            margin: 30px 0;
        }
        
        .barcode {
            width: 100%;
            max-width: 300px;
            height: 120px;
            background: #f5f5f5;
            margin: 20px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: monospace;
            font-size: 24px;
            letter-spacing: 2px;
            color: #333;
            padding: 10px;
        }
        
        /* الفاتورة الصغيرة */
        .small-invoice {
            width: 80mm;
            background: white;
            padding: 15px;
            margin: 0 auto;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        
        /* النوافذ المنبثقة */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease-out;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #777;
        }
        
        /* التبويبات */
        .tabs {
            display: flex;
            border-bottom: 2px solid #eee;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 15px 25px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .tab.active {
            border-bottom-color: var(--primary);
            color: var(--primary);
            font-weight: 700;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* التجاوب */
        @media (max-width: 992px) {
            .sidebar {
                right: -250px;
            }
            
            .sidebar.active {
                right: 0;
            }
            
            .content {
                margin-right: 0;
            }
            
            .menu-toggle {
                display: block;
                background: var(--primary);
                color: white;
                border: none;
                width: 45px;
                height: 45px;
                border-radius: 10px;
                font-size: 20px;
                cursor: pointer;
            }
        }
        
        @media (max-width: 768px) {
            .stats-cards {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
            
            .header {
                padding: 15px 20px;
                flex-wrap: wrap;
                gap: 15px;
            }
            
            .content {
                padding: 20px;
            }
        }
        
        /* الألوان للاقتراح التلقائي */
        .color-suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .color-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
        }
        
        .color-option:hover {
            transform: scale(1.1);
        }
        
        .color-option.selected {
            border-color: #333;
        }
        
        /* شجرة القائمة */
        .menu-tree {
            list-style: none;
            padding-right: 20px;
        }
        
        .menu-tree li {
            margin-bottom: 10px;
        }
        
        .menu-tree label {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }
        
        /* الحقول المتقدمة */
        .advanced-fields {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 10px;
        }
        
        .advanced-fields.active {
            display: block;
        }
        
        /* التحميل */
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- أنيميشن الخلفية -->
    <div class="bg-animation"></div>
    
    <!-- صفحة تسجيل الدخول -->
    <div class="login-container" id="loginPage">
        <div class="login-box">
            <div class="logo-container">
                <div class="logo">
                    <i class="fas fa-shopping-cart"></i>
                </div>
                <h1 class="system-name">نظام إدارة بيع الإلكترونيات</h1>
                <p class="system-subtitle">متجرك الإلكتروني المتكامل لإدارة المبيعات والمخزون</p>
            </div>
            
            <form class="login-form" id="loginForm">
                <h2>تسجيل الدخول</h2>
                
                <div class="form-group">
                    <label for="username">اسم المستخدم</label>
                    <input type="text" id="username" class="form-control" placeholder="أدخل اسم المستخدم" required>
                </div>
                
                <div class="form-group">
                    <label for="password">كلمة المرور</label>
                    <input type="password" id="password" class="form-control" placeholder="أدخل كلمة المرور" required>
                </div>
                
                <button type="submit" class="btn">دخول إلى النظام</button>
                <p style="text-align: center; margin-top: 15px; color: #777;">
                    كلمة المرور الافتراضية: <strong>farzad1234</strong>
                </p>
            </form>
        </div>
    </div>
    
    <!-- النظام الرئيسي -->
    <div class="main-system" id="mainSystem">
        <!-- الهيدر -->
        <header class="header">
            <div class="header-logo">
                <div class="logo">
                    <i class="fas fa-shopping-cart"></i>
                </div>
                <div class="header-info">
                    <h1>نظام إدارة بيع الإلكترونيات</h1>
                </div>
            </div>
            
            <button class="menu-toggle" id="menuToggle">
                <i class="fas fa-bars"></i>
            </button>
            
            <div class="user-info">
                <div class="user-avatar">م</div>
                <div>
                    <div style="font-weight: 700;">مدير النظام</div>
                    <div style="font-size: 13px; color: #777;">مدير</div>
                </div>
                <button class="logout-btn" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i> خروج
                </button>
            </div>
        </header>
        
        <!-- القائمة الجانبية -->
        <nav class="sidebar" id="sidebar">
            <ul class="sidebar-menu">
                <li><a href="#" class="active" data-section="dashboard"><i class="fas fa-tachometer-alt"></i> لوحة التحكم</a></li>
                <li><a href="#" data-section="sales"><i class="fas fa-cash-register"></i> نقطة البيع</a></li>
                <li><a href="#" data-section="inventory"><i class="fas fa-boxes"></i> إدارة المخزون</a></li>
                <li><a href="#" data-section="purchases"><i class="fas fa-shopping-cart"></i> المشتريات</a></li>
                <li><a href="#" data-section="customers"><i class="fas fa-users"></i> العملاء والموردين</a></li>
                <li><a href="#" data-section="payments"><i class="fas fa-money-bill-wave"></i> الدفعات والمصروفات</a></li>
                <li><a href="#" data-section="invoices"><i class="fas fa-file-invoice"></i> الفواتير</a></li>
                <li><a href="#" data-section="reports"><i class="fas fa-chart-bar"></i> التقارير</a></li>
                <li><a href="#" data-section="users"><i class="fas fa-user-shield"></i> المستخدمين والصلاحيات</a></li>
                <li><a href="#" data-section="settings"><i class="fas fa-cog"></i> الإعدادات</a></li>
                <li><a href="#" data-section="backup"><i class="fas fa-database"></i> النسخ الاحتياطي</a></li>
            </ul>
        </nav>
        
        <!-- المحتوى الرئيسي -->
        <main class="content">
            <!-- لوحة التحكم -->
            <section class="section active" id="dashboard">
                <h2 class="section-title"><i class="fas fa-tachometer-alt"></i> لوحة التحكم</h2>
                
                <div class="stats-cards">
                    <!-- إحصائيات الشهر -->
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-shopping-bag"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-title">إجمالي المبيعات (شهري)</div>
                            <div class="stat-value">125,750 <span style="font-size: 16px;">د.ع</span></div>
                            <div class="stat-change positive"><i class="fas fa-arrow-up"></i> 12.5% عن الشهر الماضي</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-cart-arrow-down"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-title">إجمالي المشتريات (شهري)</div>
                            <div class="stat-value">89,500 <span style="font-size: 16px;">د.ع</span></div>
                            <div class="stat-change positive"><i class="fas fa-arrow-up"></i> 8.3% عن الشهر الماضي</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-title">الفرق (المبيعات - المشتريات)</div>
                            <div class="stat-value">36,250 <span style="font-size: 16px;">د.ع</span></div>
                            <div class="stat-change positive"><i class="fas fa-arrow-up"></i> 24.7% عن الشهر الماضي</div>
                        </div>
                    </div>
                    
                    <!-- إحصائيات الأسبوع -->
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-shopping-bag"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-title">إجمالي المبيعات (أسبوعي)</div>
                            <div class="stat-value">32,400 <span style="font-size: 16px;">د.ع</span></div>
                            <div class="stat-change positive"><i class="fas fa-arrow-up"></i> 5.2% عن الأسبوع الماضي</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-cart-arrow-down"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-title">إجمالي المشتريات (أسبوعي)</div>
                            <div class="stat-value">21,800 <span style="font-size: 16px;">د.ع</span></div>
                            <div class="stat-change negative"><i class="fas fa-arrow-down"></i> 3.1% عن الأسبوع الماضي</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-title">الفرق (المبيعات - المشتريات)</div>
                            <div class="stat-value">10,600 <span style="font-size: 16px;">د.ع</span></div>
                            <div class="stat-change positive"><i class="fas fa-arrow-up"></i> 18.5% عن الأسبوع الماضي</div>
                        </div>
                    </div>
                    
                    <!-- إحصائيات اليوم -->
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-shopping-bag"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-title">إجمالي المبيعات (اليوم)</div>
                            <div class="stat-value">5,850 <span style="font-size: 16px;">د.ع</span></div>
                            <div class="stat-change positive"><i class="fas fa-arrow-up"></i> 15% عن الأمس</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-cart-arrow-down"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-title">إجمالي المشتريات (اليوم)</div>
                            <div class="stat-value">3,200 <span style="font-size: 16px;">د.ع</span></div>
                            <div class="stat-change negative"><i class="fas fa-arrow-down"></i> 7% عن الأمس</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-title">الفرق (المبيعات - المشتريات)</div>
                            <div class="stat-value">2,650 <span style="font-size: 16px;">د.ع</span></div>
                            <div class="stat-change positive"><i class="fas fa-arrow-up"></i> 42% عن الأمس</div>
                        </div>
                    </div>
                    
                    <!-- إحصائيات إضافية -->
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-box"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-title">إجمالي المنتجات في المخزون</div>
                            <div class="stat-value">1,248</div>
                            <div class="stat-change positive"><i class="fas fa-arrow-up"></i> 34 منتج جديد</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-user-friends"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-title">إجمالي العملاء</div>
                            <div class="stat-value">342</div>
                            <div class="stat-change positive"><i class="fas fa-arrow-up"></i> 12 عميل جديد</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-title">إجمالي الديون على العملاء</div>
                            <div class="stat-value">45,300 <span style="font-size: 16px;">د.ع</span></div>
                            <div class="stat-change negative"><i class="fas fa-arrow-up"></i> 2,500 د.ع زيادة</div>
                        </div>
                    </div>
                </div>
                
                <!-- أحدث الفواتير -->
                <div class="table-container">
                    <h3 style="padding: 20px; margin: 0; border-bottom: 1px solid #eee;">أحدث الفواتير</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>رقم الفاتورة</th>
                                <th>التاريخ</th>
                                <th>العميل</th>
                                <th>إجمالي الفاتورة</th>
                                <th>طريقة الدفع</th>
                                <th>الإجراءات</th>
                            </tr>
                        </thead>
                        <tbody id="recentInvoices">
                            <!-- سيتم ملء أحدث الفواتير ديناميكيا -->
                        </tbody>
                    </table>
                </div>
            </section>
            
            <!-- نقطة البيع -->
            <section class="section" id="sales">
                <h2 class="section-title"><i class="fas fa-cash-register"></i> نقطة البيع</h2>
                
                <div class="search-container">
                    <div class="search-box">
                        <input type="text" id="productSearch" class="search-input" placeholder="ابحث عن المنتج بالاسم أو الباركود..." onkeyup="searchProducts()">
                        <button class="btn" onclick="scanBarcode()"><i class="fas fa-barcode"></i> مسح باركود</button>
                        <button class="btn btn-success" onclick="clearCart()"><i class="fas fa-trash"></i> تفريغ السلة</button>
                    </div>
                </div>
                
                <div class="products-grid" id="productsGrid">
                    <!-- سيتم ملء المنتجات ديناميكيا -->
                </div>
                
                <div class="table-container">
                    <h3 style="padding: 20px; margin: 0; border-bottom: 1px solid #eee;">سلة المشتريات</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>المنتج</th>
                                <th>السعر</th>
                                <th>الكمية</th>
                                <th>الإجمالي</th>
                                <th>الإجراءات</th>
                            </tr>
                        </thead>
                        <tbody id="cartItems">
                            <!-- سيتم ملء عناصر السلة ديناميكيا -->
                        </tbody>
                    </table>
                </div>
                
                <div style="display: flex; justify-content: space-between; margin-top: 30px; flex-wrap: wrap; gap: 20px;">
                    <div style="background: white; padding: 20px; border-radius: 15px; flex: 1; min-width: 300px;">
                        <h3 style="margin-bottom: 15px;">معلومات العميل</h3>
                        <div class="search-box">
                            <input type="text" id="customerSearch" class="search-input" placeholder="ابحث عن العميل..." onkeyup="searchCustomers()">
                            <div id="customerSuggestions" style="display: none; background: white; border: 1px solid #ddd; border-radius: 10px; max-height: 200px; overflow-y: auto; position: absolute; width: calc(100% - 15px); z-index: 100; margin-top: 5px;"></div>
                        </div>
                        <div id="selectedCustomerInfo" style="margin-top: 15px; display: none;">
                            <div style="padding: 10px; background: #f9f9f9; border-radius: 10px;">
                                <strong>العميل المحدد:</strong> <span id="selectedCustomerName"></span><br>
                                <strong>الديون السابقة:</strong> <span id="customerPreviousDebt">0</span> د.ع
                            </div>
                        </div>
                        <div style="margin-top: 15px;">
                            <label style="display: block; margin-bottom: 10px;">
                                <input type="radio" name="paymentType" value="cash" checked> نقداً
                            </label>
                            <label style="display: block;">
                                <input type="radio" name="paymentType" value="credit"> بالدين
                            </label>
                        </div>
                        <div id="creditSection" style="display: none; margin-top: 15px;">
                            <input type="number" id="creditAmount" class="form-control" placeholder="مبلغ الدين" style="margin-bottom: 10px;">
                            <input type="date" id="creditDueDate" class="form-control">
                        </div>
                    </div>
                    
                    <div style="background: white; padding: 20px; border-radius: 15px; flex: 2; min-width: 300px;">
                        <h3 style="margin-bottom: 15px;">ملخص الفاتورة</h3>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>إجمالي المنتجات:</span>
                            <span style="font-weight: 700;" id="subtotal">0 د.ع</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>الخصم:</span>
                            <span style="font-weight: 700;" id="discount">0 د.ع</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>الضريبة:</span>
                            <span style="font-weight: 700;" id="tax">0 د.ع</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 20px; padding-top: 15px; border-top: 2px solid #eee;">
                            <span style="font-size: 18px; font-weight: 700;">الإجمالي النهائي:</span>
                            <span style="font-size: 24px; font-weight: 800; color: var(--primary);" id="totalAmount">0 د.ع</span>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <input type="number" id="discountInput" class="form-control" placeholder="مبلغ الخصم" style="margin-bottom: 10px;" onchange="updateDiscount()">
                            <button class="btn btn-warning" onclick="applyDiscount(10)" style="width: auto; margin-right: 5px;">خصم 10%</button>
                            <button class="btn btn-warning" onclick="applyDiscount(20)" style="width: auto;">خصم 20%</button>
                        </div>
                        
                        <!-- خيارات الطباعة -->
                        <div class="print-options">
                            <div class="print-option" id="printSmall">
                                <div class="print-icon">
                                    <i class="fas fa-print"></i>
                                </div>
                                <h4>طباعة إيصال صغير</h4>
                                <p>مناسب للطابعات المحمولة</p>
                            </div>
                            
                            <div class="print-option" id="printA4">
                                <div class="print-icon">
                                    <i class="fas fa-file-invoice"></i>
                                </div>
                                <h4>طباعة فاتورة A4</h4>
                                <p>فاتورة كاملة في صفحة واحدة</p>
                            </div>
                        </div>
                        
                        <button class="btn btn-success" style="margin-top: 20px;" onclick="completeSale()">
                            <i class="fas fa-check-circle"></i> إتمام البيع
                        </button>
                    </div>
                </div>
            </section>
            
            <!-- إدارة المخزون -->
            <section class="section" id="inventory">
                <h2 class="section-title"><i class="fas fa-boxes"></i> إدارة المخزون</h2>
                
                <div class="search-container">
                    <div class="search-box">
                        <input type="text" id="inventorySearch" class="search-input" placeholder="ابحث عن المنتج..." onkeyup="searchInventory()">
                        <button class="btn"><i class="fas fa-search"></i> بحث</button>
                        <button class="btn btn-success" onclick="openAddProductModal()"><i class="fas fa-plus"></i> إضافة منتج جديد</button>
                    </div>
                </div>
                
                <div class="table-container">
                    <table id="inventoryTable">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>المنتج</th>
                                <th>الصورة</th>
                                <th>الكمية المتاحة</th>
                                <th>سعر الشراء</th>
                                <th>سعر البيع</th>
                                <th>النوع</th>
                                <th>اللون</th>
                                <th>الإجراءات</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- سيتم ملء بيانات المخزون ديناميكيا -->
                        </tbody>
                    </table>
                </div>
            </section>
            
            <!-- المشتريات -->
            <section class="section" id="purchases">
                <h2 class="section-title"><i class="fas fa-shopping-cart"></i> المشتريات</h2>
                
                <div class="search-container">
                    <div class="search-box">
                        <input type="text" id="purchaseSearch" class="search-input" placeholder="ابحث عن فاتورة شراء..." onkeyup="searchPurchaseInvoices()">
                        <button class="btn"><i class="fas fa-search"></i> بحث</button>
                        <button class="btn btn-success" onclick="openAddPurchaseModal()"><i class="fas fa-plus"></i> عملية شراء جديدة</button>
                    </div>
                </div>
                
                <div class="table-container">
                    <table id="purchasesTable">
                        <thead>
                            <tr>
                                <th>رقم الفاتورة</th>
                                <th>التاريخ</th>
                                <th>المورد</th>
                                <th>إجمالي الفاتورة</th>
                                <th>طريقة الدفع</th>
                                <th>الحالة</th>
                                <th>الإجراءات</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- سيتم ملء بيانات المشتريات ديناميكيا -->
                        </tbody>
                    </table>
                </div>
            </section>
            
            <!-- العملاء والموردين -->
            <section class="section" id="customers">
                <h2 class="section-title"><i class="fas fa-users"></i> العملاء والموردين</h2>
                
                <div class="tabs">
                    <div class="tab active" data-tab="customers">العملاء</div>
                    <div class="tab" data-tab="suppliers">الموردين</div>
                </div>
                
                <!-- تبويب العملاء -->
                <div class="tab-content active" id="customersTab">
                    <div class="search-container">
                        <div class="search-box">
                            <input type="text" id="customerListSearch" class="search-input" placeholder="ابحث عن عميل..." onkeyup="searchCustomerList()">
                            <button class="btn"><i class="fas fa-search"></i> بحث</button>
                            <button class="btn btn-success" onclick="openAddCustomerModal()"><i class="fas fa-user-plus"></i> إضافة عميل جديد</button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table id="customersTable">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>الاسم</th>
                                    <th>رقم الهاتف</th>
                                    <th>البريد الإلكتروني</th>
                                    <th>إجمالي المشتريات</th>
                                    <th>الديون الحالية</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- سيتم ملء بيانات العملاء ديناميكيا -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- تبويب الموردين -->
                <div class="tab-content" id="suppliersTab">
                    <div class="search-container">
                        <div class="search-box">
                            <input type="text" id="supplierSearch" class="search-input" placeholder="ابحث عن مورد..." onkeyup="searchSuppliers()">
                            <button class="btn"><i class="fas fa-search"></i> بحث</button>
                            <button class="btn btn-success" onclick="openAddSupplierModal()"><i class="fas fa-user-plus"></i> إضافة مورد جديد</button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table id="suppliersTable">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>الاسم</th>
                                    <th>رقم الهاتف</th>
                                    <th>البريد الإلكتروني</th>
                                    <th>إجمالي المشتريات</th>
                                    <th>الديون الحالية</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- سيتم ملء بيانات الموردين ديناميكيا -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
            
            <!-- الدفعات والمصروفات -->
            <section class="section" id="payments">
                <h2 class="section-title"><i class="fas fa-money-bill-wave"></i> الدفعات والمصروفات</h2>
                
                <div class="tabs">
                    <div class="tab active" data-tab="customerPayments">دفعات العملاء</div>
                    <div class="tab" data-tab="supplierPayments">دفعات الموردين</div>
                    <div class="tab" data-tab="expenses">المصروفات</div>
                </div>
                
                <!-- تبويب دفعات العملاء -->
                <div class="tab-content active" id="customerPaymentsTab">
                    <div class="search-container">
                        <div class="search-box">
                            <input type="text" id="customerPaymentSearch" class="search-input" placeholder="ابحث عن دفعة عميل...">
                            <button class="btn"><i class="fas fa-search"></i> بحث</button>
                            <button class="btn btn-success" onclick="openAddCustomerPaymentModal()"><i class="fas fa-money-bill"></i> إضافة دفعة عميل</button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table id="customerPaymentsTable">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>العميل</th>
                                    <th>المبلغ</th>
                                    <th>التاريخ</th>
                                    <th>الطريقة</th>
                                    <th>ملاحظات</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- سيتم ملء بيانات دفعات العملاء ديناميكيا -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- تبويب دفعات الموردين -->
                <div class="tab-content" id="supplierPaymentsTab">
                    <div class="search-container">
                        <div class="search-box">
                            <input type="text" id="supplierPaymentSearch" class="search-input" placeholder="ابحث عن دفعة مورد...">
                            <button class="btn"><i class="fas fa-search"></i> بحث</button>
                            <button class="btn btn-success" onclick="openAddSupplierPaymentModal()"><i class="fas fa-money-bill"></i> إضافة دفعة مورد</button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table id="supplierPaymentsTable">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>المورد</th>
                                    <th>المبلغ</th>
                                    <th>التاريخ</th>
                                    <th>الطريقة</th>
                                    <th>ملاحظات</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- سيتم ملء بيانات دفعات الموردين ديناميكيا -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- تبويب المصروفات -->
                <div class="tab-content" id="expensesTab">
                    <div class="search-container">
                        <div class="search-box">
                            <input type="text" id="expenseSearch" class="search-input" placeholder="ابحث عن مصروف...">
                            <button class="btn"><i class="fas fa-search"></i> بحث</button>
                            <button class="btn btn-success" onclick="openAddExpenseModal()"><i class="fas fa-money-bill"></i> إضافة مصروف</button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table id="expensesTable">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>النوع</th>
                                    <th>المبلغ</th>
                                    <th>التاريخ</th>
                                    <th>المستلم</th>
                                    <th>ملاحظات</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- سيتم ملء بيانات المصروفات ديناميكيا -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
            
            <!-- الفواتير -->
            <section class="section" id="invoices">
                <h2 class="section-title"><i class="fas fa-file-invoice"></i> الفواتير</h2>
                
                <div class="search-container">
                    <div class="search-box">
                        <input type="text" id="invoiceSearch" class="search-input" placeholder="ابحث برقم الفاتورة أو اسم العميل..." onkeyup="searchInvoices()">
                        <button class="btn"><i class="fas fa-search"></i> بحث</button>
                        <button class="btn btn-info" onclick="exportInvoices()"><i class="fas fa-file-export"></i> تصدير</button>
                    </div>
                </div>
                
                <div class="table-container">
                    <table id="invoicesTable">
                        <thead>
                            <tr>
                                <th>رقم الفاتورة</th>
                                <th>التاريخ</th>
                                <th>العميل</th>
                                <th>إجمالي الفاتورة</th>
                                <th>طريقة الدفع</th>
                                <th>الحالة</th>
                                <th>الإجراءات</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- سيتم ملء بيانات الفواتير ديناميكيا -->
                        </tbody>
                    </table>
                </div>
            </section>
            
            <!-- التقارير -->
            <section class="section" id="reports">
                <h2 class="section-title"><i class="fas fa-chart-bar"></i> التقارير والإحصائيات</h2>
                
                <div class="search-container">
                    <div class="search-box">
                        <select id="reportType" class="search-input" style="flex: 1;">
                            <option value="daily">تقرير يومي</option>
                            <option value="weekly">تقرير أسبوعي</option>
                            <option value="monthly">تقرير شهري</option>
                            <option value="yearly">تقرير سنوي</option>
                        </select>
                        <input type="date" id="reportDate" class="search-input" style="width: 200px;">
                        <button class="btn" onclick="generateReport()"><i class="fas fa-chart-line"></i> توليد التقرير</button>
                        <button class="btn btn-info" onclick="printReport()"><i class="fas fa-print"></i> طباعة التقرير</button>
                    </div>
                </div>
                
                <div id="reportResults">
                    <!-- سيتم عرض نتائج التقرير هنا -->
                </div>
            </section>
            
            <!-- المستخدمين والصلاحيات -->
            <section class="section" id="users">
                <h2 class="section-title"><i class="fas fa-user-shield"></i> المستخدمين والصلاحيات</h2>
                
                <div class="tabs">
                    <div class="tab active" data-tab="users">المستخدمين</div>
                    <div class="tab" data-tab="roles">الصلاحيات</div>
                </div>
                
                <!-- تبويب المستخدمين -->
                <div class="tab-content active" id="usersTab">
                    <div class="search-container">
                        <div class="search-box">
                            <input type="text" id="userSearch" class="search-input" placeholder="ابحث عن مستخدم...">
                            <button class="btn"><i class="fas fa-search"></i> بحث</button>
                            <button class="btn btn-success" onclick="openAddUserModal()"><i class="fas fa-user-plus"></i> إضافة مستخدم جديد</button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table id="usersTable">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>اسم المستخدم</th>
                                    <th>الاسم الكامل</th>
                                    <th>الدور</th>
                                    <th>تاريخ الإنشاء</th>
                                    <th>الحالة</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- سيتم ملء بيانات المستخدمين ديناميكيا -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- تبويب الصلاحيات -->
                <div class="tab-content" id="rolesTab">
                    <div class="search-container">
                        <div class="search-box">
                            <input type="text" id="roleSearch" class="search-input" placeholder="ابحث عن صلاحية...">
                            <button class="btn"><i class="fas fa-search"></i> بحث</button>
                            <button class="btn btn-success" onclick="openAddRoleModal()"><i class="fas fa-plus"></i> إضافة صلاحية جديدة</button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table id="rolesTable">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>اسم الصلاحية</th>
                                    <th>عدد المستخدمين</th>
                                    <th>الوصف</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- سيتم ملء بيانات الصلاحيات ديناميكيا -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
            
            <!-- الإعدادات -->
            <section class="section" id="settings">
                <h2 class="section-title"><i class="fas fa-cog"></i> الإعدادات</h2>
                
                <div class="tabs">
                    <div class="tab active" data-tab="general">عام</div>
                    <div class="tab" data-tab="printing">الطباعة</div>
                    <div class="tab" data-tab="products">المنتجات</div>
                    <div class="tab" data-tab="company">الشركة</div>
                </div>
                
                <!-- تبويب الإعدادات العامة -->
                <div class="tab-content active" id="generalTab">
                    <div class="search-container">
                        <div class="search-box" style="flex-direction: column; align-items: flex-start; gap: 25px;">
                            <div style="width: 100%;">
                                <h3 style="margin-bottom: 15px;">تغيير كلمة المرور</h3>
                                <div class="form-group">
                                    <label>كلمة المرور الحالية</label>
                                    <input type="password" id="currentPassword" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label>كلمة المرور الجديدة</label>
                                    <input type="password" id="newPassword" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label>تأكيد كلمة المرور الجديدة</label>
                                    <input type="password" id="confirmPassword" class="form-control">
                                </div>
                                <button class="btn btn-success" style="width: auto; padding: 12px 40px;" onclick="changePassword()">
                                    <i class="fas fa-save"></i> تغيير كلمة المرور
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- تبويب إعدادات الطباعة -->
                <div class="tab-content" id="printingTab">
                    <div class="search-container">
                        <div class="search-box" style="flex-direction: column; align-items: flex-start; gap: 25px;">
                            <div style="width: 100%;">
                                <h3 style="margin-bottom: 15px;">إعدادات الطباعة</h3>
                                <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                                    <label style="display: flex; align-items: center; gap: 10px;">
                                        <input type="checkbox" id="autoPrint" checked> الطباعة التلقائية بعد البيع
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 10px;">
                                        <input type="checkbox" id="showPrintOptions" checked> عرض خيارات الطباعة
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 10px;">
                                        <input type="checkbox" id="showBarcodeInInvoice"> إظهار الباركود في الفاتورة
                                    </label>
                                </div>
                            </div>
                            
                            <div style="width: 100%;">
                                <h3 style="margin-bottom: 15px;">إعدادات الفواتير</h3>
                                <div class="form-group">
                                    <label>تذييل الفاتورة</label>
                                    <textarea id="invoiceFooter" class="form-control" rows="3" placeholder="النص الذي يظهر في أسفل الفاتورة..."></textarea>
                                </div>
                            </div>
                            
                            <button class="btn" style="width: auto; padding: 12px 40px;" onclick="savePrintSettings()">
                                <i class="fas fa-save"></i> حفظ الإعدادات
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- تبويب إعدادات المنتجات -->
                <div class="tab-content" id="productsTab">
                    <div class="search-container">
                        <div class="search-box" style="flex-direction: column; align-items: flex-start; gap: 25px;">
                            <div style="width: 100%;">
                                <h3 style="margin-bottom: 15px;">إعدادات المنتجات</h3>
                                <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                                    <label style="display: flex; align-items: center; gap: 10px;">
                                        <input type="checkbox" id="autoGenerateBarcode" checked> توليد الباركود تلقائياً
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 10px;">
                                        <input type="checkbox" id="autoSuggestColors" checked> اقتراح الألوان تلقائياً
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 10px;">
                                        <input type="checkbox" id="lowStockAlert"> تنبيه عند انخفاض الكمية
                                    </label>
                                </div>
                            </div>
                            
                            <div style="width: 100%;">
                                <h3 style="margin-bottom: 15px;">كمية التنبيه</h3>
                                <div class="form-group">
                                    <input type="number" id="lowStockThreshold" class="form-control" placeholder="الحد الأدنى للتنبيه" value="10">
                                </div>
                            </div>
                            
                            <button class="btn" style="width: auto; padding: 12px 40px;" onclick="saveProductSettings()">
                                <i class="fas fa-save"></i> حفظ الإعدادات
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- تبويب إعدادات الشركة -->
                <div class="tab-content" id="companyTab">
                    <div class="search-container">
                        <div class="search-box" style="flex-direction: column; align-items: flex-start; gap: 25px;">
                            <div style="width: 100%;">
                                <h3 style="margin-bottom: 15px;">معلومات الشركة</h3>
                                <div class="form-group">
                                    <label>اسم الشركة</label>
                                    <input type="text" id="companyName" class="form-control" placeholder="اسم الشركة">
                                </div>
                                <div class="form-group">
                                    <label>الشعار</label>
                                    <input type="file" id="companyLogo" class="form-control" accept="image/*">
                                    <div id="logoPreview" style="margin-top: 10px;"></div>
                                </div>
                                <div class="form-group">
                                    <label>العنوان</label>
                                    <textarea id="companyAddress" class="form-control" rows="3" placeholder="عنوان الشركة..."></textarea>
                                </div>
                                <div class="form-group">
                                    <label>رقم الهاتف</label>
                                    <input type="text" id="companyPhone" class="form-control" placeholder="رقم هاتف الشركة">
                                </div>
                            </div>
                            
                            <button class="btn" style="width: auto; padding: 12px 40px;" onclick="saveCompanySettings()">
                                <i class="fas fa-save"></i> حفظ معلومات الشركة
                            </button>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- النسخ الاحتياطي -->
            <section class="section" id="backup">
                <h2 class="section-title"><i class="fas fa-database"></i> النسخ الاحتياطي</h2>
                
                <div class="search-container">
                    <div class="search-box" style="flex-direction: column; align-items: flex-start; gap: 25px;">
                        <div style="width: 100%;">
                            <h3 style="margin-bottom: 15px;">إنشاء نسخة احتياطية</h3>
                            <p style="margin-bottom: 15px; color: #777;">
                                قم بإنشاء نسخة احتياطية من جميع بيانات النظام لحفظها واستعادتها عند الحاجة.
                            </p>
                            <button class="btn btn-success" onclick="createBackup()">
                                <i class="fas fa-download"></i> إنشاء نسخة احتياطية
                            </button>
                        </div>
                        
                        <div style="width: 100%;">
                            <h3 style="margin-bottom: 15px;">استعادة نسخة احتياطية</h3>
                            <div class="form-group">
                                <label>اختر ملف النسخة الاحتياطية</label>
                                <input type="file" id="backupFile" class="form-control" accept=".json">
                            </div>
                            <button class="btn btn-warning" onclick="restoreBackup()">
                                <i class="fas fa-upload"></i> استعادة النسخة الاحتياطية
                            </button>
                        </div>
                        
                        <div style="width: 100%;">
                            <h3 style="margin-bottom: 15px;">النسخ الاحتياطية السابقة</h3>
                            <div class="table-container">
                                <table id="backupsTable">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>اسم الملف</th>
                                            <th>التاريخ</th>
                                            <th>الحجم</th>
                                            <th>الإجراءات</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- سيتم ملء النسخ الاحتياطية ديناميكيا -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- النوافذ المنبثقة -->
    
    <!-- نافذة إضافة منتج -->
    <div class="modal" id="addProductModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-plus"></i> إضافة منتج جديد</h3>
                <button class="close-modal" onclick="closeModal('addProductModal')">&times;</button>
            </div>
            <form id="addProductForm">
                <div class="form-group">
                    <label>اسم المنتج</label>
                    <input type="text" id="productName" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label>سعر الشراء</label>
                    <input type="number" id="purchasePrice" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label>سعر البيع</label>
                    <input type="number" id="salePrice" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label>الكمية</label>
                    <input type="number" id="productQuantity" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label>النوع</label>
                    <select id="productType" class="form-control">
                        <option value="هواتف">هواتف</option>
                        <option value="أجهزة كمبيوتر">أجهزة كمبيوتر</option>
                        <option value="سماعات">سماعات</option>
                        <option value="ساعات ذكية">ساعات ذكية</option>
                        <option value="كاميرات">كاميرات</option>
                        <option value="تابلت">تابلت</option>
                        <option value="أخرى">أخرى</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>اللون</label>
                    <div class="color-suggestions" id="colorSuggestions">
                        <!-- سيتم ملء اقتراحات الألوان ديناميكيا -->
                    </div>
                    <input type="text" id="productColor" class="form-control" placeholder="أدخل لون جديد (كود HEX)">
                    <small style="color: #777;">اضغط على لون من القائمة أو أدخل كود HEX جديد</small>
                </div>
                
                <div class="form-group">
                    <label>باركود</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="productBarcode" class="form-control" placeholder="باركود المنتج">
                        <button type="button" class="btn btn-info" onclick="generateBarcode()">توليد باركود</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>صورة المنتج (اختياري)</label>
                    <input type="file" id="productImage" class="form-control" accept="image/*">
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="btn btn-success" style="flex: 1;">إضافة المنتج</button>
                    <button type="button" class="btn btn-danger" style="flex: 1;" onclick="closeModal('addProductModal')">إلغاء</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- نافذة طباعة الفاتورة A4 -->
    <div class="modal" id="printA4Modal">
        <div class="modal-content" style="max-width: 210mm;">
            <div class="modal-header">
                <h3><i class="fas fa-print"></i> طباعة فاتورة A4</h3>
                <button class="close-modal" onclick="closeModal('printA4Modal')">&times;</button>
            </div>
            <div class="invoice-a4" id="a4InvoiceContent">
                <!-- سيتم ملء محتوى الفاتورة ديناميكيا -->
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-success" onclick="printA4Invoice()"><i class="fas fa-print"></i> طباعة</button>
                <button class="btn btn-danger" onclick="closeModal('printA4Modal')">إغلاق</button>
            </div>
        </div>
    </div>
    
    <!-- نافذة طباعة الباركود -->
    <div class="modal" id="printBarcodeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-barcode"></i> طباعة باركود</h3>
                <button class="close-modal" onclick="closeModal('printBarcodeModal')">&times;</button>
            </div>
            <div class="barcode-container" id="barcodePrintContent">
                <!-- سيتم ملء محتوى الباركود ديناميكيا -->
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-success" onclick="printBarcodeOnly()"><i class="fas fa-print"></i> طباعة الباركود</button>
                <button class="btn btn-danger" onclick="closeModal('printBarcodeModal')">إغلاق</button>
            </div>
        </div>
    </div>
    
    <!-- نافذة تفاصيل العميل -->
    <div class="modal" id="customerDetailsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user"></i> تفاصيل العميل</h3>
                <button class="close-modal" onclick="closeModal('customerDetailsModal')">&times;</button>
            </div>
            <div class="tabs">
                <div class="tab active" data-tab="customerInfo">معلومات العميل</div>
                <div class="tab" data-tab="customerInvoices">فواتير العميل</div>
                <div class="tab" data-tab="customerPayments">دفعات العميل</div>
                <div class="tab" data-tab="customerReport">تقرير العميل</div>
            </div>
            
            <div class="tab-content active" id="customerInfoTab">
                <!-- سيتم ملء معلومات العميل ديناميكيا -->
            </div>
            
            <div class="tab-content" id="customerInvoicesTab">
                <!-- سيتم ملء فواتير العميل ديناميكيا -->
            </div>
            
            <div class="tab-content" id="customerPaymentsTab">
                <!-- سيتم ملء دفعات العميل ديناميكيا -->
            </div>
            
            <div class="tab-content" id="customerReportTab">
                <!-- سيتم ملء تقرير العميل ديناميكيا -->
            </div>
        </div>
    </div>
    
    <!-- نافذة تفاصيل المورد -->
    <div class="modal" id="supplierDetailsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-truck"></i> تفاصيل المورد</h3>
                <button class="close-modal" onclick="closeModal('supplierDetailsModal')">&times;</button>
            </div>
            <div class="tabs">
                <div class="tab active" data-tab="supplierInfo">معلومات المورد</div>
                <div class="tab" data-tab="supplierPurchases">مشتريات من المورد</div>
                <div class="tab" data-tab="supplierPayments">دفعات للمورد</div>
                <div class="tab" data-tab="supplierReport">تقرير المورد</div>
            </div>
            
            <div class="tab-content active" id="supplierInfoTab">
                <!-- سيتم ملء معلومات المورد ديناميكيا -->
            </div>
            
            <div class="tab-content" id="supplierPurchasesTab">
                <!-- سيتم ملء مشتريات المورد ديناميكيا -->
            </div>
            
            <div class="tab-content" id="supplierPaymentsTab">
                <!-- سيتم ملء دفعات المورد ديناميكيا -->
            </div>
            
            <div class="tab-content" id="supplierReportTab">
                <!-- سيتم ملء تقرير المورد ديناميكيا -->
            </div>
        </div>
    </div>
    
    <!-- نافذة إضافة عميل جديد -->
    <div class="modal" id="addCustomerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user-plus"></i> إضافة عميل جديد</h3>
                <button class="close-modal" onclick="closeModal('addCustomerModal')">&times;</button>
            </div>
            
            <form id="addCustomerForm">
                <div class="form-group">
                    <label>الاسم الكامل *</label>
                    <input type="text" id="newCustomerName" class="form-control" placeholder="أدخل الاسم الكامل" required>
                </div>
                
                <div class="form-group">
                    <label>رقم الهاتف *</label>
                    <input type="tel" id="newCustomerPhone" class="form-control" placeholder="أدخل رقم الهاتف" required>
                </div>
                
                <div class="form-group">
                    <label>البريد الإلكتروني (اختياري)</label>
                    <input type="email" id="newCustomerEmail" class="form-control" placeholder="أدخل البريد الإلكتروني">
                </div>
                
                <div class="form-group">
                    <label>العنوان (اختياري)</label>
                    <textarea id="newCustomerAddress" class="form-control" rows="3" placeholder="أدخل العنوان"></textarea>
                </div>
                
                <div class="form-group">
                    <label>الديون السابقة (اختياري)</label>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="number" id="newCustomerPreviousDebt" class="form-control" placeholder="مبلغ الديون السابقة" value="0" style="flex: 1;">
                        <span>د.ع</span>
                    </div>
                    <small style="color: #777;">إذا كان العميل مديناً من قبل، أدخل المبلغ هنا</small>
                </div>
                
                <div class="form-group">
                    <label>ملاحظات إضافية (اختياري)</label>
                    <textarea id="newCustomerNotes" class="form-control" rows="3" placeholder="ملاحظات إضافية عن العميل"></textarea>
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="btn btn-success" style="flex: 1;">حفظ العميل</button>
                    <button type="button" class="btn btn-danger" style="flex: 1;" onclick="closeModal('addCustomerModal')">إلغاء</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- نافذة إضافة مورد جديد -->
    <div class="modal" id="addSupplierModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-truck"></i> إضافة مورد جديد</h3>
                <button class="close-modal" onclick="closeModal('addSupplierModal')">&times;</button>
            </div>
            
            <form id="addSupplierForm">
                <div class="form-group">
                    <label>اسم المورد / الشركة *</label>
                    <input type="text" id="newSupplierName" class="form-control" placeholder="أدخل اسم المورد أو الشركة" required>
                </div>
                
                <div class="form-group">
                    <label>رقم الهاتف *</label>
                    <input type="tel" id="newSupplierPhone" class="form-control" placeholder="أدخل رقم الهاتف" required>
                </div>
                
                <div class="form-group">
                    <label>البريد الإلكتروني (اختياري)</label>
                    <input type="email" id="newSupplierEmail" class="form-control" placeholder="أدخل البريد الإلكتروني">
                </div>
                
                <div class="form-group">
                    <label>العنوان (اختياري)</label>
                    <textarea id="newSupplierAddress" class="form-control" rows="3" placeholder="أدخل العنوان"></textarea>
                </div>
                
                <div class="form-group">
                    <label>نوع المورد (اختياري)</label>
                    <select id="newSupplierType" class="form-control">
                        <option value="مورد إلكترونيات">مورد إلكترونيات</option>
                        <option value="مورد هواتف">مورد هواتف</option>
                        <option value="مورد أجهزة كمبيوتر">مورد أجهزة كمبيوتر</option>
                        <option value="مورد قطع غيار">مورد قطع غيار</option>
                        <option value="مورد عام">مورد عام</option>
                        <option value="أخرى">أخرى</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>الديون الحالية للمورد (اختياري)</label>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="number" id="newSupplierDebt" class="form-control" placeholder="مبلغ الديون الحالية" value="0" style="flex: 1;">
                        <span>د.ع</span>
                    </div>
                    <small style="color: #777;">إذا كنت مديناً للمورد من قبل، أدخل المبلغ هنا</small>
                </div>
                
                <div class="form-group">
                    <label>ملاحظات إضافية (اختياري)</label>
                    <textarea id="newSupplierNotes" class="form-control" rows="3" placeholder="ملاحظات إضافية عن المورد"></textarea>
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="btn btn-success" style="flex: 1;">حفظ المورد</button>
                    <button type="button" class="btn btn-danger" style="flex: 1;" onclick="closeModal('addSupplierModal')">إلغاء</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- نافذة إضافة عملية شراء -->
    <div class="modal" id="addPurchaseModal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h3><i class="fas fa-shopping-cart"></i> عملية شراء جديدة</h3>
                <button class="close-modal" onclick="closeModal('addPurchaseModal')">&times;</button>
            </div>
            
            <div class="tabs">
                <div class="tab active" data-tab="purchaseInfo">معلومات الشراء</div>
                <div class="tab" data-tab="purchaseItems">المنتجات</div>
                <div class="tab" data-tab="purchaseSummary">الملخص</div>
            </div>
            
            <!-- تبويب معلومات الشراء -->
            <div class="tab-content active" id="purchaseInfoTab">
                <div style="padding: 20px;">
                    <div class="form-group">
                        <label>اختر المورد *</label>
                        <div class="search-box">
                            <input type="text" id="supplierSearchPurchase" class="search-input" placeholder="ابحث عن المورد..." onkeyup="searchSuppliersForPurchase()" required>
                            <button type="button" class="btn" onclick="openAddSupplierModalFromPurchase()"><i class="fas fa-plus"></i> مورد جديد</button>
                        </div>
                        <div id="supplierSuggestionsPurchase" style="display: none; background: white; border: 1px solid #ddd; border-radius: 10px; max-height: 200px; overflow-y: auto; position: absolute; width: calc(100% - 30px); z-index: 100; margin-top: 5px;"></div>
                    </div>
                    
                    <div id="selectedSupplierInfoPurchase" style="margin-top: 15px; display: none;">
                        <div style="padding: 15px; background: #f0f8ff; border-radius: 10px;">
                            <h4>معلومات المورد المحدد</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
                                <div><strong>الاسم:</strong> <span id="selectedSupplierName">-</span></div>
                                <div><strong>الهاتف:</strong> <span id="selectedSupplierPhone">-</span></div>
                                <div><strong>النوع:</strong> <span id="selectedSupplierType">-</span></div>
                                <div><strong>الديون الحالية:</strong> <span id="selectedSupplierDebt">0</span> د.ع</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>تاريخ الشراء *</label>
                        <input type="date" id="purchaseDate" class="form-control" value="${new Date().toISOString().split('T')[0]}" required>
                    </div>
                    
                    <div class="form-group">
                        <label>طريقة الدفع *</label>
                        <div style="display: flex; gap: 20px; margin-top: 10px;">
                            <label style="display: flex; align-items: center; gap: 10px;">
                                <input type="radio" name="purchasePaymentType" value="cash" checked> نقداً
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px;">
                                <input type="radio" name="purchasePaymentType" value="credit"> بالدين
                            </label>
                        </div>
                    </div>
                    
                    <div id="purchaseCreditSection" style="display: none; margin-top: 20px; padding: 15px; background: #fff8e1; border-radius: 10px;">
                        <h4>معلومات الدين</h4>
                        <div class="form-group">
                            <label>تاريخ الاستحقاق</label>
                            <input type="date" id="purchaseDueDate" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>ملاحظات على الدين (اختياري)</label>
                            <textarea id="purchaseCreditNotes" class="form-control" rows="2" placeholder="ملاحظات إضافية حول الدين..."></textarea>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>ملاحظات عامة (اختياري)</label>
                        <textarea id="purchaseNotes" class="form-control" rows="3" placeholder="ملاحظات إضافية حول عملية الشراء..."></textarea>
                    </div>
                    
                    <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">
                        <button class="btn" onclick="switchTab('purchaseItemsTab')">
                            <i class="fas fa-arrow-right"></i> التالي إلى المنتجات
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- تبويب المنتجات -->
            <div class="tab-content" id="purchaseItemsTab">
                <div style="padding: 20px;">
                    <div class="search-container" style="margin-bottom: 20px;">
                        <div class="search-box">
                            <input type="text" id="productSearchPurchase" class="search-input" placeholder="ابحث عن المنتج بالاسم أو النوع..." onkeyup="searchProductsForPurchase()">
                            <button class="btn" onclick="refreshProductsForPurchase()"><i class="fas fa-sync-alt"></i> تحديث</button>
                        </div>
                    </div>
                    
                    <div id="purchaseProductsGrid" class="products-grid" style="max-height: 400px; overflow-y: auto; margin-bottom: 20px; padding: 10px; border: 1px solid #eee; border-radius: 10px;">
                        <!-- سيتم ملء المنتجات ديناميكيا -->
                    </div>
                    
                    <div style="background: #f9f9f9; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                        <h4 style="margin-bottom: 10px;">سلة مشتريات المنتجات</h4>
                        <div class="table-container" style="background: white;">
                            <table style="width: 100%;">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>المنتج</th>
                                        <th>النوع</th>
                                        <th>الكمية</th>
                                        <th>سعر الشراء</th>
                                        <th>سعر البيع الحالي</th>
                                        <th>سعر البيع الجديد</th>
                                        <th>الإجمالي</th>
                                        <th>الإجراءات</th>
                                    </tr>
                                </thead>
                                <tbody id="purchaseCartItems">
                                    <!-- سيتم ملء عناصر سلة المشتريات ديناميكيا -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; margin-top: 20px;">
                        <button class="btn" onclick="switchTab('purchaseInfoTab')">
                            <i class="fas fa-arrow-left"></i> السابق
                        </button>
                        <button class="btn" onclick="switchTab('purchaseSummaryTab')">
                            التالي إلى الملخص <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- تبويب الملخص -->
            <div class="tab-content" id="purchaseSummaryTab">
                <div style="padding: 20px;">
                    <div style="background: #f0f8ff; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <h4>ملخص عملية الشراء</h4>
                        
                        <div id="purchaseSummaryInfo" style="margin-top: 15px;">
                            <!-- سيتم ملء معلومات الملخص ديناميكيا -->
                        </div>
                    </div>
                    
                    <div style="background: #fff8e1; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <h4>إجماليات الفاتورة</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">
                            <div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                    <span>إجمالي المنتجات:</span>
                                    <span style="font-weight: 700;" id="purchaseSubtotal">0 د.ع</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                    <span>الخصم:</span>
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <input type="number" id="purchaseDiscountInput" style="width: 120px; padding: 5px; border: 1px solid #ddd; border-radius: 5px;" value="0" onchange="updatePurchaseSummary()">
                                        <span>د.ع</span>
                                    </div>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-top: 15px; padding-top: 15px; border-top: 2px solid #ddd;">
                                    <span style="font-size: 18px; font-weight: 700;">الإجمالي النهائي:</span>
                                    <span style="font-size: 20px; font-weight: 800; color: var(--primary);" id="purchaseTotalAmount">0 د.ع</span>
                                </div>
                            </div>
                            
                            <div style="border-right: 2px solid #eee; padding-right: 20px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                    <span>عدد المنتجات:</span>
                                    <span id="purchaseProductsCount">0</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                    <span>إجمالي الكميات:</span>
                                    <span id="purchaseTotalQuantity">0</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                    <span>طريقة الدفع:</span>
                                    <span id="purchasePaymentMethod">نقداً</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; margin-top: 20px;">
                        <button class="btn" onclick="switchTab('purchaseItemsTab')">
                            <i class="fas fa-arrow-left"></i> السابق
                        </button>
                        <button class="btn btn-success" onclick="completePurchase()">
                            <i class="fas fa-check-circle"></i> إتمام عملية الشراء
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // بيانات النظام
        let systemData = {
            users: [
                { id: 1, username: "admin", password: "farzad1234", fullName: "مدير النظام", role: "مدير", createdAt: "2023-01-01", active: true }
            ],
            products: [
                { id: 1, name: "هاتف سامسونج جالاكسي S23", purchasePrice: 1000000, salePrice: 1250000, quantity: 50, type: "هواتف", color: "#000000", barcode: "123456789012", image: "mobile-alt" },
                { id: 2, name: "لاب توب ديل XPS 13", purchasePrice: 1500000, salePrice: 1850000, quantity: 30, type: "أجهزة كمبيوتر", color: "#808080", barcode: "123456789013", image: "laptop" },
                { id: 3, name: "سماعات سوني WH-1000XM5", purchasePrice: 350000, salePrice: 450000, quantity: 100, type: "سماعات", color: "#000000", barcode: "123456789014", image: "headphones" },
                { id: 4, name: "ساعة أبل ووتش سيريز 8", purchasePrice: 600000, salePrice: 750000, quantity: 40, type: "ساعات ذكية", color: "#FFFFFF", barcode: "123456789015", image: "clock" },
                { id: 5, name: "كاميرا كانون EOS R6", purchasePrice: 2500000, salePrice: 3200000, quantity: 20, type: "كاميرات", color: "#000000", barcode: "123456789016", image: "camera" },
                { id: 6, name: "تابلت سامسونج تاب S8", purchasePrice: 750000, salePrice: 950000, quantity: 60, type: "تابلت", color: "#808080", barcode: "123456789017", image: "tablet-alt" }
            ],
            customers: [
                { id: 1, name: "أحمد محمد", phone: "07701234567", email: "ahmed@example.com", address: "بغداد", totalPurchases: 1250000, debt: 150000, previousDebt: 0, notes: "", createdAt: "2023-01-15", active: true },
                { id: 2, name: "سارة علي", phone: "07702345678", email: "sara@example.com", address: "البصرة", totalPurchases: 850000, debt: 0, previousDebt: 0, notes: "", createdAt: "2023-02-10", active: true },
                { id: 3, name: "عمر خالد", phone: "07703456789", email: "omar@example.com", address: "الموصل", totalPurchases: 2100000, debt: 300000, previousDebt: 50000, notes: "", createdAt: "2023-03-05", active: true }
            ],
            suppliers: [
                { id: 1, name: "شركة الإلكترونيات المتقدمة", phone: "07704567890", email: "info@advanced.com", address: "بغداد", type: "مورد إلكترونيات", totalPurchases: 5000000, debt: 250000, previousDebt: 0, notes: "", createdAt: "2023-01-01", active: true },
                { id: 2, name: "مورد الأجهزة الذكية", phone: "07705678901", email: "contact@smartdevices.com", address: "أربيل", type: "مورد هواتف", totalPurchases: 3200000, debt: 0, previousDebt: 0, notes: "", createdAt: "2023-02-15", active: true },
                { id: 3, name: "شركة الكمبيوتر المتطور", phone: "07706789012", email: "info@computer.com", address: "بغداد", type: "مورد أجهزة كمبيوتر", totalPurchases: 1800000, debt: 120000, previousDebt: 120000, notes: "مورد جيد للمعدات المكتبية", createdAt: "2023-03-20", active: true }
            ],
            invoices: [],
            purchases: [],
            customerPayments: [],
            supplierPayments: [],
            expenses: [],
            settings: {
                companyName: "متجر الإلكترونيات",
                companyAddress: "بغداد - المنصور",
                companyPhone: "07700000000",
                autoPrint: true,
                showPrintOptions: true,
                autoGenerateBarcode: true,
                autoSuggestColors: true,
                lowStockAlert: false,
                lowStockThreshold: 10,
                invoiceFooter: "شكراً لتعاملكم معنا"
            },
            colorSuggestions: [
                '#FF0000', '#00FF00', '#0000FF', '#FFFF00', '#FF00FF', '#00FFFF',
                '#FFA500', '#800080', '#008080', '#FFC0CB', '#A52A2A', '#808080'
            ]
        };

        // العناصر الرئيسية في DOM
        const loginPage = document.getElementById('loginPage');
        const mainSystem = document.getElementById('mainSystem');
        const loginForm = document.getElementById('loginForm');
        const logoutBtn = document.getElementById('logoutBtn');
        const menuToggle = document.getElementById('menuToggle');
        const sidebar = document.getElementById('sidebar');
        const sidebarLinks = document.querySelectorAll('.sidebar-menu a');
        const sections = document.querySelectorAll('.section');
        const cartItems = document.getElementById('cartItems');
        const productsGrid = document.getElementById('productsGrid');
        const printSmall = document.getElementById('printSmall');
        const printA4 = document.getElementById('printA4');
        
        // سلة المشتريات
        let cart = [];
        let currentCustomerId = null;
        let invoiceCounter = 1;

        // بيانات سلة المشتريات
        let purchaseCart = [];
        let selectedPurchaseSupplierId = null;
        let currentPurchaseSupplier = null;

        // ============================================
        // نظام الدخول والخروج
        // ============================================

        // تسجيل الدخول
        loginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // التحقق من بيانات الدخول
            const user = systemData.users.find(u => u.username === username && u.password === password);
            
            if (user) {
                // إخفاء صفحة تسجيل الدخول وإظهار النظام الرئيسي
                loginPage.style.display = 'none';
                mainSystem.style.display = 'block';
                
                // تحميل بيانات النظام
                loadSystemData();
            } else {
                alert('اسم المستخدم أو كلمة المرور غير صحيحة');
            }
        });
        
        // تسجيل الخروج
        logoutBtn.addEventListener('click', function() {
            mainSystem.style.display = 'none';
            loginPage.style.display = 'flex';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            cart = [];
            currentCustomerId = null;
            purchaseCart = [];
            selectedPurchaseSupplierId = null;
            currentPurchaseSupplier = null;
        });
        
        // تبديل القائمة الجانبية على الأجهزة الصغيرة
        menuToggle.addEventListener('click', function() {
            sidebar.classList.toggle('active');
        });
        
        // تبديل بين الأقسام
        sidebarLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                // إزالة النشاط من جميع الروابط
                sidebarLinks.forEach(l => l.classList.remove('active'));
                
                // إضافة النشاط للرابط المختار
                this.classList.add('active');
                
                // إخفاء جميع الأقسام
                sections.forEach(section => section.classList.remove('active'));
                
                // إظهار القسم المختار
                const sectionId = this.getAttribute('data-section');
                document.getElementById(sectionId).classList.add('active');
                
                // إغلاق القائمة الجانبية على الأجهزة الصغيرة
                if (window.innerWidth <= 992) {
                    sidebar.classList.remove('active');
                }
            });
        });
        
        // ============================================
        // تحميل بيانات النظام
        // ============================================
        
        // تحميل بيانات النظام
        function loadSystemData() {
            // تحميل المنتجات في قسم المبيعات
            loadProducts();
            
            // تحميل بيانات المخزون
            loadInventory();
            
            // تحميل بيانات العملاء
            loadCustomers();
            
            // تحميل بيانات الموردين
            loadSuppliers();
            
            // تحميل الفواتير
            loadInvoices();
            
            // تحميل المشتريات
            loadPurchases();
            
            // تحميل أحدث الفواتير في لوحة التحكم
            loadRecentInvoices();
            
            // تحميل إعدادات الطباعة
            loadPrintSettings();
            
            // تحميل اقتراحات الألوان
            loadColorSuggestions();
            
            // إضافة أحداث للتبويبات
            setupTabs();
            
            // إضافة أحداث لخيارات الدفع
            setupPaymentEvents();
            
            // إضافة أحداث للطباعة
            setupPrintEvents();
        }
        
        // ============================================
        // نظام المنتجات والمخزون
        // ============================================
        
        // تحميل المنتجات
        function loadProducts() {
            productsGrid.innerHTML = '';
            systemData.products.forEach(product => {
                const productIcon = getProductIcon(product.type);
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                productCard.innerHTML = `
                    <div class="product-img" style="background: linear-gradient(135deg, ${product.color || '#4361ee'}, #3a0ca3);">
                        <i class="fas fa-${productIcon}" style="color: white;"></i>
                    </div>
                    <div class="product-info">
                        <div class="product-name">${product.name}</div>
                        <div class="product-type" style="font-size: 14px; color: #777; margin-bottom: 10px;">${product.type}</div>
                        <div class="product-price">${product.salePrice.toLocaleString()} د.ع</div>
                        <button class="btn" style="padding: 8px 15px; font-size: 14px;" onclick="addToCart(${product.id})">
                            <i class="fas fa-cart-plus"></i> إضافة للسلة
                        </button>
                    </div>
                `;
                productsGrid.appendChild(productCard);
            });
        }
        
        // الحصول على أيقونة المنتج حسب النوع
        function getProductIcon(type) {
            const icons = {
                'هواتف': 'mobile-alt',
                'أجهزة كمبيوتر': 'laptop',
                'سماعات': 'headphones',
                'ساعات ذكية': 'clock',
                'كاميرات': 'camera',
                'تابلت': 'tablet-alt',
                'أخرى': 'box'
            };
            
            return icons[type] || 'box';
        }
        
        // تحميل المخزون
        function loadInventory() {
            const inventoryTable = document.querySelector('#inventoryTable tbody');
            inventoryTable.innerHTML = '';
            systemData.products.forEach((product, index) => {
                const productIcon = getProductIcon(product.type);
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${product.name}</td>
                    <td><i class="fas fa-${productIcon}" style="font-size: 24px; color: ${product.color || '#4361ee'};"></i></td>
                    <td>${product.quantity}</td>
                    <td>${product.purchasePrice.toLocaleString()} د.ع</td>
                    <td>${product.salePrice.toLocaleString()} د.ع</td>
                    <td>${product.type}</td>
                    <td><div style="width: 20px; height: 20px; background: ${product.color || '#000000'}; border-radius: 50%;"></div></td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-small btn-edit" onclick="editProduct(${product.id})"><i class="fas fa-edit"></i></button>
                            <button class="btn-small btn-delete" onclick="deleteProduct(${product.id})"><i class="fas fa-trash"></i></button>
                            <button class="btn-small btn-print" onclick="openPrintBarcodeModal(${product.id})"><i class="fas fa-barcode"></i></button>
                        </div>
                    </td>
                `;
                inventoryTable.appendChild(row);
            });
        }
        
        // ============================================
        // نظام العملاء والموردين
        // ============================================
        
        // تحميل العملاء
        function loadCustomers() {
            const customersTable = document.querySelector('#customersTable tbody');
            if (customersTable) {
                customersTable.innerHTML = '';
                systemData.customers.forEach((customer, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${customer.name}</td>
                        <td>${customer.phone}</td>
                        <td>${customer.email || '-'}</td>
                        <td>${customer.totalPurchases.toLocaleString()} د.ع</td>
                        <td>
                            <span style="color: ${customer.debt > 0 ? '#e74c3c' : '#2ecc71'}; font-weight: bold;">
                                ${customer.debt.toLocaleString()} د.ع
                            </span>
                        </td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn-small btn-edit" onclick="editCustomer(${customer.id})"><i class="fas fa-edit"></i></button>
                                <button class="btn-small btn-delete" onclick="deleteCustomer(${customer.id})"><i class="fas fa-trash"></i></button>
                                <button class="btn-small btn-view" onclick="openCustomerDetailsModal(${customer.id})"><i class="fas fa-eye"></i></button>
                            </div>
                        </td>
                    `;
                    customersTable.appendChild(row);
                });
            }
        }
        
        // تحميل الموردين
        function loadSuppliers() {
            const suppliersTable = document.querySelector('#suppliersTable tbody');
            if (suppliersTable) {
                suppliersTable.innerHTML = '';
                systemData.suppliers.forEach((supplier, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${supplier.name}</td>
                        <td>${supplier.phone}</td>
                        <td>${supplier.email || '-'}</td>
                        <td>${supplier.totalPurchases.toLocaleString()} د.ع</td>
                        <td>
                            <span style="color: ${supplier.debt > 0 ? '#e74c3c' : '#2ecc71'}; font-weight: bold;">
                                ${supplier.debt.toLocaleString()} د.ع
                            </span>
                        </td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn-small btn-edit" onclick="editSupplier(${supplier.id})"><i class="fas fa-edit"></i></button>
                                <button class="btn-small btn-delete" onclick="deleteSupplier(${supplier.id})"><i class="fas fa-trash"></i></button>
                                <button class="btn-small btn-view" onclick="openSupplierDetailsModal(${supplier.id})"><i class="fas fa-eye"></i></button>
                            </div>
                        </td>
                    `;
                    suppliersTable.appendChild(row);
                });
            }
        }
        
        // ============================================
        // نظام الفواتير
        // ============================================
        
        // تحميل الفواتير
        function loadInvoices() {
            const invoicesTable = document.querySelector('#invoicesTable tbody');
            if (invoicesTable) {
                invoicesTable.innerHTML = '';
                systemData.invoices.forEach((invoice, index) => {
                    const customer = systemData.customers.find(c => c.id === invoice.customerId) || { name: "زائر" };
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${invoice.id}</td>
                        <td>${invoice.date}</td>
                        <td>${customer.name}</td>
                        <td>${invoice.total.toLocaleString()} د.ع</td>
                        <td>${invoice.paymentType === 'cash' ? 'نقداً' : 'بالدين'}</td>
                        <td><span style="padding: 5px 10px; border-radius: 20px; background: #4CAF50; color: white;">مكتمل</span></td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn-small btn-view" onclick="viewInvoice(${invoice.id})"><i class="fas fa-eye"></i></button>
                                <button class="btn-small btn-print" onclick="printInvoice(${invoice.id})"><i class="fas fa-print"></i></button>
                                <button class="btn-small btn-delete" onclick="deleteInvoice(${invoice.id})"><i class="fas fa-trash"></i></button>
                            </div>
                        </td>
                    `;
                    invoicesTable.appendChild(row);
                });
            }
        }
        
        // تحميل المشتريات
        function loadPurchases() {
            const purchasesTable = document.querySelector('#purchasesTable tbody');
            if (purchasesTable) {
                purchasesTable.innerHTML = '';
                
                if (systemData.purchases.length === 0) {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td colspan="7" style="text-align: center; padding: 30px; color: #777;">
                            <i class="fas fa-shopping-cart" style="font-size: 40px; margin-bottom: 15px;"></i>
                            <p>لا توجد فواتير شراء بعد</p>
                            <button class="btn" onclick="openAddPurchaseModal()" style="margin-top: 10px;">
                                <i class="fas fa-plus"></i> إضافة عملية شراء جديدة
                            </button>
                        </td>
                    `;
                    purchasesTable.appendChild(row);
                    return;
                }
                
                systemData.purchases.forEach((purchase, index) => {
                    const supplier = systemData.suppliers.find(s => s.id === purchase.supplierId) || { 
                        name: "غير محدد", 
                        phone: "-" 
                    };
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${purchase.id}</td>
                        <td>${purchase.date}</td>
                        <td>${supplier.name}</td>
                        <td>${purchase.total.toLocaleString()} د.ع</td>
                        <td>
                            <span style="padding: 5px 10px; border-radius: 20px; background: ${purchase.paymentType === 'cash' ? '#4CAF50' : '#FF9800'}; color: white;">
                                ${purchase.paymentType === 'cash' ? 'نقداً' : 'بالدين'}
                            </span>
                        </td>
                        <td><span style="padding: 5px 10px; border-radius: 20px; background: #4CAF50; color: white;">${purchase.status}</span></td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn-small btn-view" onclick="viewPurchase('${purchase.id}')" title="عرض التفاصيل">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn-small btn-print" onclick="printPurchase('${purchase.id}')" title="طباعة">
                                    <i class="fas fa-print"></i>
                                </button>
                                <button class="btn-small btn-delete" onclick="deletePurchase('${purchase.id}')" title="حذف">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    purchasesTable.appendChild(row);
                });
            }
        }
        
        // تحميل أحدث الفواتير
        function loadRecentInvoices() {
            const recentInvoices = document.getElementById('recentInvoices');
            if (recentInvoices) {
                recentInvoices.innerHTML = '';
                const recent = systemData.invoices.slice(-5).reverse();
                recent.forEach(invoice => {
                    const customer = systemData.customers.find(c => c.id === invoice.customerId) || { name: "زائر" };
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${invoice.id}</td>
                        <td>${invoice.date}</td>
                        <td>${customer.name}</td>
                        <td>${invoice.total.toLocaleString()} د.ع</td>
                        <td>${invoice.paymentType === 'cash' ? 'نقداً' : 'بالدين'}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn-small btn-view" onclick="viewInvoice(${invoice.id})"><i class="fas fa-eye"></i></button>
                                <button class="btn-small btn-print" onclick="printInvoice(${invoice.id})"><i class="fas fa-print"></i></button>
                            </div>
                        </td>
                    `;
                    recentInvoices.appendChild(row);
                });
            }
        }
        
        // ============================================
        // الإعدادات
        // ============================================
        
        // تحميل إعدادات الطباعة
        function loadPrintSettings() {
            document.getElementById('autoPrint').checked = systemData.settings.autoPrint;
            document.getElementById('showPrintOptions').checked = systemData.settings.showPrintOptions;
            document.getElementById('autoGenerateBarcode').checked = systemData.settings.autoGenerateBarcode;
            document.getElementById('autoSuggestColors').checked = systemData.settings.autoSuggestColors;
            document.getElementById('lowStockAlert').checked = systemData.settings.lowStockAlert;
            document.getElementById('lowStockThreshold').value = systemData.settings.lowStockThreshold;
            document.getElementById('invoiceFooter').value = systemData.settings.invoiceFooter;
            document.getElementById('companyName').value = systemData.settings.companyName;
            document.getElementById('companyAddress').value = systemData.settings.companyAddress;
            document.getElementById('companyPhone').value = systemData.settings.companyPhone;
        }
        
        // تحميل اقتراحات الألوان
        function loadColorSuggestions() {
            const colorContainer = document.getElementById('colorSuggestions');
            if (colorContainer) {
                colorContainer.innerHTML = '';
                systemData.colorSuggestions.forEach(color => {
                    const colorOption = document.createElement('div');
                    colorOption.className = 'color-option';
                    colorOption.style.backgroundColor = color;
                    colorOption.title = color;
                    colorOption.onclick = function() {
                        document.getElementById('productColor').value = color;
                    };
                    colorContainer.appendChild(colorOption);
                });
            }
        }
        
        // إعداد التبويبات
        function setupTabs() {
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    const parent = this.closest('.section') || this.closest('.modal-content');
                    
                    // إزالة النشاط من جميع التبويبات
                    parent.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    
                    // إضافة النشاط للتبويب المختار
                    this.classList.add('active');
                    
                    // إخفاء جميع محتويات التبويبات
                    parent.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                    
                    // إظهار محتوى التبويب المختار
                    parent.querySelector(`#${tabId}Tab`).classList.add('active');
                });
            });
        }
        
        // إعداد أحداث الدفع
        function setupPaymentEvents() {
            const paymentRadios = document.querySelectorAll('input[name="paymentType"]');
            paymentRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    const creditSection = document.getElementById('creditSection');
                    if (this.value === 'credit') {
                        creditSection.style.display = 'block';
                    } else {
                        creditSection.style.display = 'none';
                    }
                });
            });
        }
        
        // إعداد أحداث الطباعة
        function setupPrintEvents() {
            printSmall.addEventListener('click', function() {
                printSmallInvoice();
            });
            
            printA4.addEventListener('click', function() {
                openPrintA4Modal();
            });
        }
        
        // ============================================
        // نظام البيع (نقطة البيع)
        // ============================================
        
        // البحث عن المنتجات
        function searchProducts() {
            const searchTerm = document.getElementById('productSearch').value.toLowerCase();
            const products = document.querySelectorAll('.product-card');
            
            products.forEach(product => {
                const productName = product.querySelector('.product-name').textContent.toLowerCase();
                const productType = product.querySelector('.product-type').textContent.toLowerCase();
                
                if (productName.includes(searchTerm) || productType.includes(searchTerm)) {
                    product.style.display = 'block';
                } else {
                    product.style.display = 'none';
                }
            });
        }
        
        // البحث عن العملاء
        function searchCustomers() {
            const searchTerm = document.getElementById('customerSearch').value.toLowerCase();
            const suggestions = document.getElementById('customerSuggestions');
            
            if (searchTerm.length === 0) {
                suggestions.style.display = 'none';
                return;
            }
            
            const filteredCustomers = systemData.customers.filter(customer => 
                customer.name.toLowerCase().includes(searchTerm) || 
                customer.phone.includes(searchTerm)
            );
            
            suggestions.innerHTML = '';
            filteredCustomers.forEach(customer => {
                const suggestion = document.createElement('div');
                suggestion.style.padding = '10px';
                suggestion.style.cursor = 'pointer';
                suggestion.style.borderBottom = '1px solid #eee';
                suggestion.innerHTML = `${customer.name} - ${customer.phone}`;
                suggestion.onclick = function() {
                    selectCustomer(customer.id);
                    suggestions.style.display = 'none';
                };
                suggestions.appendChild(suggestion);
            });
            
            suggestions.style.display = 'block';
        }
        
        // اختيار عميل
        function selectCustomer(customerId) {
            currentCustomerId = customerId;
            const customer = systemData.customers.find(c => c.id === customerId);
            
            document.getElementById('customerSearch').value = customer.name;
            document.getElementById('selectedCustomerName').textContent = customer.name;
            document.getElementById('customerPreviousDebt').textContent = customer.debt.toLocaleString();
            
            document.getElementById('selectedCustomerInfo').style.display = 'block';
        }
        
        // إضافة منتج للسلة
        window.addToCart = function(productId) {
            const product = systemData.products.find(p => p.id === productId);
            if (!product) return;
            
            // التحقق من توفر المنتج
            if (product.quantity <= 0) {
                alert('المنتج غير متوفر في المخزون');
                return;
            }
            
            // التحقق إذا كان المنتج موجود بالفعل في السلة
            const existingItem = cart.find(item => item.productId === productId);
            
            if (existingItem) {
                // زيادة الكمية إذا المنتج موجود
                existingItem.quantity += 1;
            } else {
                // إضافة منتج جديد للسلة
                cart.push({
                    productId: productId,
                    name: product.name,
                    price: product.salePrice,
                    quantity: 1,
                    type: product.type
                });
            }
            
            updateCartDisplay();
            updateInvoiceSummary();
        };
        
        // تحديث عرض السلة
        function updateCartDisplay() {
            cartItems.innerHTML = '';
            
            cart.forEach((item, index) => {
                const product = systemData.products.find(p => p.id === item.productId);
                const row = document.createElement('tr');
                row.setAttribute('data-product-id', item.productId);
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${item.name}</td>
                    <td>${item.price.toLocaleString()} د.ع</td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <button class="btn-small" onclick="updateCartQuantity(${item.productId}, -1)" style="padding: 2px 8px;">-</button>
                            <span>${item.quantity}</span>
                            <button class="btn-small" onclick="updateCartQuantity(${item.productId}, 1)" style="padding: 2px 8px;">+</button>
                        </div>
                    </td>
                    <td>${(item.price * item.quantity).toLocaleString()} د.ع</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-small btn-edit" onclick="editCartItem(${item.productId})"><i class="fas fa-edit"></i></button>
                            <button class="btn-small btn-delete" onclick="removeFromCart(${item.productId})"><i class="fas fa-trash"></i></button>
                        </div>
                    </td>
                `;
                cartItems.appendChild(row);
            });
        }
        
        // تحديث كمية المنتج في السلة
        window.updateCartQuantity = function(productId, change) {
            const item = cart.find(item => item.productId === productId);
            if (!item) return;
            
            const product = systemData.products.find(p => p.id === productId);
            
            if (item.quantity + change <= 0) {
                removeFromCart(productId);
            } else if (item.quantity + change > product.quantity) {
                alert(`الكمية المتاحة في المخزون: ${product.quantity}`);
            } else {
                item.quantity += change;
                updateCartDisplay();
                updateInvoiceSummary();
            }
        };
        
        // تعديل عنصر في السلة
        window.editCartItem = function(productId) {
            const item = cart.find(item => item.productId === productId);
            if (!item) return;
            
            const newQuantity = prompt('أدخل الكمية الجديدة:', item.quantity);
            
            if (newQuantity && !isNaN(newQuantity) && newQuantity > 0) {
                const product = systemData.products.find(p => p.id === productId);
                
                if (parseInt(newQuantity) > product.quantity) {
                    alert(`الكمية المتاحة في المخزون: ${product.quantity}`);
                } else {
                    item.quantity = parseInt(newQuantity);
                    updateCartDisplay();
                    updateInvoiceSummary();
                }
            }
        };
        
        // إزالة منتج من السلة
        window.removeFromCart = function(productId) {
            cart = cart.filter(item => item.productId !== productId);
            updateCartDisplay();
            updateInvoiceSummary();
        };
        
        // تفريغ السلة
        window.clearCart = function() {
            if (confirm('هل أنت متأكد من تفريغ السلة؟')) {
                cart = [];
                updateCartDisplay();
                updateInvoiceSummary();
                currentCustomerId = null;
                document.getElementById('customerSearch').value = '';
                document.getElementById('selectedCustomerInfo').style.display = 'none';
            }
        };
        
        // تحديث ملخص الفاتورة
        function updateInvoiceSummary() {
            let subtotal = 0;
            
            cart.forEach(item => {
                subtotal += item.price * item.quantity;
            });
            
            const discount = parseFloat(document.getElementById('discountInput').value) || 0;
            const tax = subtotal * 0.05; // 5% ضريبة
            
            const total = subtotal - discount + tax;
            
            document.getElementById('subtotal').textContent = subtotal.toLocaleString() + ' د.ع';
            document.getElementById('discount').textContent = discount.toLocaleString() + ' د.ع';
            document.getElementById('tax').textContent = tax.toLocaleString() + ' د.ع';
            document.getElementById('totalAmount').textContent = total.toLocaleString() + ' د.ع';
        }
        
        // تطبيق خصم
        window.applyDiscount = function(percentage) {
            let subtotal = 0;
            
            cart.forEach(item => {
                subtotal += item.price * item.quantity;
            });
            
            const discount = subtotal * (percentage / 100);
            document.getElementById('discountInput').value = discount;
            updateInvoiceSummary();
        };
        
        // تحديث الخصم
        window.updateDiscount = function() {
            updateInvoiceSummary();
        };
        
        // إتمام عملية البيع
        window.completeSale = function() {
            if (cart.length === 0) {
                alert('السلة فارغة. الرجاء إضافة منتجات قبل إتمام البيع.');
                return;
            }
            
            const paymentType = document.querySelector('input[name="paymentType"]:checked').value;
            const discount = parseFloat(document.getElementById('discountInput').value) || 0;
            
            // حساب الإجمالي
            let subtotal = 0;
            cart.forEach(item => {
                subtotal += item.price * item.quantity;
            });
            
            const tax = subtotal * 0.05;
            const total = subtotal - discount + tax;
            
            // إنشاء فاتورة
            const invoice = {
                id: `INV-${Date.now()}`,
                date: new Date().toLocaleDateString('ar-EG'),
                time: new Date().toLocaleTimeString('ar-EG'),
                customerId: currentCustomerId,
                items: [...cart],
                subtotal: subtotal,
                discount: discount,
                tax: tax,
                total: total,
                paymentType: paymentType,
                status: 'مكتمل'
            };
            
            // تحديث المخزون
            cart.forEach(item => {
                const product = systemData.products.find(p => p.id === item.productId);
                if (product) {
                    product.quantity -= item.quantity;
                }
            });
            
            // تحديث بيانات العميل إذا كان هناك دين
            if (paymentType === 'credit' && currentCustomerId) {
                const customer = systemData.customers.find(c => c.id === currentCustomerId);
                if (customer) {
                    customer.debt += total;
                    customer.totalPurchases += total;
                }
            }
            
            // إضافة الفاتورة إلى النظام
            systemData.invoices.push(invoice);
            
            // حفظ البيانات
            saveSystemData();
            
            // طباعة الفاتورة إذا كان الإعداد مفعلاً
            if (systemData.settings.autoPrint) {
                printSmallInvoice();
            } else if (systemData.settings.showPrintOptions) {
                alert('تم إتمام البيع بنجاح. الرجاء اختيار خيار الطباعة.');
            } else {
                alert('تم إتمام البيع بنجاح!');
            }
            
            // إعادة تعيين السلة
            cart = [];
            updateCartDisplay();
            updateInvoiceSummary();
            currentCustomerId = null;
            document.getElementById('customerSearch').value = '';
            document.getElementById('selectedCustomerInfo').style.display = 'none';
            document.getElementById('discountInput').value = '';
            
            // تحديث العرض
            loadInventory();
            loadCustomers();
            loadInvoices();
            loadRecentInvoices();
        };
        
        // ============================================
        // نظام الشراء (المشتريات)
        // ============================================
        
        // فتح نافذة إضافة عملية شراء
        window.openAddPurchaseModal = function() {
            // إعادة تعيين البيانات
            purchaseCart = [];
            selectedPurchaseSupplierId = null;
            currentPurchaseSupplier = null;
            
            // إعادة تعيين الحقول
            document.getElementById('supplierSearchPurchase').value = '';
            document.getElementById('selectedSupplierInfoPurchase').style.display = 'none';
            document.getElementById('purchaseDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('purchaseDueDate').value = '';
            document.getElementById('purchaseCreditNotes').value = '';
            document.getElementById('purchaseNotes').value = '';
            document.getElementById('purchaseDiscountInput').value = '0';
            
            // تفعيل الدفع النقدي كخيار افتراضي
            document.querySelector('input[name="purchasePaymentType"][value="cash"]').checked = true;
            document.getElementById('purchaseCreditSection').style.display = 'none';
            
            // تحميل المنتجات للشراء
            loadProductsForPurchase();
            
            // تحديث السلة
            updatePurchaseCartDisplay();
            
            // تحديث الملخص
            updatePurchaseSummary();
            
            // التبديل إلى التبويب الأول
            switchTab('purchaseInfoTab');
            
            // فتح النافذة
            openModal('addPurchaseModal');
        };
        
        // تحميل المنتجات للشراء مع صورها
        function loadProductsForPurchase() {
            const productsGrid = document.getElementById('purchaseProductsGrid');
            productsGrid.innerHTML = '';
            
            if (systemData.products.length === 0) {
                productsGrid.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #777;">
                        <i class="fas fa-box-open" style="font-size: 50px; margin-bottom: 15px;"></i>
                        <p>لا توجد منتجات في النظام</p>
                        <button class="btn" onclick="openAddProductModal()" style="margin-top: 10px;">
                            <i class="fas fa-plus"></i> إضافة منتج جديد
                        </button>
                    </div>
                `;
                return;
            }
            
            systemData.products.forEach(product => {
                const productIcon = getProductIcon(product.type);
                
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                productCard.innerHTML = `
                    <div class="product-img" style="background: linear-gradient(135deg, ${product.color || '#4361ee'}, #3a0ca3);">
                        <i class="fas fa-${productIcon}" style="color: white;"></i>
                    </div>
                    <div class="product-info">
                        <div class="product-name">${product.name}</div>
                        <div class="product-type" style="font-size: 14px; color: #777; margin-bottom: 5px;">
                            <i class="fas fa-tag"></i> ${product.type}
                        </div>
                        <div style="font-size: 14px; color: #555; margin-bottom: 5px;">
                            <i class="fas fa-box"></i> المتاح: ${product.quantity}
                        </div>
                        <div class="product-price" style="color: #f72585; margin-bottom: 10px;">
                            شراء: ${product.purchasePrice.toLocaleString()} د.ع
                        </div>
                        <div style="font-size: 14px; color: #4361ee; margin-bottom: 15px;">
                            بيع: ${product.salePrice.toLocaleString()} د.ع
                        </div>
                        <button class="btn" style="padding: 8px 15px; font-size: 14px; width: 100%;" onclick="addToPurchaseCart(${product.id})">
                            <i class="fas fa-cart-plus"></i> إضافة للشراء
                        </button>
                    </div>
                `;
                productsGrid.appendChild(productCard);
            });
        }
        
        // البحث عن موردين للشراء
        window.searchSuppliersForPurchase = function() {
            const searchTerm = document.getElementById('supplierSearchPurchase').value.toLowerCase().trim();
            const suggestions = document.getElementById('supplierSuggestionsPurchase');
            
            if (searchTerm.length === 0) {
                suggestions.style.display = 'none';
                return;
            }
            
            const filteredSuppliers = systemData.suppliers.filter(supplier => 
                supplier.name.toLowerCase().includes(searchTerm) || 
                supplier.phone.includes(searchTerm) ||
                (supplier.type && supplier.type.toLowerCase().includes(searchTerm))
            );
            
            suggestions.innerHTML = '';
            
            if (filteredSuppliers.length === 0) {
                const suggestion = document.createElement('div');
                suggestion.style.padding = '10px';
                suggestion.style.color = '#777';
                suggestion.style.textAlign = 'center';
                suggestion.innerHTML = 'لا توجد نتائج';
                suggestions.appendChild(suggestion);
            } else {
                filteredSuppliers.forEach(supplier => {
                    const suggestion = document.createElement('div');
                    suggestion.style.padding = '10px';
                    suggestion.style.cursor = 'pointer';
                    suggestion.style.borderBottom = '1px solid #eee';
                    suggestion.style.transition = 'background 0.2s';
                    suggestion.innerHTML = `
                        <div style="font-weight: bold;">${supplier.name}</div>
                        <div style="font-size: 12px; color: #666;">${supplier.phone} | ${supplier.type || 'غير محدد'}</div>
                        <div style="font-size: 12px; color: ${supplier.debt > 0 ? '#e74c3c' : '#27ae60'};">
                            الديون: ${supplier.debt.toLocaleString()} د.ع
                        </div>
                    `;
                    suggestion.onmouseover = function() { this.style.background = '#f5f5f5'; };
                    suggestion.onmouseout = function() { this.style.background = 'white'; };
                    suggestion.onclick = function() {
                        selectSupplierForPurchase(supplier.id);
                        suggestions.style.display = 'none';
                    };
                    suggestions.appendChild(suggestion);
                });
            }
            
            suggestions.style.display = 'block';
        };
        
        // اختيار مورد للشراء
        function selectSupplierForPurchase(supplierId) {
            selectedPurchaseSupplierId = supplierId;
            currentPurchaseSupplier = systemData.suppliers.find(s => s.id === supplierId);
            
            if (!currentPurchaseSupplier) return;
            
            document.getElementById('supplierSearchPurchase').value = currentPurchaseSupplier.name;
            
            // تحديث معلومات المورد
            document.getElementById('selectedSupplierName').textContent = currentPurchaseSupplier.name;
            document.getElementById('selectedSupplierPhone').textContent = currentPurchaseSupplier.phone;
            document.getElementById('selectedSupplierType').textContent = currentPurchaseSupplier.type || 'غير محدد';
            document.getElementById('selectedSupplierDebt').textContent = currentPurchaseSupplier.debt.toLocaleString();
            
            document.getElementById('selectedSupplierInfoPurchase').style.display = 'block';
            
            // تحديث خيارات الدفع
            setupPurchasePaymentOptions();
        };
        
        // إعداد خيارات الدفع للمشتريات
        function setupPurchasePaymentOptions() {
            const creditRadio = document.querySelector('input[name="purchasePaymentType"][value="credit"]');
            const cashRadio = document.querySelector('input[name="purchasePaymentType"][value="cash"]');
            const creditSection = document.getElementById('purchaseCreditSection');
            
            creditRadio.onchange = function() {
                if (this.checked) {
                    creditSection.style.display = 'block';
                    
                    // تعيين تاريخ الاستحقاق افتراضياً (30 يوم من الآن)
                    const dueDate = new Date();
                    dueDate.setDate(dueDate.getDate() + 30);
                    document.getElementById('purchaseDueDate').value = dueDate.toISOString().split('T')[0];
                }
            };
            
            cashRadio.onchange = function() {
                if (this.checked) {
                    creditSection.style.display = 'none';
                }
            };
            
            // تحديث طريقة الدفع في الملخص
            updatePurchasePaymentMethod();
        }
        
        // البحث عن منتجات للشراء
        window.searchProductsForPurchase = function() {
            const searchTerm = document.getElementById('productSearchPurchase').value.toLowerCase();
            const products = document.querySelectorAll('#purchaseProductsGrid .product-card');
            
            products.forEach(product => {
                const productName = product.querySelector('.product-name').textContent.toLowerCase();
                const productType = product.querySelector('.product-type').textContent.toLowerCase();
                
                if (productName.includes(searchTerm) || productType.includes(searchTerm)) {
                    product.style.display = 'block';
                } else {
                    product.style.display = 'none';
                }
            });
        };
        
        // تحديث قائمة المنتجات
        window.refreshProductsForPurchase = function() {
            loadProductsForPurchase();
            document.getElementById('productSearchPurchase').value = '';
        };
        
        // إضافة منتج إلى سلة الشراء
        window.addToPurchaseCart = function(productId) {
            const product = systemData.products.find(p => p.id === productId);
            if (!product) return;
            
            // التحقق إذا كان المنتج موجوداً بالفعل في السلة
            const existingItem = purchaseCart.find(item => item.productId === productId);
            
            if (existingItem) {
                // زيادة الكمية إذا المنتج موجود
                existingItem.quantity += 1;
            } else {
                // إضافة منتج جديد للسلة
                purchaseCart.push({
                    productId: productId,
                    name: product.name,
                    purchasePrice: product.purchasePrice,
                    salePrice: product.salePrice,
                    newSalePrice: product.salePrice, // سعر البيع الجديد (يمكن تعديله)
                    quantity: 1,
                    type: product.type,
                    currentStock: product.quantity
                });
            }
            
            updatePurchaseCartDisplay();
            updatePurchaseSummary();
        };
        
        // تحديث عرض سلة الشراء
        function updatePurchaseCartDisplay() {
            const cartItems = document.getElementById('purchaseCartItems');
            cartItems.innerHTML = '';
            
            if (purchaseCart.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="9" style="text-align: center; padding: 20px; color: #777;">
                        <i class="fas fa-shopping-cart" style="font-size: 30px; margin-bottom: 10px;"></i>
                        <p>سلة المشتريات فارغة</p>
                    </td>
                `;
                cartItems.appendChild(row);
                return;
            }
            
            purchaseCart.forEach((item, index) => {
                const product = systemData.products.find(p => p.id === item.productId);
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td><strong>${item.name}</strong></td>
                    <td>${item.type}</td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 5px;">
                            <button class="btn-small" onclick="updatePurchaseCartQuantity(${item.productId}, -1)" style="padding: 2px 8px; background: #ddd; border: none;">-</button>
                            <input type="number" value="${item.quantity}" min="1" style="width: 60px; text-align: center; padding: 5px; border: 1px solid #ddd; border-radius: 5px;" 
                                   onchange="changePurchaseQuantity(${item.productId}, this.value)">
                            <button class="btn-small" onclick="updatePurchaseCartQuantity(${item.productId}, 1)" style="padding: 2px 8px; background: #ddd; border: none;">+</button>
                        </div>
                    </td>
                    <td>
                        <input type="number" value="${item.purchasePrice}" min="0" style="width: 100px; text-align: center; padding: 5px; border: 1px solid #ddd; border-radius: 5px;" 
                               onchange="changePurchasePrice(${item.productId}, this.value)">
                        د.ع
                    </td>
                    <td style="color: #777;">
                        ${item.salePrice.toLocaleString()} د.ع
                    </td>
                    <td>
                        <input type="number" value="${item.newSalePrice}" min="0" style="width: 100px; text-align: center; padding: 5px; border: 1px solid #4CAF50; border-radius: 5px;" 
                               onchange="changeSalePrice(${item.productId}, this.value)">
                        د.ع
                    </td>
                    <td><strong>${(item.purchasePrice * item.quantity).toLocaleString()} د.ع</strong></td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-small btn-delete" onclick="removeFromPurchaseCart(${item.productId})" title="حذف">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                cartItems.appendChild(row);
            });
        }
        
        // تحديث كمية المنتج في سلة الشراء
        window.updatePurchaseCartQuantity = function(productId, change) {
            const item = purchaseCart.find(item => item.productId === productId);
            if (!item) return;
            
            const newQuantity = item.quantity + change;
            
            if (newQuantity <= 0) {
                removeFromPurchaseCart(productId);
            } else {
                item.quantity = newQuantity;
                updatePurchaseCartDisplay();
                updatePurchaseSummary();
            }
        };
        
        // تغيير كمية المنتج
        window.changePurchaseQuantity = function(productId, newQuantity) {
            const item = purchaseCart.find(item => item.productId === productId);
            if (!item) return;
            
            newQuantity = parseInt(newQuantity);
            if (isNaN(newQuantity) || newQuantity <= 0) {
                newQuantity = 1;
            }
            
            item.quantity = newQuantity;
            updatePurchaseCartDisplay();
            updatePurchaseSummary();
        };
        
        // تغيير سعر الشراء
        window.changePurchasePrice = function(productId, newPrice) {
            const item = purchaseCart.find(item => item.productId === productId);
            if (!item) return;
            
            newPrice = parseFloat(newPrice);
            if (isNaN(newPrice) || newPrice < 0) {
                newPrice = item.purchasePrice;
            }
            
            item.purchasePrice = newPrice;
            updatePurchaseCartDisplay();
            updatePurchaseSummary();
        };
        
        // تغيير سعر البيع
        window.changeSalePrice = function(productId, newPrice) {
            const item = purchaseCart.find(item => item.productId === productId);
            if (!item) return;
            
            newPrice = parseFloat(newPrice);
            if (isNaN(newPrice) || newPrice < 0) {
                newPrice = item.salePrice;
            }
            
            item.newSalePrice = newPrice;
            updatePurchaseCartDisplay();
        };
        
        // إزالة منتج من سلة الشراء
        window.removeFromPurchaseCart = function(productId) {
            if (confirm('هل تريد حذف هذا المنتج من سلة المشتريات؟')) {
                purchaseCart = purchaseCart.filter(item => item.productId !== productId);
                updatePurchaseCartDisplay();
                updatePurchaseSummary();
            }
        };
        
        // التبديل بين التبويبات
        window.switchTab = function(tabId) {
            // التحقق من البيانات قبل التبديل
            if (tabId === 'purchaseItemsTab') {
                if (!selectedPurchaseSupplierId) {
                    alert('الرجاء اختيار مورد أولاً');
                    return;
                }
            }
            
            if (tabId === 'purchaseSummaryTab') {
                if (purchaseCart.length === 0) {
                    alert('الرجاء إضافة منتجات للشراء أولاً');
                    return;
                }
            }
            
            // إخفاء جميع التبويبات
            document.querySelectorAll('#addPurchaseModal .tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // إزالة النشاط من جميع التبويبات
            document.querySelectorAll('#addPurchaseModal .tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // إظهار التبويب المحدد
            document.getElementById(tabId).classList.add('active');
            
            // تفعيل تبويب القائمة
            const tabName = tabId.replace('Tab', '');
            document.querySelector(`#addPurchaseModal .tab[data-tab="${tabName}"]`).classList.add('active');
            
            // تحديث الملخص إذا كنا في تبويب الملخص
            if (tabId === 'purchaseSummaryTab') {
                updatePurchaseSummaryInfo();
                updatePurchasePaymentMethod();
            }
        };
        
        // تحديث معلومات الملخص
        function updatePurchaseSummaryInfo() {
            const summaryDiv = document.getElementById('purchaseSummaryInfo');
            
            let supplierInfo = '';
            if (currentPurchaseSupplier) {
                supplierInfo = `
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
                        <div><strong>المورد:</strong> ${currentPurchaseSupplier.name}</div>
                        <div><strong>الهاتف:</strong> ${currentPurchaseSupplier.phone}</div>
                        <div><strong>النوع:</strong> ${currentPurchaseSupplier.type || 'غير محدد'}</div>
                        <div><strong>الديون قبل الشراء:</strong> ${currentPurchaseSupplier.debt.toLocaleString()} د.ع</div>
                    </div>
                `;
            }
            
            const paymentType = document.querySelector('input[name="purchasePaymentType"]:checked').value;
            const paymentInfo = paymentType === 'cash' ? 'نقداً' : 'بالدين';
            
            // حساب إجمالي الكميات
            const totalQuantity = purchaseCart.reduce((sum, item) => sum + item.quantity, 0);
            
            summaryDiv.innerHTML = `
                <div style="background: white; padding: 15px; border-radius: 8px; border: 1px solid #e0e0e0;">
                    ${supplierInfo}
                    <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee;">
                        <strong>طريقة الدفع:</strong> ${paymentInfo}<br>
                        <strong>عدد المنتجات:</strong> ${purchaseCart.length}<br>
                        <strong>إجمالي الكميات:</strong> ${totalQuantity}<br>
                        <strong>تاريخ الشراء:</strong> ${document.getElementById('purchaseDate').value}
                    </div>
                </div>
            `;
            
            // تحديث العناصر الأخرى
            document.getElementById('purchaseProductsCount').textContent = purchaseCart.length;
            document.getElementById('purchaseTotalQuantity').textContent = totalQuantity;
        }
        
        // تحديث طريقة الدفع في الملخص
        function updatePurchasePaymentMethod() {
            const paymentType = document.querySelector('input[name="purchasePaymentType"]:checked').value;
            const paymentText = paymentType === 'cash' ? 'نقداً' : 'بالدين';
            document.getElementById('purchasePaymentMethod').textContent = paymentText;
        }
        
        // تحديث ملخص الشراء
        function updatePurchaseSummary() {
            let subtotal = 0;
            
            purchaseCart.forEach(item => {
                subtotal += item.purchasePrice * item.quantity;
            });
            
            const discount = parseFloat(document.getElementById('purchaseDiscountInput').value) || 0;
            const total = subtotal - discount;
            
            document.getElementById('purchaseSubtotal').textContent = subtotal.toLocaleString() + ' د.ع';
            document.getElementById('purchaseTotalAmount').textContent = total.toLocaleString() + ' د.ع';
        }
        
        // إتمام عملية الشراء
        window.completePurchase = function() {
            if (!selectedPurchaseSupplierId) {
                alert('الرجاء اختيار مورد');
                switchTab('purchaseInfoTab');
                return;
            }
            
            if (purchaseCart.length === 0) {
                alert('الرجاء إضافة منتجات للشراء');
                switchTab('purchaseItemsTab');
                return;
            }
            
            // حساب الإجماليات
            let subtotal = 0;
            purchaseCart.forEach(item => {
                subtotal += item.purchasePrice * item.quantity;
            });
            
            const discount = parseFloat(document.getElementById('purchaseDiscountInput').value) || 0;
            const total = subtotal - discount;
            
            const paymentType = document.querySelector('input[name="purchasePaymentType"]:checked').value;
            const supplier = systemData.suppliers.find(s => s.id === selectedPurchaseSupplierId);
            
            if (!supplier) {
                alert('المورد غير موجود');
                return;
            }
            
            // تحديث بيانات المورد
            if (paymentType === 'credit') {
                // إذا كان الدفع بالدين، أضف المبلغ إلى ديوني للمورد
                supplier.debt += total;
                alert(`تم إضافة ${total.toLocaleString()} د.ع إلى ديون المورد ${supplier.name}\nإجمالي الديون الآن: ${supplier.debt.toLocaleString()} د.ع`);
            } else {
                // إذا كان الدفع نقداً، اخفض من إجمالي المبيعات في الداشبورد
                // سيتم التعامل مع هذا في تحديث الإحصائيات
            }
            
            // تحديث إجمالي مشتريات المورد
            supplier.totalPurchases += total;
            
            // تحديث المخزون وأسعار المنتجات
            purchaseCart.forEach(item => {
                const product = systemData.products.find(p => p.id === item.productId);
                if (product) {
                    // زيادة الكمية في المخزون
                    product.quantity += item.quantity;
                    
                    // تحديث سعر الشراء
                    product.purchasePrice = item.purchasePrice;
                    
                    // تحديث سعر البيع إذا تم تغييره
                    if (item.newSalePrice !== item.salePrice) {
                        product.salePrice = item.newSalePrice;
                    }
                }
            });
            
            // إنشاء فاتورة الشراء
            const purchase = {
                id: `PUR-${Date.now()}`,
                date: document.getElementById('purchaseDate').value || new Date().toISOString().split('T')[0],
                supplierId: selectedPurchaseSupplierId,
                supplierName: supplier.name,
                items: purchaseCart.map(item => ({
                    productId: item.productId,
                    name: item.name,
                    purchasePrice: item.purchasePrice,
                    salePrice: item.newSalePrice,
                    quantity: item.quantity,
                    type: item.type
                })),
                subtotal: subtotal,
                discount: discount,
                total: total,
                paymentType: paymentType,
                dueDate: paymentType === 'credit' ? document.getElementById('purchaseDueDate').value : null,
                notes: document.getElementById('purchaseNotes').value,
                creditNotes: paymentType === 'credit' ? document.getElementById('purchaseCreditNotes').value : null,
                status: 'مكتمل',
                createdAt: new Date().toISOString()
            };
            
            // إضافة فاتورة الشراء للنظام
            systemData.purchases.push(purchase);
            
            // حفظ البيانات
            saveSystemData();
            
            // تحديث جميع العروض
            loadInventory();
            loadSuppliers();
            loadPurchases();
            updateDashboardStats();
            
            // إغلاق النافذة
            closeModal('addPurchaseModal');
            
            // رسالة نجاح
            const successMessage = `
                تم إتمام عملية الشراء بنجاح!
                
                رقم الفاتورة: ${purchase.id}
                المورد: ${supplier.name}
                الإجمالي: ${total.toLocaleString()} د.ع
                طريقة الدفع: ${paymentType === 'cash' ? 'نقداً' : 'بالدين'}
                ${paymentType === 'credit' ? `الديون الجديدة: ${total.toLocaleString()} د.ع\nإجمالي ديون المورد الآن: ${supplier.debt.toLocaleString()} د.ع` : ''}
            `;
            
            alert(successMessage);
            
            // إذا كان الدفع نقداً، اعرض ملاحظة حول تأثيرها على الداشبورد
            if (paymentType === 'cash') {
                alert('ملاحظة: تم خصم قيمة الشراء النقدي من إجمالي المبيعات في لوحة التحكم');
            }
        };
        
        // ============================================
        // نظام العملاء والموردين
        // ============================================
        
        // فتح نافذة إضافة عميل جديد
        window.openAddCustomerModal = function() {
            // إعادة تعيين الحقول
            document.getElementById('addCustomerForm').reset();
            document.getElementById('newCustomerPreviousDebt').value = '0';
            
            // فتح النافذة
            openModal('addCustomerModal');
        };
        
        // فتح نافذة إضافة مورد جديد
        window.openAddSupplierModal = function() {
            // إعادة تعيين الحقول
            document.getElementById('addSupplierForm').reset();
            document.getElementById('newSupplierDebt').value = '0';
            document.getElementById('newSupplierType').value = 'مورد إلكترونيات';
            
            // فتح النافذة
            openModal('addSupplierModal');
        };
        
        // إضافة عميل جديد
        document.getElementById('addCustomerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // التحقق من البيانات
            const name = document.getElementById('newCustomerName').value.trim();
            const phone = document.getElementById('newCustomerPhone').value.trim();
            const email = document.getElementById('newCustomerEmail').value.trim();
            const address = document.getElementById('newCustomerAddress').value.trim();
            const previousDebt = parseFloat(document.getElementById('newCustomerPreviousDebt').value) || 0;
            const notes = document.getElementById('newCustomerNotes').value.trim();
            
            if (!name || !phone) {
                alert('الرجاء إدخال الاسم ورقم الهاتف');
                return;
            }
            
            // التحقق إذا كان العميل موجوداً بالفعل
            const existingCustomer = systemData.customers.find(c => 
                c.phone === phone || (email && c.email === email)
            );
            
            if (existingCustomer) {
                alert('العميل موجود بالفعل في النظام');
                return;
            }
            
            // إنشاء عميل جديد
            const newCustomer = {
                id: systemData.customers.length > 0 ? Math.max(...systemData.customers.map(c => c.id)) + 1 : 1,
                name: name,
                phone: phone,
                email: email || '',
                address: address || '',
                totalPurchases: 0,
                debt: previousDebt, // الديون السابقة
                previousDebt: previousDebt,
                notes: notes || '',
                createdAt: new Date().toISOString().split('T')[0],
                active: true
            };
            
            // إضافة العميل للنظام
            systemData.customers.push(newCustomer);
            
            // حفظ البيانات
            saveSystemData();
            
            // تحديث العرض
            loadCustomers();
            
            // إغلاق النافذة
            closeModal('addCustomerModal');
            
            // رسالة نجاح
            alert(`تم إضافة العميل "${name}" بنجاح!\n\nرقم الهاتف: ${phone}\nالديون السابقة: ${previousDebt.toLocaleString()} د.ع`);
        });
        
        // إضافة مورد جديد
        document.getElementById('addSupplierForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // التحقق من البيانات
            const name = document.getElementById('newSupplierName').value.trim();
            const phone = document.getElementById('newSupplierPhone').value.trim();
            const email = document.getElementById('newSupplierEmail').value.trim();
            const address = document.getElementById('newSupplierAddress').value.trim();
            const type = document.getElementById('newSupplierType').value;
            const debt = parseFloat(document.getElementById('newSupplierDebt').value) || 0;
            const notes = document.getElementById('newSupplierNotes').value.trim();
            
            if (!name || !phone) {
                alert('الرجاء إدخال اسم المورد ورقم الهاتف');
                return;
            }
            
            // التحقق إذا كان المورد موجوداً بالفعل
            const existingSupplier = systemData.suppliers.find(s => 
                s.phone === phone || (email && s.email === email)
            );
            
            if (existingSupplier) {
                alert('المورد موجود بالفعل في النظام');
                return;
            }
            
            // إنشاء مورد جديد
            const newSupplier = {
                id: systemData.suppliers.length > 0 ? Math.max(...systemData.suppliers.map(s => s.id)) + 1 : 1,
                name: name,
                phone: phone,
                email: email || '',
                address: address || '',
                type: type,
                totalPurchases: 0,
                debt: debt, // الديون التي أنا مدين بها للمورد
                previousDebt: debt,
                notes: notes || '',
                createdAt: new Date().toISOString().split('T')[0],
                active: true
            };
            
            // إضافة المورد للنظام
            systemData.suppliers.push(newSupplier);
            
            // حفظ البيانات
            saveSystemData();
            
            // تحديث العرض
            loadSuppliers();
            
            // إغلاق النافذة
            closeModal('addSupplierModal');
            
            // رسالة نجاح
            alert(`تم إضافة المورد "${name}" بنجاح!\n\nرقم الهاتف: ${phone}\nنوع المورد: ${type}\nالديون الحالية: ${debt.toLocaleString()} د.ع`);
        });
        
        // فتح نافذة إضافة مورد من خلال المشتريات
        window.openAddSupplierModalFromPurchase = function() {
            // إغلاق نافذة المشتريات أولاً
            closeModal('addPurchaseModal');
            
            // فتح نافذة إضافة مورد
            setTimeout(() => {
                openAddSupplierModal();
            }, 300);
        };
        
        // ============================================
        // النظام العام
        // ============================================
        
        // حفظ البيانات
        function saveSystemData() {
            localStorage.setItem('electronicsSalesSystem', JSON.stringify(systemData));
        }
        
        // تحميل البيانات المحفوظة
        function loadSavedData() {
            const savedData = localStorage.getItem('electronicsSalesSystem');
            if (savedData) {
                systemData = JSON.parse(savedData);
            }
        }
        
        // فتح نافذة منبثقة
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }
        
        // إغلاق نافذة منبثقة
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }
        
        // ============================================
        // دوال إضافية
        // ============================================
        
        // مسح الباركود
        window.scanBarcode = function() {
            alert('في التطبيق الفعلي، سيتم فتح كاميرا الجهاز لمسح الباركود');
        };
        
        // طباعة فاتورة صغيرة
        function printSmallInvoice() {
            if (cart.length === 0) {
                alert('لا توجد فاتورة للطباعة');
                return;
            }
            
            const printContent = `
                <div class="small-invoice">
                    <div style="text-align: center; margin-bottom: 15px;">
                        <h3>${systemData.settings.companyName}</h3>
                        <p>${systemData.settings.companyAddress}</p>
                        <p>${systemData.settings.companyPhone}</p>
                    </div>
                    
                    <div style="border-bottom: 1px dashed #000; margin-bottom: 15px; padding-bottom: 10px;">
                        <p><strong>رقم الفاتورة:</strong> INV-${Date.now()}</p>
                        <p><strong>التاريخ:</strong> ${new Date().toLocaleDateString('ar-EG')}</p>
                        <p><strong>الوقت:</strong> ${new Date().toLocaleTimeString('ar-EG')}</p>
                    </div>
                    
                    <table style="width: 100%; margin-bottom: 15px;">
                        <thead>
                            <tr>
                                <th style="text-align: right; border-bottom: 1px solid #000;">المنتج</th>
                                <th style="text-align: center; border-bottom: 1px solid #000;">الكمية</th>
                                <th style="text-align: left; border-bottom: 1px solid #000;">السعر</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${cart.map(item => `
                                <tr>
                                    <td style="text-align: right;">${item.name}</td>
                                    <td style="text-align: center;">${item.quantity}</td>
                                    <td style="text-align: left;">${item.price.toLocaleString()} د.ع</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    
                    <div style="border-top: 1px dashed #000; padding-top: 10px; margin-bottom: 15px;">
                        ${currentCustomerId ? `<p><strong>العميل:</strong> ${systemData.customers.find(c => c.id === currentCustomerId).name}</p>` : ''}
                        <p><strong>الإجمالي:</strong> ${document.getElementById('totalAmount').textContent}</p>
                    </div>
                    
                    <div style="text-align: center; font-size: 12px; color: #777;">
                        <p>${systemData.settings.invoiceFooter}</p>
                        <p>شكراً لتعاملكم معنا</p>
                    </div>
                </div>
            `;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>طباعة الفاتورة</title>
                        <style>
                            body { font-family: Arial, sans-serif; direction: rtl; }
                            @media print {
                                body { margin: 0; padding: 0; }
                            }
                        </style>
                    </head>
                    <body>
                        ${printContent}
                        <script>
                            window.onload = function() {
                                window.print();
                                setTimeout(function() {
                                    window.close();
                                }, 1000);
                            };
                        <\/script>
                    </body>
                </html>
            `);
            printWindow.document.close();
        }
        
        // تحميل النظام عند فتح الصفحة
        window.addEventListener('load', function() {
            // تحميل البيانات المحفوظة
            loadSavedData();
            
            // إخفاء النظام الرئيسي وإظهار صفحة الدخول
            mainSystem.style.display = 'none';
            loginPage.style.display = 'flex';
            
            // أنيميشن للبطاقات
            setTimeout(() => {
                document.querySelectorAll('.stat-card').forEach((card, index) => {
                    card.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                });
            }, 500);
        });
        
        // إغلاق النوافذ المنبثقة عند النقر خارجها
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('active');
                }
            });
        });
        
        // ============================================
        // دوال النسخ الاحتياطي والإعدادات
        // ============================================
        
        // تغيير كلمة المرور
        window.changePassword = function() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (currentPassword !== systemData.users[0].password) {
                alert('كلمة المرور الحالية غير صحيحة');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                alert('كلمة المرور الجديدة وتأكيدها غير متطابقتين');
                return;
            }
            
            systemData.users[0].password = newPassword;
            saveSystemData();
            alert('تم تغيير كلمة المرور بنجاح!');
        };
        
        // حفظ إعدادات الطباعة
        window.savePrintSettings = function() {
            systemData.settings.autoPrint = document.getElementById('autoPrint').checked;
            systemData.settings.showPrintOptions = document.getElementById('showPrintOptions').checked;
            systemData.settings.invoiceFooter = document.getElementById('invoiceFooter').value;
            
            saveSystemData();
            alert('تم حفظ إعدادات الطباعة بنجاح!');
        };
        
        // حفظ إعدادات المنتجات
        window.saveProductSettings = function() {
            systemData.settings.autoGenerateBarcode = document.getElementById('autoGenerateBarcode').checked;
            systemData.settings.autoSuggestColors = document.getElementById('autoSuggestColors').checked;
            systemData.settings.lowStockAlert = document.getElementById('lowStockAlert').checked;
            systemData.settings.lowStockThreshold = parseInt(document.getElementById('lowStockThreshold').value);
            
            saveSystemData();
            alert('تم حفظ إعدادات المنتجات بنجاح!');
        };
        
        // حفظ إعدادات الشركة
        window.saveCompanySettings = function() {
            systemData.settings.companyName = document.getElementById('companyName').value;
            systemData.settings.companyAddress = document.getElementById('companyAddress').value;
            systemData.settings.companyPhone = document.getElementById('companyPhone').value;
            
            saveSystemData();
            alert('تم حفظ معلومات الشركة بنجاح!');
        };
        
        // إنشاء نسخة احتياطية
        window.createBackup = function() {
            const dataStr = JSON.stringify(systemData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `backup-${new Date().toISOString().slice(0,10)}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            alert('تم إنشاء النسخة الاحتياطية بنجاح!');
        };
        
        // استعادة نسخة احتياطية
        window.restoreBackup = function() {
            const fileInput = document.getElementById('backupFile');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('الرجاء اختيار ملف النسخة الاحتياطية');
                return;
            }
            
            if (confirm('هل أنت متأكد من استعادة النسخة الاحتياطية؟ سيتم استبدال جميع البيانات الحالية.')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const restoredData = JSON.parse(e.target.result);
                        systemData = restoredData;
                        saveSystemData();
                        loadSystemData();
                        alert('تم استعادة النسخة الاحتياطية بنجاح!');
                    } catch (error) {
                        alert('خطأ في ملف النسخة الاحتياطية: ' + error.message);
                    }
                };
                reader.readAsText(file);
            }
        };
        
        // ============================================
        // دوال البحث
        // ============================================
        
        // البحث في المخزون
        window.searchInventory = function() {
            const searchTerm = document.getElementById('inventorySearch').value.toLowerCase();
            const rows = document.querySelectorAll('#inventoryTable tbody tr');
            
            rows.forEach(row => {
                const productName = row.cells[1].textContent.toLowerCase();
                const productType = row.cells[6].textContent.toLowerCase();
                
                if (productName.includes(searchTerm) || productType.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        };
        
        // البحث في قائمة العملاء
        window.searchCustomerList = function() {
            const searchTerm = document.getElementById('customerListSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#customersTable tbody tr');
            
            rows.forEach(row => {
                const customerName = row.cells[1].textContent.toLowerCase();
                const customerPhone = row.cells[2].textContent.toLowerCase();
                
                if (customerName.includes(searchTerm) || customerPhone.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        };
        
        // البحث في الموردين
        window.searchSuppliers = function() {
            const searchTerm = document.getElementById('supplierSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#suppliersTable tbody tr');
            
            rows.forEach(row => {
                const supplierName = row.cells[1].textContent.toLowerCase();
                const supplierPhone = row.cells[2].textContent.toLowerCase();
                
                if (supplierName.includes(searchTerm) || supplierPhone.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        };
        
        // البحث في الفواتير
        window.searchInvoices = function() {
            const searchTerm = document.getElementById('invoiceSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#invoicesTable tbody tr');
            
            rows.forEach(row => {
                const invoiceId = row.cells[0].textContent.toLowerCase();
                const customerName = row.cells[2].textContent.toLowerCase();
                
                if (invoiceId.includes(searchTerm) || customerName.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        };
        
        // البحث في فواتير الشراء
        window.searchPurchaseInvoices = function() {
            const searchTerm = document.getElementById('purchaseSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#purchasesTable tbody tr');
            
            rows.forEach(row => {
                const invoiceId = row.cells[0].textContent.toLowerCase();
                const supplierName = row.cells[2].textContent.toLowerCase();
                
                if (invoiceId.includes(searchTerm) || supplierName.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        };
        
        // ============================================
        // دوال إضافية للمنتجات
        // ============================================
        
        // فتح نافذة إضافة منتج
        window.openAddProductModal = function() {
            document.getElementById('addProductForm').reset();
            openModal('addProductModal');
        };
        
        // توليد باركود
        window.generateBarcode = function() {
            const barcode = Math.floor(100000000000 + Math.random() * 900000000000).toString();
            document.getElementById('productBarcode').value = barcode;
        };
        
        // إضافة منتج جديد
        document.getElementById('addProductForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const newProduct = {
                id: systemData.products.length + 1,
                name: document.getElementById('productName').value,
                purchasePrice: parseFloat(document.getElementById('purchasePrice').value),
                salePrice: parseFloat(document.getElementById('salePrice').value),
                quantity: parseInt(document.getElementById('productQuantity').value),
                type: document.getElementById('productType').value,
                color: document.getElementById('productColor').value || '#000000',
                barcode: document.getElementById('productBarcode').value || Math.floor(100000000000 + Math.random() * 900000000000).toString(),
                image: 'box' // افتراضي
            };
            
            // إضافة اللون الجديد إلى الاقتراحات إذا لم يكن موجوداً
            if (newProduct.color && !systemData.colorSuggestions.includes(newProduct.color)) {
                systemData.colorSuggestions.push(newProduct.color);
            }
            
            systemData.products.push(newProduct);
            saveSystemData();
            
            // تحديث العرض
            loadProducts();
            loadInventory();
            loadColorSuggestions();
            
            closeModal('addProductModal');
            alert('تم إضافة المنتج بنجاح!');
        });
        
        // تعديل منتج
        window.editProduct = function(productId) {
            const product = systemData.products.find(p => p.id === productId);
            if (!product) return;
            
            // فتح نافذة التعديل
            document.getElementById('productName').value = product.name;
            document.getElementById('purchasePrice').value = product.purchasePrice;
            document.getElementById('salePrice').value = product.salePrice;
            document.getElementById('productQuantity').value = product.quantity;
            document.getElementById('productType').value = product.type;
            document.getElementById('productColor').value = product.color;
            document.getElementById('productBarcode').value = product.barcode;
            
            // تغيير النص على الزر
            const submitBtn = document.querySelector('#addProductForm button[type="submit"]');
            submitBtn.textContent = 'تحديث المنتج';
            submitBtn.onclick = function(e) {
                e.preventDefault();
                updateProduct(productId);
            };
            
            openModal('addProductModal');
        };
        
        // تحديث المنتج
        function updateProduct(productId) {
            const productIndex = systemData.products.findIndex(p => p.id === productId);
            if (productIndex === -1) return;
            
            systemData.products[productIndex] = {
                ...systemData.products[productIndex],
                name: document.getElementById('productName').value,
                purchasePrice: parseFloat(document.getElementById('purchasePrice').value),
                salePrice: parseFloat(document.getElementById('salePrice').value),
                quantity: parseInt(document.getElementById('productQuantity').value),
                type: document.getElementById('productType').value,
                color: document.getElementById('productColor').value || '#000000',
                barcode: document.getElementById('productBarcode').value
            };
            
            saveSystemData();
            
            // تحديث العرض
            loadProducts();
            loadInventory();
            
            closeModal('addProductModal');
            alert('تم تحديث المنتج بنجاح!');
        };
        
        // حذف منتج
        window.deleteProduct = function(productId) {
            if (confirm('هل أنت متأكد من حذف هذا المنتج؟')) {
                systemData.products = systemData.products.filter(p => p.id !== productId);
                saveSystemData();
                
                loadProducts();
                loadInventory();
                alert('تم حذف المنتج بنجاح!');
            }
        };
        
        // ============================================
        // دوال إضافية للعملاء والموردين
        // ============================================
        
        // تعديل عميل
        window.editCustomer = function(customerId) {
            const customer = systemData.customers.find(c => c.id === customerId);
            if (!customer) return;
            
            const newName = prompt('الاسم الجديد:', customer.name);
            if (!newName || newName.trim() === '') {
                alert('الاسم مطلوب');
                return;
            }
            
            const newPhone = prompt('رقم الهاتف الجديد:', customer.phone);
            if (!newPhone || newPhone.trim() === '') {
                alert('رقم الهاتف مطلوب');
                return;
            }
            
            const newDebt = prompt('الديون الحالية:', customer.debt.toString());
            const debtValue = parseFloat(newDebt) || 0;
            
            // تحديث بيانات العميل
            customer.name = newName.trim();
            customer.phone = newPhone.trim();
            customer.debt = debtValue;
            
            // حفظ البيانات
            saveSystemData();
            
            // تحديث العرض
            loadCustomers();
            
            alert('تم تحديث بيانات العميل بنجاح!');
        };
        
        // حذف عميل
        window.deleteCustomer = function(customerId) {
            const customer = systemData.customers.find(c => c.id === customerId);
            if (!customer) return;
            
            if (confirm(`هل أنت متأكد من حذف العميل "${customer.name}"؟\n\nرقم الهاتف: ${customer.phone}\nالديون الحالية: ${customer.debt.toLocaleString()} د.ع`)) {
                // التحقق إذا كان للعميل ديون
                if (customer.debt > 0) {
                    if (!confirm('هذا العميل لديه ديون. هل تريد المتابعة مع الحذف؟')) {
                        return;
                    }
                }
                
                systemData.customers = systemData.customers.filter(c => c.id !== customerId);
                saveSystemData();
                loadCustomers();
                alert('تم حذف العميل بنجاح!');
            }
        };
        
        // تعديل مورد
        window.editSupplier = function(supplierId) {
            const supplier = systemData.suppliers.find(s => s.id === supplierId);
            if (!supplier) return;
            
            const newName = prompt('اسم المورد الجديد:', supplier.name);
            if (!newName || newName.trim() === '') {
                alert('اسم المورد مطلوب');
                return;
            }
            
            const newPhone = prompt('رقم الهاتف الجديد:', supplier.phone);
            if (!newPhone || newPhone.trim() === '') {
                alert('رقم الهاتف مطلوب');
                return;
            }
            
            const newType = prompt('نوع المورد الجديد:', supplier.type);
            const newDebt = prompt('الديون الحالية:', supplier.debt.toString());
            const debtValue = parseFloat(newDebt) || 0;
            
            // تحديث بيانات المورد
            supplier.name = newName.trim();
            supplier.phone = newPhone.trim();
            supplier.type = newType ? newType.trim() : supplier.type;
            supplier.debt = debtValue;
            
            // حفظ البيانات
            saveSystemData();
            
            // تحديث العرض
            loadSuppliers();
            
            alert('تم تحديث بيانات المورد بنجاح!');
        };
        
        // حذف مورد
        window.deleteSupplier = function(supplierId) {
            const supplier = systemData.suppliers.find(s => s.id === supplierId);
            if (!supplier) return;
            
            if (confirm(`هل أنت متأكد من حذف المورد "${supplier.name}"؟\n\nرقم الهاتف: ${supplier.phone}\nالديون الحالية: ${supplier.debt.toLocaleString()} د.ع`)) {
                // التحقق إذا كان هناك ديون للمورد
                if (supplier.debt > 0) {
                    if (!confirm('هناك ديون لهذا المورد. هل تريد المتابعة مع الحذف؟')) {
                        return;
                    }
                }
                
                systemData.suppliers = systemData.suppliers.filter(s => s.id !== supplierId);
                saveSystemData();
                loadSuppliers();
                alert('تم حذف المورد بنجاح!');
            }
        };
        
        // ============================================
        // دوال الفواتير والمشتريات
        // ============================================
        
        // تصدير الفواتير
        window.exportInvoices = function() {
            const dataStr = JSON.stringify(systemData.invoices, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `invoices-${new Date().toISOString().slice(0,10)}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        };
        
        // عرض الفاتورة
        window.viewInvoice = function(invoiceId) {
            const invoice = systemData.invoices.find(inv => inv.id === invoiceId);
            if (!invoice) return;
            
            alert(`عرض الفاتورة ${invoiceId}\n\nفي التطبيق الكامل، سيتم عرض تفاصيل الفاتورة الكاملة.`);
        };
        
        // طباعة الفاتورة
        window.printInvoice = function(invoiceId) {
            const invoice = systemData.invoices.find(inv => inv.id === invoiceId);
            if (!invoice) return;
            
            alert(`طباعة الفاتورة ${invoiceId}\n\nفي التطبيق الكامل، سيتم فتح نافذة الطباعة.`);
        };
        
        // حذف الفاتورة
        window.deleteInvoice = function(invoiceId) {
            if (confirm('هل أنت متأكد من حذف هذه الفاتورة؟')) {
                systemData.invoices = systemData.invoices.filter(inv => inv.id !== invoiceId);
                saveSystemData();
                loadInvoices();
                loadRecentInvoices();
                alert('تم حذف الفاتورة بنجاح!');
            }
        };
        
        // عرض فاتورة شراء
        window.viewPurchase = function(purchaseId) {
            const purchase = systemData.purchases.find(p => p.id === purchaseId);
            if (!purchase) {
                alert('فاتورة الشراء غير موجودة');
                return;
            }
            
            const supplier = systemData.suppliers.find(s => s.id === purchase.supplierId);
            
            let itemsHTML = '';
            purchase.items.forEach((item, index) => {
                itemsHTML += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${item.name}</td>
                        <td>${item.type}</td>
                        <td>${item.quantity}</td>
                        <td>${item.purchasePrice.toLocaleString()} د.ع</td>
                        <td>${(item.purchasePrice * item.quantity).toLocaleString()} د.ع</td>
                    </tr>
                `;
            });
            
            const modalContent = `
                <div class="modal-content" style="max-width: 800px;">
                    <div class="modal-header">
                        <h3><i class="fas fa-file-invoice"></i> فاتورة شراء #${purchase.id}</h3>
                        <button class="close-modal" onclick="closeModal('viewPurchaseModal')">&times;</button>
                    </div>
                    
                    <div style="padding: 20px;">
                        <div style="background: #f9f9f9; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                <div>
                                    <h4>معلومات الفاتورة</h4>
                                    <p><strong>رقم الفاتورة:</strong> ${purchase.id}</p>
                                    <p><strong>التاريخ:</strong> ${purchase.date}</p>
                                    <p><strong>طريقة الدفع:</strong> ${purchase.paymentType === 'cash' ? 'نقداً' : 'بالدين'}</p>
                                    ${purchase.dueDate ? `<p><strong>تاريخ الاستحقاق:</strong> ${purchase.dueDate}</p>` : ''}
                                </div>
                                <div>
                                    <h4>معلومات المورد</h4>
                                    <p><strong>الاسم:</strong> ${supplier?.name || 'غير معروف'}</p>
                                    <p><strong>الهاتف:</strong> ${supplier?.phone || '-'}</p>
                                    <p><strong>النوع:</strong> ${supplier?.type || '-'}</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="table-container">
                            <h4>المنتجات المشتراة</h4>
                            <table style="width: 100%;">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>المنتج</th>
                                        <th>النوع</th>
                                        <th>الكمية</th>
                                        <th>سعر الشراء</th>
                                        <th>الإجمالي</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${itemsHTML}
                                </tbody>
                            </table>
                        </div>
                        
                        <div style="background: #fff8e1; padding: 20px; border-radius: 10px; margin-top: 20px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span>إجمالي المنتجات:</span>
                                <span>${purchase.subtotal.toLocaleString()} د.ع</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span>الخصم:</span>
                                <span>${purchase.discount.toLocaleString()} د.ع</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-top: 15px; padding-top: 15px; border-top: 2px solid #ddd; font-size: 18px; font-weight: bold;">
                                <span>الإجمالي النهائي:</span>
                                <span>${purchase.total.toLocaleString()} د.ع</span>
                            </div>
                        </div>
                        
                        ${purchase.notes ? `
                            <div style="margin-top: 20px; padding: 15px; background: #f0f8ff; border-radius: 10px;">
                                <h4>ملاحظات:</h4>
                                <p>${purchase.notes}</p>
                            </div>
                        ` : ''}
                        
                        <div style="display: flex; gap: 10px; margin-top: 20px;">
                            <button class="btn btn-print" onclick="printPurchase('${purchaseId}')" style="flex: 1;">
                                <i class="fas fa-print"></i> طباعة الفاتورة
                            </button>
                            <button class="btn btn-danger" onclick="deletePurchase('${purchaseId}')" style="flex: 1;">
                                <i class="fas fa-trash"></i> حذف الفاتورة
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            // إنشاء نافذة عرض ديناميكية
            const modalDiv = document.createElement('div');
            modalDiv.className = 'modal active';
            modalDiv.id = 'viewPurchaseModal';
            modalDiv.innerHTML = modalContent;
            document.body.appendChild(modalDiv);
            
            // إضافة حدث لإغلاق النافذة عند النقر خارجها
            modalDiv.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.remove();
                }
            });
        };
        
        // طباعة فاتورة شراء
        window.printPurchase = function(purchaseId) {
            const purchase = systemData.purchases.find(p => p.id === purchaseId);
            if (!purchase) return;
            
            const supplier = systemData.suppliers.find(s => s.id === purchase.supplierId);
            
            let itemsHTML = '';
            purchase.items.forEach((item, index) => {
                itemsHTML += `
                    <tr>
                        <td style="padding: 8px; border: 1px solid #ddd;">${index + 1}</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">${item.name}</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">${item.quantity}</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">${item.purchasePrice.toLocaleString()} د.ع</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">${(item.purchasePrice * item.quantity).toLocaleString()} د.ع</td>
                    </tr>
                `;
            });
            
            const printContent = `
                <html>
                    <head>
                        <title>فاتورة شراء #${purchase.id}</title>
                        <style>
                            body { font-family: Arial, sans-serif; direction: rtl; margin: 20px; }
                            .header { text-align: center; margin-bottom: 30px; }
                            .info { display: flex; justify-content: space-between; margin-bottom: 30px; }
                            table { width: 100%; border-collapse: collapse; margin-bottom: 30px; }
                            th { background: #f5f5f5; padding: 10px; border: 1px solid #ddd; }
                            .total { background: #fff8e1; padding: 20px; border-radius: 10px; }
                            @media print {
                                body { margin: 0; padding: 10mm; }
                                .no-print { display: none; }
                            }
                        </style>
                    </head>
                    <body>
                        <div class="header">
                            <h2>${systemData.settings.companyName}</h2>
                            <h3>فاتورة شراء</h3>
                        </div>
                        
                        <div class="info">
                            <div>
                                <p><strong>رقم الفاتورة:</strong> ${purchase.id}</p>
                                <p><strong>التاريخ:</strong> ${purchase.date}</p>
                                <p><strong>طريقة الدفع:</strong> ${purchase.paymentType === 'cash' ? 'نقداً' : 'بالدين'}</p>
                            </div>
                            <div>
                                <p><strong>المورد:</strong> ${supplier?.name || 'غير معروف'}</p>
                                <p><strong>الهاتف:</strong> ${supplier?.phone || '-'}</p>
                            </div>
                        </div>
                        
                        <table>
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>المنتج</th>
                                    <th>الكمية</th>
                                    <th>سعر الشراء</th>
                                    <th>الإجمالي</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${itemsHTML}
                            </tbody>
                        </table>
                        
                        <div class="total">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span>إجمالي المنتجات:</span>
                                <span>${purchase.subtotal.toLocaleString()} د.ع</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span>الخصم:</span>
                                <span>${purchase.discount.toLocaleString()} د.ع</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-top: 15px; padding-top: 15px; border-top: 2px solid #ddd; font-size: 18px; font-weight: bold;">
                                <span>الإجمالي النهائي:</span>
                                <span>${purchase.total.toLocaleString()} د.ع</span>
                            </div>
                        </div>
                        
                        <div class="no-print" style="text-align: center; margin-top: 30px;">
                            <button onclick="window.print()" style="padding: 10px 20px; background: #4361ee; color: white; border: none; border-radius: 5px; cursor: pointer;">
                                طباعة الفاتورة
                            </button>
                        </div>
                        
                        <script>
                            window.onload = function() {
                                window.print();
                            };
                        </script>
                    </body>
                </html>
            `;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(printContent);
            printWindow.document.close();
        };
        
        // حذف فاتورة شراء
        window.deletePurchase = function(purchaseId) {
            const purchase = systemData.purchases.find(p => p.id === purchaseId);
            if (!purchase) return;
            
            if (!confirm(`هل أنت متأكد من حذف فاتورة الشراء #${purchaseId}؟\n\nهذا الإجراء لا يمكن التراجع عنه!`)) {
                return;
            }
            
            // إزالة الفاتورة
            systemData.purchases = systemData.purchases.filter(p => p.id !== purchaseId);
            
            // تحديث البيانات
            saveSystemData();
            loadPurchases();
            updateDashboardStats();
            
            // إغلاق نافذة العرض إذا كانت مفتوحة
            const viewModal = document.getElementById('viewPurchaseModal');
            if (viewModal) {
                viewModal.remove();
            }
            
            alert('تم حذف فاتورة الشراء بنجاح!');
        };
        
        // ============================================
        // دوال إضافية
        // ============================================
        
        // فتح نافذة طباعة الباركود
        window.openPrintBarcodeModal = function(productId) {
            const product = systemData.products.find(p => p.id === productId);
            if (!product) return;
            
            const barcodeContent = document.getElementById('barcodePrintContent');
            barcodeContent.innerHTML = `
                <h3>${product.name}</h3>
                <p>النوع: ${product.type}</p>
                <p>السعر: ${product.salePrice.toLocaleString()} د.ع</p>
                <div class="barcode">
                    ${product.barcode}
                </div>
                <p>باركود: ${product.barcode}</p>
            `;
            
            openModal('printBarcodeModal');
        };
        
        // طباعة الباركود فقط
        function printBarcodeOnly() {
            const printContent = document.getElementById('barcodePrintContent').innerHTML;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>طباعة الباركود</title>
                        <style>
                            body { 
                                font-family: Arial, sans-serif; 
                                direction: rtl; 
                                text-align: center;
                                margin: 0;
                                padding: 20px;
                            }
                            .barcode {
                                font-family: monospace;
                                font-size: 24px;
                                letter-spacing: 2px;
                                padding: 20px;
                                border: 1px solid #000;
                                margin: 20px auto;
                                width: 300px;
                            }
                        </style>
                    </head>
                    <body>
                        ${printContent}
                        <script>
                            window.onload = function() {
                                window.print();
                                setTimeout(function() {
                                    window.close();
                                }, 1000);
                            };
                        <\/script>
                    </body>
                </html>
            `);
            printWindow.document.close();
        };
        
        // تحديث إحصائيات الداشبورد
        function updateDashboardStats() {
            // حساب إجمالي المشتريات النقدية لهذا اليوم
            const today = new Date().toISOString().split('T')[0];
            const todayCashPurchases = systemData.purchases
                .filter(p => p.date === today && p.paymentType === 'cash')
                .reduce((sum, p) => sum + p.total, 0);
            
            // حساب إجمالي المشتريات النقدية لهذا الشهر
            const currentMonth = new Date().getMonth() + 1;
            const currentYear = new Date().getFullYear();
            const monthlyCashPurchases = systemData.purchases
                .filter(p => {
                    const purchaseDate = new Date(p.date);
                    return purchaseDate.getMonth() + 1 === currentMonth && 
                           purchaseDate.getFullYear() === currentYear &&
                           p.paymentType === 'cash';
                })
                .reduce((sum, p) => sum + p.total, 0);
            
            // تحديث الإحصائيات في الداشبورد
            console.log(`المشتريات النقدية اليوم: ${todayCashPurchases.toLocaleString()} د.ع`);
            console.log(`المشتريات النقدية الشهرية: ${monthlyCashPurchases.toLocaleString()} د.ع`);
            
            // تحديث الإحصائيات في الجداول
            updateDashboardTables();
        }
        
        // تحديث جداول الداشبورد
        function updateDashboardTables() {
            // هذا المثال يظهر كيفية تحديث الإحصائيات
            // يمكنك تعديله حسب احتياجاتك
            const monthlyPurchaseElement = document.querySelector('.stat-card:nth-child(2) .stat-value');
            if (monthlyPurchaseElement) {
                const currentMonth = new Date().getMonth() + 1;
                const currentYear = new Date().getFullYear();
                const monthlyPurchases = systemData.purchases
                    .filter(p => {
                        const purchaseDate = new Date(p.date);
                        return purchaseDate.getMonth() + 1 === currentMonth && 
                               purchaseDate.getFullYear() === currentYear;
                    })
                    .reduce((sum, p) => sum + p.total, 0);
                
                monthlyPurchaseElement.innerHTML = `${monthlyPurchases.toLocaleString()} <span style="font-size: 16px;">د.ع</span>`;
            }
        }
        
        // ============================================
        // دوال التقارير
        // ============================================
        
        // توليد تقرير
        window.generateReport = function() {
            const reportType = document.getElementById('reportType').value;
            const reportDate = document.getElementById('reportDate').value;
            
            let reportContent = '';
            
            switch(reportType) {
                case 'daily':
                    reportContent = '<h3>تقرير المبيعات اليومي</h3>';
                    break;
                case 'weekly':
                    reportContent = '<h3>تقرير المبيعات الأسبوعي</h3>';
                    break;
                case 'monthly':
                    reportContent = '<h3>تقرير المبيعات الشهري</h3>';
                    break;
                case 'yearly':
                    reportContent = '<h3>تقرير المبيعات السنوي</h3>';
                    break;
            }
            
            // إضافة إحصائيات وهمية
            reportContent += `
                <div class="stats-cards" style="margin-top: 20px;">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-shopping-bag"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-title">إجمالي المبيعات</div>
                            <div class="stat-value">125,750 <span style="font-size: 16px;">د.ع</span></div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-cart-arrow-down"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-title">إجمالي المشتريات</div>
                            <div class="stat-value">89,500 <span style="font-size: 16px;">د.ع</span></div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-title">صافي الربح</div>
                            <div class="stat-value">36,250 <span style="font-size: 16px;">د.ع</span></div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('reportResults').innerHTML = reportContent;
        };
        
        // طباعة التقرير
        window.printReport = function() {
            const reportContent = document.getElementById('reportResults').innerHTML;
            
            if (!reportContent) {
                alert('الرجاء توليد التقرير أولاً');
                return;
            }
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>طباعة التقرير</title>
                        <style>
                            body { 
                                font-family: Arial, sans-serif; 
                                direction: rtl; 
                                padding: 20px;
                            }
                        </style>
                    </head>
                    <body>
                        ${reportContent}
                        <script>
                            window.onload = function() {
                                window.print();
                                setTimeout(function() {
                                    window.close();
                                }, 1000);
                            };
                        <\/script>
                    </body>
                </html>
            `);
            printWindow.document.close();
        };
        
        // ============================================
        // دوال أخرى
        // ============================================
        
        // فتح نافذة إضافة دفعة عميل
        window.openAddCustomerPaymentModal = function() {
            alert('في التطبيق الكامل، سيتم فتح نافذة لإضافة دفعة عميل');
        };
        
        // فتح نافذة إضافة دفعة مورد
        window.openAddSupplierPaymentModal = function() {
            alert('في التطبيق الكامل، سيتم فتح نافذة لإضافة دفعة مورد');
        };
        
        // فتح نافذة إضافة مصروف
        window.openAddExpenseModal = function() {
            alert('في التطبيق الكامل، سيتم فتح نافذة لإضافة مصروف');
        };
        
        // فتح نافذة إضافة مستخدم
        window.openAddUserModal = function() {
            alert('في التطبيق الكامل، سيتم فتح نافذة لإضافة مستخدم جديد');
        };
        
        // فتح نافذة إضافة صلاحية
        window.openAddRoleModal = function() {
            alert('في التطبيق الكامل، سيتم فتح نافذة لإضافة صلاحية جديدة');
        };
        
        // فتح نافذة تفاصيل العميل
        window.openCustomerDetailsModal = function(customerId) {
            const customer = systemData.customers.find(c => c.id === customerId);
            if (!customer) return;
            
            // تحميل معلومات العميل
            document.getElementById('customerInfoTab').innerHTML = `
                <div style="padding: 20px;">
                    <h4>معلومات العميل</h4>
                    <div class="form-group">
                        <label>الاسم الكامل</label>
                        <input type="text" class="form-control" value="${customer.name}" readonly>
                    </div>
                    <div class="form-group">
                        <label>رقم الهاتف</label>
                        <input type="text" class="form-control" value="${customer.phone}" readonly>
                    </div>
                    <div class="form-group">
                        <label>البريد الإلكتروني</label>
                        <input type="email" class="form-control" value="${customer.email}" readonly>
                    </div>
                    <div class="form-group">
                        <label>العنوان</label>
                        <textarea class="form-control" readonly>${customer.address}</textarea>
                    </div>
                    <div class="form-group">
                        <label>إجمالي المشتريات</label>
                        <input type="text" class="form-control" value="${customer.totalPurchases.toLocaleString()} د.ع" readonly>
                    </div>
                    <div class="form-group">
                        <label>الديون الحالية</label>
                        <input type="text" class="form-control" value="${customer.debt.toLocaleString()} د.ع" readonly>
                    </div>
                </div>
            `;
            
            // تحميل فواتير العميل
            const customerInvoices = systemData.invoices.filter(inv => inv.customerId === customerId);
            document.getElementById('customerInvoicesTab').innerHTML = `
                <div style="padding: 20px;">
                    <h4>فواتير العميل</h4>
                    ${customerInvoices.length > 0 ? `
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="background: #f5f5f5;">
                                    <th style="padding: 10px; border: 1px solid #ddd;">رقم الفاتورة</th>
                                    <th style="padding: 10px; border: 1px solid #ddd;">التاريخ</th>
                                    <th style="padding: 10px; border: 1px solid #ddd;">الإجمالي</th>
                                    <th style="padding: 10px; border: 1px solid #ddd;">طريقة الدفع</th>
                                    <th style="padding: 10px; border: 1px solid #ddd;">الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${customerInvoices.map(invoice => `
                                    <tr>
                                        <td style="padding: 10px; border: 1px solid #ddd;">${invoice.id}</td>
                                        <td style="padding: 10px; border: 1px solid #ddd;">${invoice.date}</td>
                                        <td style="padding: 10px; border: 1px solid #ddd;">${invoice.total.toLocaleString()} د.ع</td>
                                        <td style="padding: 10px; border: 1px solid #ddd;">${invoice.paymentType === 'cash' ? 'نقداً' : 'بالدين'}</td>
                                        <td style="padding: 10px; border: 1px solid #ddd;">
                                            <button class="btn-small btn-view" onclick="viewInvoice('${invoice.id}')"><i class="fas fa-eye"></i></button>
                                            <button class="btn-small btn-print" onclick="printInvoice('${invoice.id}')"><i class="fas fa-print"></i></button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    ` : '<p>لا توجد فواتير لهذا العميل</p>'}
                </div>
            `;
            
            openModal('customerDetailsModal');
        };
        
        // فتح نافذة تفاصيل المورد
        window.openSupplierDetailsModal = function(supplierId) {
            const supplier = systemData.suppliers.find(s => s.id === supplierId);
            if (!supplier) return;
            
            // تحميل معلومات المورد
            document.getElementById('supplierInfoTab').innerHTML = `
                <div style="padding: 20px;">
                    <h4>معلومات المورد</h4>
                    <div class="form-group">
                        <label>اسم المورد</label>
                        <input type="text" class="form-control" value="${supplier.name}" readonly>
                    </div>
                    <div class="form-group">
                        <label>رقم الهاتف</label>
                        <input type="text" class="form-control" value="${supplier.phone}" readonly>
                    </div>
                    <div class="form-group">
                        <label>البريد الإلكتروني</label>
                        <input type="email" class="form-control" value="${supplier.email}" readonly>
                    </div>
                    <div class="form-group">
                        <label>العنوان</label>
                        <textarea class="form-control" readonly>${supplier.address}</textarea>
                    </div>
                    <div class="form-group">
                        <label>إجمالي المشتريات</label>
                        <input type="text" class="form-control" value="${supplier.totalPurchases.toLocaleString()} د.ع" readonly>
                    </div>
                    <div class="form-group">
                        <label>الديون الحالية</label>
                        <input type="text" class="form-control" value="${supplier.debt.toLocaleString()} د.ع" readonly>
                    </div>
                </div>
            `;
            
            openModal('supplierDetailsModal');
        };
    </script>
</body>
</html>